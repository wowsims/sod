import{x as e,aq as t,ar as s,bf as i,bg as a,bh as n,t as o,e as l,A as r,bi as c,Z as d,T as m,as as h,S as u,b3 as p,bj as g,bk as f,bl as I,bm as w,bn as v,bo as b,bp as S,aU as x,bq as y,br as E,bs as P,f as k,J as C,bt as L,bu as T,bv as N,bw as A,bx as R,by as _,D,o as M,Q as V,at as U,bz as W,C as F,bA as O,y as H,bB as q,bC as B,a as z,I as j,bD as $,P as G,bE as K,bF as J,bG as Z,bH as Y,bI as Q,bJ as X,bK as ee,bL as te,bM as se,bN as ie,bO as ae,bP as ne,bQ as oe,a9 as le,bR as re,bS as ce,a2 as de,bT as me,bU as he,aE as ue,aJ as pe,E as ge,bV as fe,bW as Ie,ab as we,al as ve,am as be,ap as Se,bX as xe,bY as ye,bZ as Ee,b_ as Pe,b$ as ke,U as Ce,c0 as Le,s as Te,c1 as Ne,c2 as Ae,c3 as Re,b as _e,c4 as De,c5 as Me,c6 as Ve,c7 as Ue,c8 as We,c9 as Fe,ca as Oe,cb as He,cc as qe,cd as Be,ce as ze,cf as je,cg as $e,ch as Ge,ci as Ke,cj as Je,ck as Ze,cl as Ye,cm as Qe,cn as Xe,co as et,cp as tt,cq as st,cr as it,cs as at,ct as nt,cu as ot,cv as lt,cw as rt,cx as ct,cy as dt,cz as mt,cA as ht,cB as ut,cC as pt,cD as gt,cE as ft,cF as It,cG as wt,cH as vt,cI as bt,cJ as St,cK as xt,cL as yt,cM as Et,cN as Pt,cO as kt,cP as Ct,cQ as Lt,cR as Tt,cS as Nt,cT as At,cU as Rt,cV as _t,cW as Dt,cX as Mt,cY as Vt,cZ as Ut,c_ as Wt,c$ as Ft,d0 as Ot,d1 as Ht,d2 as qt,d3 as Bt,d4 as zt,d5 as jt,d6 as $t,d7 as Gt,d8 as Kt,d9 as Jt,da as Zt,db as Yt,dc as Qt,dd as Xt,de as es,df as ts,dg as ss,dh as is,di as as,dj as ns,dk as os,dl as ls,B as rs,dm as cs,dn as ds,dp as ms,dq as hs,dr as us,ds as ps,dt as gs,du as fs,dv as Is,dw as ws,dx as vs,dy as bs,dz as Ss,dA as xs,dB as ys,dC as Es,dD as Ps,dE as ks,dF as Cs,dG as Ls,dH as Ts,dI as Ns,dJ as As,dK as Rs,dL as _s,dM as Ds,dN as Ms,dO as Vs,dP as Us,dQ as Ws,k as Fs,g as Os,dR as Hs,dS as qs,dT as Bs,dU as zs,F as js,an as $s,dV as Gs,_ as Ks,ah as Js,dW as Zs,ac as Ys,ae as Qs,aB as Xs,aY as ei,af as ti,ag as si,aQ as ii,aX as ai,aR as ni,av as oi,aA as li,ax as ri,a$ as ci,ak as di,dX as mi,ad as hi,aj as ui,aw as pi,dY as gi,b8 as fi,ai as Ii,b0 as wi,dZ as vi,d_ as bi,d$ as Si,e0 as xi,r as yi,p as Ei,e1 as Pi,e2 as ki,e3 as Ci,a4 as Li,ao as Ti,e4 as Ni,e5 as Ai,e6 as Ri,e7 as _i,a8 as Di,e8 as Mi,e9 as Vi,ea as Ui,eb as Wi,ec as Fi,ed as Oi,ee as Hi,a1 as qi,V as Bi,ef as zi,eg as ji,eh as $i,ei as Gi,ej as Ki,ek as Ji,el as Zi,em as Yi,en as Qi,a5 as Xi,eo as ea,ep as ta,eq as sa,a6 as ia,er as aa,es as na,et as oa,eu as la,ev as ra,ew as ca,ex as da,ey as ma,ez as ha,eA as ua,eB as pa,eC as ga,eD as fa,eE as Ia,u as wa,eF as va,eG as ba,eH as Sa,eI as xa,eJ as ya,eK as Ea,eL as Pa,i as ka,v as Ca,l as La,eM as Ta,j as Na,eN as Aa,$ as Ra,eO as _a,c as Da,eP as Ma,eQ as Va,eR as Ua,eS as Wa,eT as Fa,q as Oa,eU as Ha,eV as qa,eW as Ba,eX as za,eY as ja,z as $a,eZ as Ga,e_ as Ka,e$ as Ja,h as Za,a7 as Ya,f0 as Qa,f1 as Xa,f2 as en,f3 as tn,f4 as sn,f5 as an,f6 as nn,f7 as on,f8 as ln,f9 as rn,fa as cn,fb as dn,fc as mn,fd as hn,fe as un,ff as pn,fg as gn,fh as fn,fi as In,fj as wn,fk as vn,fl as bn,fm as Sn,fn as xn,fo as yn,fp as En,fq as Pn,fr as kn}from"./detailed_results-BbkThem3.chunk.js";import{M as Cn,t as Ln,i as Tn,T as Nn}from"./index-CsPe537V.chunk.js";const An=e(t).length,Rn=e(s).length;class _n{constructor(e,t){this.stat=e,this.pseudoStat=t}isStat(){return null!=this.stat}isPseudoStat(){return null!=this.pseudoStat}getStat(){if(!this.isStat())throw new Error("Not a stat!");return this.stat}getPseudoStat(){if(!this.isPseudoStat())throw new Error("Not a pseudo stat!");return this.pseudoStat}equals(e){return this.stat==e.stat&&this.pseudoStat==e.pseudoStat}getName(e){return this.isStat()?i(this.stat):a.get(this.pseudoStat)}getProtoValue(e){return this.isStat()?e.stats[this.stat]:e.pseudoStats[this.pseudoStat]}setProtoValue(e,t){this.isStat()?e.stats[this.stat]=t:e.pseudoStats[this.pseudoStat]=t}static fromStat(e){return new _n(e,null)}static fromPseudoStat(e){return new _n(null,e)}static getAll(){const i=e(t).filter((e=>![t.StatEnergy,t.StatRage].includes(e))),a=e(s);return[i.map((e=>_n.fromStat(e))),a.map((e=>_n.fromPseudoStat(e)))].flat()}}class Dn{constructor(e,t){this.stats=Dn.initStatsArray(An,e),this.pseudoStats=Dn.initStatsArray(Rn,t)}static initStatsArray(e,t){let s=t?.slice(0,e)||[];s.length<e&&(s=s.concat(new Array(e-(t?.length||0)).fill(0)));for(let i=0;i<e;i++)null==s[i]&&(s[i]=0);return s}equals(e){return this.stats.every(((t,s)=>t==e.getStat(s)))&&this.pseudoStats.every(((t,s)=>t==e.getPseudoStat(s)))}getStat(e){return this.stats[e]}getPseudoStat(e){return this.pseudoStats[e]}getUnitStat(e){return e.isStat()?this.stats[e.getStat()]:this.pseudoStats[e.getPseudoStat()]}withStat(e,t){const s=this.stats.slice();return s[e]=t,new Dn(s,this.pseudoStats)}withPseudoStat(e,t){const s=this.pseudoStats.slice();return s[e]=t,new Dn(this.stats,s)}withUnitStat(e,t){return e.isStat()?this.withStat(e.getStat(),t):this.withPseudoStat(e.getPseudoStat(),t)}addStat(e,t){return this.withStat(e,this.getStat(e)+t)}addPseudoStat(e,t){return this.withPseudoStat(e,this.getPseudoStat(e)+t)}add(e){return new Dn(this.stats.map(((t,s)=>t+e.stats[s])),this.pseudoStats.map(((t,s)=>t+e.pseudoStats[s])))}subtract(e){return new Dn(this.stats.map(((t,s)=>t-e.stats[s])),this.pseudoStats.map(((t,s)=>t-e.pseudoStats[s])))}scale(e){return new Dn(this.stats.map(((t,s)=>t*e)),this.pseudoStats.map(((t,s)=>t*e)))}computeEP(e){let t=0;return this.stats.forEach(((s,i)=>{t+=s*e.stats[i]})),this.pseudoStats.forEach(((s,i)=>{t+=s*e.pseudoStats[i]})),t}belowCaps(e){for(const[t,s]of this.stats.entries())if(e.stats[t]>0&&s>e.stats[t])return!1;return!0}asArray(){return this.stats.slice()}toJson(){return n.toJson(this.toProto())}toProto(){return n.create({stats:this.stats.slice(),pseudoStats:this.pseudoStats.slice()})}static fromJson(e){return Dn.fromProto(n.fromJson(e))}static fromMap(e,t){const s=new Array(An).fill(0);Object.entries(e).forEach((e=>{const[t,i]=e;s[Number(t)]=i}));const i=new Array(Rn).fill(0);return t&&Object.entries(t).forEach((e=>{const[t,s]=e;i[Number(t)]=s})),new Dn(s,i)}static fromProto(e){return e?new Dn(e.stats,e.pseudoStats):new Dn}}const Mn={footer:!1,header:!0,scrollContents:!1,size:"lg",title:null};class Vn extends o{constructor(e,t,s={disposeOnClose:!0}){super(e,"modal"),this.isOpen=!1,this.onHideCallbacks=[],this.modalConfig={...Mn,...s};const i=r(),a=r(),n=r(),o=r(),c=this.modalConfig.size&&"md"!=this.modalConfig.size?`modal-${this.modalConfig.size}`:"";this.rootElem.classList.add("fade"),this.rootElem.appendChild(l("div",{className:`modal-dialog ${t} ${c} ${this.modalConfig.scrollContents?"modal-overflow-scroll":""}`,ref:i},l("div",{className:"modal-content"},l("div",{className:"modal-header "+(this.modalConfig.header||this.modalConfig.title?"":"p-0 border-0"),ref:a},this.modalConfig.title&&l("h5",{className:"modal-title"},this.modalConfig.title),l("button",{type:"button",className:"btn-close "+(this.modalConfig.closeButton?.fixed?"position-fixed":""),onclick:()=>this.close(),attributes:{"aria-label":"Close"}},l("i",{className:"fas fa-times fa-2xl"}))),l("div",{className:"modal-body",ref:n}),this.modalConfig.footer&&l("div",{className:"modal-footer",ref:o})))),this.dialog=i.value,this.header=a.value,this.body=n.value,this.footer=o.value,this.modal=new Cn(this.rootElem),this.modalConfig.disposeOnClose&&this.rootElem.addEventListener("hidden.bs.modal",(()=>{this.rootElem.remove(),this.dispose()}),{once:!0})}open(){const e=this.closeModalOnEscKey.bind(this),t=this.showBSFn.bind(this),s=this.hideBSFn.bind(this),i=this.hiddenBSFn.bind(this);document.addEventListener("keydown",e),this.rootElem.addEventListener("show.bs.modal",t),this.rootElem.addEventListener("hide.bs.modal",s),this.rootElem.addEventListener("hidden.bs.modal",i),this.addOnHideCallback((()=>document.removeEventListener("keydown",e))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("show.bs.modal",t))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("hide.bs.modal",s))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("hidden.bs.modal",i))),this.modal.show(),this.isOpen=!0}close(){this.modal.hide(),this.isOpen=!1}addOnHideCallback(e){this.onHideCallbacks.push(e)}onShow(e){}onHide(e){this.onHideCallbacks.forEach((e=>e()))}async showBSFn(e){e.stopImmediatePropagation();const t=await new Promise((e=>{setTimeout((()=>{this.modal._backdrop._element&&e(this.modal._backdrop._element)}),100)}));this.rootElem.insertAdjacentElement("afterend",t),this.onShow(e)}hideBSFn(e){e.stopImmediatePropagation(),this.onHide(e)}hiddenBSFn(e){e.stopPropagation()}closeModalOnEscKey(e){"Escape"==e.key&&this.close()}}const Un={[c.ItemQualityJunk]:"item-quality-junk",[c.ItemQualityCommon]:"item-quality-common",[c.ItemQualityUncommon]:"item-quality-uncommon",[c.ItemQualityRare]:"item-quality-rare",[c.ItemQualityEpic]:"item-quality-epic",[c.ItemQualityLegendary]:"item-quality-legendary",[c.ItemQualityArtifact]:"item-quality-artifact",[c.ItemQualityHeirloom]:"item-quality-heirloom"};function Wn(e,t){Object.values(Un).forEach((t=>e.classList.remove(t))),t&&e.classList.add(Un[t])}class Fn extends d{constructor(e,t,s){super(e,"number-picker-root",t,s),this.float=s.float??!1,this.positive=s.positive??!1,this.showZeroes=s.showZeroes??!0,this.inputElem=document.createElement("input"),this.inputElem.id=s.id,this.inputElem.type="text",this.inputElem.classList.add("form-control","number-picker-input"),this.positive&&this.inputElem.addEventListener("change",(()=>{this.float?this.inputElem.value=Math.abs(parseFloat(this.inputElem.value)).toFixed(2):this.inputElem.value=Math.abs(parseInt(this.inputElem.value)).toString()}),{signal:this.signal}),this.inputElem.addEventListener("change",(()=>{this.inputChanged(m.nextEventID())}),{signal:this.signal}),this.inputElem.addEventListener("input",(()=>{this.updateSize()}),{signal:this.signal}),this.rootElem.appendChild(this.inputElem),this.init(),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.float?parseFloat(this.inputElem.value||"")||0:parseInt(this.inputElem.value||"")||0}setInputValue(e){(0!=e||this.showZeroes)&&(this.float?this.inputElem.value=e.toFixed(2):this.inputElem.value=String(e))}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}const On=new Map([["Primary",[{stat:_n.fromStat(t.StatHealth)},{stat:_n.fromStat(t.StatMana)}]],["Attributes",[{stat:_n.fromStat(t.StatStrength)},{stat:_n.fromStat(t.StatAgility)},{stat:_n.fromStat(t.StatStamina)},{stat:_n.fromStat(t.StatIntellect)},{stat:_n.fromStat(t.StatSpirit)}]],["Physical",[{stat:_n.fromStat(t.StatAttackPower)},{stat:_n.fromStat(t.StatFeralAttackPower)},{stat:_n.fromStat(t.StatRangedAttackPower)},{stat:_n.fromStat(t.StatMeleeHit)},{stat:_n.fromStat(t.StatExpertise)},{stat:_n.fromStat(t.StatMeleeCrit)},{stat:_n.fromPseudoStat(s.PseudoStatMeleeSpeedMultiplier)},{stat:_n.fromPseudoStat(s.PseudoStatRangedSpeedMultiplier)},{stat:_n.fromPseudoStat(s.PseudoStatBonusPhysicalDamage)}]],["Spell",[{stat:_n.fromStat(t.StatSpellPower)},{stat:_n.fromStat(t.StatSpellDamage)},{stat:_n.fromStat(t.StatArcanePower)},{stat:_n.fromStat(t.StatFirePower)},{stat:_n.fromStat(t.StatFrostPower)},{stat:_n.fromStat(t.StatHolyPower)},{stat:_n.fromStat(t.StatNaturePower)},{stat:_n.fromStat(t.StatShadowPower)},{stat:_n.fromStat(t.StatHealingPower)},{stat:_n.fromStat(t.StatSpellHit)},{stat:_n.fromStat(t.StatSpellCrit)},{stat:_n.fromPseudoStat(s.PseudoStatCastSpeedMultiplier)},{stat:_n.fromStat(t.StatSpellPenetration)},{stat:_n.fromStat(t.StatMP5)}]],["Defense",[{stat:_n.fromStat(t.StatArmor)},{stat:_n.fromStat(t.StatBonusArmor)},{stat:_n.fromStat(t.StatDefense)},{stat:_n.fromStat(t.StatDodge)},{stat:_n.fromStat(t.StatParry)},{stat:_n.fromStat(t.StatBlock)},{stat:_n.fromStat(t.StatBlockValue)}]],["Resistance",[{stat:_n.fromStat(t.StatArcaneResistance)},{stat:_n.fromStat(t.StatFireResistance)},{stat:_n.fromStat(t.StatFrostResistance)},{stat:_n.fromStat(t.StatNatureResistance)},{stat:_n.fromStat(t.StatShadowResistance)}]],["Misc",[{stat:_n.fromPseudoStat(s.PseudoStatThornsDamage),notEditable:!0},{stat:_n.fromPseudoStat(s.PseudoStatTimewornBonus)},{stat:_n.fromPseudoStat(s.PseudoStatSanctifiedBonus)}]]]);class Hn extends o{constructor(e,t,s,i){super(e,"character-stats-root"),this.stats=[],this.player=t,this.modifyDisplayStats=i;const a=r();this.player.levelChangeEmitter.on((()=>a.value.textContent=`Level ${t.getLevel()}`)),this.rootElem.appendChild(l("label",{className:"character-stats-label"},l("span",null,"Stats"),l("span",{ref:a,className:"ms-auto"},"Level ",t.getLevel())));const n=l("table",{className:"character-stats-table"});if(this.rootElem.appendChild(n),this.valueElems=[],On.forEach(((e,i)=>{const a=e.filter((e=>s.find((t=>t.equals(e.stat)))));if(!a.length)return;const o=l("tbody",null);a.forEach((e=>{const{stat:s}=e;this.stats.push(s);const i=s.getName(t.getClass()),a=l("tr",{className:"character-stats-table-row"},l("td",{className:"character-stats-table-label"},i),l("td",{className:"character-stats-table-value"},this.bonusStatsLink(e)));o.appendChild(a);const n=a.getElementsByClassName("character-stats-table-value")[0];this.valueElems.push(n)})),n.appendChild(o)})),this.shouldShowMeleeCritCap(t)){const e=l("tr",{className:"character-stats-table-row"},l("td",{className:"character-stats-table-label"},"Melee Crit Cap"),l("td",{className:"character-stats-table-value"}));n.appendChild(e),this.meleeCritCapValueElem=e.getElementsByClassName("character-stats-table-value")[0]}this.updateStats(t),m.onAny([t.currentStatsEmitter,t.sim.changeEmitter,t.talentsChangeEmitter]).on((()=>{this.updateStats(t)}))}updateStats(e){const i=e.getCurrentStats(),a=e.getGear(),n=a.getEquippedItem(h.ItemSlotMainHand),o=a.getEquippedItem(h.ItemSlotOffHand),c=this.modifyDisplayStats?this.modifyDisplayStats(this.player):{};c.talents||(c.talents=new Dn),c.buffs||(c.buffs=new Dn);const d=Dn.fromProto(i.baseStats),m=Dn.fromProto(i.gearStats),g=Dn.fromProto(i.talentsStats),f=Dn.fromProto(i.buffsStats),I=Dn.fromProto(i.consumesStats),w=this.getDebuffStats(e),v=e.getBonusStats(),b=d,S=m.subtract(d).subtract(v),x=g.subtract(m).add(c.talents),y=f.subtract(g).add(c.buffs),E=I.subtract(f),P=Dn.fromProto(i.finalStats).add(c.talents).add(c.buffs).add(w);if(this.stats.forEach(((i,a)=>{const c=v.getUnitStat(i);let h;h=0===c?"text-white":c>0?"text-success":"text-danger";const k=r(),C=l("div",{className:"stat-value-link-container"},l("a",{href:"javascript:void(0)",className:`stat-value-link ${h}`,attributes:{role:"button"},ref:k},`${this.statDisplayString(e,P,P,i)} `)),L=k.value;this.valueElems[a].querySelector(".stat-value-link-container")?.remove(),this.valueElems[a].prepend(C);const T=l("div",{className:"d-flex"},l("div",null,l("div",{className:"character-stats-tooltip-row"},l("span",null,"Base:"),l("span",null,this.statDisplayString(e,d,b,i))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Gear:"),l("span",null,this.statDisplayString(e,m,S,i))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Talents:"),l("span",null,this.statDisplayString(e,g,x,i))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Buffs:"),l("span",null,this.statDisplayString(e,f,y,i))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Consumes:"),l("span",null,this.statDisplayString(e,I,E,i))),i.isStat()&&0!=w.getStat(i.getStat())&&l("div",{className:"character-stats-tooltip-row"},l("span",null,"Debuffs:"),l("span",null,this.statDisplayString(e,w,w,i))),0!=c&&l("div",{className:"character-stats-tooltip-row"},l("span",null,"Bonus:"),l("span",null,this.statDisplayString(e,v,v,i))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Total:"),l("span",null,this.statDisplayString(e,P,P,i)))));if(i.isStat()&&[t.StatMeleeHit,t.StatExpertise].includes(i.getStat()))T.appendChild(l("div",{className:"ps-2"},l("div",{className:"character-stats-tooltip-row"},l("span",null,"Axes"),l("span",null,this.weaponSkillDisplayString(m,s.PseudoStatAxesSkill)," /"," ",this.weaponSkillDisplayString(m,s.PseudoStatTwoHandedAxesSkill))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Daggers"),l("span",null,this.weaponSkillDisplayString(m,s.PseudoStatDaggersSkill))),e.spec===u.SpecFeralDruid&&l("div",{className:"character-stats-tooltip-row"},l("span",null,"Feral Combat"),l("span",null,this.weaponSkillDisplayString(m,s.PseudoStatFeralCombatSkill))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Maces"),l("span",null,this.weaponSkillDisplayString(m,s.PseudoStatMacesSkill)," /"," ",this.weaponSkillDisplayString(m,s.PseudoStatTwoHandedMacesSkill))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Polearms"),l("span",null,this.weaponSkillDisplayString(m,s.PseudoStatPolearmsSkill))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Staves"),l("span",null,this.weaponSkillDisplayString(m,s.PseudoStatStavesSkill))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Swords"),l("span",null,this.weaponSkillDisplayString(m,s.PseudoStatSwordsSkill)," /"," ",this.weaponSkillDisplayString(m,s.PseudoStatTwoHandedSwordsSkill))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Unarmed"),l("span",null,this.weaponSkillDisplayString(m,s.PseudoStatUnarmedSkill)))));else if(i.isStat()&&i.getStat()===t.StatSpellHit)T.appendChild(l("div",{className:"ps-2"},l("div",{className:"character-stats-tooltip-row"},l("span",null,"Arcane"),l("span",null,this.spellSchoolHitDisplayString(P,s.PseudoStatSchoolHitArcane))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Fire"),l("span",null,this.spellSchoolHitDisplayString(P,s.PseudoStatSchoolHitFire))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Frost"),l("span",null,this.spellSchoolHitDisplayString(P,s.PseudoStatSchoolHitFrost))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Holy"),l("span",null,this.spellSchoolHitDisplayString(P,s.PseudoStatSchoolHitHoly))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Nature"),l("span",null,this.spellSchoolHitDisplayString(P,s.PseudoStatSchoolHitNature))),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Shadow"),l("span",null,this.spellSchoolHitDisplayString(P,s.PseudoStatSchoolHitShadow)))));else if(i.isPseudoStat()&&i.getPseudoStat()===s.PseudoStatMeleeSpeedMultiplier&&(n||o)){const e=P.getPseudoStat(s.PseudoStatMeleeSpeedMultiplier),t=o&&o.item.weaponType!==p.WeaponTypeShield&&o.item.weaponType!==p.WeaponTypeOffHand&&o.item.weaponType!==p.WeaponTypeUnknown,i=t?"Main-hand":"Weapon";T.appendChild(l("div",{className:"ps-2"},n&&l("div",{className:"character-stats-tooltip-row"},l("span",null,i," Speed"),l("span",null,(n.item.weaponSpeed/e).toFixed(2),"s")),t&&l("div",{className:"character-stats-tooltip-row"},l("span",null,"Off-hand Speed"),l("span",null,(o.item.weaponSpeed/e).toFixed(2),"s"))))}Ln(L,{content:T})})),this.meleeCritCapValueElem){const t=e.getMeleeCritCapInfo(),s=l("a",{href:"javascript:void(0)",className:"stat-value-link",attributes:{role:"button"}},`${this.meleeCritCapDisplayString(e,P)} `),i=t.playerCritCapDelta;0===i?s.classList.add("text-white"):i>0?s.classList.add("text-danger"):i<0&&s.classList.add("text-success"),this.meleeCritCapValueElem.querySelector(".stat-value-link")?.remove(),this.meleeCritCapValueElem.prepend(s);const a=l("div",null,l("div",{className:"character-stats-tooltip-row"},l("span",null,"Glancing:"),l("span",null,`${t.glancing.toFixed(2)}%`)),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Suppression:"),l("span",null,`${t.suppression.toFixed(2)}%`)),l("div",{className:"character-stats-tooltip-row"},l("span",null,"To Hit Cap:"),l("span",null,`${t.remainingMeleeHitCap.toFixed(2)}%`)),l("div",{className:"character-stats-tooltip-row"},l("span",null,"To Exp Cap:"),l("span",null,`${t.remainingExpertiseCap.toFixed(2)}%`)),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Debuffs:"),l("span",null,`${t.debuffCrit.toFixed(2)}%`)),0!=t.specSpecificOffset&&l("div",{className:"character-stats-tooltip-row"},l("span",null,"Spec Offsets:"),l("span",null,`${t.specSpecificOffset.toFixed(2)}%`)),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Final Crit Cap:"),l("span",null,`${t.baseCritCap.toFixed(2)}%`)),l("hr",null),l("div",{className:"character-stats-tooltip-row"},l("span",null,"Can Raise By:"),l("span",null,`${(t.remainingExpertiseCap+t.remainingMeleeHitCap).toFixed(2)}%`)));Ln(s,{content:a})}}statDisplayString(e,i,a,n){const o=a.getUnitStat(n);let l;if(n.isStat()){switch(n.getStat()){case t.StatBlockValue:const n=i.getPseudoStat(s.PseudoStatBlockValueMultiplier)||1,r=Math.max(0,i.getPseudoStat(s.PseudoStatBlockValuePerStrength)*a.getStat(t.StatStrength)-1);l=String(Math.round(o*n+r));break;case t.StatMeleeHit:l=`${(o/y).toFixed(2)}%`;break;case t.StatSpellHit:l=`${(o/x).toFixed(2)}%`;break;case t.StatSpellDamage:const c=Math.round(o);l=Math.round(a.getStat(t.StatSpellPower))+c+` (+${c})`;break;case t.StatArcanePower:case t.StatFirePower:case t.StatFrostPower:case t.StatHolyPower:case t.StatNaturePower:case t.StatShadowPower:case t.StatHealingPower:const d=Math.round(o);l=Math.round(a.getStat(t.StatSpellPower)+a.getStat(t.StatSpellDamage))+d+` (+${d})`;break;case t.StatMeleeCrit:case t.StatSpellCrit:l=`${(o/S).toFixed(2)}%`;break;case t.StatArmorPenetration:l=`${o} (${(o/b).toFixed(2)}%)`;break;case t.StatExpertise:l=`${o}%`;break;case t.StatDefense:l=`${(5*e.getLevel()+Math.floor(o/v)).toFixed(0)}`;break;case t.StatBlock:l=`${(o/w).toFixed(2)}%`;break;case t.StatDodge:l=`${(o/I).toFixed(2)}%`;break;case t.StatParry:l=`${(o/f).toFixed(2)}%`;break;case t.StatResilience:l=`${o} (${(o/g).toFixed(2)}%)`}}else{switch(n.getPseudoStat()){case s.PseudoStatMeleeSpeedMultiplier:l=`${(100*a.getPseudoStat(s.PseudoStatMeleeSpeedMultiplier)).toFixed(2)}%`;break;case s.PseudoStatRangedSpeedMultiplier:l=`${(100*a.getPseudoStat(s.PseudoStatRangedSpeedMultiplier)).toFixed(2)}%`;break;case s.PseudoStatCastSpeedMultiplier:l=`${(100*a.getPseudoStat(s.PseudoStatCastSpeedMultiplier)).toFixed(2)}%`}}return l||(l=String(Math.round(o))),l}weaponSkillDisplayString(e,t){return`${300+e.getPseudoStat(t)}`}spellSchoolHitDisplayString(e,s){return`${(e.getPseudoStat(s)+e.getStat(t.StatSpellHit)).toFixed(2)}%`}raidAvoidanceDebuff(e){const s=e.sim.encounter.targets;let i=new Dn;if(!s||0===s.length)return i;if(e.sim.db){const s=e.sim.db.getAllPresetEncounters().find((t=>e.sim.encounter.matchesPreset(t)));if(s&&s.path.includes("Scarlet Enclave"))return i=i.addStat(t.StatDodge,-20),i}const a=s[0].targetInputs;if(!a||0===a.length)return i;const n=a.find((e=>e.inputType===E.Enum&&"Difficulty Level"===e.label));return n&&n.enumValue>0&&(i=i.addStat(t.StatDodge,-4*n.enumValue)),i}getDebuffStats(e){return(new Dn).add(this.raidAvoidanceDebuff(e))}bonusStatsLink(e){const{stat:t,notEditable:s}=e,i=e.stat.getName(this.player.getClass()),a=r(),n=r(),o=l("a",{ref:a,href:"javascript:void(0)",className:P("add-bonus-stats text-white ms-2",s&&"invisible"),dataset:{bsToggle:"popover"},attributes:{role:"button"}},l("i",{ref:n,className:"fas fa-plus-minus"}));return Ln(n.value,{content:`Bonus ${i}`}),Ln(a.value,{interactive:!0,trigger:"click",theme:"bonus-stats-popover",placement:"right",onShow:e=>{const s=new Fn(null,this.player,{id:"character-bonus-"+(t.isStat()?"stat-"+t.getStat():"pseudostat-"+t.getPseudoStat()),label:`Bonus ${i}`,extraCssClasses:["mb-0"],changedEvent:e=>e.bonusStatsChangeEmitter,getValue:e=>e.getBonusStats().getUnitStat(t),setValue:(s,i,a)=>{const n=i.getBonusStats().withUnitStat(t,a);i.setBonusStats(s,n),e?.hide()}});e.setContent(s.rootElem)}}),o}shouldShowMeleeCritCap(e){return!1}meleeCritCapDisplayString(e,t){const s=e.getMeleeCritCap();if(0===s)return"Exact";return`${s>0?"Over by ":"Under by "} ${Math.abs(s).toFixed(2)}%`}}class qn extends o{constructor(e,t,s){super(e,"content-block",s.rootElem),this.config=s,this.rootElem.classList.add(t),s.extraCssClasses&&this.rootElem.classList.add(...s.extraCssClasses),this.headerElement=this.buildHeader(),this.bodyElement=this.buildBody(),s.bodyClasses?.forEach((e=>{this.bodyElement.classList.add(e)}))}buildHeader(){if(this.config.header&&Object.keys(this.config.header).length){const e=this.config.header.titleTag||"h6",t=r(),s=l("div",{className:"content-block-header"},l(e,{ref:t,className:"content-block-title"},this.config.header.title));return this.config.header.extraCssClasses&&s.classList.add(...this.config.header.extraCssClasses),this.config.header.tooltip&&Ln(t.value,{content:this.config.header.tooltip}),this.rootElem.appendChild(s),s}return null}buildBody(){const e=l("div",{className:"content-block-body"});return this.rootElem.appendChild(e),e}}const Bn=l("ul",{className:"text-start ps-3 mb-0"});class zn extends o{constructor(e){super(e,"results-viewer"),this.warnings=[],this.warningsTooltip=null;const t=r(),s=r(),i=r(),a=r();this.rootElem.appendChild(l(k,null,l("div",{ref:t,className:"results-pending"},l("div",{className:"loader"})),l("div",{ref:s,className:"results-content"}),l("div",{ref:a,className:"button-zone text-center"}),l("div",{ref:i,className:"warning-zone text-center"}))),this.pendingElem=t.value,this.contentElem=s.value,this.warningElem=i.value,this.buttonElem=a.value,this.warningsLink=this.addWarningsLink(),this.updateWarnings(),this.hideAll()}addWarningLink(e){const t=l("div",{className:"sim-toolbar-item"},l("a",{href:e.href?e.href:"javascript:void(0)",target:e.href?"_blank":"_self",className:e.classes},e.icon&&l("i",{className:e.icon}),e.text?e.text:""));return e.parent.appendChild(t),e.tooltip&&(this.warningsTooltip=Ln(t,{appendTo:"parent",content:e.tooltip,placement:"bottom",inlinePositioning:!0,plugins:[Tn]})),t}addWarningsLink(){return this.addWarningLink({parent:this.warningElem,icon:"fas fa-exclamation-triangle fa-3x",tooltip:Bn,classes:"warning link-warning"})}addWarning(e){this.warnings.push(e),e.updateOn.on((()=>this.updateWarnings())),this.updateWarnings()}updateWarnings(){const e=this.warnings.map((e=>e.getContent())).flat().filter((e=>""!==e)),t=this.warningsTooltip?.props.content?.cloneNode(!0)||l(k,null);t&&(t.innerHTML=""),t.appendChild(l(k,null,e?.map((e=>l("li",null,e))))),this.warningsLink.parentElement?.classList?.[e.length?"remove":"add"]("hide"),this.warningsTooltip?.setContent(t)}hideAll(){this.contentElem.style.display="none",this.pendingElem.style.display="none",this.buttonElem.style.display="none"}setPending(){this.contentElem.style.display="none",this.pendingElem.style.display="block"}setContent(e){"string"==typeof e?this.contentElem.innerHTML=e:(this.contentElem.innerHTML="",this.contentElem.appendChild(e)),this.contentElem.style.display="block",this.pendingElem.style.display="none"}addAbortButton(e){this.buttonElem.replaceChildren(l("button",{className:"sim-abort-button",onclick:e},l("i",{className:"fa fa-times fa-lg me-1"}),"Stop")),this.buttonElem.style.display="block"}removeAbortButton(){this.buttonElem.replaceChildren(),this.buttonElem.style.display="none"}}class jn extends o{constructor(e,t,s){super(e,"sim-tab"),this.rootElem.classList.add(s.identifier),this.simUI=t,this.config=s,this.rootElem.id=this.config.identifier,this.rootElem.classList.add("tab-pane","fade"),0==e.childNodes.length&&this.rootElem.classList.add("active","show"),this.navItem=this.buildNavItem(),this.navLink=this.navItem.children[0],this.contentContainer=document.createElement("div"),this.contentContainer.classList.add("tab-pane-content-container"),this.rootElem.appendChild(this.contentContainer),this.simUI.simHeader.addSimTabLink(this)}buildNavItem(){const e=document.createElement("fragment");return e.innerHTML=`\n\t\t\t<li class="${this.config.identifier} nav-item" role="presentation">\n\t\t\t\t<a\n\t\t\t\t\tclass="nav-link"\n\t\t\t\t\tdata-bs-toggle="tab"\n\t\t\t\t\tdata-bs-target="#${this.config.identifier}"\n\t\t\t\t\ttype="button"\n\t\t\t\t\trole="tab"\n\t\t\t\t\taria-controls="${this.config.identifier}"\n\t\t\t\t>${this.config.title}</a>\n\t\t\t</li>\n\t\t`,e.children[0]}buildColumn(e,t){let s=document.createElement("div");return s.classList.add("tab-panel-col",`${t}-${e}`),s}}class $n{constructor(e){const{title:t,variant:s,autoShow:i=!0,canClose:a=!0,body:n,additionalClasses:o,container:l,...r}=e||{};this.container=l||document.getElementById("toastContainer"),this.additionalClasses=o,this.title=t||"WoWSims",this.variant=s||"info",this.body=n,this.canClose=a,this.element=this.template(),this.container.appendChild(this.element),this.instance=Nn.getOrCreateInstance(this.element,{delay:3e3,...r}),i&&this.instance.show(),this.element.addEventListener("hidden.bs.toast",(()=>{this.destroy()}))}destroy(){this.instance.dispose(),this.element.remove()}show(){this.instance.show()}hide(){this.instance.hide()}getVariantIcon(){switch(this.variant){case"info":return"fa-info-circle";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";case"warning":return"fa-triangle-exclamation"}}template(){return l("div",{className:P("toast position-relative bottom-0 end-0",`toast--${this.variant}`,this.additionalClasses),attributes:{role:"alert","aria-live":"assertive","aria-atomic":"true"}},l("div",{className:"toast-header"},l("i",{className:`d-block fas fa-2xl me-2 ${this.getVariantIcon()}`}),l("strong",{className:"me-auto"},this.title),this.canClose&&l("a",{href:"javascript:void(0);",className:"btn-close",attributes:{role:"button","aria-label":"Close"},dataset:{bsDismiss:"toast"},"aria-label":"Close"},l("i",{className:`fas fa-times fa-1xl ${this.getVariantIcon()}`}))),l("div",{className:"toast-body"},this.body))}}let Gn=null;async function Kn(e){return(await(null==Gn&&(Gn=fetch("/sod/assets/enchants/descriptions.json").then((e=>e.json())).then((e=>{const t={};for(let s in e)t[parseInt(s)]=e[s];return t}))),Gn))[e.effectId]||e.name}function Jn(e){return e.effectId+"-"+e.type}const Zn={[h.ItemSlotHead]:"/sod/assets/item_slots/head.jpg",[h.ItemSlotNeck]:"/sod/assets/item_slots/neck.jpg",[h.ItemSlotShoulder]:"/sod/assets/item_slots/shoulders.jpg",[h.ItemSlotBack]:"/sod/assets/item_slots/shirt.jpg",[h.ItemSlotChest]:"/sod/assets/item_slots/chest.jpg",[h.ItemSlotWrist]:"/sod/assets/item_slots/wrists.jpg",[h.ItemSlotHands]:"/sod/assets/item_slots/hands.jpg",[h.ItemSlotWaist]:"/sod/assets/item_slots/waist.jpg",[h.ItemSlotLegs]:"/sod/assets/item_slots/legs.jpg",[h.ItemSlotFeet]:"/sod/assets/item_slots/feet.jpg",[h.ItemSlotFinger1]:"/sod/assets/item_slots/finger.jpg",[h.ItemSlotFinger2]:"/sod/assets/item_slots/finger.jpg",[h.ItemSlotTrinket1]:"/sod/assets/item_slots/trinket.jpg",[h.ItemSlotTrinket2]:"/sod/assets/item_slots/trinket.jpg",[h.ItemSlotMainHand]:"/sod/assets/item_slots/mainhand.jpg",[h.ItemSlotOffHand]:"/sod/assets/item_slots/offhand.jpg",[h.ItemSlotRanged]:"/sod/assets/item_slots/ranged.jpg"};function Yn(e){return Zn[e]}const Qn="https://wow.zamimg.com/images/wow/icons/medium/inventoryslot_empty.jpg";class Xn extends o{constructor(e,t,s){super(e,"gear-picker-root");const i=document.createElement("div");i.classList.add("gear-picker-left","tab-panel-col"),this.rootElem.appendChild(i);const a=document.createElement("div");a.classList.add("gear-picker-right","tab-panel-col"),this.rootElem.appendChild(a);const n=[h.ItemSlotHead,h.ItemSlotNeck,h.ItemSlotShoulder,h.ItemSlotBack,h.ItemSlotChest,h.ItemSlotWrist,h.ItemSlotMainHand,h.ItemSlotOffHand,h.ItemSlotRanged].map((e=>new to(i,this,t,s,e))),o=[h.ItemSlotHands,h.ItemSlotWaist,h.ItemSlotLegs,h.ItemSlotFeet,h.ItemSlotFinger1,h.ItemSlotFinger2,h.ItemSlotTrinket1,h.ItemSlotTrinket2].map((e=>new to(a,this,t,s,e)));this.itemPickers=n.concat(o).sort(((e,t)=>e.slot-t.slot)),this.selectorModal=new UI(t.rootElem,t,s,this)}}class eo extends o{constructor(e,t,s){super(e,"item-picker-root",t),this.player=s;const i=r(),a=r(),n=r(),o=r(),c=r(),d=r();this.rootElem.appendChild(l(k,null,l("div",{className:"item-picker-icon-wrapper"},l("span",{className:"item-picker-ilvl",ref:o}),l("a",{ref:i,className:"item-picker-icon",href:"javascript:void(0)",attributes:{role:"button"}}),l("div",{className:"item-picker-rune-container"},l("img",{ref:a,className:"item-picker-rune-icon hide"}))),l("div",{className:"item-picker-labels-container"},l("a",{ref:n,className:"item-picker-name",href:"javascript:void(0)",attributes:{role:"button"}}),l("a",{ref:c,className:"item-picker-enchant hide",href:"javascript:void(0)",attributes:{role:"button"}}),l("a",{ref:d,className:"item-picker-rune hide",href:"javascript:void(0)",attributes:{role:"button"}})))),this.iconElem=i.value,this.runeIconElem=a.value,this.nameElem=n.value,this.ilvlElem=o.value,this.enchantElem=c.value,this.runeElem=d.value}clear(){this.iconElem.removeAttribute("data-wowhead"),this.iconElem.removeAttribute("href"),this.nameElem.removeAttribute("data-wowhead"),this.nameElem.removeAttribute("href"),this.enchantElem.removeAttribute("data-wowhead"),this.enchantElem.removeAttribute("href"),this.enchantElem.classList.add("hide"),this.runeElem.removeAttribute("data-wowhead"),this.runeElem.removeAttribute("href"),this.runeElem.classList.add("hide"),this.iconElem.style.backgroundImage="",this.runeIconElem.src=Qn,this.nameElem.innerText="",this.ilvlElem.innerText="",this.enchantElem.innerText="",this.runeElem.innerText=""}update(e){this.nameElem.textContent=e.item.name,this.ilvlElem.textContent=e.item.ilvl.toString(),e.randomSuffix&&(this.nameElem.textContent+=" "+e.randomSuffix.name),Wn(this.nameElem,e.item.quality),this.player.setWowheadData(e,this.iconElem),this.player.setWowheadData(e,this.nameElem),e.asActionId().fill().then((e=>{e.setBackgroundAndHref(this.iconElem),e.setWowheadHref(this.nameElem)})),e.enchant?(Kn(e.enchant).then((e=>{this.enchantElem.textContent=e})),e.enchant.spellId?(this.enchantElem.href=C.makeSpellUrl(e.enchant.spellId),C.makeSpellTooltipData(e.enchant.spellId).then((e=>{this.enchantElem.dataset.wowhead=e}))):(this.enchantElem.href=C.makeItemUrl(e.enchant.itemId),C.makeItemTooltipData(e.enchant.itemId).then((e=>{this.enchantElem.dataset.wowhead=e}))),this.enchantElem.dataset.whtticon="false",this.enchantElem.classList.remove("hide")):this.enchantElem.classList.add("hide");const t=L[e._item.type]?.some((e=>this.player.sim.db.hasRuneBySlot(e,this.player.getClass())));t&&(this.runeIconElem.classList.remove("hide"),e.rune?(C.fromSpellId(e.rune.id).fill().then((e=>this.runeIconElem.src=e.iconUrl)),this.runeElem.classList.remove("hide"),this.runeElem.textContent=e.rune.name,this.runeElem.href=C.makeSpellUrl(e.rune.id),this.runeElem.dataset.wowhead=`domain=${T}&spell=${e.rune.id}`,this.runeElem.dataset.whtticon="false"):this.runeIconElem.src=Qn)}}class to extends o{constructor(e,t,s,i,a){super(e,"item-picker-root"),this.onUpdateCallbacks=[],this._equippedItem=null,this.gearPicker=t,this.simUI=s,this.player=i,this.slot=a,this.itemElem=new eo(e,this.rootElem,i),this.item=i.getEquippedItem(a),i.sim.waitForInit().then((()=>{const e=e=>{e.preventDefault(),this.openSelectorModal(VI.Items)};this.itemElem.iconElem.addEventListener("click",e),this.itemElem.nameElem.addEventListener("click",e),this.itemElem.enchantElem.addEventListener("click",(e=>{e.preventDefault(),this.openSelectorModal(VI.Enchants)})),this.itemElem.runeElem.addEventListener("click",(e=>{e.preventDefault(),this.openSelectorModal(VI.Runes)}))})),i.gearChangeEmitter.on((()=>{this.item=this.player.getEquippedItem(this.slot)})),i.professionChangeEmitter.on((()=>{this._equippedItem&&this.player.setWowheadData(this._equippedItem,this.itemElem.iconElem)}))}createGearData(){return{equipItem:(e,t)=>{this.player.equipItem(e,this.slot,t)},getEquippedItem:()=>this.player.getEquippedItem(this.slot),changeEvent:this.player.gearChangeEmitter}}get item(){return this._equippedItem}set item(e){this.itemElem.clear(),this.itemElem.nameElem.textContent=N.get(this.slot)??"",Wn(this.itemElem.nameElem,null),e?this.itemElem.update(e):this.itemElem.iconElem.style.backgroundImage=`url('${Yn(this.slot)}')`,this._equippedItem=e,this.onUpdateCallbacks.forEach((e=>e()))}onUpdate(e){this.onUpdateCallbacks.push(e)}openSelectorModal(e){this.gearPicker.selectorModal.openTab(this.slot,e,this.createGearData())}}class so extends o{constructor(e,t,s,i,a){super(e,"bulk-item-picker"),this.simUI=t,this.bulkUI=s,this.index=a,this.item=i,this.itemElem=new eo(e,this.rootElem,t.player);const n=r();this.itemElem.rootElem.appendChild(l("button",{className:"remove-batch-item-btn",ref:n},l("i",{className:"fas fa-times"})));const o=()=>this.bulkUI.removeItemByIndex(this.index);n.value.addEventListener("click",o),this.addOnDisposeCallback((()=>n.value.removeEventListener("click",o))),this.simUI.sim.waitForInit().then((()=>{this.setItem(i);const e=A(this.item.item)[0],t=this.simUI.sim.db.getEnchants(e),s=this.simUI.sim.db.getRunes(e,this.simUI.player.getClass()),a=this.item.item.randomSuffixOptions,n=i=>{i.preventDefault(),t.length?this.bulkUI.selectorModal.openTab(e,VI.Enchants,this.createGearData()):s.length?this.bulkUI.selectorModal.openTab(e,VI.Runes,this.createGearData()):a.length&&this.bulkUI.selectorModal.openTab(e,VI.RandomSuffixes,this.createGearData())};this.itemElem.iconElem.addEventListener("click",n),this.itemElem.nameElem.addEventListener("click",n),this.itemElem.enchantElem.addEventListener("click",n)}))}setItem(e){this.itemElem.clear(),e?(this.itemElem.update(e),this.item=e):(this.itemElem.rootElem.style.opacity="30%",this.itemElem.iconElem.style.backgroundImage="url('/cata/assets/item_slots/empty.jpg')",this.itemElem.nameElem.textContent="Add new item (not implemented)",this.itemElem.rootElem.style.alignItems="center")}createGearData(){const e=new m;return{equipItem:(t,s)=>{if(s){const t=this.bulkUI.getItems();t[this.index]=s.asSpec(),this.item=s,this.bulkUI.setItems(t),e.emit(m.nextEventID())}},getEquippedItem:()=>this.item,changeEvent:e}}}class io extends o{constructor(e,t,s,i){super(e,".bulk-sim-results");const a=s.unitMetrics.dps.avg-i.unitMetrics.dps.avg,n=r(),o=r(),c=r();if(e.appendChild(l(k,null,l("div",{className:"results-sim"},l("div",{className:"bulk-result-body-dps bulk-items-text-line results-sim-dps damage-metrics"},l("span",{className:"topline-result-avg"},this.formatDps(s.unitMetrics.dps.avg)),l("span",{ref:o,className:P(a>=0?"bulk-result-header-positive":"bulk-result-header-negative")},this.formatDpsDelta(a)),l("p",{className:"talent-loadout-text"},s.talentLoadout&&"object"==typeof s.talentLoadout?"string"==typeof s.talentLoadout.name&&l(k,null,"Talent loadout used: ",s.talentLoadout.name):l(k,null,"Current talents")))),l("div",{ref:c,className:"bulk-gear-combo"}),!!s.itemsAdded?.length&&l("button",{ref:n,className:"btn btn-primary bulk-equipit"},"Equip"))),s.itemsAdded?.length){n.value?.addEventListener("click",(()=>{s.itemsAdded.forEach((e=>{const s=t.sim.db.lookupItemSpec(e.item);t.player.equipItem(m.nextEventID(),e.slot,s),t.simHeader.activateTab("gear-tab")}))}));const e=l(k,null);for(const i of s.itemsAdded){const s=l("div",{className:"bulk-result-item"}),a=t.sim.db.lookupItemSpec(i.item),n=new eo(e,s,t.player);n.update(a),n.nameElem.appendChild(l("a",{className:"bulk-result-item-slot"},this.itemSlotName(i))),e.appendChild(s)}c.value?.appendChild(e)}else s.talentLoadout&&"object"==typeof s.talentLoadout||(o.value?.classList.add("hide"),e.appendChild(l("p",null,"No changes - this is your currently equipped gear!")))}formatDps(e){return(Math.round(100*e)/100).toFixed(2)}formatDpsDelta(e){return(e>=0?"+":"")+this.formatDps(e)}itemSlotName(e){return JSON.parse(R.toJsonString(e,{emitDefaultValues:!0})).slot.replace("ItemSlot","")}}var ao=(e=>(e[e.Gear=0]="Gear",e[e.Talents=1]="Talents",e[e.Rotation=2]="Rotation",e[e.Consumes=3]="Consumes",e[e.Miscellaneous=4]="Miscellaneous",e[e.External=5]="External",e[e.Encounter=6]="Encounter",e[e.UISettings=7]="UISettings",e))(ao||{});const no=(()=>{const e=new Map;return e.set(0,"g"),e.set(1,"t"),e.set(2,"r"),e.set(3,"c"),e.set(4,"m"),e.set(5,"x"),e.set(6,"e"),e.set(7,"u"),e})();class oo extends Vn{constructor(e,t){super(e,"importer",{title:t.title,footer:!0,disposeOnClose:!1}),this.allowFileUpload=t.allowFileUpload||!1;const s="upload-input-"+t.title.toLowerCase().replaceAll(" ","-"),i=r(),a=r(),n=r(),o=r();this.body.replaceChildren(l(k,null,l("div",{ref:i,className:"import-description"}),l("textarea",{ref:a,className:"importer-textarea form-control",attributes:{spellcheck:!1}}))),this.footer.appendChild(l(k,null,this.allowFileUpload&&l(k,null,l("label",{htmlFor:s,className:"importer-button btn btn-primary upload-button me-2"},l("i",{className:"fas fa-file-arrow-up me-1"}),"Upload File"),l("input",{ref:o,type:"file",id:s,className:"importer-upload-input d-none",hidden:!0})),l("button",{ref:n,className:"importer-button btn btn-primary import-button"},l("i",{className:"fa fa-download me-1"}),"Import"))),this.descriptionElem=i.value,this.textElem=a.value,this.allowFileUpload&&o.value&&o.value.addEventListener("change",(async e=>{this.textElem.textContent=await e.target.files[0].text()})),this.importButton=n.value,this.importButton.addEventListener("click",(async e=>{try{await this.onImport(this.textElem.value||"")}catch(t){new $n({variant:"error",body:`Import error: ${t?.message||t}`})}}))}}const lo=class extends oo{constructor(e,t,s){super(e,s),this.simUI=t}async finishIndividualImport(e,t,s,i,a,n){const o=e.player.getClass();if(t!=o)throw new Error(`Wrong Class! Expected ${_.get(o)} but found ${_.get(t)}!`);await D.loadLeftoversIfNecessary(i);const l=e.sim.db.lookupEquipmentSpec(i),r=i.items.map((e=>e.enchant)),c=l.asSpec().items.map((e=>e.enchant)),d=r.filter((e=>0!=e&&!c.includes(e))),h=i.items.map((e=>e.id)),u=l.asSpec().items.map((e=>e.id)),p=h.filter((e=>!u.includes(e))),g=m.nextEventID();m.freezeAllAndDo((()=>{e.player.setRace(g,s),e.player.setGear(g,l),a&&"--"!=a&&e.player.setTalentsString(g,a),n.length>0&&e.player.setProfessions(g,n)})),this.close(),0==p.length&&0==d.length?new $n({variant:"success",body:"Import successful!"}):new $n({variant:"info",body:"Import successful, but the following IDs were not found in the sim database:"+(0==p.length?"":"\n\nItems: "+p.join(", "))+(0==d.length?"":"\n\nEnchants: "+d.join(", "))})}};lo.DEFAULT_CATEGORIES=e(ao).filter((e=>e!==ao.UISettings)),lo.CATEGORY_PARAM="i";let ro=lo;class co extends ro{constructor(e,t,s){super(e,t,{title:"Bag Item Import",allowFileUpload:!0}),this.bulkUI=s,this.descriptionElem.appendChild(l(k,null,l("p",null,"Import bag items from a JSON file, which can be created by the WowSimsExporter in-game AddOn."),l("p",null,"To import, upload the file or paste the text below, then click, 'Import'.")))}async onImport(e){try{const t=M.fromJsonString(e,{ignoreUnknownFields:!0});if(t?.items?.length>0){const e=await D.loadLeftoversIfNecessary(t),s=t.items.filter((t=>t.id>0&&e.lookupItemSpec(t)));s.length>0&&this.bulkUI.addItems(s)}this.close()}catch(t){console.warn(t),alert(t.toString())}}}class mo extends o{constructor(e,t){const s=r();super(e,"copy-button",l("button",{className:`btn ${t.extraCssClasses?.join(" ")??""}`,ref:s},l("i",{className:"fas fa-copy me-1"}),t.text??"Copy to Clipboard")),this.config=t;const i=s.value;let a=!1;i.addEventListener("click",(()=>{if(a)return;const e=this.config.getContent();if(null==navigator.clipboard)alert(e);else{a=!0,navigator.clipboard.writeText(e);const t=i.innerHTML;i.innerHTML='<i class="fas fa-check me-1"></i>Copied',setTimeout((()=>{i.innerHTML=t,a=!1}),1500)}})),t.tooltip&&Ln(i,{content:t.tooltip})}}class ho extends d{constructor(e,t,s){super(e,"talents-picker-root",t,s),this.config=s,this.pointsPerRow=s.pointsPerRow,this.numRows=Math.max(...s.trees.map((e=>e.talents.map((e=>e.location.rowIdx)).flat())).flat())+1,this.numCols=Math.max(...s.trees.map((e=>e.talents.map((e=>e.location.colIdx)).flat())).flat())+1;const i=()=>t.getLevel()-9;this.maxPoints=i();const a=()=>this.maxPoints-t.getTalentTreePoints().reduce(((e,t)=>e+t),0),n=r(),o=r(),c=r(),d=r(),h=r();this.rootElem.appendChild(l("div",{className:"talents-picker-inner"},l("div",{className:"talents-picker-header"},l("div",{className:"d-flex"},l("label",null,"Points Remaining:",l("span",{ref:n},a()))),l("div",{className:"talents-picker-actions",ref:o})),l("div",{id:"talents-carousel",className:"carousel slide"},l("div",{className:"carousel-inner",ref:c}),l("button",{className:"carousel-control-prev",type:"button",ref:d},l("span",{className:"carousel-control-prev-icon",attributes:{"aria-hidden":!0}}),l("span",{className:"visually-hidden"},"Previous")),l("button",{className:"carousel-control-next",type:"button",ref:h},l("span",{className:"carousel-control-next-icon",attributes:{"aria-hidden":!0}}),l("span",{className:"visually-hidden"},"Next")))));const u=c.value,p=d.value,g=h.value;m.onAny([t.levelChangeEmitter,t.talentsChangeEmitter]).on((()=>{this.setMaxPoints(i()),n.value.textContent=`${a()}`})),new mo(o.value,{extraCssClasses:["btn-sm","btn-outline-primary","copy-talents"],getContent:()=>t.getTalentsString(),text:"Copy",tooltip:"Copy talent string"}),this.trees=s.trees.map(((e,t)=>{const i=document.createElement("div");return u.appendChild(i),i.classList.add("carousel-item"),1===t&&i.classList.add("active"),new uo(i,e,this,s.klass,t)})),this.trees.forEach((e=>e.talents.forEach((e=>e.setPoints(0,!1)))));let f=0;p.addEventListener("click",(()=>{f>=1||(f+=1,u.style.transform=`translateX(${33.3*f}%)`,u.children[Math.abs(f-2)%3].classList.remove("active"),u.children[Math.abs(f-1)%3].classList.add("active"))})),g.addEventListener("click",(()=>{f<=-1||(f-=1,u.style.transform=`translateX(${33.3*f}%)`,u.children[Math.abs(f)%3].classList.remove("active"),u.children[Math.abs(f)+1].classList.add("active"))})),this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.trees.map((e=>e.getTalentsString())).join("-").replace(/-+$/g,"")}setInputValue(e){const t=e.split("-");this.trees.forEach(((e,s)=>e.setTalentsString(t[s]||""))),this.updateTrees()}updateTrees(){this.isFull()?this.rootElem.classList.add("talents-full"):this.rootElem.classList.remove("talents-full"),this.trees.forEach((e=>e.update()))}get numPoints(){return V(this.trees.map((e=>e.numPoints)))}isFull(){return this.numPoints>=this.maxPoints}setMaxPoints(e){e!=this.maxPoints&&(this.maxPoints=e,this.updateTrees())}}class uo extends o{constructor(e,t,s,i,a){super(e,"talent-tree-picker-root"),this.config=t,this.numPoints=0,this.picker=s,this.rootElem.appendChild(l(k,null,l("div",{className:"talent-tree-header"},l("img",{src:U(i,a),className:"talent-tree-icon"}),l("span",{className:"talent-tree-title"}),l("label",{className:"talent-tree-points"}),l("button",{className:"talent-tree-reset btn link-danger"},l("i",{className:"fa fa-times"}))),l("div",{className:"talent-tree-background"}),l("div",{className:"talent-tree-main"}))),this.title=this.rootElem.getElementsByClassName("talent-tree-title")[0],this.pointsElem=this.rootElem.querySelector(".talent-tree-points");this.rootElem.querySelector(".talent-tree-background").style.backgroundImage=`url('${t.backgroundUrl}')`;const n=this.rootElem.querySelector(".talent-tree-main");n.style.gridTemplateRows=`repeat(${this.picker.numRows}, 1fr)`,n.style.gridTemplateColumns=`repeat(${this.picker.numCols}, 1fr)`;const o="3.5rem";n.style.height=`calc(${o} * ${this.picker.numRows})`,n.style.maxWidth=`calc(${o} * ${this.picker.numCols})`,this.rootElem.style.maxWidth=`calc(${o} * ${this.picker.numCols+2})`,this.talents=t.talents.map((e=>new go(n,e,this))),this.talents.forEach((e=>{e.config.prereqLocation&&this.getTalent(e.config.prereqLocation).config.childLocations.push(e.config.location)}));const r=(e,t)=>{e.initChildReqs(),e.zIndex=t;for(const s of e.config.childLocations){const i=this.getTalent(s);i.parentReq=e.getChildReqArrow(s),r(i,t-2)}};for(const l of this.talents)0!=l.config.childLocations.length&&void 0===l.config.prereqLocation&&r(l,20);const c=this.rootElem.querySelector(".talent-tree-reset");Ln(c,{content:"Reset talent points"}),c.addEventListener("click",(e=>{this.talents.forEach((e=>e.setPoints(0,!1))),this.picker.inputChanged(m.nextEventID())}))}update(){this.title.innerHTML=this.config.name,this.pointsElem.textContent=`${this.numPoints} / ${this.getMaxSpendablePoints()}`,this.talents.forEach((e=>e.update()))}getTalent(e){const t=this.talents.find((t=>t.getRow()==e.rowIdx&&t.getCol()==e.colIdx));if(!t)throw new Error("No talent found with location: "+e);return t}getTalentsString(){return this.talents.map((e=>String(e.getPoints()))).join("").replace(/0+$/g,"")}setTalentsString(e){this.talents.forEach(((t,s)=>t.setPoints(Number(e.charAt(s)),!1)))}getMaxSpendablePoints(){return this.picker.maxPoints}}class po extends o{constructor(e,t,s){super(e,"talent-picker-req-arrow",document.createElement("div")),this.zIdx=0,this.parentLoc=t,this.childLoc=s,this.rootElem.style.gridRow=String(t.rowIdx+1),this.rootElem.style.gridColumn=String(t.colIdx+1);let i=Math.max(t.rowIdx,s.rowIdx)+1,a=Math.max(t.colIdx,s.colIdx)+1;t.rowIdx==s.rowIdx?(this.dir=t.colIdx<s.colIdx?"right":"left",this.rootElem.dataset.reqArrowColSize=String(Math.abs(t.colIdx-s.colIdx)),a="left"==this.dir?a+1:a-1):t.colIdx==s.colIdx?(this.dir="down",this.rootElem.dataset.reqArrowRowSize=String(Math.abs(t.rowIdx-s.rowIdx)),i+=1):(this.dir=t.colIdx<s.colIdx?"rightdown":"leftdown",this.rootElem.dataset.reqArrowColSize=String(Math.abs(t.colIdx-s.colIdx)),this.rootElem.dataset.reqArrowRowSize=String(Math.abs(t.rowIdx-s.rowIdx)),i+=1,a="rightdown"==this.dir?a+1:a-1,this.rootElem.appendChild(l("div",null))),this.rootElem.style.gridRowEnd=String(i),this.rootElem.style.gridColumnEnd=String(a),this.rootElem.classList.add(`talent-picker-req-arrow-${this.dir}`)}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(e)}setReqFufilled(e){e?this.rootElem.dataset.reqActive="true":delete this.rootElem.dataset.reqActive}}class go extends o{constructor(e,t,s){super(e,"talent-picker-root",document.createElement("a")),this.config=t,this.tree=s,this.childReqs=[],this.parentReq=null,this.zIdx=0,this.rootElem.style.gridRow=String(this.config.location.rowIdx+1),this.rootElem.style.gridColumn=String(this.config.location.colIdx+1),this.rootElem.dataset.maxPoints=String(this.config.maxPoints),this.rootElem.dataset.whtticon="false",this.pointsDisplay=document.createElement("span"),this.pointsDisplay.classList.add("talent-picker-points"),this.rootElem.appendChild(this.pointsDisplay),this.rootElem.addEventListener("click",(e=>{e.preventDefault()})),this.rootElem.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.rootElem.addEventListener("touchmove",(e=>{null!=this.longTouchTimer&&(clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0)})),this.rootElem.addEventListener("touchstart",(e=>{e.preventDefault(),this.longTouchTimer=window.setTimeout((()=>{this.setPoints(0,!0),this.tree.picker.inputChanged(m.nextEventID()),this.longTouchTimer=void 0}),750)})),this.rootElem.addEventListener("touchend",(e=>{if(e.preventDefault(),null==this.longTouchTimer)return;clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0;let t=this.getPoints()+1;this.config.maxPoints<t&&(t=0),this.setPoints(t,!0),this.tree.picker.inputChanged(m.nextEventID())})),this.rootElem.addEventListener("mousedown",(e=>{W(e)?this.setPoints(this.getPoints()-1,!0):this.setPoints(this.getPoints()+1,!0),this.tree.picker.inputChanged(m.nextEventID())}))}initChildReqs(){if(0!=this.config.childLocations.length)for(const e of this.config.childLocations)this.childReqs.push(new po(this.rootElem.parentElement,this.config.location,e))}getChildReqArrow(e){for(const t of this.childReqs)if(t.childLoc===e)return t;throw Error("missing child prereq?")}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(this.zIdx);for(const t of this.childReqs)t.zIndex=this.zIdx-1}getRow(){return this.config.location.rowIdx}getCol(){return this.config.location.colIdx}getPoints(){const e=Number(this.rootElem.dataset.points);return isNaN(e)?0:e}isFull(){return this.getPoints()>=this.config.maxPoints}canSetPoints(e){const t=this.getPoints();if(e>t){const s=e-t;if(this.tree.picker.numPoints+s>this.tree.picker.maxPoints)return!1;if(this.tree.numPoints<this.getRow()*this.tree.picker.pointsPerRow)return!1;if(this.config.prereqLocation&&!this.tree.getTalent(this.config.prereqLocation).isFull())return!1}else{const s=t-e,i=[...Array(this.tree.picker.numRows).keys()].map((e=>this.tree.talents.filter((t=>t.getRow()==e)))).map((e=>V(e.map((e=>e.getPoints())))));i[this.getRow()]-=s;const a=i.map(((e,t)=>V(i.slice(0,t+1))));if(!this.tree.talents.every((e=>0==e.getPoints()||0==e.getRow()||a[e.getRow()-1]>=e.getRow()*this.tree.picker.pointsPerRow)))return!1;for(const e of this.config.childLocations)if(this.tree.getTalent(e).getPoints()>0)return!1}return!0}setPoints(e,t){const s=this.getPoints();if(e=Math.max(0,e),e=Math.min(this.config.maxPoints,e),t&&!this.canSetPoints(e))return;this.tree.numPoints+=e-s,this.rootElem.dataset.points=String(e),this.pointsDisplay.textContent=e+"/"+this.config.maxPoints,this.isFull()?this.rootElem.classList.add("talent-full"):this.rootElem.classList.remove("talent-full");const i=this.getSpellIdForPoints(e);C.fromSpellId(i).fill().then((e=>{e.setWowheadHref(this.rootElem),this.rootElem.style.backgroundImage=`url('${e.iconUrl}')`}))}getSpellIdForPoints(e){const t=Math.max(0,e-1);if(this.config.spellIds[t])return this.config.spellIds[t];throw new Error(`No rank ${e} for talent ${String(this.config.fieldName)}`)}update(){const e=this.canSetPoints(this.getPoints()+1);e?this.rootElem.classList.add("talent-picker-can-add"):this.rootElem.classList.remove("talent-picker-can-add"),this.parentReq&&this.parentReq.setReqFufilled(e||this.isFull())}}function fo(e){return e.forEach((e=>{e.talents.forEach(((t,s)=>{if(t.childLocations=[],0!=s){const i=e.talents[s-1];if(t.location.rowIdx<i.location.rowIdx||t.location.rowIdx==i.location.rowIdx&&t.location.colIdx<=i.location.colIdx)throw new Error(`Out-of-order talent: ${String(t.fieldName)}`)}if(t.spellIds.length<t.maxPoints){let e=t.spellIds[t.spellIds.length-1];for(let s=t.spellIds.length;s<t.maxPoints;s++)e++,t.spellIds.push(e)}}))})),e}const Io=fo([{name:"Balance",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/283.jpg",talents:[{fieldName:"improvedWrath",location:{rowIdx:0,colIdx:0},spellIds:[16814,16815,16816,16817,16818],maxPoints:5},{fieldName:"naturesGrasp",location:{rowIdx:0,colIdx:1},spellIds:[16689],maxPoints:1},{fieldName:"improvedNaturesGrasp",location:{rowIdx:0,colIdx:2},spellIds:[17245,17247,17248,17249],maxPoints:4,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"improvedEntanglingRoots",location:{rowIdx:1,colIdx:0},spellIds:[16918,16919,16920],maxPoints:3},{fieldName:"improvedMoonfire",location:{rowIdx:1,colIdx:1},spellIds:[16821,16822,16823,16824,16825],maxPoints:5},{fieldName:"naturalWeapons",location:{rowIdx:1,colIdx:2},spellIds:[16902,16903,16904,16905,16906],maxPoints:5},{fieldName:"naturalShapeshifter",location:{rowIdx:1,colIdx:3},spellIds:[16833,16834,16835],maxPoints:3},{fieldName:"improvedThorns",location:{rowIdx:2,colIdx:0},spellIds:[16836,16839,16840],maxPoints:3},{fieldName:"omenOfClarity",location:{rowIdx:2,colIdx:2},spellIds:[16864],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"naturesReach",location:{rowIdx:2,colIdx:3},spellIds:[16819,16820],maxPoints:2},{fieldName:"vengeance",location:{rowIdx:3,colIdx:1},spellIds:[16909,16910,16911,16912,16913],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"improvedStarfire",location:{rowIdx:3,colIdx:2},spellIds:[16850,16923,16924,16925,16926],maxPoints:5},{fieldName:"naturesGrace",location:{rowIdx:4,colIdx:1},spellIds:[16880],maxPoints:1},{fieldName:"moonglow",location:{rowIdx:4,colIdx:2},spellIds:[16845,16846,16847],maxPoints:3},{fieldName:"moonfury",location:{rowIdx:5,colIdx:1},spellIds:[16896,16897,16899,16900,16901],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"moonkinForm",location:{rowIdx:6,colIdx:1},spellIds:[24858],maxPoints:1}]},{name:"Feral Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/281.jpg",talents:[{fieldName:"ferocity",location:{rowIdx:0,colIdx:1},spellIds:[16934,16935,16936,16937,16938],maxPoints:5},{fieldName:"feralAggression",location:{rowIdx:0,colIdx:2},spellIds:[16858,16859,16860,16861,16862],maxPoints:5},{fieldName:"feralInstinct",location:{rowIdx:1,colIdx:0},spellIds:[16947,16948,16949,16950,16951],maxPoints:5},{fieldName:"brutalImpact",location:{rowIdx:1,colIdx:1},spellIds:[16940,16941],maxPoints:2},{fieldName:"thickHide",location:{rowIdx:1,colIdx:2},spellIds:[16929,16930,16931,16932,16933],maxPoints:5},{fieldName:"felineSwiftness",location:{rowIdx:2,colIdx:0},spellIds:[17002,24866],maxPoints:2},{fieldName:"feralCharge",location:{rowIdx:2,colIdx:1},spellIds:[16979],maxPoints:1},{fieldName:"sharpenedClaws",location:{rowIdx:2,colIdx:2},spellIds:[16942,16943,16944],maxPoints:3},{fieldName:"improvedShred",location:{rowIdx:3,colIdx:0},spellIds:[16966,16968],maxPoints:2},{fieldName:"predatoryStrikes",location:{rowIdx:3,colIdx:1},spellIds:[16972,16974,16975],maxPoints:3},{fieldName:"bloodFrenzy",location:{rowIdx:3,colIdx:2},spellIds:[16952,16954],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"primalFury",location:{rowIdx:3,colIdx:3},spellIds:[16958,16961],maxPoints:2},{fieldName:"savageFury",location:{rowIdx:4,colIdx:0},spellIds:[16998,16999],maxPoints:2},{fieldName:"faerieFireFeral",location:{rowIdx:4,colIdx:2},spellIds:[16857],maxPoints:1},{fieldName:"heartOfTheWild",location:{rowIdx:5,colIdx:1},spellIds:[17003,17004,17005,17006,24894],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"leaderOfThePack",location:{rowIdx:6,colIdx:1},spellIds:[17007],maxPoints:1}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/282.jpg",talents:[{fieldName:"improvedMarkOfTheWild",location:{rowIdx:0,colIdx:1},spellIds:[17050,17051,17053,17054,17055],maxPoints:5},{fieldName:"furor",location:{rowIdx:0,colIdx:2},spellIds:[17056,17058,17059,17060,17061],maxPoints:5},{fieldName:"improvedHealingTouch",location:{rowIdx:1,colIdx:0},spellIds:[17069,17070,17071,17072,17073],maxPoints:5},{fieldName:"naturesFocus",location:{rowIdx:1,colIdx:1},spellIds:[17063,17065,17066,17067,17068],maxPoints:5},{fieldName:"improvedEnrage",location:{rowIdx:1,colIdx:2},spellIds:[17079,17082],maxPoints:2},{fieldName:"reflection",location:{rowIdx:2,colIdx:1},spellIds:[17106,17107,17108],maxPoints:3},{fieldName:"insectSwarm",location:{rowIdx:2,colIdx:2},spellIds:[5570],maxPoints:1},{fieldName:"subtlety",location:{rowIdx:2,colIdx:3},spellIds:[17118,17119,17120,17121,17122],maxPoints:5},{fieldName:"tranquilSpirit",location:{rowIdx:3,colIdx:1},spellIds:[24968,24969,24970,24971,24972],maxPoints:5},{fieldName:"improvedRejuvenation",location:{rowIdx:3,colIdx:3},spellIds:[17111,17112,17113],maxPoints:3},{fieldName:"naturesSwiftness",location:{rowIdx:4,colIdx:0},spellIds:[17116],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"giftOfNature",location:{rowIdx:4,colIdx:2},spellIds:[17104,24943,24944,24945,24946],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"improvedTranquility",location:{rowIdx:4,colIdx:3},spellIds:[17123,17124],maxPoints:2},{fieldName:"improvedRegrowth",location:{rowIdx:5,colIdx:2},spellIds:[17074,17075,17076,17077,17078],maxPoints:5},{fieldName:"swiftmend",location:{rowIdx:6,colIdx:1},spellIds:[18562],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}}]}]),wo=fo([{name:"Beast Mastery",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/361.jpg",talents:[{fieldName:"improvedAspectOfTheHawk",location:{rowIdx:0,colIdx:1},spellIds:[19552,19553,19554,19555,19556],maxPoints:5},{fieldName:"enduranceTraining",location:{rowIdx:0,colIdx:2},spellIds:[19583,19584,19585,19586,19587],maxPoints:5},{fieldName:"improvedEyesOfTheBeast",location:{rowIdx:1,colIdx:0},spellIds:[19557,19558],maxPoints:2},{fieldName:"improvedAspectOfTheMonkey",location:{rowIdx:1,colIdx:1},spellIds:[19549,19550,19551,24386,24387],maxPoints:5},{fieldName:"thickHide",location:{rowIdx:1,colIdx:2},spellIds:[19609,19610,19612],maxPoints:3},{fieldName:"improvedRevivePet",location:{rowIdx:1,colIdx:3},spellIds:[24443,19575],maxPoints:2},{fieldName:"pathfinding",location:{rowIdx:2,colIdx:0},spellIds:[19559,19560],maxPoints:2},{fieldName:"bestialSwiftness",location:{rowIdx:2,colIdx:1},spellIds:[19596],maxPoints:1},{fieldName:"unleashedFury",location:{rowIdx:2,colIdx:2},spellIds:[19616,19617,19618,19619,19620],maxPoints:5},{fieldName:"improvedMendPet",location:{rowIdx:3,colIdx:1},spellIds:[19572,19573],maxPoints:2},{fieldName:"ferocity",location:{rowIdx:3,colIdx:2},spellIds:[19598,19599,19600,19601,19602],maxPoints:5},{fieldName:"spiritBond",location:{rowIdx:4,colIdx:0},spellIds:[19578,20895],maxPoints:2},{fieldName:"intimidation",location:{rowIdx:4,colIdx:1},spellIds:[19577],maxPoints:1},{fieldName:"bestialDiscipline",location:{rowIdx:4,colIdx:3},spellIds:[19590,19592],maxPoints:2},{fieldName:"frenzy",location:{rowIdx:5,colIdx:2},spellIds:[19621,19622,19623,19624,19625],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"bestialWrath",location:{rowIdx:6,colIdx:1},spellIds:[19574],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Marksmanship",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/363.jpg",talents:[{fieldName:"improvedConcussiveShot",location:{rowIdx:0,colIdx:1},spellIds:[19407,19412,19413,19414,19415],maxPoints:5},{fieldName:"efficiency",location:{rowIdx:0,colIdx:2},spellIds:[19416,19417,19418,19419,19420],maxPoints:5},{fieldName:"improvedHuntersMark",location:{rowIdx:1,colIdx:1},spellIds:[19421,19422,19423,19424,19425],maxPoints:5},{fieldName:"lethalShots",location:{rowIdx:1,colIdx:2},spellIds:[19426,19427,19429,19430,19431],maxPoints:5},{fieldName:"aimedShot",location:{rowIdx:2,colIdx:0},spellIds:[19434],maxPoints:1},{fieldName:"improvedArcaneShot",location:{rowIdx:2,colIdx:1},spellIds:[19454,19455,19456,19457,19458],maxPoints:5},{fieldName:"hawkEye",location:{rowIdx:2,colIdx:3},spellIds:[19498,19499,19500],maxPoints:3},{fieldName:"improvedSerpentSting",location:{rowIdx:3,colIdx:1},spellIds:[19464,19465,19466,19467,19468],maxPoints:5},{fieldName:"mortalShots",location:{rowIdx:3,colIdx:2},spellIds:[19485,19487,19488,19489,19490],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"scatterShot",location:{rowIdx:4,colIdx:0},spellIds:[19503],maxPoints:1},{fieldName:"barrage",location:{rowIdx:4,colIdx:1},spellIds:[19461,19462,24691],maxPoints:3},{fieldName:"improvedScorpidSting",location:{rowIdx:4,colIdx:2},spellIds:[19491,19493,19494],maxPoints:3},{fieldName:"rangedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[19507,19508,19509,19510,19511],maxPoints:5},{fieldName:"trueshotAura",location:{rowIdx:6,colIdx:1},spellIds:[19506],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Survival",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/362.jpg",talents:[{fieldName:"monsterSlaying",location:{rowIdx:0,colIdx:0},spellIds:[24293,24294,24295],maxPoints:3},{fieldName:"humanoidSlaying",location:{rowIdx:0,colIdx:1},spellIds:[19151,19152,19153],maxPoints:3},{fieldName:"deflection",location:{rowIdx:0,colIdx:2},spellIds:[19295,19297,19298,19300,19301],maxPoints:5},{fieldName:"entrapment",location:{rowIdx:1,colIdx:0},spellIds:[19184,19387,19388,19389,19390],maxPoints:5},{fieldName:"savageStrikes",location:{rowIdx:1,colIdx:1},spellIds:[19159,19160],maxPoints:2},{fieldName:"improvedWingClip",location:{rowIdx:1,colIdx:2},spellIds:[19228,19232,19233,19234,19235],maxPoints:5},{fieldName:"cleverTraps",location:{rowIdx:2,colIdx:0},spellIds:[19239,19245],maxPoints:2},{fieldName:"survivalist",location:{rowIdx:2,colIdx:1},spellIds:[19255,19256,19257,19258,19259],maxPoints:5},{fieldName:"deterrence",location:{rowIdx:2,colIdx:2},spellIds:[19263],maxPoints:1},{fieldName:"trapMastery",location:{rowIdx:3,colIdx:0},spellIds:[19376,19377],maxPoints:2},{fieldName:"surefooted",location:{rowIdx:3,colIdx:1},spellIds:[19290,19294,24283],maxPoints:3},{fieldName:"improvedFeignDeath",location:{rowIdx:3,colIdx:3},spellIds:[19286,19287],maxPoints:2},{fieldName:"killerInstinct",location:{rowIdx:4,colIdx:1},spellIds:[19370,19371,19373],maxPoints:3},{fieldName:"counterattack",location:{rowIdx:4,colIdx:2},spellIds:[19306],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"lightningReflexes",location:{rowIdx:5,colIdx:2},spellIds:[19168,19180,19181,24296,24297],maxPoints:5},{fieldName:"wyvernSting",location:{rowIdx:6,colIdx:1},spellIds:[19386],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),vo=fo([{name:"Arcane",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/81.jpg",talents:[{fieldName:"arcaneSubtlety",location:{rowIdx:0,colIdx:0},spellIds:[11210,12592],maxPoints:2},{fieldName:"arcaneFocus",location:{rowIdx:0,colIdx:1},spellIds:[11222,12839,12840,12841,12842],maxPoints:5},{fieldName:"improvedArcaneMissiles",location:{rowIdx:0,colIdx:2},spellIds:[11237,12463,12464,16769,16770],maxPoints:5},{fieldName:"wandSpecialization",location:{rowIdx:1,colIdx:0},spellIds:[6057,6085],maxPoints:2},{fieldName:"magicAbsorption",location:{rowIdx:1,colIdx:1},spellIds:[29441,29444,29445,29446,29447],maxPoints:5},{fieldName:"arcaneConcentration",location:{rowIdx:1,colIdx:2},spellIds:[11213,12574,12575,12576,12577],maxPoints:5},{fieldName:"magicAttunement",location:{rowIdx:2,colIdx:0},spellIds:[11247,12606],maxPoints:2},{fieldName:"improvedArcaneExplosion",location:{rowIdx:2,colIdx:1},spellIds:[11242,12467,12469],maxPoints:3},{fieldName:"arcaneResilience",location:{rowIdx:2,colIdx:2},spellIds:[28574],maxPoints:1},{fieldName:"improvedManaShield",location:{rowIdx:3,colIdx:0},spellIds:[11252,12605],maxPoints:2},{fieldName:"improvedCounterspell",location:{rowIdx:3,colIdx:1},spellIds:[11255,12598],maxPoints:2},{fieldName:"arcaneMeditation",location:{rowIdx:3,colIdx:3},spellIds:[18462,18463,18464],maxPoints:3},{fieldName:"presenceOfMind",location:{rowIdx:4,colIdx:1},spellIds:[12043],maxPoints:1},{fieldName:"arcaneMind",location:{rowIdx:4,colIdx:2},spellIds:[11232,12500,12501,12502,12503],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"arcaneInstability",location:{rowIdx:5,colIdx:1},spellIds:[15058,15059,15060],maxPoints:3,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"arcanePower",location:{rowIdx:6,colIdx:1},spellIds:[12042],maxPoints:1,prereqLocation:{rowIdx:5,colIdx:1}}]},{name:"Fire",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/41.jpg",talents:[{fieldName:"improvedFireball",location:{rowIdx:0,colIdx:1},spellIds:[11069,12338,12339,12340,12341],maxPoints:5},{fieldName:"impact",location:{rowIdx:0,colIdx:2},spellIds:[11103,12357,12358,12359,12360],maxPoints:5},{fieldName:"ignite",location:{rowIdx:1,colIdx:0},spellIds:[11119,11120,12846,12847,12848],maxPoints:5},{fieldName:"flameThrowing",location:{rowIdx:1,colIdx:1},spellIds:[11100,12353],maxPoints:2},{fieldName:"improvedFireBlast",location:{rowIdx:1,colIdx:2},spellIds:[11078,11080,12342],maxPoints:3},{fieldName:"incinerate",location:{rowIdx:2,colIdx:0},spellIds:[18459,18460],maxPoints:2},{fieldName:"improvedFlamestrike",location:{rowIdx:2,colIdx:1},spellIds:[11108,12349,12350],maxPoints:3},{fieldName:"pyroblast",location:{rowIdx:2,colIdx:2},spellIds:[11366],maxPoints:1},{fieldName:"burningSoul",location:{rowIdx:2,colIdx:3},spellIds:[11083,12351],maxPoints:2},{fieldName:"improvedScorch",location:{rowIdx:3,colIdx:0},spellIds:[11095,12872,12873],maxPoints:3},{fieldName:"improvedFireWard",location:{rowIdx:3,colIdx:1},spellIds:[11094,13043],maxPoints:2},{fieldName:"masterOfElements",location:{rowIdx:3,colIdx:3},spellIds:[29074,29075,29076],maxPoints:3},{fieldName:"criticalMass",location:{rowIdx:4,colIdx:1},spellIds:[11115,11367,11368],maxPoints:3},{fieldName:"blastWave",location:{rowIdx:4,colIdx:2},spellIds:[11113],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"firePower",location:{rowIdx:5,colIdx:2},spellIds:[11124,12378,12398,12399,12400],maxPoints:5},{fieldName:"combustion",location:{rowIdx:6,colIdx:1},spellIds:[11129],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Frost",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/61.jpg",talents:[{fieldName:"frostWarding",location:{rowIdx:0,colIdx:0},spellIds:[11189,28332],maxPoints:2},{fieldName:"improvedFrostbolt",location:{rowIdx:0,colIdx:1},spellIds:[11070,12473,16763,16765,16766],maxPoints:5},{fieldName:"elementalPrecision",location:{rowIdx:0,colIdx:2},spellIds:[29438,29439,29440],maxPoints:3},{fieldName:"iceShards",location:{rowIdx:1,colIdx:0},spellIds:[11207,12672,15047,15052,15053],maxPoints:5},{fieldName:"frostbite",location:{rowIdx:1,colIdx:1},spellIds:[11071,12496,12497],maxPoints:3},{fieldName:"improvedFrostNova",location:{rowIdx:1,colIdx:2},spellIds:[11165,12475],maxPoints:2},{fieldName:"permafrost",location:{rowIdx:1,colIdx:3},spellIds:[11175,12569,12571],maxPoints:3},{fieldName:"piercingIce",location:{rowIdx:2,colIdx:0},spellIds:[11151,12952,12953],maxPoints:3},{fieldName:"coldSnap",location:{rowIdx:2,colIdx:1},spellIds:[12472],maxPoints:1},{fieldName:"improvedBlizzard",location:{rowIdx:2,colIdx:3},spellIds:[11185,12487,12488],maxPoints:3},{fieldName:"arcticReach",location:{rowIdx:3,colIdx:0},spellIds:[16757,16758],maxPoints:2},{fieldName:"frostChanneling",location:{rowIdx:3,colIdx:1},spellIds:[11160,12518,12519],maxPoints:3},{fieldName:"shatter",location:{rowIdx:3,colIdx:2},spellIds:[11170,12982,12983,12984,12985],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"iceBlock",location:{rowIdx:4,colIdx:1},spellIds:[11958],maxPoints:1},{fieldName:"improvedConeOfCold",location:{rowIdx:4,colIdx:2},spellIds:[11190,12489,12490],maxPoints:3},{fieldName:"wintersChill",location:{rowIdx:5,colIdx:2},spellIds:[11180,28592,28593,28594,28595],maxPoints:5},{fieldName:"iceBarrier",location:{rowIdx:6,colIdx:1},spellIds:[11426],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),bo=fo([{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/382.jpg",talents:[{fieldName:"divineStrength",location:{rowIdx:0,colIdx:1},spellIds:[20262,20263,20264,20265,20266],maxPoints:5},{fieldName:"divineIntellect",location:{rowIdx:0,colIdx:2},spellIds:[20257,20258,20259,20260,20261],maxPoints:5},{fieldName:"spiritualFocus",location:{rowIdx:1,colIdx:1},spellIds:[20205,20206,20207,20208,20209],maxPoints:5},{fieldName:"improvedSealOfRighteousness",location:{rowIdx:1,colIdx:2},spellIds:[20224,20225,20330,20331,20332],maxPoints:5},{fieldName:"healingLight",location:{rowIdx:2,colIdx:0},spellIds:[20237,20238,20239],maxPoints:3},{fieldName:"consecration",location:{rowIdx:2,colIdx:1},spellIds:[26573],maxPoints:1},{fieldName:"improvedLayOnHands",location:{rowIdx:2,colIdx:2},spellIds:[20234,20235],maxPoints:2},{fieldName:"unyieldingFaith",location:{rowIdx:2,colIdx:3},spellIds:[9453,25836],maxPoints:2},{fieldName:"illumination",location:{rowIdx:3,colIdx:1},spellIds:[20210,20212,20213,20214,20215],maxPoints:5},{fieldName:"improvedBlessingOfWisdom",location:{rowIdx:3,colIdx:2},spellIds:[20244,20245],maxPoints:2},{fieldName:"divineFavor",location:{rowIdx:4,colIdx:1},spellIds:[20216],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"lastingJudgement",location:{rowIdx:4,colIdx:2},spellIds:[20359,20360,20361],maxPoints:3},{fieldName:"holyPower",location:{rowIdx:5,colIdx:2},spellIds:[5923,5924,5925,5926,25829],maxPoints:5},{fieldName:"holyShock",location:{rowIdx:6,colIdx:1},spellIds:[20473],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/383.jpg",talents:[{fieldName:"improvedDevotionAura",location:{rowIdx:0,colIdx:1},spellIds:[20138,20139,20140,20141,20142],maxPoints:5},{fieldName:"redoubt",location:{rowIdx:0,colIdx:2},spellIds:[20127,20130,20135,20136,20137],maxPoints:5},{fieldName:"precision",location:{rowIdx:1,colIdx:0},spellIds:[20189,20192,20193],maxPoints:3},{fieldName:"guardiansFavor",location:{rowIdx:1,colIdx:1},spellIds:[20174,20175],maxPoints:2},{fieldName:"toughness",location:{rowIdx:1,colIdx:3},spellIds:[20143,20144,20145,20146,20147],maxPoints:5},{fieldName:"blessingOfKings",location:{rowIdx:2,colIdx:0},spellIds:[20217],maxPoints:1},{fieldName:"improvedRighteousFury",location:{rowIdx:2,colIdx:1},spellIds:[20468,20469,20470],maxPoints:3},{fieldName:"shieldSpecialization",location:{rowIdx:2,colIdx:2},spellIds:[20148,20149,20150],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"anticipation",location:{rowIdx:2,colIdx:3},spellIds:[20096,20097,20098,20099,20100],maxPoints:5},{fieldName:"improvedHammerOfJustice",location:{rowIdx:3,colIdx:1},spellIds:[20487,20488,20489],maxPoints:3},{fieldName:"improvedConcentrationAura",location:{rowIdx:3,colIdx:2},spellIds:[20254,20255,20256],maxPoints:3},{fieldName:"blessingOfSanctuary",location:{rowIdx:4,colIdx:1},spellIds:[20911],maxPoints:1},{fieldName:"reckoning",location:{rowIdx:4,colIdx:2},spellIds:[20177,20179,20180,20181,20182],maxPoints:5},{fieldName:"oneHandedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[20196,20197,20198,20199,20200],maxPoints:5},{fieldName:"holyShield",location:{rowIdx:6,colIdx:1},spellIds:[20925],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Retribution",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/381.jpg",talents:[{fieldName:"improvedBlessingOfMight",location:{rowIdx:0,colIdx:1},spellIds:[20042,20045,20046,20047,20048],maxPoints:5},{fieldName:"benediction",location:{rowIdx:0,colIdx:2},spellIds:[20101,20102,20103,20104,20105],maxPoints:5},{fieldName:"improvedJudgement",location:{rowIdx:1,colIdx:0},spellIds:[25956,25957],maxPoints:2},{fieldName:"improvedSealOfTheCrusader",location:{rowIdx:1,colIdx:1},spellIds:[20335,20336,20337],maxPoints:3},{fieldName:"deflection",location:{rowIdx:1,colIdx:2},spellIds:[20060,20061,20062,20063,20064],maxPoints:5},{fieldName:"vindication",location:{rowIdx:2,colIdx:0},spellIds:[9452,26016,26021],maxPoints:3},{fieldName:"conviction",location:{rowIdx:2,colIdx:1},spellIds:[20117,20118,20119,20120,20121],maxPoints:5},{fieldName:"sealOfCommand",location:{rowIdx:2,colIdx:2},spellIds:[20375],maxPoints:1},{fieldName:"pursuitOfJustice",location:{rowIdx:2,colIdx:3},spellIds:[26022,26023],maxPoints:2},{fieldName:"eyeForAnEye",location:{rowIdx:3,colIdx:0},spellIds:[9799,25988],maxPoints:2},{fieldName:"improvedRetributionAura",location:{rowIdx:3,colIdx:2},spellIds:[20091,20092],maxPoints:2},{fieldName:"twoHandedWeaponSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[20111,20112,20113],maxPoints:3},{fieldName:"sanctityAura",location:{rowIdx:4,colIdx:2},spellIds:[20218],maxPoints:1},{fieldName:"vengeance",location:{rowIdx:5,colIdx:1},spellIds:[20049,20056,20057,20058,20059],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"repentance",location:{rowIdx:6,colIdx:1},spellIds:[20066],maxPoints:1}]}]),So=fo([{name:"Discipline",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/201.jpg",talents:[{fieldName:"unbreakableWill",location:{rowIdx:0,colIdx:1},spellIds:[14522,14788,14789,14790,14791],maxPoints:5},{fieldName:"wandSpecialization",location:{rowIdx:0,colIdx:2},spellIds:[14524,14525,14526,14527,14528],maxPoints:5},{fieldName:"silentResolve",location:{rowIdx:1,colIdx:0},spellIds:[14523,14784,14785,14786,14787],maxPoints:5},{fieldName:"improvedPowerWordFortitude",location:{rowIdx:1,colIdx:1},spellIds:[14749,14767],maxPoints:2},{fieldName:"improvedPowerWordShield",location:{rowIdx:1,colIdx:2},spellIds:[14748,14768,14769],maxPoints:3},{fieldName:"martyrdom",location:{rowIdx:1,colIdx:3},spellIds:[14531,14774],maxPoints:2},{fieldName:"innerFocus",location:{rowIdx:2,colIdx:1},spellIds:[14751],maxPoints:1},{fieldName:"meditation",location:{rowIdx:2,colIdx:2},spellIds:[14521,14776,14777],maxPoints:3},{fieldName:"improvedInnerFire",location:{rowIdx:3,colIdx:0},spellIds:[14747,14770,14771],maxPoints:3},{fieldName:"mentalAgility",location:{rowIdx:3,colIdx:1},spellIds:[14520,14780,14781,14782,14783],maxPoints:5},{fieldName:"improvedManaBurn",location:{rowIdx:3,colIdx:3},spellIds:[14750,14772],maxPoints:2},{fieldName:"mentalStrength",location:{rowIdx:4,colIdx:1},spellIds:[18551,18552,18553,18554,18555],maxPoints:5},{fieldName:"divineSpirit",location:{rowIdx:4,colIdx:2},spellIds:[14752],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"forceOfWill",location:{rowIdx:5,colIdx:2},spellIds:[18544,18547,18548,18549,18550],maxPoints:5},{fieldName:"powerInfusion",location:{rowIdx:6,colIdx:1},spellIds:[10060],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/202.jpg",talents:[{fieldName:"healingFocus",location:{rowIdx:0,colIdx:0},spellIds:[14913,15012],maxPoints:2},{fieldName:"improvedRenew",location:{rowIdx:0,colIdx:1},spellIds:[14908,15020,17191],maxPoints:3},{fieldName:"holySpecialization",location:{rowIdx:0,colIdx:2},spellIds:[14889,15008,15009,15010,15011],maxPoints:5},{fieldName:"spellWarding",location:{rowIdx:1,colIdx:1},spellIds:[27900,27901,27902,27903,27904],maxPoints:5},{fieldName:"divineFury",location:{rowIdx:1,colIdx:2},spellIds:[18530,18531,18533,18534,18535],maxPoints:5},{fieldName:"holyNova",location:{rowIdx:2,colIdx:0},spellIds:[15237],maxPoints:1},{fieldName:"blessedRecovery",location:{rowIdx:2,colIdx:1},spellIds:[27811,27815,27816],maxPoints:3},{fieldName:"inspiration",location:{rowIdx:2,colIdx:3},spellIds:[14892,15362,15363],maxPoints:3},{fieldName:"holyReach",location:{rowIdx:3,colIdx:0},spellIds:[27789,27790],maxPoints:2},{fieldName:"improvedHealing",location:{rowIdx:3,colIdx:1},spellIds:[14912,15013,15014],maxPoints:3},{fieldName:"searingLight",location:{rowIdx:3,colIdx:2},spellIds:[14909,15017],maxPoints:2,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"improvedPrayerOfHealing",location:{rowIdx:4,colIdx:0},spellIds:[14911,15018],maxPoints:2},{fieldName:"spiritOfRedemption",location:{rowIdx:4,colIdx:1},spellIds:[20711],maxPoints:1},{fieldName:"spiritualGuidance",location:{rowIdx:4,colIdx:2},spellIds:[14901,15028,15029,15030,15031],maxPoints:5},{fieldName:"spiritualHealing",location:{rowIdx:5,colIdx:2},spellIds:[14898,15349,15354,15355,15356],maxPoints:5},{fieldName:"lightwell",location:{rowIdx:6,colIdx:1},spellIds:[724],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Shadow",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/203.jpg",talents:[{fieldName:"spiritTap",location:{rowIdx:0,colIdx:1},spellIds:[15270,15335,15336,15337,15338],maxPoints:5},{fieldName:"blackout",location:{rowIdx:0,colIdx:2},spellIds:[15268,15323,15324,15325,15326],maxPoints:5},{fieldName:"shadowAffinity",location:{rowIdx:1,colIdx:0},spellIds:[15318,15272,15320],maxPoints:3},{fieldName:"improvedShadowWordPain",location:{rowIdx:1,colIdx:1},spellIds:[15275,15317],maxPoints:2},{fieldName:"shadowFocus",location:{rowIdx:1,colIdx:2},spellIds:[15260,15327,15328],maxPoints:5},{fieldName:"improvedPsychicScream",location:{rowIdx:2,colIdx:0},spellIds:[15392,15448],maxPoints:2},{fieldName:"improvedMindBlast",location:{rowIdx:2,colIdx:1},spellIds:[15273,15312,15313,15314,15316],maxPoints:5},{fieldName:"mindFlay",location:{rowIdx:2,colIdx:2},spellIds:[15407],maxPoints:1},{fieldName:"improvedFade",location:{rowIdx:3,colIdx:1},spellIds:[15274,15311],maxPoints:2},{fieldName:"shadowReach",location:{rowIdx:3,colIdx:2},spellIds:[17322,17323,17325],maxPoints:3},{fieldName:"shadowWeaving",location:{rowIdx:3,colIdx:3},spellIds:[15257,15331,15332,15333,15334],maxPoints:5},{fieldName:"silence",location:{rowIdx:4,colIdx:0},spellIds:[15487],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:0}},{fieldName:"vampiricEmbrace",location:{rowIdx:4,colIdx:1},spellIds:[15286],maxPoints:1},{fieldName:"improvedVampiricEmbrace",location:{rowIdx:4,colIdx:2},spellIds:[27839,27840],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"darkness",location:{rowIdx:5,colIdx:2},spellIds:[15259,15307,15308,15309,15310],maxPoints:5},{fieldName:"shadowform",location:{rowIdx:6,colIdx:1},spellIds:[15473],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),xo=fo([{name:"Assassination",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/182.jpg",talents:[{fieldName:"improvedEviscerate",location:{rowIdx:0,colIdx:0},spellIds:[14162,14163,14164],maxPoints:3},{fieldName:"remorselessAttacks",location:{rowIdx:0,colIdx:1},spellIds:[14144,14148],maxPoints:2},{fieldName:"malice",location:{rowIdx:0,colIdx:2},spellIds:[14138,14139,14140,14141,14142],maxPoints:5},{fieldName:"ruthlessness",location:{rowIdx:1,colIdx:0},spellIds:[14156,14160,14161],maxPoints:3},{fieldName:"murder",location:{rowIdx:1,colIdx:1},spellIds:[14158,14159],maxPoints:2},{fieldName:"improvedSliceAndDice",location:{rowIdx:1,colIdx:3},spellIds:[14165,14166,14167],maxPoints:3},{fieldName:"relentlessStrikes",location:{rowIdx:2,colIdx:0},spellIds:[14179],maxPoints:1},{fieldName:"improvedExposeArmor",location:{rowIdx:2,colIdx:1},spellIds:[14168,14169],maxPoints:2},{fieldName:"lethality",location:{rowIdx:2,colIdx:2},spellIds:[14128,14132,14135,14136,14137],maxPoints:5,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"vilePoisons",location:{rowIdx:3,colIdx:1},spellIds:[16513,16514,16515,16719,16720],maxPoints:5},{fieldName:"improvedPoisons",location:{rowIdx:3,colIdx:2},spellIds:[14113,14114,14115,14116,14117],maxPoints:5},{fieldName:"coldBlood",location:{rowIdx:4,colIdx:1},spellIds:[14177],maxPoints:1},{fieldName:"improvedKidneyShot",location:{rowIdx:4,colIdx:2},spellIds:[14174,14175,14176],maxPoints:3},{fieldName:"sealFate",location:{rowIdx:5,colIdx:1},spellIds:[14186,14190,14193,14194,14195],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"vigor",location:{rowIdx:6,colIdx:1},spellIds:[14983],maxPoints:1}]},{name:"Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/181.jpg",talents:[{fieldName:"improvedGouge",location:{rowIdx:0,colIdx:0},spellIds:[13741,13792,13793],maxPoints:3},{fieldName:"improvedSinisterStrike",location:{rowIdx:0,colIdx:1},spellIds:[13732,13863],maxPoints:2},{fieldName:"lightningReflexes",location:{rowIdx:0,colIdx:2},spellIds:[13712,13788,13789,13790,13791],maxPoints:5},{fieldName:"improvedBackstab",location:{rowIdx:1,colIdx:0},spellIds:[13733,13865,13866],maxPoints:3},{fieldName:"deflection",location:{rowIdx:1,colIdx:1},spellIds:[13713,13853,13854,13855,13856],maxPoints:5},{fieldName:"precision",location:{rowIdx:1,colIdx:2},spellIds:[13705,13832,13843,13844,13845],maxPoints:5},{fieldName:"endurance",location:{rowIdx:2,colIdx:0},spellIds:[13742,13872],maxPoints:2},{fieldName:"riposte",location:{rowIdx:2,colIdx:1},spellIds:[14251],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"improvedSprint",location:{rowIdx:2,colIdx:3},spellIds:[13743,13875],maxPoints:2},{fieldName:"improvedKick",location:{rowIdx:3,colIdx:0},spellIds:[13754,13867],maxPoints:2},{fieldName:"daggerSpecialization",location:{rowIdx:3,colIdx:1},spellIds:[13706,13804,13805,13806,13807],maxPoints:5},{fieldName:"dualWieldSpecialization",location:{rowIdx:3,colIdx:2},spellIds:[13715,13848,13849,13851,13852],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"maceSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[13709,13800,13801,13802,13803],maxPoints:5},{fieldName:"bladeFlurry",location:{rowIdx:4,colIdx:1},spellIds:[13877],maxPoints:1},{fieldName:"swordSpecialization",location:{rowIdx:4,colIdx:2},spellIds:[13960,13961,13962,13963,13964],maxPoints:5},{fieldName:"fistWeaponSpecialization",location:{rowIdx:4,colIdx:3},spellIds:[13707,13966,13967,13968,13969],maxPoints:5},{fieldName:"weaponExpertise",location:{rowIdx:5,colIdx:1},spellIds:[30919,30920],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"aggression",location:{rowIdx:5,colIdx:2},spellIds:[18427,18428,18429],maxPoints:3},{fieldName:"adrenalineRush",location:{rowIdx:6,colIdx:1},spellIds:[13750],maxPoints:1}]},{name:"Subtlety",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/183.jpg",talents:[{fieldName:"masterOfDeception",location:{rowIdx:0,colIdx:1},spellIds:[13958,13970,13971,13972,13973],maxPoints:5},{fieldName:"opportunity",location:{rowIdx:0,colIdx:2},spellIds:[14057,14072,14073,14074,14075],maxPoints:5},{fieldName:"sleightOfHand",location:{rowIdx:1,colIdx:0},spellIds:[30892,30893],maxPoints:2},{fieldName:"elusiveness",location:{rowIdx:1,colIdx:1},spellIds:[13981,14066],maxPoints:2},{fieldName:"camouflage",location:{rowIdx:1,colIdx:2},spellIds:[13975,14062,14063,14064,14065],maxPoints:5},{fieldName:"initiative",location:{rowIdx:2,colIdx:0},spellIds:[13976,13979,13980],maxPoints:3},{fieldName:"ghostlyStrike",location:{rowIdx:2,colIdx:1},spellIds:[14278],maxPoints:1},{fieldName:"improvedAmbush",location:{rowIdx:2,colIdx:2},spellIds:[14079,14080,14081],maxPoints:3},{fieldName:"setup",location:{rowIdx:3,colIdx:0},spellIds:[13983,14070,14071],maxPoints:3},{fieldName:"improvedSap",location:{rowIdx:3,colIdx:1},spellIds:[14076,14094,14095],maxPoints:3},{fieldName:"serratedBlades",location:{rowIdx:3,colIdx:2},spellIds:[14171,14172,14173],maxPoints:3},{fieldName:"heightenedSenses",location:{rowIdx:4,colIdx:0},spellIds:[30894,30895],maxPoints:2},{fieldName:"preparation",location:{rowIdx:4,colIdx:1},spellIds:[14185],maxPoints:1},{fieldName:"dirtyDeeds",location:{rowIdx:4,colIdx:2},spellIds:[14082,14083],maxPoints:2},{fieldName:"hemorrhage",location:{rowIdx:4,colIdx:3},spellIds:[16511],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"deadliness",location:{rowIdx:5,colIdx:2},spellIds:[30902,30903,30904,30905,30906],maxPoints:5},{fieldName:"premeditation",location:{rowIdx:6,colIdx:1},spellIds:[14183],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),yo=fo([{name:"Elemental",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/261.jpg",talents:[{fieldName:"convection",location:{rowIdx:0,colIdx:1},spellIds:[16039,16109,16110,16111,16112],maxPoints:5},{fieldName:"concussion",location:{rowIdx:0,colIdx:2},spellIds:[16035,16105,16106,16107,16108],maxPoints:5},{fieldName:"earthsGrasp",location:{rowIdx:1,colIdx:0},spellIds:[16043,16130],maxPoints:2},{fieldName:"elementalWarding",location:{rowIdx:1,colIdx:1},spellIds:[28996,28997,28998],maxPoints:3},{fieldName:"callOfFlame",location:{rowIdx:1,colIdx:2},spellIds:[16038,16160,16161],maxPoints:3},{fieldName:"elementalFocus",location:{rowIdx:2,colIdx:0},spellIds:[16164],maxPoints:1},{fieldName:"reverberation",location:{rowIdx:2,colIdx:1},spellIds:[16040,16113,16114,16115,16116],maxPoints:5},{fieldName:"callOfThunder",location:{rowIdx:2,colIdx:2},spellIds:[16041,16117,16118,16119,16120],maxPoints:5},{fieldName:"improvedFireTotems",location:{rowIdx:3,colIdx:0},spellIds:[16086,16544],maxPoints:2},{fieldName:"eyeOfTheStorm",location:{rowIdx:3,colIdx:1},spellIds:[29062,29064,29065],maxPoints:3},{fieldName:"elementalDevastation",location:{rowIdx:3,colIdx:3},spellIds:[30160,29179,29180],maxPoints:3},{fieldName:"stormReach",location:{rowIdx:4,colIdx:0},spellIds:[28999,29e3],maxPoints:2},{fieldName:"elementalFury",location:{rowIdx:4,colIdx:1},spellIds:[16089],maxPoints:1},{fieldName:"lightningMastery",location:{rowIdx:5,colIdx:2},spellIds:[16578,16579,16580,16581,16582],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"elementalMastery",location:{rowIdx:6,colIdx:1},spellIds:[16166],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Enhancement",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/263.jpg",talents:[{fieldName:"ancestralKnowledge",location:{rowIdx:0,colIdx:1},spellIds:[17485,17486,17487,17488,17489],maxPoints:5},{fieldName:"shieldSpecialization",location:{rowIdx:0,colIdx:2},spellIds:[16253,16298],maxPoints:5},{fieldName:"guardianTotems",location:{rowIdx:1,colIdx:0},spellIds:[16258,16293],maxPoints:2},{fieldName:"thunderingStrikes",location:{rowIdx:1,colIdx:1},spellIds:[16255,16302,16303,16304,16305],maxPoints:5},{fieldName:"improvedGhostWolf",location:{rowIdx:1,colIdx:2},spellIds:[16262,16287],maxPoints:2},{fieldName:"improvedLightningShield",location:{rowIdx:1,colIdx:3},spellIds:[16261,16290],maxPoints:3},{fieldName:"enhancingTotems",location:{rowIdx:2,colIdx:0},spellIds:[16259,16295],maxPoints:2},{fieldName:"twoHandedAxesAndMaces",location:{rowIdx:2,colIdx:2},spellIds:[16269],maxPoints:1},{fieldName:"anticipation",location:{rowIdx:2,colIdx:3},spellIds:[16254,16271,16272,16273,16274],maxPoints:5},{fieldName:"flurry",location:{rowIdx:3,colIdx:1},spellIds:[16256,16281,16282,16283,16284],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"toughness",location:{rowIdx:3,colIdx:2},spellIds:[16252,16306,16307,16308,16309],maxPoints:5},{fieldName:"improvedWeaponTotems",location:{rowIdx:4,colIdx:0},spellIds:[29192,29193],maxPoints:2},{fieldName:"elementalWeapons",location:{rowIdx:4,colIdx:1},spellIds:[16266,29079,29080],maxPoints:3},{fieldName:"parry",location:{rowIdx:4,colIdx:2},spellIds:[16268],maxPoints:1},{fieldName:"weaponMastery",location:{rowIdx:5,colIdx:2},spellIds:[29082,29084,29086,29087,29088],maxPoints:5},{fieldName:"stormstrike",location:{rowIdx:6,colIdx:1},spellIds:[17364],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/262.jpg",talents:[{fieldName:"improvedHealingWave",location:{rowIdx:0,colIdx:1},spellIds:[16182,16226,16227,16228,16229],maxPoints:5},{fieldName:"tidalFocus",location:{rowIdx:0,colIdx:2},spellIds:[16179,16214,16215,16216,16217],maxPoints:5},{fieldName:"improvedReincarnation",location:{rowIdx:1,colIdx:0},spellIds:[16184,16209],maxPoints:2},{fieldName:"ancestralHealing",location:{rowIdx:1,colIdx:1},spellIds:[16176,16235,16240],maxPoints:3},{fieldName:"totemicFocus",location:{rowIdx:1,colIdx:2},spellIds:[16173,16222,16223,16224,16225],maxPoints:5},{fieldName:"naturesGuidance",location:{rowIdx:2,colIdx:0},spellIds:[16180,16196,16198],maxPoints:3},{fieldName:"healingFocus",location:{rowIdx:2,colIdx:1},spellIds:[16181,16230,16232,16233,16234],maxPoints:5},{fieldName:"totemicMastery",location:{rowIdx:2,colIdx:2},spellIds:[16189],maxPoints:1},{fieldName:"healingGrace",location:{rowIdx:2,colIdx:3},spellIds:[29187,29189,29191],maxPoints:3},{fieldName:"restorativeTotems",location:{rowIdx:3,colIdx:1},spellIds:[16187,16205,16206,16207,16208],maxPoints:5},{fieldName:"tidalMastery",location:{rowIdx:3,colIdx:2},spellIds:[16194,16218,16219,16220,16221],maxPoints:5},{fieldName:"healingWay",location:{rowIdx:4,colIdx:0},spellIds:[29206,29202,29205],maxPoints:3},{fieldName:"naturesSwiftness",location:{rowIdx:4,colIdx:2},spellIds:[16188],maxPoints:1},{fieldName:"purification",location:{rowIdx:5,colIdx:2},spellIds:[16178,16210,16211,16212,16213],maxPoints:5},{fieldName:"manaTideTotem",location:{rowIdx:6,colIdx:1},spellIds:[16190],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}}]}]),Eo=fo([{name:"Affliction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/302.jpg",talents:[{fieldName:"suppression",location:{rowIdx:0,colIdx:1},spellIds:[18174,18175,18176,18177,18178],maxPoints:5},{fieldName:"improvedCorruption",location:{rowIdx:0,colIdx:2},spellIds:[17810,17811,17812,17813,17814],maxPoints:5},{fieldName:"improvedCurseOfWeakness",location:{rowIdx:1,colIdx:0},spellIds:[18179,18180,18181],maxPoints:3},{fieldName:"improvedDrainSoul",location:{rowIdx:1,colIdx:1},spellIds:[18213,18372],maxPoints:2},{fieldName:"improvedLifeTap",location:{rowIdx:1,colIdx:2},spellIds:[18182,18183],maxPoints:2},{fieldName:"improvedDrainLife",location:{rowIdx:1,colIdx:3},spellIds:[17804,17805,17806,17807,17808],maxPoints:5},{fieldName:"improvedCurseOfAgony",location:{rowIdx:2,colIdx:0},spellIds:[18827,18829,18830],maxPoints:3},{fieldName:"felConcentration",location:{rowIdx:2,colIdx:1},spellIds:[17783,17784,17785,17786,17787],maxPoints:5},{fieldName:"amplifyCurse",location:{rowIdx:2,colIdx:2},spellIds:[18288],maxPoints:1},{fieldName:"grimReach",location:{rowIdx:3,colIdx:0},spellIds:[18218,18219],maxPoints:2},{fieldName:"nightfall",location:{rowIdx:3,colIdx:1},spellIds:[18094,18095],maxPoints:2},{fieldName:"improvedDrainMana",location:{rowIdx:3,colIdx:3},spellIds:[17864,18393],maxPoints:2},{fieldName:"siphonLife",location:{rowIdx:4,colIdx:1},spellIds:[18265],maxPoints:1},{fieldName:"curseOfExhaustion",location:{rowIdx:4,colIdx:2},spellIds:[18223],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"improvedCurseOfExhaustion",location:{rowIdx:4,colIdx:3},spellIds:[18310,18311,18312,18313],maxPoints:4,prereqLocation:{rowIdx:4,colIdx:2}},{fieldName:"shadowMastery",location:{rowIdx:5,colIdx:1},spellIds:[18271,18272,18273,18274,18275],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"darkPact",location:{rowIdx:6,colIdx:1},spellIds:[18220],maxPoints:1}]},{name:"Demonology",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/303.jpg",talents:[{fieldName:"improvedHealthstone",location:{rowIdx:0,colIdx:0},spellIds:[18692,18693],maxPoints:2},{fieldName:"improvedImp",location:{rowIdx:0,colIdx:1},spellIds:[18694,18695,18696],maxPoints:3},{fieldName:"demonicEmbrace",location:{rowIdx:0,colIdx:2},spellIds:[18697,18698,18699,18700,18701],maxPoints:5},{fieldName:"improvedHealthFunnel",location:{rowIdx:1,colIdx:0},spellIds:[18703,18704],maxPoints:2},{fieldName:"improvedVoidwalker",location:{rowIdx:1,colIdx:1},spellIds:[18705,18706,18707],maxPoints:3},{fieldName:"felIntellect",location:{rowIdx:1,colIdx:2},spellIds:[18731,18743,18744,18745,18746],maxPoints:5},{fieldName:"improvedSayaad",location:{rowIdx:2,colIdx:0},spellIds:[18754,18755,18756],maxPoints:3},{fieldName:"felDomination",location:{rowIdx:2,colIdx:1},spellIds:[18708],maxPoints:1},{fieldName:"felStamina",location:{rowIdx:2,colIdx:2},spellIds:[18748],maxPoints:5},{fieldName:"masterSummoner",location:{rowIdx:3,colIdx:1},spellIds:[18709,18710],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"unholyPower",location:{rowIdx:3,colIdx:2},spellIds:[18769,18770,18771,18772,18773],maxPoints:5},{fieldName:"improvedSubjugateDemon",location:{rowIdx:4,colIdx:0},spellIds:[18821,18823,18824,18825],maxPoints:5},{fieldName:"demonicSacrifice",location:{rowIdx:4,colIdx:1},spellIds:[18788],maxPoints:1},{fieldName:"improvedFirestone",location:{rowIdx:4,colIdx:3},spellIds:[18767,18768],maxPoints:2},{fieldName:"masterDemonologist",location:{rowIdx:5,colIdx:2},spellIds:[23785,23822,23823,23824,23825],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"soulLink",location:{rowIdx:6,colIdx:1},spellIds:[19028],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"improvedSpellstone",location:{rowIdx:6,colIdx:2},spellIds:[18774,18775],maxPoints:2}]},{name:"Destruction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/301.jpg",talents:[{fieldName:"improvedShadowBolt",location:{rowIdx:0,colIdx:1},spellIds:[17793,17796,17801,17802,17803],maxPoints:5},{fieldName:"cataclysm",location:{rowIdx:0,colIdx:2},spellIds:[17778,17779,17780,17781,17782],maxPoints:5},{fieldName:"bane",location:{rowIdx:1,colIdx:1},spellIds:[17788,17789,17790,17791,17792],maxPoints:5},{fieldName:"aftermath",location:{rowIdx:1,colIdx:2},spellIds:[18119,18120,18121,18122,18123],maxPoints:5},{fieldName:"improvedFirebolt",location:{rowIdx:2,colIdx:0},spellIds:[18126,18127],maxPoints:2},{fieldName:"improvedLashOfPain",location:{rowIdx:2,colIdx:1},spellIds:[18128],maxPoints:2},{fieldName:"devastation",location:{rowIdx:2,colIdx:2},spellIds:[18130,18131,18132,18133,18134],maxPoints:5},{fieldName:"shadowburn",location:{rowIdx:2,colIdx:3},spellIds:[17877],maxPoints:1},{fieldName:"intensity",location:{rowIdx:3,colIdx:0},spellIds:[18135,18136],maxPoints:2},{fieldName:"destructiveReach",location:{rowIdx:3,colIdx:1},spellIds:[17917,17918],maxPoints:2},{fieldName:"improvedSearingPain",location:{rowIdx:3,colIdx:3},spellIds:[17927,17929,17930,17931,17932],maxPoints:5},{fieldName:"pyroclasm",location:{rowIdx:4,colIdx:0},spellIds:[18096,18073],maxPoints:2,prereqLocation:{rowIdx:3,colIdx:0}},{fieldName:"improvedImmolate",location:{rowIdx:4,colIdx:1},spellIds:[17815,17833,17834,17835,17836],maxPoints:5},{fieldName:"ruin",location:{rowIdx:4,colIdx:2},spellIds:[17959],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"emberstorm",location:{rowIdx:5,colIdx:2},spellIds:[17954,17955,17956,17957,17958],maxPoints:5},{fieldName:"conflagrate",location:{rowIdx:6,colIdx:1},spellIds:[17962],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Po=fo([{name:"Arms",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/161.jpg",talents:[{fieldName:"improvedHeroicStrike",location:{rowIdx:0,colIdx:0},spellIds:[12282,12663,12664],maxPoints:3},{fieldName:"deflection",location:{rowIdx:0,colIdx:1},spellIds:[16462,16463,16464,16465,16466],maxPoints:5},{fieldName:"improvedRend",location:{rowIdx:0,colIdx:2},spellIds:[12286,12658,12659],maxPoints:3},{fieldName:"improvedCharge",location:{rowIdx:1,colIdx:0},spellIds:[12285,12697],maxPoints:2},{fieldName:"tacticalMastery",location:{rowIdx:1,colIdx:1},spellIds:[12295,12676,12677,12678,12679],maxPoints:5},{fieldName:"improvedThunderClap",location:{rowIdx:1,colIdx:3},spellIds:[12287,12665,12666],maxPoints:3},{fieldName:"improvedOverpower",location:{rowIdx:2,colIdx:0},spellIds:[12290,12963],maxPoints:2},{fieldName:"angerManagement",location:{rowIdx:2,colIdx:1},spellIds:[12296],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"deepWounds",location:{rowIdx:2,colIdx:2},spellIds:[12834,12849,12867],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"twoHandedWeaponSpecialization",location:{rowIdx:3,colIdx:1},spellIds:[12163,12711,12712,12713,12714],maxPoints:5},{fieldName:"impale",location:{rowIdx:3,colIdx:2},spellIds:[16493,16494],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"axeSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[12700,12781,12783,12784,12785],maxPoints:5},{fieldName:"sweepingStrikes",location:{rowIdx:4,colIdx:1},spellIds:[12292],maxPoints:1},{fieldName:"maceSpecialization",location:{rowIdx:4,colIdx:2},spellIds:[12284,12701,12702,12703,12704],maxPoints:5},{fieldName:"swordSpecialization",location:{rowIdx:4,colIdx:3},spellIds:[12281,12812,12813,12814,12815],maxPoints:5},{fieldName:"polearmSpecialization",location:{rowIdx:5,colIdx:0},spellIds:[12165,12830,12831,12832,12833],maxPoints:5},{fieldName:"improvedHamstring",location:{rowIdx:5,colIdx:2},spellIds:[12289,12668,23695],maxPoints:3},{fieldName:"mortalStrike",location:{rowIdx:6,colIdx:1},spellIds:[12294],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Fury",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/164.jpg",talents:[{fieldName:"boomingVoice",location:{rowIdx:0,colIdx:1},spellIds:[12321,12835,12836,12837,12838],maxPoints:5},{fieldName:"cruelty",location:{rowIdx:0,colIdx:2},spellIds:[12320,12852,12853,12855,12856],maxPoints:5},{fieldName:"improvedDemoralizingShout",location:{rowIdx:1,colIdx:1},spellIds:[12324,12876,12877,12878,12879],maxPoints:5},{fieldName:"unbridledWrath",location:{rowIdx:1,colIdx:2},spellIds:[12322,12999,13e3,13001,13002],maxPoints:5},{fieldName:"improvedCleave",location:{rowIdx:2,colIdx:0},spellIds:[12329,12950,20496],maxPoints:3},{fieldName:"piercingHowl",location:{rowIdx:2,colIdx:1},spellIds:[12323],maxPoints:1},{fieldName:"bloodCraze",location:{rowIdx:2,colIdx:2},spellIds:[16487,16489,16492],maxPoints:3},{fieldName:"improvedBattleShout",location:{rowIdx:2,colIdx:3},spellIds:[12318,12857,12858,12860,12861],maxPoints:5},{fieldName:"dualWieldSpecialization",location:{rowIdx:3,colIdx:0},spellIds:[23584,23585,23586,23587,23588],maxPoints:5},{fieldName:"improvedExecute",location:{rowIdx:3,colIdx:1},spellIds:[20502,20503],maxPoints:2},{fieldName:"enrage",location:{rowIdx:3,colIdx:2},spellIds:[12317,13045,13046,13047,13048],maxPoints:5},{fieldName:"improvedSlam",location:{rowIdx:4,colIdx:0},spellIds:[12862,12330,20497,20498,20499],maxPoints:5},{fieldName:"deathWish",location:{rowIdx:4,colIdx:1},spellIds:[12328],maxPoints:1},{fieldName:"improvedIntercept",location:{rowIdx:4,colIdx:3},spellIds:[20504,20505],maxPoints:2},{fieldName:"improvedBerserkerRage",location:{rowIdx:5,colIdx:0},spellIds:[20500,20501],maxPoints:2},{fieldName:"flurry",location:{rowIdx:5,colIdx:2},spellIds:[12319,12971,12972,12973,12974],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"bloodthirst",location:{rowIdx:6,colIdx:1},spellIds:[23881],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/163.jpg",talents:[{fieldName:"shieldSpecialization",location:{rowIdx:0,colIdx:1},spellIds:[12298,12724,12725,12726,12727],maxPoints:5},{fieldName:"anticipation",location:{rowIdx:0,colIdx:2},spellIds:[12297,12750,12751,12752,12753],maxPoints:5},{fieldName:"improvedBloodrage",location:{rowIdx:1,colIdx:0},spellIds:[12301,12818],maxPoints:2},{fieldName:"toughness",location:{rowIdx:1,colIdx:2},spellIds:[12299,12761,12762,12763,12764],maxPoints:5},{fieldName:"ironWill",location:{rowIdx:1,colIdx:3},spellIds:[12300,12959,12960,12961,12962],maxPoints:5},{fieldName:"lastStand",location:{rowIdx:2,colIdx:0},spellIds:[12975],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"improvedShieldBlock",location:{rowIdx:2,colIdx:1},spellIds:[12945,12307,12944],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"improvedRevenge",location:{rowIdx:2,colIdx:2},spellIds:[12797,12799,12800],maxPoints:3},{fieldName:"defiance",location:{rowIdx:2,colIdx:3},spellIds:[12303,12788,12789,12791,12792],maxPoints:5},{fieldName:"improvedSunderArmor",location:{rowIdx:3,colIdx:0},spellIds:[12308,12810,12811],maxPoints:3},{fieldName:"improvedDisarm",location:{rowIdx:3,colIdx:1},spellIds:[12313,12804,12807],maxPoints:3},{fieldName:"improvedTaunt",location:{rowIdx:3,colIdx:2},spellIds:[12302,12765],maxPoints:2},{fieldName:"improvedShieldWall",location:{rowIdx:4,colIdx:0},spellIds:[12312,12803],maxPoints:2},{fieldName:"concussionBlow",location:{rowIdx:4,colIdx:1},spellIds:[12809],maxPoints:1},{fieldName:"improvedShieldBash",location:{rowIdx:4,colIdx:2},spellIds:[12311,12958],maxPoints:2},{fieldName:"oneHandedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[16538,16539,16540,16541,16542],maxPoints:5},{fieldName:"shieldSlam",location:{rowIdx:6,colIdx:1},spellIds:[23922],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),ko={[F.ClassUnknown]:[],[F.ClassDruid]:Io,[F.ClassShaman]:yo,[F.ClassHunter]:wo,[F.ClassMage]:vo,[F.ClassRogue]:xo,[F.ClassPaladin]:bo,[F.ClassPriest]:So,[F.ClassWarlock]:Eo,[F.ClassWarrior]:Po};function Co(e,t){return function(e,t,s){return t.split("-").forEach(((t,i)=>{const a=s[i];[...t].forEach(((t,s)=>{const i=a.talents[s],n=parseInt(t);i.fieldName&&(1==i.maxPoints?e[i.fieldName]=1==n:e[i.fieldName]=n)}))})),e}(O[e].talentsCreate(),t,ko[H[e]])}class Lo extends ro{constructor(e,t){super(e,t,{title:"Sixty Upgrades SoD Import",allowFileUpload:!0}),this.descriptionElem.appendChild(l(k,null,l("p",null,"Import settings from"," ",l("a",{href:"https://sixtyupgrades.com/sod",target:"_blank"},"Sixty Upgrades"),"."),l("p",null,"This feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats."),l("p",null,"To import, paste the output from the site's export option below and click, 'Import'.")))}async onImport(e){const t=JSON.parse(e),s=q(t?.character?.gameClass||"");if(s==F.ClassUnknown)throw new Error("Could not parse Class!");const i=B(t?.character?.race||"");if(i==z.RaceUnknown)throw new Error("Could not parse Race!");let a="";if(t?.talents?.length>0){a=function(e,t){return ko[e].map((e=>e.talents.map((e=>{const s=e.spellIds.findIndex((e=>t.includes(e)));return-1==s?"0":String(s+1)})).join("").replace(/0+$/g,""))).join("-").replace(/-+$/g,"")}(s,t.talents.map((e=>e.spellId)))}let n=!1;const o=[],r=M.create();t.items.forEach((e=>{const t=j.create();t.id=e.id,e.enchant?.id&&(t.enchant=e.enchant.id),e.suffixId&&(n=!0,e.reforge?.id&&(e.reforge.id=null),o.push(e.name)),r.items.push(t)})),this.simUI.sim.db.lookupEquipmentSpec(r),this.finishIndividualImport(this.simUI,s,i,r,a,[]),n&&o.length&&new $n({variant:"warning",body:l(k,null,l("p",null,"Sixty Upgrades currently exports the wrong Random Suffixes. We have removed the random suffix on the following item(s):"),l("ul",null,o.map((e=>l("li",null,l("strong",null,e)))))),delay:8e3})}}class To extends ro{constructor(e,t){super(e,t,{title:"Addon Import",allowFileUpload:!0}),this.descriptionElem.appendChild(l(k,null,l("p",null,"Import settings from the"," ",l("a",{href:"https://www.curseforge.com/wow/addons/wowsimsexporter",target:"_blank"},"WoWSims Exporter In-Game Addon"),"."),l("p",null,"This feature imports gear, race, talents, and professions. It does NOT import buffs, debuffs, consumes, rotation, or custom stats."),l("p",null,"To import, paste the output from the addon below and click, 'Import'.")))}async onImport(e){const t=JSON.parse(e),s=q(t.class||"");if(s==F.ClassUnknown)throw new Error("Could not parse Class!");const i=B(t.race||"");if(i==z.RaceUnknown)throw new Error("Could not parse Race!");const a=t.professions.map((e=>$(e.name)));a.forEach(((e,s)=>{if(e==G.ProfessionUnknown)throw new Error(`Could not parse profession '${t.professions[s]}'`)}));const n=t.talents||"",o=t.gear;delete o.version,o.items=o.items.filter((e=>null!=e));const l=M.fromJson(o);this.finishIndividualImport(this.simUI,s,i,l,n,a)}}class No extends ro{constructor(e,t){super(e,t,{title:"JSON Import",allowFileUpload:!0}),this.descriptionElem.appendChild(l(k,null,l("p",null,"Import settings from a JSON file, which can be created using the JSON Export feature."),l("p",null,"To import, upload the file or paste the text below, then click, 'Import'.")))}async onImport(e){let t=null;try{t=K.fromJsonString(e,{ignoreUnknownFields:!0})}catch{throw new Error("Please use a valid JSON object.")}t.player?.equipment&&await D.loadLeftoversIfNecessary(t.player.equipment),this.simUI.isWithinRaidSim?t.player&&this.simUI.player.fromProto(m.nextEventID(),t.player):this.simUI.fromProto(m.nextEventID(),t),this.close()}}
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Ao(e){let t=e.length;for(;--t>=0;)e[t]=0}const Ro=256,_o=286,Do=30,Mo=15,Vo=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Uo=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Wo=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Fo=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Oo=new Array(576);Ao(Oo);const Ho=new Array(60);Ao(Ho);const qo=new Array(512);Ao(qo);const Bo=new Array(256);Ao(Bo);const zo=new Array(29);Ao(zo);const jo=new Array(Do);function $o(e,t,s,i,a){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=i,this.max_length=a,this.has_stree=e&&e.length}let Go,Ko,Jo;function Zo(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Ao(jo);const Yo=e=>e<256?qo[e]:qo[256+(e>>>7)],Qo=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Xo=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,Qo(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},el=(e,t,s)=>{Xo(e,s[2*t],s[2*t+1])},tl=(e,t)=>{let s=0;do{s|=1&e,e>>>=1,s<<=1}while(--t>0);return s>>>1},sl=(e,t,s)=>{const i=new Array(16);let a,n,o=0;for(a=1;a<=Mo;a++)o=o+s[a-1]<<1,i[a]=o;for(n=0;n<=t;n++){let t=e[2*n+1];0!==t&&(e[2*n]=tl(i[t]++,t))}},il=e=>{let t;for(t=0;t<_o;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Do;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},al=e=>{e.bi_valid>8?Qo(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},nl=(e,t,s,i)=>{const a=2*t,n=2*s;return e[a]<e[n]||e[a]===e[n]&&i[t]<=i[s]},ol=(e,t,s)=>{const i=e.heap[s];let a=s<<1;for(;a<=e.heap_len&&(a<e.heap_len&&nl(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!nl(t,i,e.heap[a],e.depth));)e.heap[s]=e.heap[a],s=a,a<<=1;e.heap[s]=i},ll=(e,t,s)=>{let i,a,n,o,l=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+l++],i+=(255&e.pending_buf[e.sym_buf+l++])<<8,a=e.pending_buf[e.sym_buf+l++],0===i?el(e,a,t):(n=Bo[a],el(e,n+Ro+1,t),o=Vo[n],0!==o&&(a-=zo[n],Xo(e,a,o)),i--,n=Yo(i),el(e,n,s),o=Uo[n],0!==o&&(i-=jo[n],Xo(e,i,o)))}while(l<e.sym_next);el(e,256,t)},rl=(e,t)=>{const s=t.dyn_tree,i=t.stat_desc.static_tree,a=t.stat_desc.has_stree,n=t.stat_desc.elems;let o,l,r,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<n;o++)0!==s[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):s[2*o+1]=0;for(;e.heap_len<2;)r=e.heap[++e.heap_len]=c<2?++c:0,s[2*r]=1,e.depth[r]=0,e.opt_len--,a&&(e.static_len-=i[2*r+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)ol(e,s,o);r=n;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ol(e,s,1),l=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=l,s[2*r]=s[2*o]+s[2*l],e.depth[r]=(e.depth[o]>=e.depth[l]?e.depth[o]:e.depth[l])+1,s[2*o+1]=s[2*l+1]=r,e.heap[1]=r++,ol(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const s=t.dyn_tree,i=t.max_code,a=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,r=t.stat_desc.max_length;let c,d,m,h,u,p,g=0;for(h=0;h<=Mo;h++)e.bl_count[h]=0;for(s[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)d=e.heap[c],h=s[2*s[2*d+1]+1]+1,h>r&&(h=r,g++),s[2*d+1]=h,d>i||(e.bl_count[h]++,u=0,d>=l&&(u=o[d-l]),p=s[2*d],e.opt_len+=p*(h+u),n&&(e.static_len+=p*(a[2*d+1]+u)));if(0!==g){do{for(h=r-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[r]--,g-=2}while(g>0);for(h=r;0!==h;h--)for(d=e.bl_count[h];0!==d;)m=e.heap[--c],m>i||(s[2*m+1]!==h&&(e.opt_len+=(h-s[2*m+1])*s[2*m],s[2*m+1]=h),d--)}})(e,t),sl(s,c,e.bl_count)},cl=(e,t,s)=>{let i,a,n=-1,o=t[1],l=0,r=7,c=4;for(0===o&&(r=138,c=3),t[2*(s+1)+1]=65535,i=0;i<=s;i++)a=o,o=t[2*(i+1)+1],++l<r&&a===o||(l<c?e.bl_tree[2*a]+=l:0!==a?(a!==n&&e.bl_tree[2*a]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,n=a,0===o?(r=138,c=3):a===o?(r=6,c=3):(r=7,c=4))},dl=(e,t,s)=>{let i,a,n=-1,o=t[1],l=0,r=7,c=4;for(0===o&&(r=138,c=3),i=0;i<=s;i++)if(a=o,o=t[2*(i+1)+1],!(++l<r&&a===o)){if(l<c)do{el(e,a,e.bl_tree)}while(0!=--l);else 0!==a?(a!==n&&(el(e,a,e.bl_tree),l--),el(e,16,e.bl_tree),Xo(e,l-3,2)):l<=10?(el(e,17,e.bl_tree),Xo(e,l-3,3)):(el(e,18,e.bl_tree),Xo(e,l-11,7));l=0,n=a,0===o?(r=138,c=3):a===o?(r=6,c=3):(r=7,c=4)}};let ml=!1;const hl=(e,t,s,i)=>{Xo(e,0+(i?1:0),3),al(e),Qo(e,s),Qo(e,~s),s&&e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s};var ul={_tr_init:e=>{ml||((()=>{let e,t,s,i,a;const n=new Array(16);for(s=0,i=0;i<28;i++)for(zo[i]=s,e=0;e<1<<Vo[i];e++)Bo[s++]=i;for(Bo[s-1]=i,a=0,i=0;i<16;i++)for(jo[i]=a,e=0;e<1<<Uo[i];e++)qo[a++]=i;for(a>>=7;i<Do;i++)for(jo[i]=a<<7,e=0;e<1<<Uo[i]-7;e++)qo[256+a++]=i;for(t=0;t<=Mo;t++)n[t]=0;for(e=0;e<=143;)Oo[2*e+1]=8,e++,n[8]++;for(;e<=255;)Oo[2*e+1]=9,e++,n[9]++;for(;e<=279;)Oo[2*e+1]=7,e++,n[7]++;for(;e<=287;)Oo[2*e+1]=8,e++,n[8]++;for(sl(Oo,287,n),e=0;e<Do;e++)Ho[2*e+1]=5,Ho[2*e]=tl(e,5);Go=new $o(Oo,Vo,257,_o,Mo),Ko=new $o(Ho,Uo,0,Do,Mo),Jo=new $o(new Array(0),Wo,0,19,7)})(),ml=!0),e.l_desc=new Zo(e.dyn_ltree,Go),e.d_desc=new Zo(e.dyn_dtree,Ko),e.bl_desc=new Zo(e.bl_tree,Jo),e.bi_buf=0,e.bi_valid=0,il(e)},_tr_stored_block:hl,_tr_flush_block:(e,t,s,i)=>{let a,n,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,s=4093624447;for(t=0;t<=31;t++,s>>>=1)if(1&s&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Ro;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),rl(e,e.l_desc),rl(e,e.d_desc),o=(e=>{let t;for(cl(e,e.dyn_ltree,e.l_desc.max_code),cl(e,e.dyn_dtree,e.d_desc.max_code),rl(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Fo[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=a&&(a=n)):a=n=s+5,s+4<=a&&-1!==t?hl(e,t,s,i):4===e.strategy||n===a?(Xo(e,2+(i?1:0),3),ll(e,Oo,Ho)):(Xo(e,4+(i?1:0),3),((e,t,s,i)=>{let a;for(Xo(e,t-257,5),Xo(e,s-1,5),Xo(e,i-4,4),a=0;a<i;a++)Xo(e,e.bl_tree[2*Fo[a]+1],3);dl(e,e.dyn_ltree,t-1),dl(e,e.dyn_dtree,s-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),ll(e,e.dyn_ltree,e.dyn_dtree)),il(e),i&&al(e)},_tr_tally:(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,0===t?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(Bo[s]+Ro+1)]++,e.dyn_dtree[2*Yo(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{Xo(e,2,3),el(e,256,Oo),(e=>{16===e.bi_valid?(Qo(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var pl=(e,t,s,i)=>{let a=65535&e,n=e>>>16&65535,o=0;for(;0!==s;){o=s>2e3?2e3:s,s-=o;do{a=a+t[i++]|0,n=n+a|0}while(--o);a%=65521,n%=65521}return a|n<<16};const gl=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var fl=(e,t,s,i)=>{const a=gl,n=i+s;e^=-1;for(let o=i;o<n;o++)e=e>>>8^a[255&(e^t[o])];return~e},Il={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},wl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:vl,_tr_stored_block:bl,_tr_flush_block:Sl,_tr_tally:xl,_tr_align:yl}=ul,{Z_NO_FLUSH:El,Z_PARTIAL_FLUSH:Pl,Z_FULL_FLUSH:kl,Z_FINISH:Cl,Z_BLOCK:Ll,Z_OK:Tl,Z_STREAM_END:Nl,Z_STREAM_ERROR:Al,Z_DATA_ERROR:Rl,Z_BUF_ERROR:_l,Z_DEFAULT_COMPRESSION:Dl,Z_FILTERED:Ml,Z_HUFFMAN_ONLY:Vl,Z_RLE:Ul,Z_FIXED:Wl,Z_DEFAULT_STRATEGY:Fl,Z_UNKNOWN:Ol,Z_DEFLATED:Hl}=wl,ql=258,Bl=262,zl=42,jl=113,$l=666,Gl=(e,t)=>(e.msg=Il[t],t),Kl=e=>2*e-(e>4?9:0),Jl=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Zl=e=>{let t,s,i,a=e.w_size;t=e.hash_size,i=t;do{s=e.head[--i],e.head[i]=s>=a?s-a:0}while(--t);t=a,i=t;do{s=e.prev[--i],e.prev[i]=s>=a?s-a:0}while(--t)};let Yl=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask;const Ql=e=>{const t=e.state;let s=t.pending;s>e.avail_out&&(s=e.avail_out),0!==s&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,0===t.pending&&(t.pending_out=0))},Xl=(e,t)=>{Sl(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ql(e.strm)},er=(e,t)=>{e.pending_buf[e.pending++]=t},tr=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},sr=(e,t,s,i)=>{let a=e.avail_in;return a>i&&(a=i),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),s),1===e.state.wrap?e.adler=pl(e.adler,t,a,s):2===e.state.wrap&&(e.adler=fl(e.adler,t,a,s)),e.next_in+=a,e.total_in+=a,a)},ir=(e,t)=>{let s,i,a=e.max_chain_length,n=e.strstart,o=e.prev_length,l=e.nice_match;const r=e.strstart>e.w_size-Bl?e.strstart-(e.w_size-Bl):0,c=e.window,d=e.w_mask,m=e.prev,h=e.strstart+ql;let u=c[n+o-1],p=c[n+o];e.prev_length>=e.good_match&&(a>>=2),l>e.lookahead&&(l=e.lookahead);do{if(s=t,c[s+o]===p&&c[s+o-1]===u&&c[s]===c[n]&&c[++s]===c[n+1]){n+=2,s++;do{}while(c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&n<h);if(i=ql-(h-n),n=h-ql,i>o){if(e.match_start=t,o=i,i>=l)break;u=c[n+o-1],p=c[n+o]}}}while((t=m[t&d])>r&&0!=--a);return o<=e.lookahead?o:e.lookahead},ar=e=>{const t=e.w_size;let s,i,a;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Bl)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Zl(e),i+=t),0===e.strm.avail_in)break;if(s=sr(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=s,e.lookahead+e.insert>=3)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=Yl(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=Yl(e,e.ins_h,e.window[a+3-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Bl&&0!==e.strm.avail_in)},nr=(e,t)=>{let s,i,a,n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,l=e.strm.avail_in;do{if(s=65535,a=e.bi_valid+42>>3,e.strm.avail_out<a)break;if(a=e.strm.avail_out-a,i=e.strstart-e.block_start,s>i+e.strm.avail_in&&(s=i+e.strm.avail_in),s>a&&(s=a),s<n&&(0===s&&t!==Cl||t===El||s!==i+e.strm.avail_in))break;o=t===Cl&&s===i+e.strm.avail_in?1:0,bl(e,0,0,o),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,Ql(e.strm),i&&(i>s&&(i=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,s-=i),s&&(sr(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(0===o);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==El&&t!==Cl&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(a=e.window_size-e.strstart,e.strm.avail_in>a&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,a+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),a>e.strm.avail_in&&(a=e.strm.avail_in),a&&(sr(e.strm,e.window,e.strstart,a),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.high_water<e.strstart&&(e.high_water=e.strstart),a=e.bi_valid+42>>3,a=e.pending_buf_size-a>65535?65535:e.pending_buf_size-a,n=a>e.w_size?e.w_size:a,i=e.strstart-e.block_start,(i>=n||(i||t===Cl)&&t!==El&&0===e.strm.avail_in&&i<=a)&&(s=i>a?a:i,o=t===Cl&&0===e.strm.avail_in&&s===i?1:0,bl(e,e.block_start,s,o),e.block_start+=s,Ql(e.strm)),o?3:1)},or=(e,t)=>{let s,i;for(;;){if(e.lookahead<Bl){if(ar(e),e.lookahead<Bl&&t===El)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=Yl(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==s&&e.strstart-s<=e.w_size-Bl&&(e.match_length=ir(e,s)),e.match_length>=3)if(i=xl(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Yl(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Yl(e,e.ins_h,e.window[e.strstart+1]);else i=xl(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Xl(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Cl?(Xl(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Xl(e,!1),0===e.strm.avail_out)?1:2},lr=(e,t)=>{let s,i,a;for(;;){if(e.lookahead<Bl){if(ar(e),e.lookahead<Bl&&t===El)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=Yl(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==s&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-Bl&&(e.match_length=ir(e,s),e.match_length<=5&&(e.strategy===Ml||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,i=xl(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=Yl(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Xl(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=xl(e,0,e.window[e.strstart-1]),i&&Xl(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=xl(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Cl?(Xl(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Xl(e,!1),0===e.strm.avail_out)?1:2};function rr(e,t,s,i,a){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=i,this.func=a}const cr=[new rr(0,0,0,0,nr),new rr(4,4,8,4,or),new rr(4,5,16,8,or),new rr(4,6,32,32,or),new rr(4,4,16,16,lr),new rr(8,16,32,32,lr),new rr(8,16,128,128,lr),new rr(8,32,128,256,lr),new rr(32,128,258,1024,lr),new rr(32,258,258,4096,lr)];function dr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Hl,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Jl(this.dyn_ltree),Jl(this.dyn_dtree),Jl(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Jl(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Jl(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const mr=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==zl&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==jl&&t.status!==$l?1:0},hr=e=>{if(mr(e))return Gl(e,Al);e.total_in=e.total_out=0,e.data_type=Ol;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?zl:jl,e.adler=2===t.wrap?0:1,t.last_flush=-2,vl(t),Tl},ur=e=>{const t=hr(e);var s;return t===Tl&&((s=e.state).window_size=2*s.w_size,Jl(s.head),s.max_lazy_match=cr[s.level].max_lazy,s.good_match=cr[s.level].good_length,s.nice_match=cr[s.level].nice_length,s.max_chain_length=cr[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),t},pr=(e,t,s,i,a,n)=>{if(!e)return Al;let o=1;if(t===Dl&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),a<1||a>9||s!==Hl||i<8||i>15||t<0||t>9||n<0||n>Wl||8===i&&1!==o)return Gl(e,Al);8===i&&(i=9);const l=new dr;return e.state=l,l.strm=e,l.status=zl,l.wrap=o,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=t,l.strategy=n,l.method=s,ur(e)};var gr={deflateInit:(e,t)=>pr(e,t,Hl,15,8,Fl),deflateInit2:pr,deflateReset:ur,deflateResetKeep:hr,deflateSetHeader:(e,t)=>mr(e)||2!==e.state.wrap?Al:(e.state.gzhead=t,Tl),deflate:(e,t)=>{if(mr(e)||t>Ll||t<0)return e?Gl(e,Al):Al;const s=e.state;if(!e.output||0!==e.avail_in&&!e.input||s.status===$l&&t!==Cl)return Gl(e,0===e.avail_out?_l:Al);const i=s.last_flush;if(s.last_flush=t,0!==s.pending){if(Ql(e),0===e.avail_out)return s.last_flush=-1,Tl}else if(0===e.avail_in&&Kl(t)<=Kl(i)&&t!==Cl)return Gl(e,_l);if(s.status===$l&&0!==e.avail_in)return Gl(e,_l);if(s.status===zl&&0===s.wrap&&(s.status=jl),s.status===zl){let t=Hl+(s.w_bits-8<<4)<<8,i=-1;if(i=s.strategy>=Vl||s.level<2?0:s.level<6?1:6===s.level?2:3,t|=i<<6,0!==s.strstart&&(t|=32),t+=31-t%31,tr(s,t),0!==s.strstart&&(tr(s,e.adler>>>16),tr(s,65535&e.adler)),e.adler=1,s.status=jl,Ql(e),0!==s.pending)return s.last_flush=-1,Tl}if(57===s.status)if(e.adler=0,er(s,31),er(s,139),er(s,8),s.gzhead)er(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),er(s,255&s.gzhead.time),er(s,s.gzhead.time>>8&255),er(s,s.gzhead.time>>16&255),er(s,s.gzhead.time>>24&255),er(s,9===s.level?2:s.strategy>=Vl||s.level<2?4:0),er(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(er(s,255&s.gzhead.extra.length),er(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=fl(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(er(s,0),er(s,0),er(s,0),er(s,0),er(s,0),er(s,9===s.level?2:s.strategy>=Vl||s.level<2?4:0),er(s,3),s.status=jl,Ql(e),0!==s.pending)return s.last_flush=-1,Tl;if(69===s.status){if(s.gzhead.extra){let t=s.pending,i=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+i>s.pending_buf_size;){let a=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+a),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>t&&(e.adler=fl(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex+=a,Ql(e),0!==s.pending)return s.last_flush=-1,Tl;t=0,i-=a}let a=new Uint8Array(s.gzhead.extra);s.pending_buf.set(a.subarray(s.gzindex,s.gzindex+i),s.pending),s.pending+=i,s.gzhead.hcrc&&s.pending>t&&(e.adler=fl(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex=0}s.status=73}if(73===s.status){if(s.gzhead.name){let t,i=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>i&&(e.adler=fl(e.adler,s.pending_buf,s.pending-i,i)),Ql(e),0!==s.pending)return s.last_flush=-1,Tl;i=0}t=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,er(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>i&&(e.adler=fl(e.adler,s.pending_buf,s.pending-i,i)),s.gzindex=0}s.status=91}if(91===s.status){if(s.gzhead.comment){let t,i=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>i&&(e.adler=fl(e.adler,s.pending_buf,s.pending-i,i)),Ql(e),0!==s.pending)return s.last_flush=-1,Tl;i=0}t=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,er(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>i&&(e.adler=fl(e.adler,s.pending_buf,s.pending-i,i))}s.status=103}if(103===s.status){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Ql(e),0!==s.pending))return s.last_flush=-1,Tl;er(s,255&e.adler),er(s,e.adler>>8&255),e.adler=0}if(s.status=jl,Ql(e),0!==s.pending)return s.last_flush=-1,Tl}if(0!==e.avail_in||0!==s.lookahead||t!==El&&s.status!==$l){let i=0===s.level?nr(s,t):s.strategy===Vl?((e,t)=>{let s;for(;;){if(0===e.lookahead&&(ar(e),0===e.lookahead)){if(t===El)return 1;break}if(e.match_length=0,s=xl(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,s&&(Xl(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Cl?(Xl(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Xl(e,!1),0===e.strm.avail_out)?1:2})(s,t):s.strategy===Ul?((e,t)=>{let s,i,a,n;const o=e.window;for(;;){if(e.lookahead<=ql){if(ar(e),e.lookahead<=ql&&t===El)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,i=o[a],i===o[++a]&&i===o[++a]&&i===o[++a])){n=e.strstart+ql;do{}while(i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&i===o[++a]&&a<n);e.match_length=ql-(n-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(s=xl(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(s=xl(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),s&&(Xl(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Cl?(Xl(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Xl(e,!1),0===e.strm.avail_out)?1:2})(s,t):cr[s.level].func(s,t);if(3!==i&&4!==i||(s.status=$l),1===i||3===i)return 0===e.avail_out&&(s.last_flush=-1),Tl;if(2===i&&(t===Pl?yl(s):t!==Ll&&(bl(s,0,0,!1),t===kl&&(Jl(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),Ql(e),0===e.avail_out))return s.last_flush=-1,Tl}return t!==Cl?Tl:s.wrap<=0?Nl:(2===s.wrap?(er(s,255&e.adler),er(s,e.adler>>8&255),er(s,e.adler>>16&255),er(s,e.adler>>24&255),er(s,255&e.total_in),er(s,e.total_in>>8&255),er(s,e.total_in>>16&255),er(s,e.total_in>>24&255)):(tr(s,e.adler>>>16),tr(s,65535&e.adler)),Ql(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?Tl:Nl)},deflateEnd:e=>{if(mr(e))return Al;const t=e.state.status;return e.state=null,t===jl?Gl(e,Rl):Tl},deflateSetDictionary:(e,t)=>{let s=t.length;if(mr(e))return Al;const i=e.state,a=i.wrap;if(2===a||1===a&&i.status!==zl||i.lookahead)return Al;if(1===a&&(e.adler=pl(e.adler,t,s,0)),i.wrap=0,s>=i.w_size){0===a&&(Jl(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(s-i.w_size,s),0),t=e,s=i.w_size}const n=e.avail_in,o=e.next_in,l=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,ar(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=Yl(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,ar(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=o,e.input=l,e.avail_in=n,i.wrap=a,Tl},deflateInfo:"pako deflate (from Nodeca project)"};const fr=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Ir={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const s=t.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const t in s)fr(s,t)&&(e[t]=s[t])}}return e},flattenChunks:e=>{let t=0;for(let i=0,a=e.length;i<a;i++)t+=e[i].length;const s=new Uint8Array(t);for(let i=0,a=0,n=e.length;i<n;i++){let t=e[i];s.set(t,a),a+=t.length}return s}};let wr=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(vw){wr=!1}const vr=new Uint8Array(256);for(let bw=0;bw<256;bw++)vr[bw]=bw>=252?6:bw>=248?5:bw>=240?4:bw>=224?3:bw>=192?2:1;vr[254]=vr[254]=1;var br={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,s,i,a,n,o=e.length,l=0;for(a=0;a<o;a++)s=e.charCodeAt(a),55296==(64512&s)&&a+1<o&&(i=e.charCodeAt(a+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),a++)),l+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(l),n=0,a=0;n<l;a++)s=e.charCodeAt(a),55296==(64512&s)&&a+1<o&&(i=e.charCodeAt(a+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),a++)),s<128?t[n++]=s:s<2048?(t[n++]=192|s>>>6,t[n++]=128|63&s):s<65536?(t[n++]=224|s>>>12,t[n++]=128|s>>>6&63,t[n++]=128|63&s):(t[n++]=240|s>>>18,t[n++]=128|s>>>12&63,t[n++]=128|s>>>6&63,t[n++]=128|63&s);return t},buf2string:(e,t)=>{const s=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,a;const n=new Array(2*s);for(a=0,i=0;i<s;){let t=e[i++];if(t<128){n[a++]=t;continue}let o=vr[t];if(o>4)n[a++]=65533,i+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&i<s;)t=t<<6|63&e[i++],o--;o>1?n[a++]=65533:t<65536?n[a++]=t:(t-=65536,n[a++]=55296|t>>10&1023,n[a++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&wr)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let s="";for(let i=0;i<t;i++)s+=String.fromCharCode(e[i]);return s})(n,a)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&128==(192&e[s]);)s--;return s<0||0===s?t:s+vr[e[s]]>t?s:t}};var Sr=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const xr=Object.prototype.toString,{Z_NO_FLUSH:yr,Z_SYNC_FLUSH:Er,Z_FULL_FLUSH:Pr,Z_FINISH:kr,Z_OK:Cr,Z_STREAM_END:Lr,Z_DEFAULT_COMPRESSION:Tr,Z_DEFAULT_STRATEGY:Nr,Z_DEFLATED:Ar}=wl;function Rr(e){this.options=Ir.assign({level:Tr,method:Ar,chunkSize:16384,windowBits:15,memLevel:8,strategy:Nr},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Sr,this.strm.avail_out=0;let s=gr.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==Cr)throw new Error(Il[s]);if(t.header&&gr.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?br.string2buf(t.dictionary):"[object ArrayBuffer]"===xr.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,s=gr.deflateSetDictionary(this.strm,e),s!==Cr)throw new Error(Il[s]);this._dict_set=!0}}function _r(e,t){const s=new Rr(t);if(s.push(e,!0),s.err)throw s.msg||Il[s.err];return s.result}Rr.prototype.push=function(e,t){const s=this.strm,i=this.options.chunkSize;let a,n;if(this.ended)return!1;for(n=t===~~t?t:!0===t?kr:yr,"string"==typeof e?s.input=br.string2buf(e):"[object ArrayBuffer]"===xr.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),(n===Er||n===Pr)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(a=gr.deflate(s,n),a===Lr)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),a=gr.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Cr;if(0!==s.avail_out){if(n>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},Rr.prototype.onData=function(e){this.chunks.push(e)},Rr.prototype.onEnd=function(e){e===Cr&&(this.result=Ir.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Dr={Deflate:Rr,deflate:_r,deflateRaw:function(e,t){return(t=t||{}).raw=!0,_r(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,_r(e,t)},constants:wl};const Mr=16209;var Vr=function(e,t){let s,i,a,n,o,l,r,c,d,m,h,u,p,g,f,I,w,v,b,S,x,y,E,P;const k=e.state;s=e.next_in,E=e.input,i=s+(e.avail_in-5),a=e.next_out,P=e.output,n=a-(t-e.avail_out),o=a+(e.avail_out-257),l=k.dmax,r=k.wsize,c=k.whave,d=k.wnext,m=k.window,h=k.hold,u=k.bits,p=k.lencode,g=k.distcode,f=(1<<k.lenbits)-1,I=(1<<k.distbits)-1;e:do{u<15&&(h+=E[s++]<<u,u+=8,h+=E[s++]<<u,u+=8),w=p[h&f];t:for(;;){if(v=w>>>24,h>>>=v,u-=v,v=w>>>16&255,0===v)P[a++]=65535&w;else{if(!(16&v)){if(64&v){if(32&v){k.mode=16191;break e}e.msg="invalid literal/length code",k.mode=Mr;break e}w=p[(65535&w)+(h&(1<<v)-1)];continue t}for(b=65535&w,v&=15,v&&(u<v&&(h+=E[s++]<<u,u+=8),b+=h&(1<<v)-1,h>>>=v,u-=v),u<15&&(h+=E[s++]<<u,u+=8,h+=E[s++]<<u,u+=8),w=g[h&I];;){if(v=w>>>24,h>>>=v,u-=v,v=w>>>16&255,16&v){if(S=65535&w,v&=15,u<v&&(h+=E[s++]<<u,u+=8,u<v&&(h+=E[s++]<<u,u+=8)),S+=h&(1<<v)-1,S>l){e.msg="invalid distance too far back",k.mode=Mr;break e}if(h>>>=v,u-=v,v=a-n,S>v){if(v=S-v,v>c&&k.sane){e.msg="invalid distance too far back",k.mode=Mr;break e}if(x=0,y=m,0===d){if(x+=r-v,v<b){b-=v;do{P[a++]=m[x++]}while(--v);x=a-S,y=P}}else if(d<v){if(x+=r+d-v,v-=d,v<b){b-=v;do{P[a++]=m[x++]}while(--v);if(x=0,d<b){v=d,b-=v;do{P[a++]=m[x++]}while(--v);x=a-S,y=P}}}else if(x+=d-v,v<b){b-=v;do{P[a++]=m[x++]}while(--v);x=a-S,y=P}for(;b>2;)P[a++]=y[x++],P[a++]=y[x++],P[a++]=y[x++],b-=3;b&&(P[a++]=y[x++],b>1&&(P[a++]=y[x++]))}else{x=a-S;do{P[a++]=P[x++],P[a++]=P[x++],P[a++]=P[x++],b-=3}while(b>2);b&&(P[a++]=P[x++],b>1&&(P[a++]=P[x++]))}break}if(64&v){e.msg="invalid distance code",k.mode=Mr;break e}w=g[(65535&w)+(h&(1<<v)-1)]}}break}}while(s<i&&a<o);b=u>>3,s-=b,u-=b<<3,h&=(1<<u)-1,e.next_in=s,e.next_out=a,e.avail_in=s<i?i-s+5:5-(s-i),e.avail_out=a<o?o-a+257:257-(a-o),k.hold=h,k.bits=u};const Ur=15,Wr=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Fr=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Or=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Hr=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var qr=(e,t,s,i,a,n,o,l)=>{const r=l.bits;let c,d,m,h,u,p,g=0,f=0,I=0,w=0,v=0,b=0,S=0,x=0,y=0,E=0,P=null;const k=new Uint16Array(16),C=new Uint16Array(16);let L,T,N,A=null;for(g=0;g<=Ur;g++)k[g]=0;for(f=0;f<i;f++)k[t[s+f]]++;for(v=r,w=Ur;w>=1&&0===k[w];w--);if(v>w&&(v=w),0===w)return a[n++]=20971520,a[n++]=20971520,l.bits=1,0;for(I=1;I<w&&0===k[I];I++);for(v<I&&(v=I),x=1,g=1;g<=Ur;g++)if(x<<=1,x-=k[g],x<0)return-1;if(x>0&&(0===e||1!==w))return-1;for(C[1]=0,g=1;g<Ur;g++)C[g+1]=C[g]+k[g];for(f=0;f<i;f++)0!==t[s+f]&&(o[C[t[s+f]]++]=f);if(0===e?(P=A=o,p=20):1===e?(P=Wr,A=Fr,p=257):(P=Or,A=Hr,p=0),E=0,f=0,g=I,u=n,b=v,S=0,m=-1,y=1<<v,h=y-1,1===e&&y>852||2===e&&y>592)return 1;for(;;){L=g-S,o[f]+1<p?(T=0,N=o[f]):o[f]>=p?(T=A[o[f]-p],N=P[o[f]-p]):(T=96,N=0),c=1<<g-S,d=1<<b,I=d;do{d-=c,a[u+(E>>S)+d]=L<<24|T<<16|N}while(0!==d);for(c=1<<g-1;E&c;)c>>=1;if(0!==c?(E&=c-1,E+=c):E=0,f++,0==--k[g]){if(g===w)break;g=t[s+o[f]]}if(g>v&&(E&h)!==m){for(0===S&&(S=v),u+=I,b=g-S,x=1<<b;b+S<w&&(x-=k[b+S],!(x<=0));)b++,x<<=1;if(y+=1<<b,1===e&&y>852||2===e&&y>592)return 1;m=E&h,a[m]=v<<24|b<<16|u-n}}return 0!==E&&(a[u+E]=g-S<<24|64<<16),l.bits=v,0};const{Z_FINISH:Br,Z_BLOCK:zr,Z_TREES:jr,Z_OK:$r,Z_STREAM_END:Gr,Z_NEED_DICT:Kr,Z_STREAM_ERROR:Jr,Z_DATA_ERROR:Zr,Z_MEM_ERROR:Yr,Z_BUF_ERROR:Qr,Z_DEFLATED:Xr}=wl,ec=16180,tc=16190,sc=16191,ic=16192,ac=16194,nc=16199,oc=16200,lc=16206,rc=16209,cc=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function dc(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const mc=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<ec||t.mode>16211?1:0},hc=e=>{if(mc(e))return Jr;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=ec,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,$r},uc=e=>{if(mc(e))return Jr;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,hc(e)},pc=(e,t)=>{let s;if(mc(e))return Jr;const i=e.state;return t<0?(s=0,t=-t):(s=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Jr:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=s,i.wbits=t,uc(e))},gc=(e,t)=>{if(!e)return Jr;const s=new dc;e.state=s,s.strm=e,s.window=null,s.mode=ec;const i=pc(e,t);return i!==$r&&(e.state=null),i};let fc,Ic,wc=!0;const vc=e=>{if(wc){fc=new Int32Array(512),Ic=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(qr(1,e.lens,0,288,fc,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;qr(2,e.lens,0,32,Ic,0,e.work,{bits:5}),wc=!1}e.lencode=fc,e.lenbits=9,e.distcode=Ic,e.distbits=5},bc=(e,t,s,i)=>{let a;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),i>=n.wsize?(n.window.set(t.subarray(s-n.wsize,s),0),n.wnext=0,n.whave=n.wsize):(a=n.wsize-n.wnext,a>i&&(a=i),n.window.set(t.subarray(s-i,s-i+a),n.wnext),(i-=a)?(n.window.set(t.subarray(s-i,s),0),n.wnext=i,n.whave=n.wsize):(n.wnext+=a,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=a))),0};var Sc={inflateReset:uc,inflateReset2:pc,inflateResetKeep:hc,inflateInit:e=>gc(e,15),inflateInit2:gc,inflate:(e,t)=>{let s,i,a,n,o,l,r,c,d,m,h,u,p,g,f,I,w,v,b,S,x,y,E=0;const P=new Uint8Array(4);let k,C;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(mc(e)||!e.output||!e.input&&0!==e.avail_in)return Jr;s=e.state,s.mode===sc&&(s.mode=ic),o=e.next_out,a=e.output,r=e.avail_out,n=e.next_in,i=e.input,l=e.avail_in,c=s.hold,d=s.bits,m=l,h=r,y=$r;e:for(;;)switch(s.mode){case ec:if(0===s.wrap){s.mode=ic;break}for(;d<16;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}if(2&s.wrap&&35615===c){0===s.wbits&&(s.wbits=15),s.check=0,P[0]=255&c,P[1]=c>>>8&255,s.check=fl(s.check,P,2,0),c=0,d=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",s.mode=rc;break}if((15&c)!==Xr){e.msg="unknown compression method",s.mode=rc;break}if(c>>>=4,d-=4,x=8+(15&c),0===s.wbits&&(s.wbits=x),x>15||x>s.wbits){e.msg="invalid window size",s.mode=rc;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&c?16189:sc,c=0,d=0;break;case 16181:for(;d<16;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}if(s.flags=c,(255&s.flags)!==Xr){e.msg="unknown compression method",s.mode=rc;break}if(57344&s.flags){e.msg="unknown header flags set",s.mode=rc;break}s.head&&(s.head.text=c>>8&1),512&s.flags&&4&s.wrap&&(P[0]=255&c,P[1]=c>>>8&255,s.check=fl(s.check,P,2,0)),c=0,d=0,s.mode=16182;case 16182:for(;d<32;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}s.head&&(s.head.time=c),512&s.flags&&4&s.wrap&&(P[0]=255&c,P[1]=c>>>8&255,P[2]=c>>>16&255,P[3]=c>>>24&255,s.check=fl(s.check,P,4,0)),c=0,d=0,s.mode=16183;case 16183:for(;d<16;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}s.head&&(s.head.xflags=255&c,s.head.os=c>>8),512&s.flags&&4&s.wrap&&(P[0]=255&c,P[1]=c>>>8&255,s.check=fl(s.check,P,2,0)),c=0,d=0,s.mode=16184;case 16184:if(1024&s.flags){for(;d<16;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}s.length=c,s.head&&(s.head.extra_len=c),512&s.flags&&4&s.wrap&&(P[0]=255&c,P[1]=c>>>8&255,s.check=fl(s.check,P,2,0)),c=0,d=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&s.flags&&(u=s.length,u>l&&(u=l),u&&(s.head&&(x=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(i.subarray(n,n+u),x)),512&s.flags&&4&s.wrap&&(s.check=fl(s.check,i,u,n)),l-=u,n+=u,s.length-=u),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&s.flags){if(0===l)break e;u=0;do{x=i[n+u++],s.head&&x&&s.length<65536&&(s.head.name+=String.fromCharCode(x))}while(x&&u<l);if(512&s.flags&&4&s.wrap&&(s.check=fl(s.check,i,u,n)),l-=u,n+=u,x)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&s.flags){if(0===l)break e;u=0;do{x=i[n+u++],s.head&&x&&s.length<65536&&(s.head.comment+=String.fromCharCode(x))}while(x&&u<l);if(512&s.flags&&4&s.wrap&&(s.check=fl(s.check,i,u,n)),l-=u,n+=u,x)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&s.flags){for(;d<16;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}if(4&s.wrap&&c!==(65535&s.check)){e.msg="header crc mismatch",s.mode=rc;break}c=0,d=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=sc;break;case 16189:for(;d<32;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}e.adler=s.check=cc(c),c=0,d=0,s.mode=tc;case tc:if(0===s.havedict)return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,s.hold=c,s.bits=d,Kr;e.adler=s.check=1,s.mode=sc;case sc:if(t===zr||t===jr)break e;case ic:if(s.last){c>>>=7&d,d-=7&d,s.mode=lc;break}for(;d<3;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}switch(s.last=1&c,c>>>=1,d-=1,3&c){case 0:s.mode=16193;break;case 1:if(vc(s),s.mode=nc,t===jr){c>>>=2,d-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=rc}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",s.mode=rc;break}if(s.length=65535&c,c=0,d=0,s.mode=ac,t===jr)break e;case ac:s.mode=16195;case 16195:if(u=s.length,u){if(u>l&&(u=l),u>r&&(u=r),0===u)break e;a.set(i.subarray(n,n+u),o),l-=u,n+=u,r-=u,o+=u,s.length-=u;break}s.mode=sc;break;case 16196:for(;d<14;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}if(s.nlen=257+(31&c),c>>>=5,d-=5,s.ndist=1+(31&c),c>>>=5,d-=5,s.ncode=4+(15&c),c>>>=4,d-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=rc;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;d<3;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}s.lens[L[s.have++]]=7&c,c>>>=3,d-=3}for(;s.have<19;)s.lens[L[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,k={bits:s.lenbits},y=qr(0,s.lens,0,19,s.lencode,0,s.work,k),s.lenbits=k.bits,y){e.msg="invalid code lengths set",s.mode=rc;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;E=s.lencode[c&(1<<s.lenbits)-1],f=E>>>24,I=E>>>16&255,w=65535&E,!(f<=d);){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}if(w<16)c>>>=f,d-=f,s.lens[s.have++]=w;else{if(16===w){for(C=f+2;d<C;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}if(c>>>=f,d-=f,0===s.have){e.msg="invalid bit length repeat",s.mode=rc;break}x=s.lens[s.have-1],u=3+(3&c),c>>>=2,d-=2}else if(17===w){for(C=f+3;d<C;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}c>>>=f,d-=f,x=0,u=3+(7&c),c>>>=3,d-=3}else{for(C=f+7;d<C;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}c>>>=f,d-=f,x=0,u=11+(127&c),c>>>=7,d-=7}if(s.have+u>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=rc;break}for(;u--;)s.lens[s.have++]=x}}if(s.mode===rc)break;if(0===s.lens[256]){e.msg="invalid code -- missing end-of-block",s.mode=rc;break}if(s.lenbits=9,k={bits:s.lenbits},y=qr(1,s.lens,0,s.nlen,s.lencode,0,s.work,k),s.lenbits=k.bits,y){e.msg="invalid literal/lengths set",s.mode=rc;break}if(s.distbits=6,s.distcode=s.distdyn,k={bits:s.distbits},y=qr(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,k),s.distbits=k.bits,y){e.msg="invalid distances set",s.mode=rc;break}if(s.mode=nc,t===jr)break e;case nc:s.mode=oc;case oc:if(l>=6&&r>=258){e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,s.hold=c,s.bits=d,Vr(e,h),o=e.next_out,a=e.output,r=e.avail_out,n=e.next_in,i=e.input,l=e.avail_in,c=s.hold,d=s.bits,s.mode===sc&&(s.back=-1);break}for(s.back=0;E=s.lencode[c&(1<<s.lenbits)-1],f=E>>>24,I=E>>>16&255,w=65535&E,!(f<=d);){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}if(I&&!(240&I)){for(v=f,b=I,S=w;E=s.lencode[S+((c&(1<<v+b)-1)>>v)],f=E>>>24,I=E>>>16&255,w=65535&E,!(v+f<=d);){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}c>>>=v,d-=v,s.back+=v}if(c>>>=f,d-=f,s.back+=f,s.length=w,0===I){s.mode=16205;break}if(32&I){s.back=-1,s.mode=sc;break}if(64&I){e.msg="invalid literal/length code",s.mode=rc;break}s.extra=15&I,s.mode=16201;case 16201:if(s.extra){for(C=s.extra;d<C;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}s.length+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;E=s.distcode[c&(1<<s.distbits)-1],f=E>>>24,I=E>>>16&255,w=65535&E,!(f<=d);){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}if(!(240&I)){for(v=f,b=I,S=w;E=s.distcode[S+((c&(1<<v+b)-1)>>v)],f=E>>>24,I=E>>>16&255,w=65535&E,!(v+f<=d);){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}c>>>=v,d-=v,s.back+=v}if(c>>>=f,d-=f,s.back+=f,64&I){e.msg="invalid distance code",s.mode=rc;break}s.offset=w,s.extra=15&I,s.mode=16203;case 16203:if(s.extra){for(C=s.extra;d<C;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}s.offset+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=rc;break}s.mode=16204;case 16204:if(0===r)break e;if(u=h-r,s.offset>u){if(u=s.offset-u,u>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=rc;break}u>s.wnext?(u-=s.wnext,p=s.wsize-u):p=s.wnext-u,u>s.length&&(u=s.length),g=s.window}else g=a,p=o-s.offset,u=s.length;u>r&&(u=r),r-=u,s.length-=u;do{a[o++]=g[p++]}while(--u);0===s.length&&(s.mode=oc);break;case 16205:if(0===r)break e;a[o++]=s.length,r--,s.mode=oc;break;case lc:if(s.wrap){for(;d<32;){if(0===l)break e;l--,c|=i[n++]<<d,d+=8}if(h-=r,e.total_out+=h,s.total+=h,4&s.wrap&&h&&(e.adler=s.check=s.flags?fl(s.check,a,h,o-h):pl(s.check,a,h,o-h)),h=r,4&s.wrap&&(s.flags?c:cc(c))!==s.check){e.msg="incorrect data check",s.mode=rc;break}c=0,d=0}s.mode=16207;case 16207:if(s.wrap&&s.flags){for(;d<32;){if(0===l)break e;l--,c+=i[n++]<<d,d+=8}if(4&s.wrap&&c!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=rc;break}c=0,d=0}s.mode=16208;case 16208:y=Gr;break e;case rc:y=Zr;break e;case 16210:return Yr;default:return Jr}return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,s.hold=c,s.bits=d,(s.wsize||h!==e.avail_out&&s.mode<rc&&(s.mode<lc||t!==Br))&&bc(e,e.output,e.next_out,h-e.avail_out),m-=e.avail_in,h-=e.avail_out,e.total_in+=m,e.total_out+=h,s.total+=h,4&s.wrap&&h&&(e.adler=s.check=s.flags?fl(s.check,a,h,e.next_out-h):pl(s.check,a,h,e.next_out-h)),e.data_type=s.bits+(s.last?64:0)+(s.mode===sc?128:0)+(s.mode===nc||s.mode===ac?256:0),(0===m&&0===h||t===Br)&&y===$r&&(y=Qr),y},inflateEnd:e=>{if(mc(e))return Jr;let t=e.state;return t.window&&(t.window=null),e.state=null,$r},inflateGetHeader:(e,t)=>{if(mc(e))return Jr;const s=e.state;return 2&s.wrap?(s.head=t,t.done=!1,$r):Jr},inflateSetDictionary:(e,t)=>{const s=t.length;let i,a,n;return mc(e)?Jr:(i=e.state,0!==i.wrap&&i.mode!==tc?Jr:i.mode===tc&&(a=1,a=pl(a,t,s,0),a!==i.check)?Zr:(n=bc(e,t,s,s),n?(i.mode=16210,Yr):(i.havedict=1,$r)))},inflateInfo:"pako inflate (from Nodeca project)"};var xc=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const yc=Object.prototype.toString,{Z_NO_FLUSH:Ec,Z_FINISH:Pc,Z_OK:kc,Z_STREAM_END:Cc,Z_NEED_DICT:Lc,Z_STREAM_ERROR:Tc,Z_DATA_ERROR:Nc,Z_MEM_ERROR:Ac}=wl;function Rc(e){this.options=Ir.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Sr,this.strm.avail_out=0;let s=Sc.inflateInit2(this.strm,t.windowBits);if(s!==kc)throw new Error(Il[s]);if(this.header=new xc,Sc.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=br.string2buf(t.dictionary):"[object ArrayBuffer]"===yc.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=Sc.inflateSetDictionary(this.strm,t.dictionary),s!==kc)))throw new Error(Il[s])}function _c(e,t){const s=new Rc(t);if(s.push(e),s.err)throw s.msg||Il[s.err];return s.result}Rc.prototype.push=function(e,t){const s=this.strm,i=this.options.chunkSize,a=this.options.dictionary;let n,o,l;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Pc:Ec,"[object ArrayBuffer]"===yc.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),n=Sc.inflate(s,o),n===Lc&&a&&(n=Sc.inflateSetDictionary(s,a),n===kc?n=Sc.inflate(s,o):n===Nc&&(n=Lc));s.avail_in>0&&n===Cc&&s.state.wrap>0&&0!==e[s.next_in];)Sc.inflateReset(s),n=Sc.inflate(s,o);switch(n){case Tc:case Nc:case Lc:case Ac:return this.onEnd(n),this.ended=!0,!1}if(l=s.avail_out,s.next_out&&(0===s.avail_out||n===Cc))if("string"===this.options.to){let e=br.utf8border(s.output,s.next_out),t=s.next_out-e,a=br.buf2string(s.output,e);s.next_out=t,s.avail_out=i-t,t&&s.output.set(s.output.subarray(e,e+t),0),this.onData(a)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(n!==kc||0!==l){if(n===Cc)return n=Sc.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},Rc.prototype.onData=function(e){this.chunks.push(e)},Rc.prototype.onEnd=function(e){e===kc&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ir.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Dc={Inflate:Rc,inflate:_c,inflateRaw:function(e,t){return(t=t||{}).raw=!0,_c(e,t)},ungzip:_c,constants:wl};const{Deflate:Mc,deflate:Vc,deflateRaw:Uc,gzip:Wc}=Dr,{Inflate:Fc,inflate:Oc,inflateRaw:Hc,ungzip:qc}=Dc;var Bc={Deflate:Mc,deflate:Vc,deflateRaw:Uc,gzip:Wc,Inflate:Fc,inflate:Oc,inflateRaw:Hc,ungzip:qc,constants:wl};class zc{static tryParseUrlLocation(e){let t=e.hash;if(t.length<=1)return null;t=t.substring(1);const s=atob(t),i=new Uint8Array(s.length);for(let r=0;r<i.length;r++)i[r]=s.charCodeAt(r);const a=Bc.inflate(i),n=K.fromBinary(a);let o=ro.DEFAULT_CATEGORIES;const l=new URLSearchParams(window.location.search);if(l.has(ro.CATEGORY_PARAM)){o=l.get(ro.CATEGORY_PARAM).split("").map((e=>[...no.entries()].find((t=>t[1]==e)))).filter((e=>e)).map((e=>e[0]))}return{settings:n,categories:o}}}const jc=class e extends ro{constructor(e,t){super(e,t,{title:"Wowhead Import",allowFileUpload:!0}),this.descriptionElem.appendChild(l(k,null,l("p",null,"Import settings from"," ",l("a",{href:"https://www.wowhead.com/classic/gear-planner",target:"_blank"},"Wowhead Gear Planner"),"."),l("p",null,"This feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats."),l("p",null,"To import, paste the gear planner link below and click, 'Import'.")))}async onImport(t){const s=t.match(/www\.wowhead\.com\/classic\/gear-planner\/([a-z\-]+)\/([a-z\-]+)\/([a-zA-Z0-9_\-]+)/);if(!s)throw new Error(`Invalid WCL URL ${t}, must look like "https://www.wowhead.com/classic/gear-planner/CLASS/RACE/XXXX"`);const i=q(s[1].replaceAll("-",""));if(i==F.ClassUnknown)throw new Error("Could not parse Class: "+s[1]);const a=B(s[2].replaceAll("-",""));if(a==z.RaceUnknown)throw new Error("Could not parse Race: "+s[2]);const n=s[3].replaceAll("_","/").replaceAll("-","+"),o=Uint8Array.from(atob(n),(e=>e.charCodeAt(0))),l=o[3],r=o.subarray(4,4+l),c=J(r).split("f").slice(0,3).join("-"),d=o.subarray(l),m=M.create();let h=0;for(;h<d.length;){const t=j.create(),s=63&d[h],i=Boolean(128&d[h]);h++;const a=31&d[h];if(h++,t.id=(a<<16)+(d[h]<<8)+d[h+1],h+=2,i){const e=(d[h]<<16)+(d[h+1]<<8)+d[h+2];t.enchant=this.simUI.sim.db.enchantSpellIdToEffectId(e),h+=3}null!=Object.entries(e.slotIDs).find((e=>e[1]==s))&&m.items.push(t)}this.simUI.sim.db.lookupEquipmentSpec(m),this.finishIndividualImport(this.simUI,i,a,m,c,[])}};jc.slotIDs={[h.ItemSlotHead]:1,[h.ItemSlotNeck]:2,[h.ItemSlotShoulder]:3,[h.ItemSlotBack]:15,[h.ItemSlotChest]:5,[h.ItemSlotWrist]:9,[h.ItemSlotHands]:10,[h.ItemSlotWaist]:6,[h.ItemSlotLegs]:7,[h.ItemSlotFeet]:8,[h.ItemSlotFinger1]:11,[h.ItemSlotFinger2]:12,[h.ItemSlotTrinket1]:13,[h.ItemSlotTrinket2]:14,[h.ItemSlotMainHand]:16,[h.ItemSlotOffHand]:17,[h.ItemSlotRanged]:18};class $c extends jn{constructor(e,t){super(e,t,{identifier:"bulk-tab",title:"Batch"}),this.itemsChangedEmitter=new m,this.column1=this.buildColumn(1,"raid-settings-col"),this.items=new Array,this.simUI=t,this.leftPanel=l("div",{className:"bulk-tab-left tab-panel-left"},this.column1),this.rightPanel=l("div",{className:"bulk-tab-right tab-panel-right"}),this.pendingDiv=l("div",{className:"results-pending-overlay d-flex hide"}),this.pendingResults=new zn(this.pendingDiv),this.pendingResults.hideAll(),this.selectorModal=new UI(this.simUI.rootElem,this.simUI,this.simUI.player,void 0,{id:"bulk-selector-modal",disabledTabs:[VI.Items]}),this.contentContainer.appendChild(l(k,null,this.leftPanel,this.rightPanel,this.pendingDiv)),this.doCombos=!0,this.fastMode=!0,this.autoEnchant=!0,this.savedTalents=[],this.simTalents=!1,this.buildTabContent(),this.simUI.sim.waitForInit().then((()=>{this.loadSettings()}))}getSettingsKey(){return this.simUI.getStorageKey("bulk-settings.v1")}loadSettings(){const e=window.localStorage.getItem(this.getSettingsKey());if(null!=e){const t=Z.fromJsonString(e,{ignoreUnknownFields:!0});this.doCombos=t.combinations,this.fastMode=t.fastMode,this.autoEnchant=t.autoEnchant,this.savedTalents=t.talentsToSim,this.simTalents=t.simTalents}}storeSettings(){const e=this.createBulkSettings(),t=Z.toJsonString(e,{enumAsInteger:!0});window.localStorage.setItem(this.getSettingsKey(),t)}createBulkSettings(){return Z.create({items:this.items,combinations:this.doCombos,fastMode:this.fastMode,autoEnchant:this.autoEnchant,simTalents:this.simTalents,talentsToSim:this.savedTalents,iterationsPerCombo:this.simUI.sim.getIterations()})}createBulkItemsDatabase(){const e=Y.create();for(const t of this.items){const s=this.simUI.sim.db.lookupItemSpec(t);if(!s)throw new Error(`item with ID ${t.id} not found in database`);e.items.push(Q.fromJson(X.toJson(s.item),{ignoreUnknownFields:!0})),s.enchant&&e.enchants.push(ee.fromJson(te.toJson(s.enchant),{ignoreUnknownFields:!0}))}return e}addItem(e){this.addItems([e])}addItems(e){this.items=[...this.items||[],...e],this.itemsChangedEmitter.emit(m.nextEventID())}setItems(e){this.items=e,this.itemsChangedEmitter.emit(m.nextEventID())}removeItem(e){const t=this.items.findIndex((t=>j.equals(t,e)));-1!==t&&(this.items.splice(t,1),this.itemsChangedEmitter.emit(m.nextEventID()))}removeItemByIndex(e){this.items.length<e?new $n({variant:"error",body:"Failed to remove item, please report this issue."}):(this.items.splice(e,1),this.itemsChangedEmitter.emit(m.nextEventID()))}clearItems(){this.items=new Array,this.itemsChangedEmitter.emit(m.nextEventID())}hasItem(e){return this.items.some((t=>j.equals(t,e)))}getItems(){const e=new Array;return this.items.forEach((t=>{e.push(j.clone(t))})),e}setCombinations(e){this.doCombos=e,this.itemsChangedEmitter.emit(m.nextEventID())}setFastMode(e){this.fastMode=e,this.itemsChangedEmitter.emit(m.nextEventID())}async runBulkSim(e){this.pendingResults.setPending();try{const t=await this.simUI.sim.runBulkSim(this.createBulkSettings(),this.createBulkItemsDatabase(),e);t.error?.type==se.ErrorOutcomeAborted&&new $n({variant:"info",body:"Bulk sim cancelled."})}catch(t){this.simUI.handleCrash(t)}}buildTabContent(){const e=new qn(this.column1,"bulk-items",{header:{title:"Items"}});e.bodyElement.classList.add("gear-picker-root","gear-picker-root-bulk");const t=l("div",{className:"bulk-items-text-line"},l("i",null,"Notice: This is under very early but active development and experimental. You may also need to update your WoW AddOn if you want to import your bags.")),s=l("div",{className:"tab-panel-col bulk-gear-combo"});this.itemsChangedEmitter.on((()=>{const e=l(k,null);if(this.items.length){t.textContent="The following items will be simmed together with your equipped gear.";for(let t=0;t<this.items.length;++t){const s=this.items[t],i=this.simUI.sim.db.lookupItemSpec(s);new so(e,this.simUI,this,i,t)}}s.replaceChildren(e)})),e.bodyElement.appendChild(l(k,null,t,s)),this.clearItems();const i=new qn(this.column1,"bulk-results",{header:{title:"Results",extraCssClasses:["bulk-results-header"]}});i.rootElem.hidden=!0,i.bodyElement.classList.add("gear-picker-root","gear-picker-root-bulk","tab-panel-col"),this.simUI.sim.bulkSimStartEmitter.on((()=>{i.rootElem.hidden=!0})),this.simUI.sim.bulkSimResultEmitter.on(((e,t)=>{i.rootElem.hidden=0==t.results.length,i.bodyElement.replaceChildren();for(const s of t.results){const e=new qn(i.bodyElement,"bulk-result",{header:{title:""},bodyClasses:["bulk-results-body"]});new io(e.bodyElement,this.simUI,s,t.equippedGearResult)}}));const a=new qn(this.rightPanel,"bulk-settings",{header:{title:"Setup"}}),n=l("button",{className:"btn btn-primary w-100 bulk-settings-button"},"Simulate Batch");let o=!1;n.addEventListener("click",(async()=>{if(o)return;o=!0,n.disabled=!0,this.pendingDiv.classList.remove("hide"),this.leftPanel.classList.add("blurred"),this.rightPanel.classList.add("blurred");const e=ie(n);n.disabled=!0,n.classList.add("disabled"),n.replaceChildren(l(k,null,l("i",{className:"fa fa-spinner fa-spin"})," Running"));let t=!1;try{await this.simUI.sim.signalManager.abortType(ae.All),this.pendingResults.addAbortButton((async()=>{if(!t)try{t=!0,await this.simUI.sim.signalManager.abortType(ae.BulkSim)}catch(e){console.error("Error on bulk sim abort!"),console.error(e)}finally{t=!1,o||(n.disabled=!1)}}));let e=(new Date).getTime(),s=0,i=0,a=0,l=0;await this.runBulkSim((t=>{const n=(new Date).getTime()-e,o=t.completedIterations/(n/1e3);0===l&&(l=t.totalSims),this.fastMode&&(0===i&&t.totalSims>0&&(i=Math.ceil(Math.log(t.totalSims/20)/Math.log(2))+1,a=1),t.totalSims<s&&(a+=1,e=(new Date).getTime())),this.setSimProgress(t,o,a,i,l),s=t.totalSims}))}catch(s){console.error(s)}finally{o=!1,t||(n.disabled=!1),this.pendingDiv.classList.add("hide"),this.leftPanel.classList.remove("blurred"),this.rightPanel.classList.remove("blurred"),this.pendingResults.hideAll(),n.classList.remove("disabled"),n.replaceChildren(...e)}}));const c=l("button",{className:"btn btn-secondary w-100 bulk-settings-button"},l("i",{className:"fa fa-download"})," Import From Bags");c.addEventListener("click",(()=>new co(this.simUI.rootElem,this.simUI,this).open()));const d=l("button",{className:"btn btn-secondary w-100 bulk-settings-button"},l("i",{className:"fa fa-download"})," Import Favorites");d.addEventListener("click",(()=>{const e=this.simUI.player.sim.getFilters().favoriteItems.map((e=>j.create({id:e})));this.addItems(e)}));const m=r(),h=r(),u=l("div",{className:"search-wrapper hide"},l("input",{ref:m,type:"text",placeholder:"Search...",className:"batch-search-input form-control hide"}),l("ul",{ref:h,className:"batch-search-results hide"}));let p=Array();m.value?.addEventListener("keyup",(e=>{if("Enter"==e.key){const e=Array();h.value?.childNodes.forEach((t=>{const s=t.getAttribute("data-item-id");null!=s&&e.push(j.create({id:Number.parseInt(s)}))})),this.addItems(e)}})),m.value?.addEventListener("input",(e=>{const t=m.value?.value||"";if(!t.length)return h.value?.replaceChildren(),void h.value?.classList.add("hide");const s=t.split(" "),i=l(k,null);p.forEach((e=>{let t=!0;const a=e.name.toLowerCase(),n=e.setName.toLowerCase();if(s.forEach((e=>{const s=e.toLowerCase();return!(!a.includes(s)&&!n.includes(s))||(t=!1,!1)})),t){const t=r(),s=r();i.appendChild(l("li",{ref:t,dataset:{itemId:e.id.toString()}},l("span",{ref:s},e.name),e.heroic&&l("span",{className:"item-quality-uncommon"},"[H]"),e.factionRestriction===ne.HORDE_ONLY&&l("span",{className:"faction-horde"},"(H)"),e.factionRestriction===ne.ALLIANCE_ONLY&&l("span",{className:"faction-alliance"},"(A)"))),Wn(s.value,e.quality),t.value?.addEventListener("click",(()=>this.addItem(j.create({id:e.id}))))}})),h.value?.replaceChildren(i),h.value?.classList.remove("hide")}));const g=l(k,null,l("i",{className:"fa fa-search"})," Add Item"),f=l("button",{className:"btn btn-secondary w-100 bulk-settings-button"},g.cloneNode(!0));f.addEventListener("click",(()=>{m.value?.classList.contains("hide")?(u?.classList.remove("hide"),f.replaceChildren(l(k,null,"Close Search Results")),p=this.simUI.sim.db.getAllItems().filter((e=>oe(this.simUI.player,e,void 0))),m.value?.classList.remove("hide"),m.value?.value&&h.value?.classList.remove("hide"),m.value?.focus()):(f.replaceChildren(g.cloneNode(!0)),u?.classList.add("hide"),m.value?.classList.add("hide"),h.value?.replaceChildren(),h.value?.classList.add("hide"))}));const I=l("button",{className:"btn btn-secondary w-100 bulk-settings-button"},"Clear all");I.addEventListener("click",(()=>{this.clearItems(),i.rootElem.hidden=!0,i.bodyElement.replaceChildren()}));const w=r(),v=l("div",{className:P("talents-picker-container",!this.simTalents&&"hide")},l("label",{className:"mb-2"},"Pick talents to sim (will increase time to sim)"),l("div",{ref:w,className:"talents-container"})),b=window.localStorage.getItem(this.simUI.getSavedTalentsStorageKey());let S;try{null!==b&&(S=JSON.parse(b))}catch(y){console.warn("Invalid json for local storage value: "+b)}const x=(e,t)=>{const s=e.querySelector(".saved-data-set-chip");if(this.savedTalents.some((e=>e.name===t.name))){const e=this.savedTalents.findIndex((e=>e.name===t.name));this.savedTalents.splice(e,1),s?.classList.remove("active")}else this.savedTalents.push(t),s?.classList.add("active")};for(const r in S)try{const e={talentsString:le.fromJson(S[r]).talentsString,name:r},t=this.savedTalents.findIndex((t=>JSON.stringify(t)===JSON.stringify(e))),s=l("div",{className:P("saved-data-set-chip badge rounded-pill",-1!==t&&"active")},l("a",{href:"javascript:void(0)",className:"saved-data-set-name",attributes:{role:"button"}},r));w.value.appendChild(s),s.addEventListener("click",(()=>x(s,e)))}catch(y){console.log(y),console.warn("Failed parsing saved data: "+S[r])}a.bodyElement.appendChild(l(k,null,n,c,d,f,u,I,v)),new re(a.bodyElement,this,{id:"bulk-fast-mode",label:"Fast Mode",labelTooltip:"Fast mode reduces accuracy but will run faster.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.fastMode,setValue:(e,t,s)=>{t.fastMode=s}}),new re(a.bodyElement,this,{id:"bulk-combinations",label:"Combinations",labelTooltip:"When checked bulk simulator will create all possible combinations of the items. When disabled trinkets and rings will still run all combinations becausee they have two slots to fill each.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.doCombos,setValue:(e,t,s)=>{t.doCombos=s}}),new re(a.bodyElement,this,{id:"bulk-auto-enchant",label:"Auto Enchant",labelTooltip:"When checked bulk simulator apply the current enchant for a slot to each replacement item it can.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.autoEnchant,setValue:(e,t,s)=>{t.autoEnchant=s}}),new re(a.bodyElement,this,{id:"bulk-sim-talents",label:"Sim Talents",labelTooltip:"When checked bulk simulator will sim chosen talent setups. Warning, it might cause the bulk sim to run for a lot longer",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.simTalents,setValue:(e,t,s)=>{t.simTalents=s,v.classList[s?"remove":"add"]("hide")}})}setSimProgress(e,t,s,i,a){const n=((e.totalIterations-e.completedIterations)/t).toFixed();this.pendingResults.setContent(l("div",{className:"results-sim"},l("div",null,a," total combinations."),l("div",null,i>0&&l(k,null,s," / ",i," refining rounds")),l("div",null,e.completedSims," / ",e.totalSims,l("br",null),"simulations complete"),l("div",null,e.completedIterations," / ",e.totalIterations,l("br",null),"iterations complete"),l("div",null,n," seconds remaining.")))}}class Gc extends Vn{constructor(e,t){if(super(e,"exporter",{title:t.title,header:!0,footer:!0}),this.changedEvent=new m,this.textElem=l("textarea",{spellcheck:!1,className:"exporter-textarea form-control"}),this.body.append(this.textElem),new mo(this.footer,{extraCssClasses:["btn-primary","me-2"],getContent:()=>this.textElem.innerHTML,text:"Copy",tooltip:"Copy to clipboard"}),t.allowDownload){const e=r();this.footer.appendChild(l("button",{className:"exporter-button btn btn-primary download-button",ref:e},l("i",{className:"fa fa-download me-1"}),"Download"));e.value.addEventListener("click",(e=>{const t=this.textElem.textContent;ce(t,"wowsims.json")}))}}open(){super.open(),this.init()}init(){this.changedEvent.on((()=>this.updateContent())),this.updateContent()}updateContent(){this.textElem.textContent=this.getData()}}const Kc=class t extends Gc{constructor(s,i,a){super(s,a),this.simUI=i;const n={};if(e(ao).forEach((e=>n[e]=ro.DEFAULT_CATEGORIES.includes(e))),this.exportCategories=n,a.selectCategories){const e=l("div",{className:"exporter-category-pickers"});this.body.prepend(e),t.exportPickerConfigs.forEach((t=>{const s=t.category;new re(e,this,{id:`link-exporter-${s}`,label:t.label,labelTooltip:t.labelTooltip,inline:!0,getValue:()=>this.exportCategories[s],setValue:(e,t,i)=>{this.exportCategories[s]=i,this.changedEvent.emit(e)},changedEvent:()=>this.changedEvent})}))}}};Kc.exportPickerConfigs=[{category:ao.Gear,label:"Gear",labelTooltip:"Also includes bonus stats and weapon swaps."},{category:ao.Talents,label:"Talents",labelTooltip:"Talents and Glyphs."},{category:ao.Rotation,label:"Rotation",labelTooltip:"Includes everything found in the Rotation tab."},{category:ao.Consumes,label:"Consumes",labelTooltip:"Flask, pots, food, etc."},{category:ao.External,label:"Buffs & Debuffs",labelTooltip:"All settings which are applied by other raid members."},{category:ao.Miscellaneous,label:"Misc",labelTooltip:"Spec-specific settings, front/back of target, distance from target, etc."},{category:ao.Encounter,label:"Encounter",labelTooltip:"Fight-related settings."}];let Jc=Kc;const Zc=class e extends Jc{constructor(e,t){super(e,t,{title:"Sixty Upgrades EP Export",allowDownload:!0})}getData(){const t=this.simUI.player,s=t.getEpWeights(),i=_n.getAll(),a={};return i.forEach((t=>{const i=e.getName(t),n=s.getUnitStat(t);0!=n&&""!=i&&(a[i]?a[i]+=n:a[i]=n)})),`https://sixtyupgrades.com/sod/ep/import?name=${encodeURIComponent(`${de[t.spec]} WoWSims Weights`)}`+Object.keys(a).map((e=>`&${e}=${a[e].toFixed(3)}`)).join("")}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};Zc.statNames={[t.StatStrength]:"strength",[t.StatAgility]:"agility",[t.StatStamina]:"stamina",[t.StatIntellect]:"intellect",[t.StatSpirit]:"spirit",[t.StatSpellPower]:"spellPower",[t.StatSpellDamage]:"spellDamage",[t.StatArcanePower]:"arcaneDamage",[t.StatHolyPower]:"holyDamage",[t.StatFirePower]:"fireDamage",[t.StatFrostPower]:"frostDamage",[t.StatNaturePower]:"natureDamage",[t.StatShadowPower]:"shadowDamage",[t.StatMP5]:"mp5",[t.StatSpellHit]:"spellHit",[t.StatSpellCrit]:"spellCrit",[t.StatSpellHaste]:"spellHaste",[t.StatSpellPenetration]:"spellPen",[t.StatAttackPower]:"attackPower",[t.StatMeleeHit]:"hit",[t.StatMeleeCrit]:"crit",[t.StatMeleeHaste]:"haste",[t.StatArmorPenetration]:"armorPen",[t.StatExpertise]:"expertise",[t.StatMana]:"mana",[t.StatEnergy]:"energy",[t.StatRage]:"rage",[t.StatArmor]:"armor",[t.StatRangedAttackPower]:"attackPower",[t.StatDefense]:"defense",[t.StatBlock]:"block",[t.StatBlockValue]:"blockValue",[t.StatDodge]:"dodge",[t.StatParry]:"parry",[t.StatResilience]:"resilience",[t.StatHealth]:"health",[t.StatArcaneResistance]:"arcaneResistance",[t.StatFireResistance]:"fireResistance",[t.StatFrostResistance]:"frostResistance",[t.StatNatureResistance]:"natureResistance",[t.StatShadowResistance]:"shadowResistance",[t.StatBonusArmor]:"armorBonus",[t.StatHealingPower]:"healing",[t.StatFeralAttackPower]:"feralAttackPower"},Zc.pseudoStatNames={[s.PseudoStatMainHandDps]:"dps",[s.PseudoStatRangedDps]:"rangedDps",[s.PseudoStatUnarmedSkill]:"unarmedSkill",[s.PseudoStatDaggersSkill]:"daggerSkill",[s.PseudoStatSwordsSkill]:"swordSkill",[s.PseudoStatMacesSkill]:"maceSkill",[s.PseudoStatAxesSkill]:"axeSkill",[s.PseudoStatTwoHandedSwordsSkill]:"sword2hSkill",[s.PseudoStatTwoHandedMacesSkill]:"mace2hSkill",[s.PseudoStatTwoHandedAxesSkill]:"axe2hSkill",[s.PseudoStatPolearmsSkill]:"polearmSkill",[s.PseudoStatStavesSkill]:"staffSkill",[s.PseudoStatBowsSkill]:"bowSkill",[s.PseudoStatCrossbowsSkill]:"crossbowSkill",[s.PseudoStatGunsSkill]:"gunSkill",[s.PseudoStatThrownSkill]:"thrownSkill"};let Yc=Zc;class Qc extends Jc{constructor(e,t){super(e,t,{title:"JSON Export",allowDownload:!0,selectCategories:!0})}getData(){return Qc.getData(this.simUI,e(ao).filter((e=>this.exportCategories[e])))}static getData(e,t){return t||(t=ro.DEFAULT_CATEGORIES),me(K.toJson(e.toProto(t)),2,((e,t)=>!!["stats","pseudoStats"].includes(t[t.length-1])||(["player","equipment","items"].every(((e,s)=>t[s]==e))||!("player"!=t[0]||"rotation"!=t[1]||!["prepullActions","priorityList"].includes(t[2])))&&t.length>3))}}class Xc extends Jc{constructor(e,t){super(e,t,{title:"Shareable Link",selectCategories:!0})}getData(){return Xc.createLink(this.simUI,e(ao).filter((e=>this.exportCategories[e])))}static createLink(e,t){t||(t=ro.DEFAULT_CATEGORIES);const s=e.toProto(t),i=K.toBinary(s),a=Bc.deflate(i,{to:"string"}),n=btoa(String.fromCharCode(...a)),o=new URL(window.location.href);if(o.hash=n,he(t,ro.DEFAULT_CATEGORIES))o.searchParams.delete(ro.CATEGORY_PARAM);else{const e=t.map((e=>no.get(e))).join("");o.searchParams.set(ro.CATEGORY_PARAM,e)}return o.toString()}}const ed=class e extends Jc{constructor(e,t){super(e,t,{title:"Pawn EP Export",allowDownload:!0})}getData(){const t=this.simUI.player,s=t.getEpWeights(),i=_n.getAll(),a={};return i.forEach((t=>{const i=e.getName(t),n=s.getUnitStat(t);0!=n&&""!=i&&(a[i]?a[i]+=n:a[i]=n)})),`( Pawn: v1: "${de[t.spec]} WoWSims Weights": Class=${_.get(t.getClass())},`+Object.keys(a).map((e=>`${e}=${a[e].toFixed(3)}`)).join(",")+" )"}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};ed.statNames={[t.StatStrength]:"Strength",[t.StatAgility]:"Agility",[t.StatStamina]:"Stamina",[t.StatIntellect]:"Intellect",[t.StatSpirit]:"Spirit",[t.StatSpellPower]:"SpellDamage",[t.StatSpellDamage]:"SpellDamage",[t.StatArcanePower]:"ArcaneSpellDamage",[t.StatFirePower]:"FireSpellDamage",[t.StatFrostPower]:"FrostSpellDamage",[t.StatHolyPower]:"HolySpellDamage",[t.StatNaturePower]:"NatureSpellDamage",[t.StatShadowPower]:"ShadowSpellDamage",[t.StatMP5]:"Mp5",[t.StatSpellHit]:"SpellHitRating",[t.StatSpellCrit]:"SpellCritRating",[t.StatSpellHaste]:"SpellHasteRating",[t.StatSpellPenetration]:"SpellPen",[t.StatAttackPower]:"Ap",[t.StatMeleeHit]:"HitRating",[t.StatMeleeCrit]:"CritRating",[t.StatMeleeHaste]:"HasteRating",[t.StatArmorPenetration]:"ArmorPenetration",[t.StatExpertise]:"ExpertiseRating",[t.StatMana]:"Mana",[t.StatEnergy]:"Energy",[t.StatRage]:"Rage",[t.StatArmor]:"Armor",[t.StatRangedAttackPower]:"Ap",[t.StatDefense]:"DefenseRating",[t.StatBlock]:"BlockRating",[t.StatBlockValue]:"BlockValue",[t.StatDodge]:"DodgeRating",[t.StatParry]:"ParryRating",[t.StatResilience]:"ResilienceRating",[t.StatHealth]:"Health",[t.StatArcaneResistance]:"ArcaneResistance",[t.StatFireResistance]:"FireResistance",[t.StatFrostResistance]:"FrostResistance",[t.StatNatureResistance]:"NatureResistance",[t.StatShadowResistance]:"ShadowResistance",[t.StatBonusArmor]:"Armor2",[t.StatHealingPower]:"Healing",[t.StatFeralAttackPower]:"FeralAttackPower"},ed.pseudoStatNames={[s.PseudoStatMainHandDps]:"MeleeDps",[s.PseudoStatRangedDps]:"RangedDps"};let td=ed;class sd extends o{constructor(e,t,s){super(e,"saved-data-manager-root"),this.modObject=t,this.config=s,this.userData=[],this.presets=[],this.frozen=!1;const i=new qn(this.rootElem,"saved-data",{header:s.header}),a=r(),n=r(),o=r();i.bodyElement.replaceChildren(l("div",{ref:a,className:"saved-data-container hide"},l("div",{ref:n,className:"saved-data-presets"}),l("div",{ref:o,className:"saved-data-custom"}))),this.savedDataDiv=a.value,this.presetDataDiv=n.value,this.customDataDiv=o.value,s.presetsOnly||i.bodyElement.appendChild(this.buildCreateContainer())}addSavedData(e){this.savedDataDiv.classList.remove("hide");const t=this.makeSavedData(e),s=e.isPreset?this.presets:this.userData,i=s.findIndex((t=>t.name==e.name));-1==i?(e.isPreset?this.presetDataDiv.appendChild(t.elem):this.customDataDiv.appendChild(t.elem),s.push(t)):(s[i].elem.replaceWith(t.elem),s[i]=t)}makeSavedData(e){const t=r(),s=l("div",{className:"saved-data-set-chip badge rounded-pill"},l("a",{href:"javascript:void(0)",className:"saved-data-set-name",attributes:{role:"button"}},e.name),!e.isPreset&&l("a",{ref:t,href:"javascript:void(0)",className:"saved-data-set-delete",attributes:{role:"button"}},l("i",{className:"fa fa-times fa-lg"})));if(s.addEventListener("click",(()=>{this.config.setData(m.nextEventID(),this.modObject,e.data),e.onLoad?.(this.modObject),this.saveInput&&(this.saveInput.value=e.name)})),!e.isPreset&&t.value){const s=Ln(t.value,{content:`Delete saved ${this.config.label}`});t.value.addEventListener("click",(t=>{t.stopPropagation();if(!confirm(`Delete saved ${this.config.label} '${e.name}'?`))return;s.destroy();const i=this.userData.findIndex((t=>t.name==e.name));this.userData[i].elem.remove(),this.userData.splice(i,1),this.saveUserData()}))}e.tooltip&&Ln(s,{content:e.tooltip,placement:"bottom"});const i=()=>{this.config.equals(e.data,this.config.getData(this.modObject))?(s.classList.add("active"),this.saveInput&&(this.saveInput.value=e.name)):s.classList.remove("active"),e.enableWhen&&!e.enableWhen(this.modObject)?s.classList.add("disabled"):s.classList.remove("disabled")};return i(),this.config.changeEmitters.forEach((e=>e.on(i))),{name:e.name,data:e.data,elem:s,enableWhen:e.enableWhen,onLoad:e.onLoad}}saveUserData(){const e={};this.userData.forEach((t=>{e[t.name]=this.config.toJson(t.data)})),0==this.userData.length&&0==this.presets.length&&this.savedDataDiv.classList.add("hide"),window.localStorage.setItem(this.config.storageKey,JSON.stringify(e))}loadUserData(){const e=window.localStorage.getItem(this.config.storageKey);if(!e)return;let t;try{t=JSON.parse(e)}catch(s){console.warn("Invalid json for local storage value: "+e)}for(const i in t)try{this.addSavedData({name:i,data:this.config.fromJson(t[i])})}catch(s){console.warn("Failed parsing saved data: "+t[i])}}freeze(){this.frozen=!0,this.rootElem.classList.add("frozen")}buildCreateContainer(){const e=r(),t=r(),s=l("div",{className:"saved-data-create-container"},l("label",{className:"form-label"},this.config.label," Name"),l("input",{ref:t,className:"saved-data-save-input form-control",type:"text",placeholder:"Name"}),l("button",{ref:e,className:"saved-data-save-button btn btn-primary"},"Save ",this.config.label));return this.saveInput=t.value,e.value?.addEventListener("click",(()=>{if(this.frozen)return;const e=this.saveInput?.value;e?e in this.presets?alert(`${this.config.label} with name ${e} already exists.`):(this.addSavedData({name:e,data:this.config.getData(this.modObject)}),this.saveUserData()):alert(`Choose a label for your saved ${this.config.label}!`)})),s}}var id=(e=>(e.EPWeights="epWeights",e.Gear="gear",e.Talents="talents",e.Rotation="rotation",e.Encounter="encounter",e.Settings="settings",e))(id||{});class ad extends o{constructor(e,t,s){if(super(e,"preset-configuration-picker-root"),this.rootElem.classList.add("saved-data-manager-root"),this.simUI=t,this.builds=(this.simUI.individualConfig.presets.builds??[]).filter((e=>Object.keys(e).some((t=>s?.includes(t)&&!!e[t])))),!this.builds.length)return void this.rootElem.classList.add("hide");const i=new qn(this.rootElem,"saved-data",{header:{title:"Preset Configurations",tooltip:"Preset configurations can apply an optimal combination of gear, talents, rotation and encounter settings."}}),a=r(),n=l("div",{className:"saved-data-container"},l("div",{className:"saved-data-presets",ref:a}));this.simUI.sim.waitForInit().then((()=>{this.builds.forEach((e=>{const t=r();a.value.appendChild(l("button",{className:"saved-data-set-chip badge rounded-pill",ref:t},l("span",{className:"saved-data-set-name",attributes:{role:"button"},onclick:()=>this.applyBuild(e)},e.name)));let s=Object.keys(e).filter((t=>!["name","encounter","settings"].includes(t)&&e[t]));e.encounter?.encounter&&s.push("encounter"),e.epWeights&&s.push("stat weights"),e.settings&&Object.keys(e.settings).forEach((e=>{["name","buffs","raidBuffs"].includes(e)||("options"===e?s.push("Class/Spec Options"):"consumes"===e?s.push("Consumables"):s.push("Other Settings"))})),(e.settings?.buffs||e.settings?.raidBuffs)&&s.push("buffs"),s=[...new Set(s)].sort(),Ln(t.value,{content:l(k,null,l("p",{className:"mb-1"},"This preset affects the following settings:"),l("ul",{className:"mb-0 text-capitalize"},s.map((e=>l("li",null,e)))))});const i=()=>t.value.classList[this.isBuildActive(e)?"add":"remove"]("active");i(),m.onAny([this.simUI.player.changeEmitter,this.simUI.sim.settingsChangeEmitter,this.simUI.sim.raid.changeEmitter,this.simUI.sim.encounter.changeEmitter]).on(i)})),i.bodyElement.replaceChildren(n)}))}applyBuild({gear:e,rotation:t,rotationType:s,talents:i,epWeights:a,encounter:n,settings:o}){const l=m.nextEventID();m.freezeAllAndDo((()=>{e&&this.simUI.player.setGear(l,this.simUI.sim.db.lookupEquipmentSpec(e.gear)),i&&this.simUI.player.setTalentsString(l,i.data.talentsString),s?(this.simUI.player.aplRotation.type=s,this.simUI.player.rotationChangeEmitter.emit(l)):t?.rotation.rotation&&this.simUI.player.setAplRotation(l,t.rotation.rotation),a&&this.simUI.player.setEpWeights(l,a.epWeights),n&&(n.encounter&&this.simUI.sim.encounter.fromProto(l,n.encounter),n.healingModel&&this.simUI.player.setHealingModel(l,n.healingModel),n.tanks&&this.simUI.sim.raid.setTanks(l,n.tanks)),o&&(o.level&&this.simUI.player.setLevel(l,o.level),o.race&&this.simUI.player.setRace(l,o.race),o.playerOptions?.profession1&&this.simUI.player.setProfession1(l,o.playerOptions.profession1),o.playerOptions?.profession2&&this.simUI.player.setProfession2(l,o.playerOptions.profession2),o.playerOptions?.distanceFromTarget&&this.simUI.player.setDistanceFromTarget(l,o.playerOptions.distanceFromTarget),void 0!==o.playerOptions?.enableItemSwap&&o.playerOptions?.itemSwap&&this.simUI.player.itemSwapSettings.setItemSwapSettings(l,o.playerOptions.enableItemSwap,this.simUI.sim.db.lookupItemSwap(o.playerOptions.itemSwap),Dn.fromProto(o.playerOptions.itemSwap.prepullBonusStats)),o.specOptions&&this.simUI.player.setSpecOptions(l,{...this.simUI.player.getSpecOptions(),...o.specOptions}),o.buffs&&this.simUI.player.setBuffs(l,o.buffs),o.debuffs&&this.simUI.sim.raid.setDebuffs(l,o.debuffs),o.raidBuffs&&this.simUI.sim.raid.setBuffs(l,o.raidBuffs),o.consumes&&this.simUI.player.setConsumes(l,o.consumes))}))}isBuildActive({gear:e,rotation:t,rotationType:s,talents:i,epWeights:a,encounter:n,settings:o}){const l=!e||M.equals(e.gear,this.simUI.player.getGear().asSpec()),r=!i||le.equals(i.data,le.create({talentsString:this.simUI.player.getTalentsString()}));let c=!0;if(s)c=s===this.simUI.player.getRotationType();else if(t){const e=this.simUI.player.getResolvedAplRotation();e.type===ue.TypeAuto&&(e.type=ue.TypeAPL),c=t.rotation?.rotation?.type===ue.TypeSimple&&t.rotation.rotation?.simple?.specRotationJson?this.simUI.player.specTypeFunctions.rotationEquals(this.simUI.player.specTypeFunctions.rotationFromJson(JSON.parse(t.rotation.rotation.simple.specRotationJson)),this.simUI.player.getSimpleRotation()):pe.equals(t.rotation.rotation,e)}const d=!a||this.simUI.player.getEpWeights().equals(a.epWeights),m=!n?.encounter||ge.equals(n.encounter,this.simUI.sim.encounter.toProto()),h=!n?.healingModel||fe.equals(n.healingModel,this.simUI.player.getHealingModel()),u=!o?.level||this.simUI.player.getLevel()===o.level,p=!o?.race||this.simUI.player.getRace()===o.race,g=void 0===o?.playerOptions?.profession1||this.simUI.player.getProfession1()===o.playerOptions.profession1,f=void 0===o?.playerOptions?.profession2||this.simUI.player.getProfession2()===o.playerOptions.profession2,I=void 0===o?.playerOptions?.distanceFromTarget||this.simUI.player.getDistanceFromTarget()===o.playerOptions.distanceFromTarget,w=void 0===o?.playerOptions?.enableItemSwap||this.simUI.player.itemSwapSettings.getEnableItemSwap()===o.playerOptions.enableItemSwap,v=void 0===o?.playerOptions?.itemSwap||Ie.equals(this.simUI.player.itemSwapSettings?.toProto(),o?.playerOptions?.itemSwap),b=!o?.specOptions||this.containsAllFields(this.simUI.player.getSpecOptions(),o.specOptions),S=!o?.consumes||we.equals(this.simUI.player.getConsumes(),o.consumes),x=!o?.raidBuffs||ve.equals(this.simUI.sim.raid.getBuffs(),o.raidBuffs),y=!o?.buffs||be.equals(this.simUI.player.getBuffs(),o.buffs),E=!o?.debuffs||Se.equals(this.simUI.sim.raid.getDebuffs(),o.debuffs);return l&&r&&c&&d&&m&&h&&u&&p&&g&&f&&I&&w&&v&&b&&S&&x&&y&&E}containsAllFields(e,t){return Object.keys(t).every((s=>s in e&&e[s]===t[s]))}}class nd extends jn{constructor(e,t){super(e,t,{identifier:"gear-tab",title:"Gear"}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("gear-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("gear-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildGearPickers(),this.buildPresetConfigurationPicker(),this.buildSavedGearsetPicker()}buildGearPickers(){new Xn(this.leftPanel,this.simUI,this.simUI.player)}buildPresetConfigurationPicker(){new ad(this.rightPanel,this.simUI,[id.Gear])}buildSavedGearsetPicker(){const e=new sd(this.rightPanel,this.simUI.player,{header:{title:"Gear Sets"},label:"Gear Set",storageKey:this.simUI.getSavedGearStorageKey(),getData:e=>xe.create({gear:e.getGear().asSpec(),bonusStatsStats:e.getBonusStats().toProto()}),setData:(e,t,s)=>{m.freezeAllAndDo((()=>{t.setGear(e,this.simUI.sim.db.lookupEquipmentSpec(s.gear||M.create())),t.setBonusStats(e,Dn.fromProto(s.bonusStatsStats||n.create()))}))},changeEmitters:[this.simUI.player.changeEmitter],equals:(e,t)=>xe.equals(e,t),toJson:e=>xe.toJson(e),fromJson:e=>xe.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.gear.forEach((t=>{e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:xe.create({gear:this.simUI.sim.db.lookupEquipmentSpec(t.gear).asSpec(),bonusStatsStats:(new Dn).toProto()}),enableWhen:t.enableWhen})}))}))}}class od extends d{constructor(e,t,s){super(e,"enum-picker-root",t,s),this.selectElem=document.createElement("select"),this.selectElem.id=s.id,this.selectElem.classList.add("enum-picker-selector","form-select"),s.values.forEach((e=>{const t=document.createElement("option");t.value=String(e.value),t.textContent=e.name,this.selectElem.appendChild(t),e.tooltip&&(t.title=e.tooltip)})),this.rootElem.appendChild(this.selectElem),this.init(),this.selectElem.addEventListener("change",(()=>{this.inputChanged(m.nextEventID())}),{signal:this.signal})}getInputElem(){return this.selectElem}getInputValue(){return parseInt(this.selectElem.value)}setInputValue(e){this.selectElem.value=String(e)}}var ld=(e=>(e.Vertical="vertical",e.Horizontal="Horizontal",e))(ld||{});class rd extends d{constructor(e,t,s){super(e,"icon-picker-root",t,s),this.incrementValue=()=>{0==this.config.states||this.currentValue+this.step<this.config.states*this.step?(this.currentValue+=this.step,this.inputChanged(m.nextEventID())):this.currentValue>0&&(this.currentValue=0,this.inputChanged(m.nextEventID()))},this.decrementValue=()=>{this.currentValue>0?this.currentValue-=this.step:0===this.config.states?this.currentValue=this.step:this.currentValue=(this.config.states-1)*this.step,this.inputChanged(m.nextEventID())},this.rootElem.classList.add("icon-picker"),this.active=!1,this.config=s,this.currentValue=0,this.step=s.step??1,this.rootAnchor=document.createElement("a"),this.rootAnchor.classList.add("icon-picker-button"),this.rootAnchor.dataset.whtticon="false",this.rootAnchor.dataset.disableWowheadTouchTooltip="true",this.rootAnchor.target="_blank",this.rootElem.prepend(this.rootAnchor);const i=Boolean(this.config.improvedId);i&&this.rootAnchor.classList.add("use-improved-icons"),this.config.improvedId2&&this.rootAnchor.classList.add("use-improved-icons2"),!i&&this.config.states>2&&this.rootAnchor.classList.add("use-counter");const a=r(),n=r(),o=r();this.rootAnchor.appendChild(l("div",{className:"icon-input-level-container"},l("a",{ref:a,className:"icon-picker-button icon-input-improved icon-input-improved1",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),l("a",{ref:n,className:"icon-picker-button icon-input-improved icon-input-improved2",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),l("span",{ref:o,className:"icon-picker-label "+(this.config.states>2?"":"hide")}))),this.improvedAnchor=a.value,this.improvedAnchor2=n.value,this.counterElem=o.value,this.config.states>=3&&this.config.improvedId&&this.config.improvedId.fillAndSet(this.improvedAnchor,!0,!0),this.config.states>=4&&this.config.improvedId2&&this.config.improvedId2.fillAndSet(this.improvedAnchor2,!0,!0),this.init();const c=()=>{this.config.actionId(this.modObject)?.fillAndSet(this.rootAnchor,!0,!0),this.showWhen()?(this.rootElem.classList.remove("hide"),this.restoreValue()):(this.storeValue(),this.rootElem.classList.add("hide"))};c(),this.config.changedEvent(this.modObject).on(c);const d=s.reverse?this.decrementValue:this.incrementValue,h=s.reverse?this.incrementValue:this.decrementValue;this.rootAnchor.addEventListener("click",(e=>{e.preventDefault(),d()})),this.rootAnchor.addEventListener("mousedown",(e=>{W(e)&&(e.preventDefault(),h())})),this.rootAnchor.addEventListener("contextmenu",(e=>e.preventDefault()))}getInputElem(){return this.rootAnchor}getInputValue(){return 2==this.config.states?Boolean(this.currentValue):this.currentValue}getActionId(){const e=Number(this.config.getValue(this.modObject));return 0==e?null:1==e?this.config.actionId(this.modObject):2==e&&this.config.improvedId?this.config.improvedId:3==e&&this.config.improvedId2?this.config.improvedId2:this.config.actionId(this.modObject)}setInputValue(e){this.currentValue=Number(e),this.currentValue>0?(this.active=!0,this.rootAnchor.classList.add("active"),this.counterElem.classList.add("active")):(this.active=!1,this.rootAnchor.classList.remove("active"),this.counterElem.classList.remove("active")),this.config.states>=3&&this.config.improvedId&&(this.currentValue>1?this.improvedAnchor.classList.add("active"):this.improvedAnchor.classList.remove("active")),this.config.states>=4&&this.config.improvedId2&&(this.currentValue>2?(this.improvedAnchor2.classList.add("active"),this.improvedAnchor.hidden=!0,this.improvedAnchor2.hidden=!1):(this.improvedAnchor2.classList.remove("active"),this.improvedAnchor.hidden=!1,this.improvedAnchor2.hidden=!0)),!this.config.improvedId&&(this.config.states>3||0==this.config.states)&&(this.counterElem.textContent=String(this.currentValue))}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(0),this.inputChanged(m.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(m.nextEventID()),this.storedValue=void 0)}showWhen(){return null!=this.config.actionId(this.modObject)&&(!this.config.showWhen||this.config.showWhen(this.modObject))}}class cd extends d{constructor(e,t,s){if(super(e,"icon-enum-picker-root",t,s),this.rootElem.classList.add("icon-picker","vertical"===(s.direction??ld.Vertical)?"dropdown":"dropend"),this.config=s,this.currentValue=this.config.zeroValue,s.tooltip){const e=Ln(this.rootElem,{content:s.tooltip});this.addOnDisposeCallback((()=>e.destroy()))}this.rootElem.appendChild(l(k,null,l("a",{href:"javascript:void(0)",className:"icon-picker-button",attributes:{"aria-expanded":"false",role:"button"},dataset:{bsToggle:"dropdown",whtticon:"false",disableWowheadTouchTooltip:"true"}}),l("ul",{className:"dropdown-menu"}),l("label",{className:"form-label"}))),this.buttonElem=this.rootElem.querySelector(".icon-picker-button"),this.buttonText=this.rootElem.querySelector("label"),this.dropdownMenu=this.rootElem.querySelector(".dropdown-menu"),this.config.numColumns&&(this.dropdownMenu.style.gridTemplateColumns=`repeat(${this.config.numColumns}, 1fr)`),this.config.direction==ld.Horizontal&&(this.dropdownMenu.style.gridAutoFlow="column"),this.config.values.forEach(((e,t)=>{const s=document.createElement("li");s.classList.add("icon-dropdown-option","dropdown-option"),this.dropdownMenu.appendChild(s);const i=document.createElement("a");i.classList.add("icon-picker-button"),i.dataset.whtticon="false",i.dataset.disableWowheadTouchTooltip="true",s.appendChild(i);const a=()=>{this.setImage(i,e),this.showValueWhen(e)?s.classList.remove("hide"):(s.classList.add("hide"),this.currentValue==e.value&&(this.setInputValue(this.config.zeroValue),this.inputChanged(m.nextEventID())))};if(this.config.changedEvent(this.modObject).on(a),a(),i.addEventListener("click",(t=>{t.preventDefault(),this.currentValue=e.value,this.storedValue=void 0,this.inputChanged(m.nextEventID())})),e.tooltip){const t=Ln(i,{content:e.tooltip});this.addOnDisposeCallback((()=>t.destroy()))}})),this.init();const i=()=>{this.showWhen()?(this.restoreValue(),this.rootElem.classList.remove("hide")):(this.storeValue(),this.rootElem.classList.add("hide"))};i(),this.config.changedEvent(this.modObject).on(i)}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(this.config.zeroValue),this.inputChanged(m.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(m.nextEventID()),this.storedValue=void 0)}setActionImage(e,t){t.fillAndSet(e,!0,!0)}setImage(e,t){if(t.showWhen&&!t.showWhen(this.modObject))return void e.removeAttribute("href");const s=t.actionId?.(this.modObject);s?(this.setActionImage(e,s),e.style.filter=""):t.iconUrl?(e.style.backgroundImage=`url(${t.iconUrl})`,e.style.filter="grayscale(1)"):(e.href="",e.style.backgroundImage="",e.style.filter="",e.style.backgroundColor=t.color)}update(){super.update(),this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue))}getInputElem(){return this.buttonElem}getInputValue(){return this.currentValue}setInputValue(e){this.currentValue=e,this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue)),this.buttonText.textContent="",this.buttonText.style.display="none";const t=this.config.values.find((e=>this.config.equals(e.value,this.currentValue)));if(t)this.setImage(this.buttonElem,t),null!=t.text&&(this.buttonText.style.display="block",this.buttonText.textContent=t.text);else if(this.config.backupIconUrl){const e=this.config.backupIconUrl(this.currentValue);this.setActionImage(this.buttonElem,e),this.setActive(!1)}}setActive(e){e?this.buttonElem.classList.add("active"):this.buttonElem.classList.remove("active")}showWhen(){return(!this.config.showWhen||this.config.showWhen(this.modObject))&&!!this.config.values.find((e=>e.actionId&&null!=e.actionId(this.modObject)&&(!e.showWhen||e.showWhen(this.modObject))))}showValueWhen(e){return(!e.actionId||null!=e.actionId?.(this.modObject))&&(!e.showWhen||e.showWhen(this.modObject))}}function dd(e){return{direction:e.direction,values:e.values,label:e.label,tooltip:e.tooltip,showWhen:t=>e.values.filter((e=>!e.showWhen||e.showWhen(t))).length>0}}function md(e){const t=e.getModObject;return{id:e.id,type:"boolean",label:e.label,labelTooltip:e.labelTooltip,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,i,a)=>e.setValue(s,t(i),a),enableWhen:e.enableWhen?s=>e.enableWhen(t(s)):void 0,showWhen:e.showWhen?s=>e.showWhen(t(s)):void 0,extraCssClasses:e.extraCssClasses}}function hd(e){return md({id:`${String(e.fieldName)||ye()}`,label:e.label,labelTooltip:e.labelTooltip,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,s,i)=>{const a=s.getSpecOptions();a[e.fieldName]=i,s.setSpecOptions(t,a)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function ud(e){return md({id:`${String(e.fieldName)||ye()}`,label:e.label,labelTooltip:e.labelTooltip,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,s,i)=>{const a=s.getSimpleRotation();a[e.fieldName]=i,s.setSimpleRotation(t,a)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function pd(e){const t=e.getModObject;return{id:e.id,type:"number",label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,defaultValue:e.defaultValue,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,i,a)=>e.setValue(s,t(i),a),enableWhen:e.enableWhen?s=>e.enableWhen(t(s)):void 0,showWhen:e.showWhen?s=>e.showWhen(t(s)):void 0,extraCssClasses:e.extraCssClasses}}function gd(e){const t={id:`${String(e.fieldName)||ye()}`,label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,defaultValue:e.defaultValue,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,s,i)=>{const a=s.getSpecOptions();a[e.fieldName]=i,s.setSpecOptions(t,a)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const e=t.getValue;t.getValue=t=>100*e(t);const s=t.setValue;t.setValue=(e,t,i)=>s(e,t,i/100)}return pd(t)}function fd(e){const t={id:`${String(e.fieldName)||ye()}`,label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,s,i)=>{const a=s.getSimpleRotation();a[e.fieldName]=i,s.setSimpleRotation(t,a)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const e=t.getValue;t.getValue=t=>100*e(t);const s=t.setValue;t.setValue=(e,t,i)=>s(e,t,i/100)}return pd(t)}function Id(e){const t=e.getModObject;return{id:e.id,type:"enum",label:e.label,labelTooltip:e.labelTooltip,values:e.values,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,i,a)=>e.setValue(s,t(i),a),enableWhen:e.enableWhen?s=>e.enableWhen(t(s)):void 0,showWhen:e.showWhen?s=>e.showWhen(t(s)):void 0}}function wd(e){return Id({id:`${String(e.fieldName)||ye()}`,label:e.label,labelTooltip:e.labelTooltip,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,s,i)=>{const a=s.getSpecOptions();a[e.fieldName]=i,s.setSpecOptions(t,a)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function vd(e){return Id({id:`${String(e.fieldName)||ye()}`,label:e.label,labelTooltip:e.labelTooltip,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,s,i)=>{const a=s.getSimpleRotation();a[e.fieldName]=i,s.setSimpleRotation(t,a)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function bd(e){const t=e.getModObject;return{type:"icon",actionId:s=>e.actionId(t(s)),states:e.states,showWhen:e.showWhen,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,i,a)=>e.setValue(s,t(i),a),extraCssClasses:e.extraCssClasses}}function Sd(e,t,s,i){return bd({getModObject:e.getModObject,actionId:t,states:2,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:e.getFieldValue||(t=>i?e.getValue(t)[s]==i:e.getValue(t)[s]),setValue:e.setFieldValue||((t,a,n)=>{const o=e.getValue(a);i?n?o[s]=i:o[s]==i&&(o[s]=0):o[s]=n,e.setValue(t,a,o)}),extraCssClasses:e.extraCssClasses})}function xd(e){return Sd({getModObject:e=>e,getValue:e=>e.getSpecOptions(),setValue:(e,t,s)=>t.setSpecOptions(e,s),changeEmitter:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses,getFieldValue:e.getValue,setFieldValue:e.setValue},e.actionId,e.fieldName,e.value)}function yd(e,t,s){return bd({getModObject:e.getModObject,actionId:t,states:0,step:1,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:t=>e.getValue(t)[s],setValue:(t,i,a)=>{const n=e.getValue(i);a<0&&(a=0),n[s]=a,e.setValue(t,i,n)}})}function Ed(e,t,s,i){const a=yd(e,t,i);return a.states=3,a.improvedId=s,a}function Pd(e,t,s,i,a,n){const o=yd(e,t,i);return o.states=s,o.step=a,o.reverse=n,o}function kd(e,t,s,i,a,n){return function(e){const t=e.getModObject;return{type:"iconEnum",numColumns:e.numColumns,direction:e.direction,tooltip:e.tooltip,values:e.values.map((e=>{if(e.showWhen){const s=e.showWhen;e.showWhen=e=>s(t(e))}return e})),equals:e.equals,showWhen:s=>!e.showWhen||e.showWhen(t(s)),zeroValue:e.zeroValue,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,i,a)=>e.setValue(s,t(i),a),extraCssClasses:e.extraCssClasses}}({values:s,zeroValue:0,numColumns:i,direction:a||ld.Vertical,tooltip:n,equals:(e,t)=>e==t,getModObject:e.getModObject,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:s=>e.getValue(s)[t],setValue:(s,i,a)=>{const n=e.getValue(i);n[t]=a,e.setValue(s,i,n)}})}function Cd(e){return kd({showWhen:e.showWhen,getModObject:e=>e,getValue:e=>e.getSpecOptions(),setValue:(e,t,s)=>t.setSpecOptions(e,s),getFieldValue:e.getValue,setFieldValue:e.setValue,changeEmitter:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses},e.fieldName,e.values,e.numColumns,e.direction,e.tooltip)}const Ld=(e,t,s)=>"icon"==s.type?new rd(e,t,s):new cd(e,t,s);function Td(e,t){return e.label=t,e}function Nd(e){return Sd({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,s)=>t.getRaid().setBuffs(e,s),changeEmitter:e=>m.onAny([e.getRaid().buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function Ad(e){return Sd({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getBuffs(),setValue:(e,t,s)=>t.setBuffs(e,s),changeEmitter:e=>m.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function Rd(e){return Sd({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getConsumes(),setValue:(e,t,s)=>t.setConsumes(e,s),changeEmitter:e=>m.onAny([e.consumesChangeEmitter,e.levelChangeEmitter,e.professionChangeEmitter])},e.actionId,e.fieldName,e.value)}function _d(e){return Sd({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getConsumes().miscConsumes??Ee.create(),setValue:(e,t,s)=>{const i=t.getConsumes();i.miscConsumes=s,t.setConsumes(e,i)},changeEmitter:e=>m.onAny([e.consumesChangeEmitter,e.levelChangeEmitter,e.professionChangeEmitter])},e.actionId,e.fieldName,e.value)}function Dd(e){return Sd({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getDebuffs(),setValue:(e,t,s)=>t.getRaid().setDebuffs(e,s),changeEmitter:e=>m.onAny([e.getRaid().debuffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function Md(e){return Ed({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,s)=>t.getRaid().setBuffs(e,s),changeEmitter:e=>m.onAny([e.getRaid().buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.impId,e.fieldName)}function Vd(e){return Ed({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getBuffs(),setValue:(e,t,s)=>t.setBuffs(e,s),changeEmitter:e=>m.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.impId,e.fieldName)}function Ud(e){return Ed({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getDebuffs(),setValue:(e,t,s)=>t.getRaid().setDebuffs(e,s),changeEmitter:e=>m.onAny([e.getRaid().debuffsChangeEmitter,e.levelChangeEmitter])},e.actionId,e.impId,e.fieldName)}function Wd(e){return Pd({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,s)=>t.getRaid().setBuffs(e,s),changeEmitter:e=>m.onAny([e.getRaid().buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.numStates,e.fieldName,e.multiplier,e.reverse)}function Fd(e){return Pd({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,s)=>t.setBuffs(e,s),changeEmitter:e=>m.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},e.actionId,e.numStates,e.fieldName,e.multiplier,e.reverse)}function Od(e){return Pd({getModObject:e=>e.getRaid(),getValue:e=>e.getDebuffs(),setValue:(e,t,s)=>t.setDebuffs(e,s),changeEmitter:e=>e.debuffsChangeEmitter},e.actionId,e.numStates,e.fieldName,e.multiplier,e.reverse)}function Hd(e){return kd({getModObject:e=>e,getValue:e=>e.getConsumes(),setValue:(e,t,s)=>t.setConsumes(e,s),changeEmitter:e=>m.onAny([e.consumesChangeEmitter,e.levelChangeEmitter])},e.fieldName,e.values,e.numColumns,e.direction||ld.Vertical)}class qd extends d{constructor(e,t,s){super(e,"adaptive-string-picker-root",t,s),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.id=s.id,this.inputElem.classList.add("form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(()=>{this.inputChanged(m.nextEventID())}),{signal:this.signal}),this.inputElem.addEventListener("input",(()=>{this.updateSize()}),{signal:this.signal}),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.inputElem.value}setInputValue(e){this.inputElem.value=e,this.updateSize()}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}const Bd={actions:{create:{useIcon:!1}}};let zd=null;class jd extends d{constructor(e,t,s){if(s.isCompact&&(s.extraCssClasses=[...s.extraCssClasses||[],"list-picker-compact"]),super(e,"list-picker-root",t,s),this.config={...Bd,...s},this.itemPickerPairs=[],this.rootElem.appendChild(l(k,null,s.title&&l("label",{className:"list-picker-title form-label"},s.title),l("div",{className:"list-picker-items"}))),this.config.hideUi&&this.rootElem.classList.add("d-none"),this.config.horizontalLayout&&(this.config.inlineMenuBar=!0,this.rootElem.classList.add("horizontal")),this.config.titleTooltip){const e=Ln(this.rootElem.querySelector(".list-picker-title"),{content:this.config.titleTooltip});this.addOnDisposeCallback((()=>e?.destroy()))}if(this.itemsDiv=this.rootElem.getElementsByClassName("list-picker-items")[0],this.actionEnabled("create")){let e=null,t=null;this.config.actions?.create?.useIcon?(e=jd.makeActionElem("link-success","fa-plus"),t=Ln(e,{allowHTML:!1,content:`New ${s.itemLabel}`}),this.addOnDisposeCallback((()=>t?.destroy()))):e=l("button",{className:"btn btn-primary"},"New ",s.itemLabel),e.classList.add("list-picker-new-button"),e.addEventListener("click",(()=>{const e=this.config.newItem(),s=this.config.getValue(this.modObject).concat([e]);this.config.setValue(m.nextEventID(),this.modObject,s),t&&t.hide()}),{signal:this.signal}),this.rootElem.appendChild(e)}this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.itemPickerPairs.map((e=>e.picker.getInputValue()))}setInputValue(e){if(e.length<this.itemPickerPairs.length)this.itemPickerPairs.slice(e.length).forEach((e=>e.elem.remove())),this.itemPickerPairs=this.itemPickerPairs.slice(0,e.length);else if(e.length>this.itemPickerPairs.length){const t=e.length-this.itemPickerPairs.length;for(let e=0;e<t;e++)this.addNewPicker()}e.forEach(((e,t)=>this.itemPickerPairs[t].picker.setInputValue(e)))}actionEnabled(e){return!this.config.allowedActions||this.config.allowedActions.includes(e)}addHoverListeners(e){e.addEventListener("mouseenter",(()=>{e.classList.add("hover")}),{signal:this.signal}),e.addEventListener("mouseleave",(()=>{e.classList.remove("hover")}),{signal:this.signal})}addNewPicker(){const e=this.itemPickerPairs.length,t=document.createElement("div");t.classList.add("list-picker-item-container"),this.config.inlineMenuBar&&t.classList.add("inline"),this.itemsDiv.appendChild(t);const s=document.createElement("div");s.classList.add("list-picker-item");const i=document.createElement("div");i.classList.add("list-picker-item-header");const a=document.createElement("div");a.classList.add("list-picker-item-popover"),a.setAttribute("popover","auto"),i.appendChild(a);let n=!1;if(this.config.inlineMenuBar)t.appendChild(s),t.appendChild(i);else if(t.appendChild(i),t.appendChild(s),this.config.itemLabel){const e=document.createElement("h6");e.classList.add("list-picker-item-title"),e.textContent=`${this.config.itemLabel} ${this.itemPickerPairs.length+1}`,i.appendChild(e)}const o=this.config.newItemPicker(s,this,e,{changedEvent:this.config.changedEvent,getValue:()=>this.getSourceValue()[e],setValue:(t,s,i)=>{const a=this.getSourceValue();a[e]=i,this.config.setValue(t,s,a)}}),l={elem:t,picker:o,idx:e};if(this.actionEnabled("delete")&&(!this.config.minimumItems||e+1>this.config.minimumItems)){n=!0;const t=jd.makeActionElem("list-picker-item-delete","fa-times");t.classList.add("link-danger"),a.appendChild(t);const s=Ln(t,{allowHTML:!1,content:`Delete ${this.config.itemLabel}`});t.addEventListener("click",(()=>{const t=this.config.getValue(this.modObject);t.splice(e,1),this.config.setValue(m.nextEventID(),this.modObject,t),s.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>s?.destroy())),this.addHoverListeners(t)}if(this.actionEnabled("copy")){n=!0;const t=jd.makeActionElem("list-picker-item-copy","fa-copy");a.appendChild(t);const s=Ln(t,{allowHTML:!1,content:`Copy to New ${this.config.itemLabel}`});t.addEventListener("click",(()=>{const t=this.config.getValue(this.modObject).slice();t.splice(e,0,this.config.copyItem(t[e])),this.config.setValue(m.nextEventID(),this.modObject,t),s.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>s?.destroy())),this.addHoverListeners(t)}if(this.actionEnabled("move")){n=!0,t.classList.add("draggable"),this.config.itemLabel&&t.classList.add(this.config.itemLabel.toLowerCase().replace(" ","-"));const s=jd.makeActionElem("list-picker-item-move","fa-arrows-up-down");a.appendChild(s);const i=Ln(s,{allowHTML:!1,content:"Move (Drag+Drop)"});s.addEventListener("click",(()=>{i.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>{i?.destroy()})),this.addHoverListeners(s),s.addEventListener("mousedown",(()=>{s.setAttribute("draggable","true"),t.setAttribute("draggable","true")}),{signal:this.signal}),s.addEventListener("mouseup",(()=>{s.removeAttribute("draggable"),t.removeAttribute("draggable")}),{signal:this.signal}),s.addEventListener("dragstart",(e=>{if(e.target==s){const s=a.getBoundingClientRect();e.dataTransfer.setDragImage(t,0,s.height/2),e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",t.classList.add("dragfrom"),zd={listPicker:this,item:l}}}),{signal:this.signal});const o=()=>zd&&"Action"===this.config.itemLabel&&zd.listPicker!==this,r=()=>zd&&zd.listPicker===this&&zd.item.idx===e,c=()=>zd&&zd.item.elem.contains(t),d=(e=!0)=>!zd||zd.listPicker.config.itemLabel!==this.config.itemLabel||(!!o()||(!(!e||!r())||!(!e||!c())));let h=0;t.addEventListener("dragenter",(e=>{d()||(e.stopPropagation(),h++,t.classList.add("dragto"))}),{signal:this.signal}),t.addEventListener("dragleave",(e=>{d()||(e.preventDefault(),h--,h<=0&&t.classList.remove("dragto"))}),{signal:this.signal}),t.addEventListener("dragover",(e=>{d()?(o()||r())&&(e.dataTransfer.dropEffect="none"):(e.dataTransfer.dropEffect="move",e.stopPropagation(),e.preventDefault())}),{signal:this.signal});const u=()=>{zd&&(s.removeAttribute("draggable"),t.removeAttribute("draggable"),zd.item.elem.removeAttribute("draggable"),[...document.querySelectorAll(".dragfrom,.dragto")].forEach((e=>{e.classList.remove("dragfrom"),e.classList.remove("dragto")})))};t.addEventListener("dragend",(e=>{d(!1)||(e.stopPropagation(),u(),zd=null)}),{signal:this.signal}),t.addEventListener("drop",(s=>{if(!zd||d())return void(r()&&(s.stopPropagation(),u()));s.stopPropagation(),u();const i=zd.item.idx;let a=e;const n=t.getBoundingClientRect();s.clientY>n.top+n.height/2&&a++;const o=this.config.getValue(this.modObject);let l;if(zd.listPicker!==this){const e=zd.listPicker.config.getValue(zd.listPicker.modObject);l=e[i],e.splice(i,1),zd.listPicker.config.setValue(m.nextEventID(),zd.listPicker.modObject,e)}else l=o[i],o.splice(i,1);o.splice(a,0,l),this.config.setValue(m.nextEventID(),this.modObject,o),zd=null}),{signal:this.signal})}if(n){const e=jd.makeActionElem("list-picker-item-actions","fa-ellipsis");i.appendChild(e),e.addEventListener("mouseover",(()=>{a.showPopover();const t=e.getBoundingClientRect(),s=a.getBoundingClientRect(),i=(s.height-t.height)/2;a.style.top=t.top-i+"px",a.style.left=t.right-s.width+10+"px",a.classList.add("hover")}),{signal:this.signal}),a.addEventListener("mouseleave",(()=>{a.classList.remove("hover"),a.hidePopover()}),{signal:this.signal})}this.itemPickerPairs.push(l)}static makeActionElem(e,t){return l("button",{type:"button",className:P("list-picker-item-action",e)},l("i",{className:P("fa","fa-xl",t)}))}static getItemHeaderElem(e){const t=e.rootElem.parentElement,s=t.nextElementSibling||t.previousElementSibling;if(!s?.classList.contains("list-picker-item-header"))throw new Error("Could not find list item header");return s}}const $d={auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s} \\(Rank [0-9]+\\)`),a=e.getAuras().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[t.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},stackable_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.maxStacks>0)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s} \\(Rank [0-9]+\\)`),a=e.getAuras().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[s]:[]}}))},icd_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasIcd)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s} \\(Rank [0-9]+\\)`),a=e.getAuras().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[s]:[]}}))},exclusive_effect_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasExclusiveEffect)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s} \\(Rank [0-9]+\\)`),a=e.getAuras().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[s]:[]}}))},castable_spells:{defaultLabel:"Spell",getActionIDs:async e=>{const t=e.getSpells().filter((e=>e.data.isCastable)),{spells:s,cooldowns:i}=_e(t,(e=>e.data.isMajorCooldown?"cooldowns":"spells")),a=[[De.OtherActionPotion,"Uses the potion selected in consumables settings."],[De.OtherActionOffensiveEquip,"Use any offensive on-use equipment."],[De.OtherActionDefensiveEquip,"Use any defensive on-use equipment."]];return[[{value:C.fromEmpty(),headerText:"Spells",submenu:["Spells"]}],(s||[]).map((e=>{const t=e.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${t.replace("(","\\(").replace(")","\\)")} \\(Rank [0-9]+\\)`),a=s.filter((e=>!!e.id.name.match(i))).length>1;return{value:e.id,submenu:a?["Spells",t]:["Spells"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}})),[{value:C.fromEmpty(),headerText:"Cooldowns",submenu:["Cooldowns"]}],(i||[]).map((e=>{const t=e.id.name.replace(/ \([\w\s%]+\)/g,""),s=new RegExp(`${t} \\(Rank [0-9]+\\)`),a=i.filter((e=>!!e.id.name.match(s))).length>1;return{value:e.id,submenu:a?["Cooldowns",t]:["Cooldowns"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}})),[{value:C.fromEmpty(),headerText:"Placeholders",submenu:["Placeholders"]}],a.map((([e,t])=>({value:C.fromOtherId(e),submenu:["Placeholders"],tooltip:t})))].flat()}},channel_spells:{defaultLabel:"Channeled Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable&&e.data.isChanneled)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s} \\(Rank [0-9]+\\)`),a=e.getSpells().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[s]:[]}}))},dot_spells:{defaultLabel:"DoT Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasDot)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s.replace("(","\\(").replace(")","\\)")} \\(Rank [0-9]+\\)`),a=e.getSpells().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[s]:[]}}))},shield_spells:{defaultLabel:"Shield Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasShield)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),i=new RegExp(`${s} \\(Rank [0-9]+\\)`),a=e.getSpells().filter((e=>!!e.id.name.match(i))).length>1;return{value:t.id,submenu:a?[s]:[]}}))}};class Gd extends Le{constructor(e,t,s){const i=$d[s.actionIdSet];super(e,t,{...s,sourceToValue:e=>e?C.fromProto(e):C.fromEmpty(),valueToSource:e=>e.toProto(),defaultLabel:i.defaultLabel,equals:(e,t)=>null==e==(null==t)&&(!e||e.equals(t)),setOptionContent:(e,t)=>{const i=t.value,a=r(),n=["auras","stackable_auras","icd_auras","exclusive_effect_auras"].includes(s.actionIdSet);e.appendChild(l(k,null,l("a",{ref:a,className:"apl-actionid-item-icon",dataset:{whtticon:!1}}),i.name)),i.setBackgroundAndHref(a.value),i.setWowheadDataset(a.value,{useBuffAura:n})},createMissingValue:e=>0==e.anyId()?new Promise((()=>{i.defaultLabel})):e.fill().then((e=>({value:e}))),values:[]});const a=s.getUnitRef,n="self"==s.defaultUnitRef?Ce.create({type:Te.Self}):Ce.create({type:Te.CurrentTarget}),o=i.getActionIDs,c=async()=>{const e=a(t),s=t.sim.getUnitMetadata(e,t,n);if(s){const e=await o(s);this.setOptions(e)}};c();const d=t.sim.unitMetadataEmitter.on(c),m=t.rotationChangeEmitter.on(c);this.addOnDisposeCallback((()=>{d.dispose(),m.dispose()}))}}class Kd extends Le{constructor(e,t,s){super(e,t,{...s,sourceToValue:e=>"spellId"==e?.rawId.oneofKind?t.sim.db.getRuneById(e.rawId.spellId):Ne.create(),valueToSource:e=>ke.create({rawId:{oneofKind:"spellId",spellId:e.id}}),defaultLabel:"Runes",equals:(e,t)=>e==t,setOptionContent:(e,t)=>{const s=C.fromSpellId(t.value.id),i=document.createElement("a");i.classList.add("apl-actionid-item-icon"),i.dataset.whtticon="false",i.classList.add("apl-actionid-item-icon"),s.fillAndSet(i,!0,!0),e.appendChild(i);const a=document.createTextNode(t.value.name);e.appendChild(a)},values:[]});(async()=>{const e=Object.values(h).filter((e=>"string"!=typeof e)).map((e=>t.getRunes(e))).flat().map((e=>({value:e,submenu:[Me.get(e.type)??""]})));this.setOptions(e)})(),t.rotationChangeEmitter.on((()=>this.update))}}const Jd={aura_sources:{getUnits:e=>[void 0,e.getPetMetadatas().asList().map(((e,t)=>Ce.create({type:Te.Pet,index:t,owner:Ce.create({type:Te.Self})}))),Ce.create({type:Te.CurrentTarget}),e.sim.encounter.targetsMetadata.asList().map(((e,t)=>Ce.create({type:Te.Target,index:t})))].flat()},aura_sources_targets_first:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>Ce.create({type:Te.Target,index:t}))),Ce.create({type:Te.Self}),e.getPetMetadatas().asList().map(((e,t)=>Ce.create({type:Te.Pet,index:t,owner:Ce.create({type:Te.Self})})))].flat()},targets:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>Ce.create({type:Te.Target,index:t})))].flat()}};class Zd extends Ae{constructor(e,t,s){const i=!!Jd[s.unitSet].targetUI;super(e,t,{...s,sourceToValue:e=>Zd.refToValue(e,t,i),valueToSource:e=>e.value,values:[],hideLabelWhenDefaultSelected:!0}),this.unitSet=s.unitSet,this.rootElem.classList.add("apl-unit-picker"),this.updateValues();const a=t.sim.unitMetadataEmitter.on((()=>this.updateValues()));this.addOnDisposeCallback((()=>{a.dispose()}))}static refToValue(e,t,s){if(!e||e.type==Te.Unknown)return{value:e,iconUrl:s?"fa-bullseye":"fa-user",text:s?"Current Target":"Self"};if(e.type==Te.Self)return{value:e,iconUrl:"fa-user",text:"Self"};if(e.type==Te.CurrentTarget)return{value:e,iconUrl:"fa-bullseye",text:"Current Target"};if(e.type==Te.Player){const s=t.sim.raid.getPlayer(e.index);if(s)return{value:e,iconUrl:s.getSpecIcon(),text:`Player ${e.index+1}`}}else if(e.type==Te.Target){if(t.sim.encounter.targetsMetadata.asList()[e.index])return{value:e,iconUrl:Re,text:`Target ${e.index+1}`}}else if(e.type==Te.Pet){const s=t.sim.getUnitMetadata(e,t,Ce.create({type:Te.Self}));let i=`Pet ${e.index+1}`,a="fa-paw";if(s){const e=s.getName();if(e){const t=e.indexOf(" - ");i=e.substring(t+3),a=Ve(i)||a}}return{value:e,iconUrl:a,text:i}}return{value:e}}updateValues(){const e=Jd[this.unitSet],t=e.getUnits(this.modObject);this.setOptions(t.map((t=>{const s={value:Zd.refToValue(t,this.modObject,e.targetUI)};return t&&t.type==Te.Pet&&(e.targetUI?s.submenu=[Zd.refToValue(t.owner,this.modObject,e.targetUI)]:s.submenu=[Zd.refToValue(void 0,this.modObject,e.targetUI)]),s})))}}class Yd extends d{constructor(e,t,s){super(e,"apl-picker-builder-root",t,s),this.config=s,this.fieldPickers=s.fields.map((e=>Yd.makeFieldPicker(this,e))),this.init()}static makeFieldPicker(e,t){const s=t.field,i=t.factory(e.rootElem,e.modObject,{label:t.label,labelTooltip:t.labelTooltip,id:ye(),changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const i=e.getSourceValue();return i[s]||(i[s]=t.newValue()),i[s]},setValue:(t,i,a)=>{e.getSourceValue()[s]=a,i.rotationChangeEmitter.emit(t)}},(()=>e.getSourceValue()));return"vals"!==s&&"actions"!==s||i.rootElem.classList.add("apl-picker-builder-multi"),{...t,picker:i}}getInputElem(){return this.rootElem}getInputValue(){const e=this.config.newValue();return this.fieldPickers.forEach((t=>{e[t.field]=t.picker.getInputValue()})),e}setInputValue(e){this.fieldPickers.forEach((t=>{t.picker.setInputValue(e[t.field])}))}}function Qd(e,t,s,i,a){return{field:e,newValue:()=>ke.create(),factory:(e,a,n,o)=>new Gd(e,a,{id:ye(),...n,actionIdSet:t,getUnitRef:()=>s?o()[s]:Ce.create(),defaultUnitRef:i||"self"}),...a||{}}}function Xd(e,t,s){return{field:e,newValue:()=>{},factory:(e,s,i)=>new Zd(e,s,{id:ye(),...i,unitSet:t}),...s||{}}}function em(e,t,s){return{field:e,newValue:()=>!1,factory:(e,t,s)=>(s.extraCssClasses=["input-inline"].concat(s.extraCssClasses||[]),new re(e,t,{id:ye(),...s})),...s||{},label:t}}function tm(e,t,s){return{field:e,newValue:()=>0,factory:(e,s,i)=>{const a=i;return a.float=t,a.extraCssClasses=["input-inline"].concat(i.extraCssClasses||[]),new Fn(e,s,a)},...s||{}}}function sm(e,t){return{field:e,newValue:()=>"",factory:(e,t,s)=>(s.extraCssClasses=["input-inline"].concat(s.extraCssClasses||[]),new qd(e,t,{id:ye(),...s})),...t||{}}}function im(e,t){return(s,i,a)=>new Yd(s,i,{...a,newValue:e,fields:t})}class am extends d{constructor(e,t,s){super(e,"apl-value-picker-root",t,s);const i=null!==this.rootElem.closest(".apl-prepull-action-picker"),a=Object.keys(rm).filter((e=>rm[e].includeIf?.(t,i)??!0));this.kindPicker=new Qt(this.rootElem,t,{id:ye(),defaultLabel:"No Condition",values:[{value:void 0,label:"<None>"}].concat(a.map((e=>{const t=rm[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}}))),equals:(e,t)=>e===t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.value.oneofKind,setValue:(e,t,s)=>{const i=this.getSourceValue(),a=i?.value.oneofKind;if(a!==s){if(s){const t=rm[s];let n=this.makeAPLValue(s,t.newValue());i&&a&&this.valuePicker&&("not"===s?n.value.not.val=this.makeAPLValue(a,this.valuePicker.getInputValue()):"not"===i.value.oneofKind&&i.value.not.val?.value.oneofKind===s?n=i.value.not.val:"and"===s?"or"===i.value.oneofKind?n.value.and.vals=i.value.or.vals:n.value.and.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"or"===s?"and"===i.value.oneofKind?n.value.or.vals=i.value.and.vals:n.value.or.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"min"===s?"max"===i.value.oneofKind?n.value.min.vals=i.value.max.vals:n.value.min.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"max"===s?"min"===i.value.oneofKind?n.value.max.vals=i.value.min.vals:n.value.max.vals=[this.makeAPLValue(a,this.valuePicker.getInputValue())]:"and"===i.value.oneofKind&&i.value.and.vals?.[0]?.value.oneofKind===s?n=i.value.and.vals[0]:"or"===i.value.oneofKind&&i.value.or.vals?.[0]?.value.oneofKind===s?n=i.value.or.vals[0]:"min"===i.value.oneofKind&&i.value.min.vals?.[0]?.value.oneofKind===s?n=i.value.min.vals[0]:"max"===i.value.oneofKind&&i.value.max.vals?.[0]?.value.oneofKind===s?n=i.value.max.vals[0]:"cmp"===s&&(n.value.cmp.lhs=this.makeAPLValue(a,this.valuePicker.getInputValue()))),i?i.value=n.value:this.setSourceValue(e,n)}else this.setSourceValue(e,void 0);t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.valuePicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return e?ns.create({value:{oneofKind:e,...(()=>{const t={};return e&&this.valuePicker&&(t[e]=this.valuePicker.getInputValue()),t})()}}):void 0}setInputValue(e){const t=e?.value.oneofKind;this.updateValuePicker(t),t&&e&&this.valuePicker.setInputValue(e.value[t])}makeAPLValue(e,t){if(!e)return ns.create();const s={oneofKind:e};return s[e]=t,ns.create({value:s})}updateValuePicker(e){const t=this.currentKind;if(e===t)return;if(this.currentKind=e,this.valuePicker&&(this.valuePicker.rootElem.remove(),this.valuePicker=null),!e)return;this.kindPicker.setInputValue(e);const s=rm[e];this.valuePicker=s.factory(this.rootElem,this.modObject,{changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const t=this.getSourceValue();return t&&t.value[e]||s.newValue()},setValue:(t,s,i)=>{const a=this.getSourceValue();a&&(a.value[e]=i),s.rotationChangeEmitter.emit(t)}})}}function nm(e,t){return{field:e,newValue:ns.create,factory:(e,t,s)=>new am(e,t,s),...t||{}}}function om(e){return{field:e,newValue:()=>[],factory:(e,t,s)=>new jd(e,t,{...s,setValue:(e,t,i)=>{s.setValue(e,t,i.map((e=>e||ns.create())))},itemLabel:"Value",newItem:ns.create,copyItem:e=>e?ns.clone(e):e,newItemPicker:(e,s,i,a)=>new am(e,t,a),allowedActions:["copy","create","delete","move"],actions:{create:{useIcon:!0}}})}}function lm(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,newValue:e.newValue,includeIf:e.includeIf,factory:im(e.newValue,e.fields)}}const rm={const:lm({label:"Const",shortDescription:"A fixed value.",fullDescription:"\n\t\t<p>\n\t\t\tExamples:\n\t\t\t<ul>\n\t\t\t\t<li><b>Number:</b> '123', '0.5', '-10'</li>\n\t\t\t\t<li><b>Time:</b> '100ms', '5s', '3m'</li>\n\t\t\t\t<li><b>Percentage:</b> '30%'</li>\n\t\t\t</ul>\n\t\t</p>\n\t\t",newValue:Ue.create,fields:[sm("val")]}),cmp:lm({label:"Compare",submenu:["Logic"],shortDescription:"Compares two values.",newValue:We.create,fields:[nm("lhs"),(cm="op",{field:cm,newValue:()=>Yt.OpEq,factory:(e,t,s)=>new Qt(e,t,{id:ye(),...s,defaultLabel:"None",equals:(e,t)=>e===t,values:[{value:Yt.OpEq,label:"=="},{value:Yt.OpNe,label:"!="},{value:Yt.OpGe,label:">="},{value:Yt.OpGt,label:">"},{value:Yt.OpLe,label:"<="},{value:Yt.OpLt,label:"<"}]})}),nm("rhs")]}),math:lm({label:"Math",submenu:["Logic"],shortDescription:"Do basic math on two values.",newValue:Fe.create,fields:[nm("lhs"),function(e){return{field:e,newValue:()=>Xt.OpAdd,factory:(e,t,s)=>new Qt(e,t,{id:ye(),...s,defaultLabel:"None",equals:(e,t)=>e===t,values:[{value:Xt.OpAdd,label:"+"},{value:Xt.OpSub,label:"-"},{value:Xt.OpMul,label:"*"},{value:Xt.OpDiv,label:"/"}]})}}("op"),nm("rhs")]}),max:lm({label:"Max",submenu:["Logic"],shortDescription:"Returns the largest value among the subvalues.",newValue:Oe.create,fields:[om("vals")]}),min:lm({label:"Min",submenu:["Logic"],shortDescription:"Returns the smallest value among the subvalues.",newValue:He.create,fields:[om("vals")]}),and:lm({label:"All of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if all of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:qe.create,fields:[om("vals")]}),or:lm({label:"Any of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if any of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:Be.create,fields:[om("vals")]}),not:lm({label:"Not",submenu:["Logic"],shortDescription:"Returns the opposite of the inner value, i.e. <b>True</b> if the value is <b>False</b> and vice-versa.",newValue:ze.create,fields:[nm("val")]}),currentTime:lm({label:"Current Time",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration.",newValue:je.create,fields:[]}),currentTimePercent:lm({label:"Current Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration, as a percentage.",newValue:$e.create,fields:[]}),remainingTime:lm({label:"Remaining Time",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration.",newValue:Ge.create,fields:[]}),remainingTimePercent:lm({label:"Remaining Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration, as a percentage.",newValue:Ke.create,fields:[]}),isExecutePhase:lm({label:"Is Execute Phase",submenu:["Encounter"],shortDescription:"<b>True</b> if the encounter is in Execute Phase, meaning the target's health is less than the given threshold, otherwise <b>False</b>.",newValue:Je.create,fields:[function(e){return{field:e,newValue:()=>ss.E20,factory:(e,t,s)=>new Qt(e,t,{id:ye(),...s,defaultLabel:"None",equals:(e,t)=>e===t,values:[{value:ss.E20,label:"20%"},{value:ss.E25,label:"25%"},{value:ss.E35,label:"35%"}]})}}("threshold")]}),numberTargets:lm({label:"Number of Targets",submenu:["Encounter"],shortDescription:"Count of targets in the current encounter",newValue:Ze.create,fields:[]}),frontOfTarget:lm({label:"Front of Target",submenu:["Encounter"],shortDescription:"<b>True</b> if facing from of target",newValue:Ye.create,fields:[]}),targetMobType:lm({label:"Target Mob Type",submenu:["Encounter"],shortDescription:"<b>True</b> if the selected target is of the specified mob type, otherwise <b>False</b>.",newValue:Qe.create,fields:[Xd("target","targets"),function(e){return{field:e,newValue:()=>is.MobTypeUnknown,factory:(e,t,s)=>new Qt(e,t,{id:ye(),...s,defaultLabel:"Unknown",equals:(e,t)=>e===t,values:[{label:"Unknown",value:is.MobTypeUnknown},{label:"Beast",value:is.MobTypeBeast},{label:"Demon",value:is.MobTypeDemon},{label:"Dragonkin",value:is.MobTypeDragonkin},{label:"Elemental",value:is.MobTypeElemental},{label:"Giant",value:is.MobTypeGiant},{label:"Humanoid",value:is.MobTypeHumanoid},{label:"Mechanical",value:is.MobTypeMechanical},{label:"Undead",value:is.MobTypeUndead}]})}}("mobType")]}),currentHealth:lm({label:"Health",submenu:["Resources"],shortDescription:"Amount of currently available Health.",newValue:Xe.create,fields:[Xd("sourceUnit","aura_sources")]}),currentHealthPercent:lm({label:"Health (%)",submenu:["Resources"],shortDescription:"Amount of currently available Health, as a percentage.",newValue:et.create,fields:[Xd("sourceUnit","aura_sources")]}),currentMana:lm({label:"Mana",submenu:["Resources"],shortDescription:"Amount of currently available Mana.",newValue:tt.create,fields:[],includeIf:(e,t)=>e.getClass()!==F.ClassRogue&&e.getClass()!==F.ClassWarrior}),currentManaPercent:lm({label:"Mana (%)",submenu:["Resources"],shortDescription:"Amount of currently available Mana, as a percentage.",newValue:st.create,fields:[],includeIf:(e,t)=>e.getClass()!==F.ClassRogue&&e.getClass()!==F.ClassWarrior}),currentRage:lm({label:"Rage",submenu:["Resources"],shortDescription:"Amount of currently available Rage.",newValue:it.create,fields:[],includeIf:(e,t)=>e.getClass()===F.ClassWarrior||e.getClass()===F.ClassDruid}),currentEnergy:lm({label:"Current Energy",submenu:["Resources","Energy"],shortDescription:"Amount of currently available Energy.",newValue:at.create,fields:[],includeIf:(e,t)=>e.getClass()===F.ClassRogue||e.getClass()===F.ClassDruid}),maxEnergy:lm({label:"Max Energy",submenu:["Resources","Energy"],shortDescription:"Amount of maximum available Energy.",newValue:nt.create,includeIf:(e,t)=>e.getClass()===F.ClassRogue||e.getClass()===F.ClassDruid,fields:[]}),timeToEnergyTick:lm({label:"Time to Next Energy Tick",submenu:["Resources"],shortDescription:"Time until the next energy regen tick will happen",newValue:ot.create,fields:[],includeIf:(e,t)=>e.getClass()===F.ClassRogue||e.getClass()===F.ClassDruid}),energyThreshold:lm({label:"Energy Threshold",submenu:["Resources"],shortDescription:"Compares current energy to a threshold value.",newValue:lt.create,fields:[tm("threshold",!1,{label:">=",labelTooltip:"Energy threshold. Subtracted from maximum energy if negative."})],includeIf:(e,t)=>e.getClass()===F.ClassRogue||e.getClass()===F.ClassDruid}),currentComboPoints:lm({label:"Combo Points",submenu:["Resources"],shortDescription:"Amount of currently available Combo Points.",newValue:rt.create,fields:[],includeIf:(e,t)=>e.getClass()===F.ClassRogue||e.getClass()===F.ClassDruid}),gcdIsReady:lm({label:"GCD Is Ready",submenu:["GCD"],shortDescription:"<b>True</b> if the GCD is not on cooldown, otherwise <b>False</b>.",newValue:ct.create,fields:[]}),gcdTimeToReady:lm({label:"GCD Time To Ready",submenu:["GCD"],shortDescription:"Amount of time remaining before the GCD comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:dt.create,fields:[]}),autoTimeToNext:lm({label:"Time To Next Auto",submenu:["Auto"],shortDescription:"Amount of time remaining before the next Main-hand or Off-hand melee attack, or <b>0</b> if autoattacks are not engaged.",newValue:mt.create,fields:[function(e){return{field:e,newValue:()=>es.Any,factory:(e,t,s)=>new Qt(e,t,{id:ye(),...s,defaultLabel:"None",equals:(e,t)=>e===t,values:[{value:es.Any,label:"Any"},{value:es.Melee,label:"Melee"},{value:es.MainHand,label:"Main Hand"},{value:es.OffHand,label:"Off Hand"},{value:es.Ranged,label:"Ranged"}]})}}("autoType")]}),autoSwingTime:lm({label:"Auto Swing Time",submenu:["Auto"],shortDescription:"Total swing duration including all haste buffs.",newValue:ht.create,fields:[function(e){return{field:e,newValue:()=>ts.MainHand,factory:(e,t,s)=>new Qt(e,t,{id:ye(),...s,defaultLabel:"None",equals:(e,t)=>e===t,values:[{value:ts.MainHand,label:"Main Hand"},{value:ts.OffHand,label:"Off Hand"},{value:ts.Ranged,label:"Ranged"}]})}}("autoType")]}),spellIsKnown:lm({label:"Spell Known",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is currently known, otherwise <b>False</b>.",newValue:ut.create,fields:[Qd("spellId","castable_spells","")]}),spellCurrentCost:lm({label:"Current Cost",submenu:["Spell"],shortDescription:"Returns current resource cost of spell",newValue:pt.create,fields:[Qd("spellId","castable_spells","")]}),spellCanCast:lm({label:"Can Cast",submenu:["Spell"],shortDescription:"<b>True</b> if all requirements for casting the spell are currently met, otherwise <b>False</b>.",fullDescription:"\n\t\t\t<p>The <b>Cast Spell</b> action does not need to be conditioned on this, because it applies this check automatically.</p>\n\t\t",newValue:gt.create,fields:[Qd("spellId","castable_spells","")]}),spellIsReady:lm({label:"Is Ready",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is not on cooldown, otherwise <b>False</b>.",newValue:ft.create,fields:[Qd("spellId","castable_spells","")]}),spellTimeToReady:lm({label:"Time To Ready",submenu:["Spell"],shortDescription:"Amount of time remaining before the spell comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:It.create,fields:[Qd("spellId","castable_spells","")]}),spellCastTime:lm({label:"Cast Time",submenu:["Spell"],shortDescription:"Amount of time to cast the spell including any haste and spell cast time adjustments.",newValue:wt.create,fields:[Qd("spellId","castable_spells","")]}),spellTravelTime:lm({label:"Travel Time",submenu:["Spell"],shortDescription:"Amount of time for the spell to travel to the target.",newValue:vt.create,fields:[Qd("spellId","castable_spells","")]}),spellInFlight:lm({label:"In Flight",submenu:["Spell"],shortDescription:"<b>True</b> if the spell has a missile in flight, otherwise <b>False</b>.",newValue:bt.create,fields:[Qd("spellId","castable_spells","")]}),spellCpm:lm({label:"CPM",submenu:["Spell"],shortDescription:"Casts Per Minute for the spell so far in the current iteration.",newValue:bt.create,fields:[Qd("spellId","castable_spells","")]}),spellIsChanneling:lm({label:"Is Channeling",submenu:["Spell"],shortDescription:"<b>True</b> if this spell is currently being channeled, otherwise <b>False</b>.",newValue:St.create,fields:[Qd("spellId","channel_spells","")]}),spellChanneledTicks:lm({label:"Channeled Ticks",submenu:["Spell"],shortDescription:"The number of completed ticks in the current channel of this spell, or <b>0</b> if the spell is not being channeled.",newValue:xt.create,fields:[Qd("spellId","channel_spells","")]}),channelClipDelay:lm({label:"Channel Clip Delay",submenu:["Spell"],shortDescription:"The amount of time specified by the <b>Channel Clip Delay</b> setting.",newValue:yt.create,fields:[]}),auraIsKnown:lm({label:"Aura Known",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently known, otherwise <b>False</b>.",newValue:Et.create,fields:[Xd("sourceUnit","aura_sources"),Qd("auraId","auras","sourceUnit")]}),auraIsActive:lm({label:"Aura Active",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active, otherwise <b>False</b>.",newValue:Pt.create,fields:[Xd("sourceUnit","aura_sources"),Qd("auraId","auras","sourceUnit")]}),auraIsActiveWithReactionTime:lm({label:"Aura Active (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active AND it has been active for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.",newValue:kt.create,fields:[Xd("sourceUnit","aura_sources"),Qd("auraId","auras","sourceUnit")]}),auraRemainingTime:lm({label:"Aura Remaining Time",submenu:["Aura"],shortDescription:"Time remaining before this aura will expire, or 0 if the aura is not currently active.",newValue:Ct.create,fields:[Xd("sourceUnit","aura_sources"),Qd("auraId","auras","sourceUnit")]}),auraNumStacks:lm({label:"Aura Num Stacks",submenu:["Aura"],shortDescription:"Number of stacks of the aura.",newValue:Lt.create,fields:[Xd("sourceUnit","aura_sources"),Qd("auraId","stackable_auras","sourceUnit")]}),auraInternalCooldown:lm({label:"Aura Remaining ICD",submenu:["Aura"],shortDescription:"Time remaining before this aura's internal cooldown will be ready, or <b>0</b> if the ICD is ready now.",newValue:Tt.create,fields:[Xd("sourceUnit","aura_sources"),Qd("auraId","icd_auras","sourceUnit")]}),auraIcdIsReadyWithReactionTime:lm({label:"Aura ICD Is Ready (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura's ICD is currently ready OR it was put on CD recently, within the player's reaction time (configured in Settings), otherwise <b>False</b>.",newValue:Nt.create,fields:[Xd("sourceUnit","aura_sources"),Qd("auraId","icd_auras","sourceUnit")]}),auraShouldRefresh:lm({label:"Should Refresh Aura",submenu:["Aura"],shortDescription:"Whether this aura should be refreshed, e.g. for the purpose of maintaining a debuff.",fullDescription:"\n\t\t<p>This condition checks not only the specified aura but also any other auras on the same unit, including auras applied by other raid members, which apply the same debuff category.</p>\n\t\t<p>For example, 'Should Refresh Debuff(Sunder Armor)' will return <b>False</b> if the unit has an active Expose Armor aura.</p>\n\t\t",newValue:()=>At.create({maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Xd("sourceUnit","aura_sources_targets_first"),Qd("auraId","exclusive_effect_auras","sourceUnit","currentTarget"),nm("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before the aura expires when it may be refreshed."})]}),runeIsEquipped:lm({label:"Rune Equipped",submenu:["Rune"],shortDescription:"<b>True</b> if the rune is currently equipped, otherwise <b>False</b>.",newValue:Rt.create,fields:[function(e){return{field:e,newValue:()=>ke.create(),factory:(e,t,s,i)=>new Kd(e,t,{id:ye(),...s})}}("runeId")]}),dotIsActive:lm({label:"Dot Is Active",submenu:["DoT"],shortDescription:"<b>True</b> if the specified dot is currently ticking, otherwise <b>False</b>.",newValue:_t.create,fields:[Xd("targetUnit","targets"),Qd("spellId","dot_spells","")]}),dotRemainingTime:lm({label:"Dot Remaining Time",submenu:["DoT"],shortDescription:"Time remaining before the last tick of this DoT will occur, or 0 if the DoT is not currently ticking.",newValue:Dt.create,fields:[Xd("targetUnit","targets"),Qd("spellId","dot_spells","")]}),sequenceIsComplete:lm({label:"Sequence Is Complete",submenu:["Sequence"],shortDescription:"<b>True</b> if there are no more subactions left to execute in the sequence, otherwise <b>False</b>.",newValue:Mt.create,fields:[sm("sequenceName")]}),sequenceIsReady:lm({label:"Sequence Is Ready",submenu:["Sequence"],shortDescription:"<b>True</b> if the next subaction in the sequence is ready to be executed, otherwise <b>False</b>.",newValue:Vt.create,fields:[sm("sequenceName")]}),sequenceTimeToReady:lm({label:"Sequence Time To Ready",submenu:["Sequence"],shortDescription:"Returns the amount of time remaining until the next subaction in the sequence will be ready.",newValue:Ut.create,fields:[sm("sequenceName")]}),totemRemainingTime:lm({label:"Totem Remaining Time",submenu:["Shaman"],shortDescription:"Returns the amount of time remaining until the totem will expire.",newValue:Wt.create,includeIf:(e,t)=>e.getClass()===F.ClassShaman,fields:[function(e){return{field:e,newValue:()=>as.Water,factory:(e,t,s)=>new Qt(e,t,{id:ye(),...s,defaultLabel:"None",equals:(e,t)=>e===t,values:[{value:as.Earth,label:"Earth"},{value:as.Air,label:"Air"},{value:as.Fire,label:"Fire"},{value:as.Water,label:"Water"}]})}}("totemType")]}),catExcessEnergy:lm({label:"Excess Energy",submenu:["Feral Druid"],shortDescription:"Returns the amount of excess energy available, after subtracting energy that will be needed to maintain DoTs.",newValue:Ft.create,includeIf:(e,t)=>e.spec===u.SpecFeralDruid,fields:[]}),catNewSavageRoarDuration:lm({label:"New Savage Roar Duration",submenu:["Feral Druid"],shortDescription:"Returns duration of savage roar based on current combo points",newValue:Ot.create,includeIf:(e,t)=>e.spec===u.SpecFeralDruid,fields:[]}),catEnergyAfterDuration:lm({label:"Energy After Duration",submenu:["Feral Druid"],shortDescription:"Returns the <b>total uncapped</b> amount of energy after the given duration. This will include Staff of the Glade timing and the Scarlet 2 piece bonus.",newValue:Ht.create,includeIf:(e,t)=>e.spec===u.SpecFeralDruid,fields:[nm("condition")]}),warlockShouldRecastDrainSoul:lm({label:"Should Recast Drain Soul",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Drain Soul channel should be immediately recast, to get a better snapshot.",newValue:qt.create,includeIf:(e,t)=>e.getClass()===F.ClassWarlock,fields:[]}),warlockShouldRefreshCorruption:lm({label:"Should Refresh Corruption",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Corruption has expired, or should be refreshed to get a better snapshot.",newValue:Bt.create,includeIf:(e,t)=>e.getClass()===F.ClassWarlock,fields:[Xd("targetUnit","targets")]}),warlockPetIsActive:lm({label:"Pet is Active",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the Warlock has a pet active.",newValue:zt.create,includeIf:(e,t)=>e.getClass()===F.ClassWarlock,fields:[]}),warlockCurrentPetMana:lm({label:"Pet Mana",submenu:["Warlock"],shortDescription:"Amount of currently available pet mana.",newValue:jt.create,includeIf:(e,t)=>e.getClass()===F.ClassWarlock,fields:[]}),warlockCurrentPetManaPercent:lm({label:"Pet Mana (%)",submenu:["Warlock"],shortDescription:"Amount of currently available pet mana, as a percentage.",newValue:$t.create,includeIf:(e,t)=>e.getClass()===F.ClassWarlock,fields:[]}),currentSealRemainingTime:lm({label:"Current Seal Remaining Time",submenu:["Paladin"],shortDescription:"Returns the amount of time remaining until the Paladin's current Seal aura will expire.",newValue:Gt.create,includeIf:(e,t)=>e.getClass()===F.ClassPaladin,fields:[]}),hunterPetIsActive:lm({label:"Pet is Active",submenu:["Hunter"],shortDescription:"Returns <b>True</b> if the Hunter has a pet active.",newValue:Kt.create,includeIf:(e,t)=>e.getClass()===F.ClassHunter,fields:[]}),hunterCurrentPetFocus:lm({label:"Pet Focus",submenu:["Hunter"],shortDescription:"Amount of currently available pet focus.",newValue:Jt.create,includeIf:(e,t)=>e.getClass()===F.ClassHunter,fields:[]}),hunterCurrentPetFocusPercent:lm({label:"Pet Focus (%)",submenu:["Hunter"],shortDescription:"Amount of currently available pet focus, as a percentage.",newValue:Zt.create,includeIf:(e,t)=>e.getClass()===F.ClassHunter,fields:[]})};var cm;class dm extends d{constructor(e,t,s){super(e,"apl-action-picker-root",t,s),this.conditionPicker=new am(this.rootElem,this.modObject,{label:"If:",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.condition,setValue:(e,t,s)=>{const i=this.getSourceValue();i?(i.condition=s,t.rotationChangeEmitter.emit(e)):this.setSourceValue(e,Ls.create({condition:s}))}}),this.conditionPicker.rootElem.classList.add("apl-action-condition","apl-priority-list-only"),this.actionDiv=document.createElement("div"),this.actionDiv.classList.add("apl-action-picker-action"),this.rootElem.appendChild(this.actionDiv);const i=null!=this.rootElem.closest(".apl-prepull-action-picker"),a=Object.keys(um).filter((e=>um[e].includeIf?.(t,i)??!0));this.kindPicker=new Qt(this.actionDiv,t,{id:ye(),defaultLabel:"Action",values:a.map((e=>{const t=um[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}})),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.action.oneofKind,setValue:(e,t,s)=>{const i=this.getSourceValue(),a=i?.action.oneofKind;if(a!=s){if(s){const t=um[s];let n=this.makeAPLAction(s,t.newValue());i&&a&&this.actionPicker&&("sequence"==s?"strictSequence"==i.action.oneofKind?n.action.sequence.actions=i.action.strictSequence.actions:n.action.sequence.actions=[this.makeAPLAction(a,this.actionPicker.getInputValue())]:"strictSequence"==s?"sequence"==i.action.oneofKind?n.action.strictSequence.actions=i.action.sequence.actions:n.action.strictSequence.actions=[this.makeAPLAction(a,this.actionPicker.getInputValue())]:"sequence"==i.action.oneofKind&&i.action.sequence.actions?.[0]?.action.oneofKind==s?n=i.action.sequence.actions[0]:"strictSequence"==i.action.oneofKind&&i.action.strictSequence.actions?.[0]?.action.oneofKind==s&&(n=i.action.strictSequence.actions[0])),i?i.action=n.action:this.setSourceValue(e,n)}else i.action={oneofKind:s};t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.actionPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return Ls.create({condition:this.conditionPicker.getInputValue(),action:{oneofKind:e,...(()=>{const t={};return e&&this.actionPicker&&(t[e]=this.actionPicker.getInputValue()),t})()}})}setInputValue(e){if(!e)return;this.conditionPicker.setInputValue(e.condition||ns.create());const t=e.action.oneofKind;this.updateActionPicker(t),t&&this.actionPicker.setInputValue(e.action[t])}makeAPLAction(e,t){if(!e)return Ls.create();const s={oneofKind:e};return s[e]=t,Ls.create({action:s})}updateActionPicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.actionPicker&&(this.actionPicker.rootElem.remove(),this.actionPicker=null),!e)return;this.kindPicker.setInputValue(e);const s=um[e];this.actionPicker=s.factory(this.actionDiv,this.modObject,{changedEvent:e=>e.rotationChangeEmitter,getValue:()=>this.getSourceValue()?.action?.[e]||s.newValue(),setValue:(t,s,i)=>{const a=this.getSourceValue();a&&((a?.action)[e]=i),s.rotationChangeEmitter.emit(t)}}),this.actionPicker.rootElem.classList.add("apl-action-"+e)}}function mm(e){return{field:e,newValue:()=>[],factory:(e,t,s)=>new jd(e,t,{...s,setValue:(e,t,i)=>{s.setValue(e,t,i.map((e=>e||Ls.create())))},itemLabel:"Action",newItem:Ls.create,copyItem:e=>e?Ls.clone(e):e,newItemPicker:(e,s,i,a)=>new dm(e,t,a),allowedActions:["create","delete","move"],actions:{create:{useIcon:!0}}})}}function hm(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,includeIf:e.includeIf,newValue:e.newValue,factory:im(e.newValue,e.fields)}}const um={castSpell:hm({label:"Cast",shortDescription:"Casts the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",newValue:os.create,fields:[Qd("spellId","castable_spells",""),Xd("target","targets")]}),multidot:hm({label:"Multi Dot",submenu:["Casting"],shortDescription:"Keeps a DoT active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t,newValue:()=>ls.create({maxDots:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Qd("spellId","dot_spells",""),tm("maxDots",!1,{label:"Max Dots",labelTooltip:"Maximum number of DoTs to simultaneously apply."}),nm("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a DoT expires when it may be refreshed."})]}),multishield:hm({label:"Multi Shield",submenu:["Casting"],shortDescription:"Keeps a Shield active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t&&rs(e.spec),newValue:()=>cs.create({maxShields:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Qd("spellId","shield_spells",""),tm("maxShields",!1,{label:"Max Shields",labelTooltip:"Maximum number of Shields to simultaneously apply."}),nm("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a Shield expires when it may be refreshed."})]}),channelSpell:hm({label:"Channel",submenu:["Casting"],shortDescription:"Channels the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",fullDescription:"\n\t\t\t<p>The difference between channeling a spell vs casting the spell is that channels can be interrupted. If the <b>Interrupt If</b> parameter is empty, this action is equivalent to <b>Cast</b>.</p>\n\t\t\t<p>The channel will be interrupted only if Instant Interrupt is true OR all of the following are true:</p>\n\t\t\t<ul>\n\t\t\t\t<li>Immediately following a tick of the channel</li>\n\t\t\t\t<li>The <b>Interrupt If</b> condition evaluates to <b>True</b></li>\n\t\t\t\t<li>Another action in the APL list is available</li>\n\t\t\t</ul>\n\t\t\t<p>Note that if you simply want to allow other actions to interrupt the channel, set <b>Interrupt If</b> to <b>True</b>.</p>\n\t\t",newValue:()=>ds.create({interruptIf:{value:{oneofKind:"gcdIsReady",gcdIsReady:{}}}}),fields:[Qd("spellId","channel_spells",""),Xd("target","targets"),nm("interruptIf",{label:"Interrupt If",labelTooltip:"Condition which must be true to allow the channel to be interrupted."}),em("instantInterrupt","Instant Interrupt",{labelTooltip:"If checked, interrupts of this channel will happen instantly after the cast."}),em("allowRecast","Recast",{labelTooltip:"If checked, interrupts of this channel will recast the spell."})]}),autocastOtherCooldowns:hm({label:"Autocast Other Cooldowns",submenu:["Casting"],shortDescription:"Auto-casts cooldowns as soon as they are ready.",fullDescription:"\n\t\t\t<ul>\n\t\t\t\t<li>Does not auto-cast cooldowns which are already controlled by other actions in the priority list.</li>\n\t\t\t\t<li>Cooldowns are usually cast immediately upon becoming ready, but there are some basic smart checks in place, e.g. don't use Mana CDs when near full mana.</li>\n\t\t\t</ul>\n\t\t",includeIf:(e,t)=>!t,newValue:ms.create,fields:[]}),wait:hm({label:"Wait",submenu:["Timing"],shortDescription:"Pauses all APL actions for a specified amount of time.",includeIf:(e,t)=>!t,newValue:()=>hs.create({duration:{value:{oneofKind:"const",const:{val:"1000ms"}}}}),fields:[nm("duration")]}),waitUntil:hm({label:"Wait Until",submenu:["Timing"],shortDescription:"Pauses all APL actions until the specified condition is <b>True</b>.",includeIf:(e,t)=>!t,newValue:()=>us.create(),fields:[nm("condition")]}),schedule:hm({label:"Scheduled Action",submenu:["Timing"],shortDescription:"Executes the inner action once at each specified timing.",includeIf:(e,t)=>!t,newValue:()=>ps.create({schedule:"0s, 60s",innerAction:{action:{oneofKind:"castSpell",castSpell:{}}}}),fields:[sm("schedule",{label:"Do At",labelTooltip:"Comma-separated list of timings. The inner action will be performed once at each timing."}),function(e){return{field:e,newValue:ns.create,factory:(e,t,s)=>new dm(e,t,s)}}("innerAction")]}),sequence:hm({label:"Sequence",submenu:["Sequences"],shortDescription:"A list of sub-actions to execute in the specified order.",fullDescription:"\n\t\t\t<p>Once one of the sub-actions has been performed, the next sub-action will not necessarily be immediately executed next. The system will restart at the beginning of the whole actions list (not the sequence). If the sequence is executed again, it will perform the next sub-action.</p>\n\t\t\t<p>When all actions have been performed, the sequence does NOT automatically reset; instead, it will be skipped from now on. Use the <b>Reset Sequence</b> action to reset it, if desired.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:gs.create,fields:[sm("name"),mm("actions")]}),resetSequence:hm({label:"Reset Sequence",submenu:["Sequences"],shortDescription:"Restarts a sequence, so that the next time it executes it will perform its first sub-action.",fullDescription:"\n\t\t\t<p>Use the <b>name</b> field to refer to the sequence to be reset. The desired sequence must have the same (non-empty) value for its <b>name</b>.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:fs.create,fields:[sm("sequenceName")]}),strictSequence:hm({label:"Strict Sequence",submenu:["Sequences"],shortDescription:"Like a regular <b>Sequence</b>, except all sub-actions are executed immediately after each other and the sequence resets automatically upon completion.",fullDescription:"\n\t\t\t<p>Strict Sequences do not begin unless ALL sub-actions are ready.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:Is.create,fields:[mm("actions")]}),changeTarget:hm({label:"Change Target",submenu:["Misc"],shortDescription:"Sets the current target, which is the target of auto attacks and most casts by default.",newValue:()=>ws.create(),fields:[Xd("newTarget","targets")]}),activateAura:hm({label:"Activate Aura",submenu:["Misc"],shortDescription:"Activates an aura",includeIf:(e,t)=>t,newValue:()=>vs.create(),fields:[Qd("auraId","auras")]}),activateAuraWithStacks:hm({label:"Activate Aura With Stacks",submenu:["Misc"],shortDescription:"Activates an aura with the specified number of stacks",includeIf:(e,t)=>t,newValue:()=>bs.create({numStacks:"1"}),fields:[Qd("auraId","stackable_auras"),sm("numStacks",{label:"stacks",labelTooltip:"Desired number of initial aura stacks."})]}),addComboPoints:hm({label:"Add Combo Points",submenu:["Misc"],shortDescription:"Add combo points to target.",includeIf:(e,t)=>t,newValue:()=>Ss.create({numPoints:"1"}),fields:[sm("numPoints",{labelTooltip:"Desired number of initial combo points."})]}),cancelAura:hm({label:"Cancel Aura",submenu:["Misc"],shortDescription:"Deactivates an aura, equivalent to /cancelaura.",newValue:()=>xs.create(),fields:[Qd("auraId","auras")]}),triggerIcd:hm({label:"Trigger ICD",submenu:["Misc"],shortDescription:"Triggers an aura's ICD, putting it on cooldown. Example usage would be to desync an ICD cooldown before combat starts.",includeIf:(e,t)=>t,newValue:()=>ys.create(),fields:[Qd("auraId","icd_auras")]}),itemSwap:hm({label:"Item Swap",submenu:["Misc"],shortDescription:"Swaps items, using the swap set specified in Settings.",includeIf:(e,t)=>LI.includes(e.spec),newValue:()=>Ts.create(),fields:[function(e){return{field:e,newValue:()=>Rs.Swap1,factory:(e,t,s)=>new Qt(e,t,{id:ye(),...s,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Rs.Main,label:"Main"},{value:Rs.Swap1,label:"Swapped"}]})}}("swapSet")]}),move:hm({label:"Move",submenu:["Misc"],shortDescription:"Starts a move to the desired range from target.",newValue:()=>Es.create(),fields:[nm("rangeFromTarget",{label:"to Range",labelTooltip:"Desired range from target."})]}),customRotation:hm({label:"Custom Rotation",shortDescription:"INTERNAL ONLY",includeIf:(e,t)=>!1,newValue:()=>Ns.create(),fields:[]}),catOptimalRotationAction:hm({label:"Optimal Rotation Action",submenu:["Feral Druid"],shortDescription:"Executes optimized Feral DPS rotation using hardcoded legacy algorithm.",includeIf:(e,t)=>e.spec==u.SpecFeralDruid,newValue:()=>Ps.create({minCombosForRip:3,maxWaitTime:2,maintainFaerieFire:!1,useShredTrick:!1}),fields:[tm("minCombosForRip",!1,{label:"Min Rip CP",labelTooltip:"Combo Point threshold for allowing a Rip cast"}),tm("maxWaitTime",!0,{label:"Max Wait Time",labelTooltip:"Max seconds to wait for an Energy tick to cast rather than powershifting"}),em("maintainFaerieFire","Maintain Faerie Fire",{labelTooltip:"If checked, bundle Faerie Fire refreshes with powershifts. Ignored if an external Faerie Fire debuff is selected in settings."}),em("useShredTrick","Use Shred Trick",{labelTooltip:'If checked, enable the "Shred trick" micro-optimization. This should only be used on short fight lengths with full powershifting uptime.'})]}),castPaladinPrimarySeal:hm({label:"Cast Primary Seal",submenu:["Paladin"],shortDescription:"Casts the Paladin's designated primary seal spell.",includeIf:(e,t)=>e.spec==u.SpecRetributionPaladin||e.spec==u.SpecProtectionPaladin,newValue:()=>As.create({}),fields:[]}),paladinCastWithMacro:hm({label:"Cast",submenu:["Paladin"],shortDescription:"Casts the specified spell, followed by the selected macro.",includeIf:(e,t)=>e.spec==u.SpecRetributionPaladin,newValue:()=>ks.create(),fields:[Qd("spellId","castable_spells",""),Xd("target","targets"),function(e){return{field:e,newValue:()=>Cs.StopAttack,factory:(e,t,s)=>new Qt(e,t,{id:ye(),...s,label:"followed by",inline:!0,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Cs.StartAttack,label:"/startattack"},{value:Cs.StopAttack,label:"/stopattack"}]})}}("macro")]})};class pm extends o{constructor(e,t,s){super(e,"apl-rotation-picker-root"),new jd(this.rootElem,s,{extraCssClasses:["apl-prepull-action-picker"],title:"Prepull Actions",titleTooltip:"Actions to perform before the pull.",itemLabel:"Prepull Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.prepullActions,setValue:(e,t,s)=>{t.aplRotation.prepullActions=s,t.rotationChangeEmitter.emit(e)},newItem:()=>_s.create({action:{},doAtValue:{value:{oneofKind:"const",const:{val:"-1s"}}}}),copyItem:e=>_s.clone(e),newItemPicker:(e,t,i,a)=>new gm(e,s,a,i),inlineMenuBar:!0}),new jd(this.rootElem,s,{extraCssClasses:["apl-list-item-picker"],title:"Priority List",titleTooltip:"At each decision point, the simulation will perform the first valid action from this list.",itemLabel:"Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.priorityList,setValue:(e,t,s)=>{t.aplRotation.priorityList=s,t.rotationChangeEmitter.emit(e)},newItem:()=>Ds.create({action:{}}),copyItem:e=>Ds.clone(e),newItemPicker:(e,t,i,a)=>new fm(e,s,a,i),inlineMenuBar:!0})}}class gm extends d{getItem(){return this.getSourceValue()||_s.create({action:{}})}constructor(e,t,s,i){s.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,s),this.player=t;const a=jd.getItemHeaderElem(this);Im(a,t,(e=>e.getCurrentStats().rotationStats?.prepullActions[i]?.warnings||[])),this.hidePicker=new wm(a,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,s)=>{this.getItem().hide=s,this.player.rotationChangeEmitter.emit(e)}}),this.doAtPicker=new qd(this.rootElem,this.player,{id:ye(),label:"Do At",labelTooltip:"Time before pull to do the action. Should be negative, and formatted like, '-1s' or '-2500ms'.",extraCssClasses:["apl-prepull-actions-doat"],changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().doAtValue?.value?.const.val||"",setValue:(e,t,s)=>{this.getItem().doAtValue=s?ns.create({value:{oneofKind:"const",const:{val:s}}}):void 0,this.player.rotationChangeEmitter.emit(e)},inline:!0}),this.actionPicker=new dm(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,s)=>{this.getItem().action=s,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return _s.create({hide:this.hidePicker.getInputValue(),doAtValue:{value:{oneofKind:"const",const:{val:this.doAtPicker.getInputValue()}}},action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.doAtPicker.setInputValue(e.doAtValue?.value?.const.val||""),this.actionPicker.setInputValue(e.action||Ls.create()))}}class fm extends d{getItem(){return this.getSourceValue()||Ds.create({action:{}})}constructor(e,t,s,i){s.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,s),this.player=t;const a=jd.getItemHeaderElem(this);Im(a,t,(e=>e.getCurrentStats().rotationStats?.priorityList[i]?.warnings||[])),this.hidePicker=new wm(a,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,s)=>{this.getItem().hide=s,this.player.rotationChangeEmitter.emit(e)}}),this.actionPicker=new dm(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,s)=>{this.getItem().action=s,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return Ds.create({hide:this.hidePicker.getInputValue(),action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.actionPicker.setInputValue(e.action||Ls.create()))}}function Im(e,t,s){const i=jd.makeActionElem("apl-warnings","fa-exclamation-triangle");i.classList.add("warning","link-warning"),i.setAttribute("data-bs-html","true");const a=Ln(i,{theme:"dropdown-tooltip",content:"Warnings"});e.appendChild(i);const n=async()=>{if(!Ms(i))return a?.destroy(),i?.remove(),void t.currentStatsEmitter.off(n);a.setContent("");const e=s(t);if(e.length){i.style.visibility="visible";const t=await Promise.all(e.map((e=>C.replaceAllInString(e))));a.setContent(`\n\t\t\t\t<p>This action has warnings, and might not behave as expected.</p>\n\t\t\t\t<ul>\n\t\t\t\t\t${t.map((e=>`<li>${e}</li>`)).join("")}\n\t\t\t\t</ul>\n\t\t\t`)}else i.style.visibility="hidden"};n(),t.currentStatsEmitter.on(n)}class wm extends d{constructor(e,t,s){super(e,"hide-picker-root",t,s),this.inputElem=jd.makeActionElem("hide-picker-button","fa-eye"),this.iconElem=this.inputElem.childNodes[0],this.rootElem.appendChild(this.inputElem),this.tooltip=Ln(this.inputElem,{content:"Enable/Disable"}),this.init(),this.inputElem.addEventListener("click",(()=>{this.setInputValue(!this.getInputValue()),this.inputChanged(m.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){return this.iconElem.classList.contains("fa-eye-slash")}setInputValue(e){e?(this.iconElem.classList.add("fa-eye-slash"),this.iconElem.classList.remove("fa-eye"),this.tooltip.setContent("Enable Action")):(this.iconElem.classList.add("fa-eye"),this.iconElem.classList.remove("fa-eye-slash"),this.tooltip.setContent("Disable Action"))}}class vm extends d{constructor(e,t,s){super(e,"number-list-picker-root",t,s),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.placeholder=s.placeholder||"",this.inputElem.classList.add("number-list-picker-input","form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(e=>{this.inputChanged(m.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){const e=this.inputElem.value;return e?e.split(",").map(parseFloat).filter((e=>!isNaN(e))):[]}setInputValue(e){he(this.getInputValue(),e)||(this.inputElem.value=e.map((e=>String(e))).join(","))}}class bm extends o{constructor(e,t){super(e,"cooldowns-picker-root"),this.player=t,this.cooldownPickers=[],m.onAny([this.player.rotationChangeEmitter,this.player.sim.unitMetadataEmitter]).on((e=>{this.update()})),this.update()}update(){this.rootElem.innerHTML="";const e=this.player.getSimpleCooldowns().cooldowns;this.cooldownPickers=[];for(let t=0;t<e.length+1;t++){const s=e[t],i=document.createElement("div");i.classList.add("cooldown-picker"),t==e.length&&i.classList.add("add-cooldown-picker"),this.rootElem.appendChild(i),this.makeActionPicker(i,t);const a=document.createElement("label");a.classList.add("cooldown-picker-label","form-label"),s&&s.id&&C.fromProto(s.id).fill(this.player.getRaidIndex()).then((e=>a.textContent=e.name)),i.appendChild(a),this.makeTimingsPicker(i,t);const n=document.createElement("fragment");n.innerHTML='\n\t\t\t\t<a\n\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\tclass="delete-cooldown link-danger"\n\t\t\t\t\trole="button"\n\t\t\t\t>\n\t\t\t\t\t<i class="fa fa-times fa-xl"></i>\n\t\t\t\t</a>\n\t\t\t';const o=n.children[0],l=Ln(o,{content:"Delete Cooldown"});o.addEventListener("click",(e=>{const s=this.player.getSimpleCooldowns();s.cooldowns.splice(t,1),this.player.setSimpleCooldowns(m.nextEventID(),s),l.hide()})),i.appendChild(o),this.cooldownPickers.push(i)}}makeActionPicker(e,t){const s=this.player.getMetadata().getSpells().filter((e=>e.data.isMajorCooldown)).map((e=>e.id));return new cd(e,this.player,{extraCssClasses:["cooldown-action-picker"],numColumns:3,values:[{color:"#grey",value:ke.create()}].concat(s.map((e=>({actionId:()=>e,value:e.toProto()})))),equals:(e,t)=>ke.equals(e,t),zeroValue:ke.create(),backupIconUrl:e=>C.fromProto(e),changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.id||ke.create(),setValue:(e,s,i)=>{const a=s.getSimpleCooldowns();for(;a.cooldowns.length<t;)a.cooldowns.push(Vs.create());a.cooldowns[t]=Vs.create({id:i,timings:[]}),s.setSimpleCooldowns(e,a)}})}makeTimingsPicker(e,t){return new vm(e,this.player,{extraCssClasses:["cooldown-timings-picker"],placeholder:"20, 40, ...",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.timings||[],setValue:(e,s,i)=>{const a=s.getSimpleCooldowns();a.cooldowns[t].timings=i,s.setSimpleCooldowns(e,a)},enableWhen:e=>{const s=e.getSimpleCooldowns().cooldowns[t];return s&&!ke.equals(s.id,ke.create())}})}}class Sm extends jn{constructor(e,t){super(e,t,{identifier:"rotation-tab",title:"Rotation"}),this.leftCol=this.buildColumn(1,"rotation-tab-col"),this.simUI=t,this.leftPanel=l("div",{className:"rotation-tab-left tab-panel-left"}),this.rightPanel=l("div",{className:"rotation-tab-right tab-panel-right"}),this.leftPanel.appendChild(this.leftCol),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent(),this.updateSections(),this.simUI.player.rotationChangeEmitter.on((()=>this.updateSections()))}buildTabContent(){this.buildHeader(),this.buildAutoContent(),this.buildAplContent(),this.buildSimpleContent(),this.buildPresetConfigurationPicker(),this.buildSavedDataPickers()}updateSections(){this.rootElem.classList.remove("rotation-type-auto","rotation-type-simple","rotation-type-apl","rotation-type-legacy");let e="";switch(this.simUI.player.getRotationType()){case ue.TypeAuto:e="rotation-type-auto";break;case ue.TypeSimple:e="rotation-type-simple";break;case ue.TypeAPL:e="rotation-type-apl"}this.rootElem.classList.add(e)}buildHeader(){const e=r(),t=r(),s=r();this.leftCol.appendChild(l("div",{ref:e,className:"rotation-tab-header d-flex justify-content-between align-items-baseline"},l("div",{ref:s}),l("button",{ref:t,className:"btn btn-sm btn-link btn-reset summary-table-reset-button"},l("i",{className:"fas fa-times me-1"}),"Reset APL"))),t.value.addEventListener("click",(()=>{this.simUI.applyEmptyAplRotation(m.nextEventID())})),this.simUI.player.rotationChangeEmitter.on((()=>{const e=this.simUI.player.getRotationType();t.value?.classList[e===ue.TypeAPL?"remove":"add"]("hide")})),new od(s.value,this.simUI.player,{extraCssClasses:["w-auto"],id:"rotation-tab-rotation-type",label:"Rotation Type",labelTooltip:"Which set of options to use for specifying the rotation.",inline:!0,values:this.simUI.player.hasSimpleRotationGenerator()?[{value:ue.TypeAuto,name:"Auto"},{value:ue.TypeSimple,name:"Simple"},{value:ue.TypeAPL,name:"APL"}]:[{value:ue.TypeAuto,name:"Auto"},{value:ue.TypeAPL,name:"APL"}],changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getRotationType(),setValue:(e,t,s)=>{t.aplRotation.type=s,t.rotationChangeEmitter.emit(e)}})}buildAutoContent(){this.leftCol.appendChild(l("div",{className:"rotation-tab-auto"}))}buildAplContent(){const e=r();this.leftCol.appendChild(l("div",{ref:e,className:"rotation-tab-apl"})),new pm(e.value,this.simUI,this.simUI.player)}buildSimpleContent(){if(!this.simUI.player.hasSimpleRotationGenerator()||!this.simUI.individualConfig.rotationInputs)return;const e="rotation-tab-simple",t=new qn(this.leftCol,"rotation-settings",{header:{title:"Rotation"}});t.rootElem.classList.add(e);const s=d.newGroupContainer();s.classList.add("rotation-icon-group","icon-group"),t.bodyElement.appendChild(s),this.simUI.individualConfig.rotationIconInputs?.length&&this.configureIconSection(s,this.simUI.individualConfig.rotationIconInputs.map((e=>Ld(s,this.simUI.player,e))),!0),this.configureInputSection(t.bodyElement,this.simUI.individualConfig.rotationInputs);const i=new qn(this.leftCol,"cooldown-settings",{header:{title:"Cooldowns",tooltip:Us}});i.rootElem.classList.add(e),new bm(i.bodyElement,this.simUI.player)}configureInputSection(e,t){t.inputs.forEach((t=>{t.extraCssClasses=[...t.extraCssClasses||[],"input-inline"],"number"==t.type?new Fn(e,this.simUI.player,{...t,inline:!0}):"boolean"==t.type?new re(e,this.simUI.player,{...t,inline:!0}):"enum"==t.type&&new od(e,this.simUI.player,{...t,inline:!0})}))}configureIconSection(e,t,s){t.length?s&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`)):e.classList.add("hide")}buildPresetConfigurationPicker(){new ad(this.rightPanel,this.simUI,[id.Rotation])}buildSavedDataPickers(){const e=new sd(this.rightPanel,this.simUI.player,{label:"Rotation",header:{title:"Saved Rotations"},storageKey:this.simUI.getSavedRotationStorageKey(),getData:e=>Ws.create({rotation:pe.clone(e.aplRotation)}),setData:(e,t,s)=>{m.freezeAllAndDo((()=>{t.setAplRotation(e,s.rotation||pe.create())}))},changeEmitters:[this.simUI.player.rotationChangeEmitter,this.simUI.player.talentsChangeEmitter],equals:(e,t)=>Ws.equals(e,t),toJson:e=>Ws.toJson(e),fromJson:e=>Ws.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),(this.simUI.individualConfig.presets.rotations||[]).forEach((t=>{const s=t.rotation;s.rotation||(s.rotation=pe.create()),e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:s,enableWhen:t.enableWhen,onLoad:t.onLoad})}))}))}}class xm extends o{constructor(e,t,s,i){super(e,"encounter-picker-root"),km(this.rootElem,t,s.showExecuteProportion),t.sim.waitForInit().then((()=>{const e=t.sim.db.getAllPresetTargets();new od(this.rootElem,t,{id:"encounter-npc",extraCssClasses:["damage-metrics","npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(e.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:t=>e.findIndex((e=>Lm(t.primaryTarget,e.target))),setValue:(t,s,i)=>{-1!=i&&s.applyPresetTarget(t,e[i],0)}}),i.isIndividualSim()&&rs(i.player.spec)&&new Fn(this.rootElem,i.sim.raid,{id:"encounter-num-allies",label:"Num Allies",labelTooltip:"Number of allied players in the raid.",changedEvent:e=>e.targetDummiesChangeEmitter,getValue:e=>e.getTargetDummies(),setValue:(e,t,s)=>{t.setTargetDummies(e,s)}}),i.isIndividualSim()&&Fs(i.player.spec)&&new Fn(this.rootElem,t,{id:"encounter-min-base-damage",label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:e=>e.changeEmitter,getValue:e=>e.primaryTarget.minBaseDamage,setValue:(e,t,s)=>{t.primaryTarget.minBaseDamage=s,t.targetsChangeEmitter.emit(e)}});const s=e.findIndex((e=>t.primaryTarget.id==e.target?.id)),a=e[s]?.target?.targetInputs||[];(a.length!=t.primaryTarget.targetInputs.length||t.primaryTarget.targetInputs.some(((e,t)=>e.label!=a[t].label)))&&(t.primaryTarget.targetInputs=a,t.targetsChangeEmitter.emit(m.nextEventID())),Cm(this.rootElem,t,0);const n=new ym(i.rootElem,i,t),o=document.createElement("button");o.classList.add("advanced-button","btn","btn-primary"),o.textContent="Advanced",o.addEventListener("click",(()=>n.open())),this.rootElem.appendChild(o)}))}}class ym extends Vn{constructor(e,t,s){super(e,"advanced-encounter-picker-modal"),this.encounter=s,this.addHeader(),this.body.innerHTML='\n\t\t\t<div class="encounter-header"></div>\n\t\t\t<div class="encounter-targets"></div>\n\t\t';const i=this.rootElem.getElementsByClassName("encounter-header")[0],a=this.rootElem.getElementsByClassName("encounter-targets")[0];km(i,this.encounter,!0),t.isIndividualSim()||new re(i,s,{id:"encounter-use-health",label:"Use Health",labelTooltip:"Uses a damage limit in place of a duration limit. Damage limit is equal to sum of all targets health.",inline:!0,changedEvent:e=>e.changeEmitter,getValue:e=>e.getUseHealth(),setValue:(e,t,s)=>{t.setUseHealth(e,s)}}),new jd(a,this.encounter,{extraCssClasses:["targets-picker","mb-0"],itemLabel:"Target",changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets,setValue:(e,t,s)=>{t.targets=s,t.targetsChangeEmitter.emit(e)},newItem:()=>JI.getPresetTargetForLevel(t.sim.raid.getPlayer(0)?.getLevel()??Os,t.sim).target,copyItem:e=>Hs.clone(e),newItemPicker:(e,t,i,a)=>new Em(e,s,i,a),minimumItems:1})}addHeader(){const e=this.encounter.sim.db.getAllPresetEncounters();new od(this.header,this.encounter,{id:"encounter-preset-encouter",label:"Encounter",extraCssClasses:["encounter-picker","mb-0","pe-2","order-first"],values:[{name:"Custom",value:-1}].concat(e.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:t=>e.findIndex((e=>t.matchesPreset(e))),setValue:(t,s,i)=>{-1!=i&&s.applyPreset(t,e[i])}})}}class Em extends d{getTarget(){return this.encounter.targets[this.targetIndex]||Hs.create()}constructor(e,t,s,i){super(e,"target-picker-root",t,i),this.encounter=t,this.targetIndex=s,this.rootElem.innerHTML='\n\t\t\t<div class="picker-group target-picker-section target-picker-section1"></div>\n\t\t\t<div class="picker-group target-picker-section target-picker-section2"></div>\n\t\t\t<div class="picker-group target-picker-section target-picker-section3 threat-metrics"></div>\n\t\t';const a=this.rootElem.getElementsByClassName("target-picker-section1")[0],n=this.rootElem.getElementsByClassName("target-picker-section2")[0],o=this.rootElem.getElementsByClassName("target-picker-section3")[0],l=t.sim.db.getAllPresetTargets();new od(a,null,{id:"encounter-npc-picker",extraCssClasses:["npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(l.map(((e,t)=>({name:e.path,value:t})))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>l.findIndex((e=>Lm(this.getTarget(),e.target))),setValue:(e,s,i)=>{-1!=i&&(t.applyPresetTarget(e,l[i],this.targetIndex),t.targetsChangeEmitter.emit(e))}}),this.aiPicker=new od(a,null,{id:"encounter-ai-picker",extraCssClasses:["ai-picker"],label:"AI",labelTooltip:"\n\t\t\t\t<p>Determines the target's ability rotation.</p>\n\t\t\t\t<p>Note that most rotations are not yet implemented.</p>\n\t\t\t",values:[{name:"None",value:0}].concat(l.map((e=>({name:e.path,value:e.target.id})))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().id,setValue:(e,s,i)=>{const a=this.getTarget();a.id=i,a.targetInputs=(l.find((e=>a.id==e.target?.id))?.target?.targetInputs||[]).map((e=>qs.clone(e))),t.targetsChangeEmitter.emit(e)}}),this.levelPicker=new od(a,null,{id:"encounter-level-picker",label:"Level",values:[{name:"63",value:63},{name:"62",value:62},{name:"61",value:61},{name:"60",value:60},{name:"53",value:53},{name:"52",value:52},{name:"51",value:51},{name:"50",value:50},{name:"43",value:43},{name:"42",value:42},{name:"41",value:41},{name:"40",value:40},{name:"28",value:28},{name:"27",value:27},{name:"26",value:26},{name:"25",value:25}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().level,setValue:(e,s,i)=>{this.getTarget().level=i,t.targetsChangeEmitter.emit(e)}}),this.mobTypePicker=new od(a,null,{id:"encounter-mob-type",label:"Mob Type",values:Nm,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().mobType,setValue:(e,s,i)=>{this.getTarget().mobType=i,t.targetsChangeEmitter.emit(e)}}),this.tankIndexPicker=new od(a,null,{id:"target-picker-tanked-by",extraCssClasses:["threat-metrics"],label:"Tanked By",labelTooltip:"Determines which player in the raid this enemy will attack. If no player is assigned to the specified tank slot, this enemy will not attack.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().tankIndex,setValue:(e,s,i)=>{this.getTarget().tankIndex=i,t.targetsChangeEmitter.emit(e)}}),this.targetInputPickers=Cm(a,t,this.targetIndex),this.statPickers=Tm.map((e=>{const s=e.stat;return new Fn(n,null,{id:`target-picker-stats-${e.stat}`,inline:!0,extraCssClasses:e.extraCssClasses,label:Bs.get(s),labelTooltip:e.tooltip,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().stats[s],setValue:(e,i,a)=>{this.getTarget().stats[s]=a,t.targetsChangeEmitter.emit(e)}})})),this.swingSpeedPicker=new Fn(o,null,{id:"target-picker-swing-speed",label:"Swing Speed",labelTooltip:"Time in seconds between auto attacks. Set to 0 to disable auto attacks.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().swingSpeed,setValue:(e,s,i)=>{this.getTarget().swingSpeed=i,t.targetsChangeEmitter.emit(e)}}),this.minBaseDamagePicker=new Fn(o,null,{id:"target-picker-min-base-damage",label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().minBaseDamage,setValue:(e,s,i)=>{this.getTarget().minBaseDamage=i,t.targetsChangeEmitter.emit(e)}}),this.damageSpreadPicker=new Fn(o,null,{id:"target-picker-damage-spread",label:"Damage Spread",labelTooltip:"Fractional spread between the minimum and maximum auto-attack damage from this enemy at 0 Attack Power.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().damageSpread,setValue:(e,s,i)=>{this.getTarget().damageSpread=i,t.targetsChangeEmitter.emit(e)}}),this.dualWieldPicker=new re(o,null,{id:"target-picker-dual-wield",label:"Dual Wield",labelTooltip:"Uses 2 separate weapons to attack.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWield,setValue:(e,s,i)=>{this.getTarget().dualWield=i,t.targetsChangeEmitter.emit(e)}}),this.dwMissPenaltyPicker=new re(o,null,{id:"target-picker-dw-miss-penalty",label:"DW Miss Penalty",labelTooltip:"Enables the Dual Wield Miss Penalty (+19% chance to miss) if dual wielding. Bosses in Hyjal/BT/SWP usually have this disabled to stop tanks from avoidance stacking.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWieldPenalty,setValue:(e,s,i)=>{this.getTarget().dualWieldPenalty=i,t.targetsChangeEmitter.emit(e)},enableWhen:()=>this.getTarget().dualWield}),this.parryHastePicker=new re(o,null,{id:"target-picker-parry-haste",label:"Parry Haste",labelTooltip:"Whether this enemy will gain parry haste when parrying attacks.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().parryHaste,setValue:(e,s,i)=>{this.getTarget().parryHaste=i,t.targetsChangeEmitter.emit(e)}}),this.spellSchoolPicker=new od(o,null,{id:"target-picker-spell-school",label:"Spell School",labelTooltip:"Type of damage caused by auto attacks. This is usually Physical, but some enemies have elemental attacks.",values:[{name:"Physical",value:zs.SpellSchoolPhysical},{name:"Arcane",value:zs.SpellSchoolArcane},{name:"Fire",value:zs.SpellSchoolFire},{name:"Frost",value:zs.SpellSchoolFrost},{name:"Holy",value:zs.SpellSchoolHoly},{name:"Nature",value:zs.SpellSchoolNature},{name:"Shadow",value:zs.SpellSchoolShadow}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().spellSchool,setValue:(e,s,i)=>{this.getTarget().spellSchool=i,t.targetsChangeEmitter.emit(e)}}),this.init()}getInputElem(){return null}getInputValue(){return Hs.create({id:this.aiPicker.getInputValue(),level:this.levelPicker.getInputValue(),mobType:this.mobTypePicker.getInputValue(),tankIndex:this.tankIndexPicker.getInputValue(),swingSpeed:this.swingSpeedPicker.getInputValue(),minBaseDamage:this.minBaseDamagePicker.getInputValue(),dualWield:this.dualWieldPicker.getInputValue(),dualWieldPenalty:this.dwMissPenaltyPicker.getInputValue(),parryHaste:this.parryHastePicker.getInputValue(),spellSchool:this.spellSchoolPicker.getInputValue(),damageSpread:this.damageSpreadPicker.getInputValue(),stats:this.statPickers.map((e=>e.getInputValue())).map(((e,t)=>(new Dn).withStat(Tm[t].stat,e))).reduce(((e,t)=>e.add(t))).asArray(),targetInputs:this.targetInputPickers.getInputValue()})}setInputValue(e){e&&(this.aiPicker.setInputValue(e.id),this.levelPicker.setInputValue(e.level),this.mobTypePicker.setInputValue(e.mobType),this.tankIndexPicker.setInputValue(e.tankIndex),this.swingSpeedPicker.setInputValue(e.swingSpeed),this.minBaseDamagePicker.setInputValue(e.minBaseDamage),this.dualWieldPicker.setInputValue(e.dualWield),this.dwMissPenaltyPicker.setInputValue(e.dualWieldPenalty),this.parryHastePicker.setInputValue(e.parryHaste),this.spellSchoolPicker.setInputValue(e.spellSchool),this.damageSpreadPicker.setInputValue(e.damageSpread),Tm.forEach(((t,s)=>this.statPickers[s].setInputValue(e.stats[t.stat]))),this.targetInputPickers.setInputValue(e.targetInputs))}}class Pm extends d{getTargetInput(){return this.encounter.targets[this.targetIndex].targetInputs[this.targetInputIndex]||qs.create()}clearPickers(){this.boolPicker&&(this.boolPicker.rootElem.remove(),this.boolPicker=null),this.numberPicker&&(this.numberPicker.rootElem.remove(),this.numberPicker=null),this.enumPicker&&(this.enumPicker.rootElem.remove(),this.enumPicker=null)}constructor(e,t,s,i,a){super(e,"target-input-picker-root",t,a),this.encounter=t,this.targetIndex=s,this.targetInputIndex=i,this.boolPicker=null,this.numberPicker=null,this.enumPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){return qs.create({boolValue:this.boolPicker?this.boolPicker.getInputValue():void 0,numberValue:this.numberPicker?this.numberPicker.getInputValue():void 0,enumValue:this.enumPicker?this.enumPicker.getInputValue():void 0})}setInputValue(e){if(e)if(e.inputType==E.Number){if(this.numberPicker&&this.numberPicker.inputConfig.label===e.label)return;this.clearPickers(),this.numberPicker=new Fn(this.rootElem,null,{id:ye(),label:e.label,labelTooltip:e.tooltip,changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().numberValue,setValue:(e,t,s)=>{this.getTargetInput().numberValue=s,this.encounter.targetsChangeEmitter.emit(e)}})}else if(e.inputType==E.Bool){if(this.boolPicker&&this.boolPicker.inputConfig.label===e.label)return;this.clearPickers(),this.boolPicker=new re(this.rootElem,null,{id:ye(),label:e.label,labelTooltip:e.tooltip,extraCssClasses:["input-inline"],changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().boolValue,setValue:(e,t,s)=>{this.getTargetInput().boolValue=s,this.encounter.targetsChangeEmitter.emit(e)}})}else e.inputType==E.Enum&&(this.clearPickers(),this.enumPicker=new od(this.rootElem,null,{id:ye(),label:e.label,labelTooltip:e.tooltip,values:e.enumOptions.map(((e,t)=>({value:t,name:e}))),changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().enumValue,setValue:(e,t,s)=>{this.getTargetInput().enumValue=s,this.encounter.targetsChangeEmitter.emit(e)}}))}}function km(e,t,s){const i=d.newGroupContainer();if(e.appendChild(i),new Fn(i,t,{id:"encounter-duration",label:"Duration",labelTooltip:"The fight length for each sim iteration, in seconds.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDuration(),setValue:(e,t,s)=>{t.setDuration(e,s)},enableWhen:e=>!t.getUseHealth()}),new Fn(i,t,{id:"encounter-duration-variation",label:"Duration +/-",labelTooltip:"Adds a random amount of time, in seconds, between [value, -1 * value] to each sim iteration. For example, setting Duration to 180 and Duration +/- to 10 will result in random durations between 170s and 190s.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDurationVariation(),setValue:(e,t,s)=>{t.setDurationVariation(e,s)},enableWhen:e=>!t.getUseHealth()}),s){const s=d.newGroupContainer();s.classList.add("execute-group"),e.appendChild(s),new Fn(s,t,{id:"encounter-execute-proportion",label:"Execute Duration 20 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 20% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion20(),setValue:(e,t,s)=>{t.setExecuteProportion20(e,s/100)},enableWhen:e=>!t.getUseHealth()}),new Fn(s,t,{id:"encounter-execute-proportion-25",label:"Execute Duration 25 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 25% HP) for the purpose of effects like Warlock's Drain Soul.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion25(),setValue:(e,t,s)=>{t.setExecuteProportion25(e,s/100)},enableWhen:e=>!t.getUseHealth()}),new Fn(s,t,{id:"encounter-execute-proportion-35",label:"Execute Duration 35 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 35% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion35(),setValue:(e,t,s)=>{t.setExecuteProportion35(e,s/100)},enableWhen:e=>!t.getUseHealth()})}}function Cm(e,t,s){return new jd(e,t,{allowedActions:[],itemLabel:"Target Input",isCompact:!0,changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets[s].targetInputs,setValue:(e,t,i)=>{t.targets[s].targetInputs=i,t.targetsChangeEmitter.emit(e)},newItem:()=>qs.create(),copyItem:e=>qs.clone(e),newItemPicker:(e,i,a,n)=>new Pm(e,t,s,a,n)})}function Lm(e,t){if(null==e!=(null==t))return!1;if(null==e)return!0;const s=Hs.clone(t);return s.targetInputs=e.targetInputs,Hs.equals(e,s)}const Tm=[{stat:t.StatHealth,tooltip:"",extraCssClasses:[]},{stat:t.StatArmor,tooltip:"",extraCssClasses:[]},{stat:t.StatArcaneResistance,tooltip:"",extraCssClasses:[]},{stat:t.StatFireResistance,tooltip:"",extraCssClasses:[]},{stat:t.StatFrostResistance,tooltip:"",extraCssClasses:[]},{stat:t.StatNatureResistance,tooltip:"",extraCssClasses:[]},{stat:t.StatShadowResistance,tooltip:"",extraCssClasses:[]},{stat:t.StatAttackPower,tooltip:"",extraCssClasses:["threat-metrics"]},{stat:t.StatBlockValue,tooltip:"",extraCssClasses:["threat-metrics"]}],Nm=[{name:"None",value:is.MobTypeUnknown},{name:"Beast",value:is.MobTypeBeast},{name:"Demon",value:is.MobTypeDemon},{name:"Dragonkin",value:is.MobTypeDragonkin},{name:"Elemental",value:is.MobTypeElemental},{name:"Giant",value:is.MobTypeGiant},{name:"Humanoid",value:is.MobTypeHumanoid},{name:"Mechanical",value:is.MobTypeMechanical},{name:"Undead",value:is.MobTypeUndead}];class Am extends o{constructor(e,t,s,i){if(super(e,"multi-icon-picker-root"),this.rootElem.classList.add("icon-picker","vertical"===(s.direction??ld.Horizontal)?"dropdown":"dropend"),this.simUI=i,this.config=s,this.currentValue=null,this.rootElem.innerHTML='\n\t\t\t<a\n\t\t\t\tclass="icon-picker-button"\n\t\t\t\trole="button"\n\t\t\t\tdata-bs-toggle="dropdown"\n\t\t\t\taria-expanded="false"\n\t\t\t\tdata-disable-wowhead-touch-tooltip="true"\n\t\t\t\tdata-whtticon="false"\n\t\t\t></a>\n\t\t\t<ul class="dropdown-menu"></ul>\n\t\t\t<label class="multi-icon-picker-label form-label"></label>\n\t  ',s.tooltip){const e=Ln(this.rootElem,{content:s.tooltip});this.addOnDisposeCallback((()=>e.destroy()))}const a=this.rootElem.querySelector(".multi-icon-picker-label");s.label?a.textContent=s.label:a.remove(),this.buttonElem=this.rootElem.querySelector(".icon-picker-button"),this.dropdownMenu=this.rootElem.querySelector(".dropdown-menu"),this.config.direction==ld.Horizontal&&(this.dropdownMenu.style.gridAutoFlow="column"),this.buttonElem.addEventListener("hide.bs.dropdown",(e=>{e.hasOwnProperty("clickEvent")&&e.preventDefault()})),this.buttonElem.addEventListener("contextmenu",(e=>e.preventDefault())),this.buttonElem.addEventListener("mousedown",(e=>{W(e)&&this.clearPicker()})),this.buildBlankOption(),this.pickers=this.config.values.map(((e,s)=>{const i=document.createElement("li");return i.classList.add("icon-picker-option","dropdown-option"),this.dropdownMenu.appendChild(i),new rd(i,t,e)})),i.sim.waitForInit().then((()=>this.updateButtonImage())),i.changeEmitter.on((()=>{this.updateButtonImage(),this.showWhen()?this.rootElem.classList.remove("hide"):this.rootElem.classList.add("hide")}))}showWhen(){return!this.config.showWhen||this.config.showWhen(this.simUI.sim.raid.getPlayer(0))&&!!this.pickers.find((e=>e.showWhen()))}buildBlankOption(){const e=document.createElement("li");this.dropdownMenu.appendChild(e);const t=document.createElement("a");t.classList.add("icon-dropdown-option","dropdown-option"),e.appendChild(t),t.addEventListener("click",(()=>this.clearPicker()))}clearPicker(){m.freezeAllAndDo((()=>{this.pickers.forEach((e=>{e.setInputValue(null),e.inputChanged(m.nextEventID())})),this.updateButtonImage()}))}updateButtonImage(){this.currentValue=this.getMaxValue(),this.currentValue?(this.buttonElem.classList.add("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.currentValue.fillAndSet(this.buttonElem,!1,!0)):(this.buttonElem.classList.remove("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.buttonElem.style.backgroundImage="",this.buttonElem.removeAttribute("href"))}getMaxValue(){return this.pickers.filter((e=>e.showWhen())).map((e=>e.getActionId())).filter((e=>null!=e))[0]||null}}const Rm=Td(Md({actionId:e=>e.getMatchingSpellActionId([{id:1126,maxLevel:9},{id:5232,minLevel:10,maxLevel:19},{id:6756,minLevel:20,maxLevel:29},{id:5234,minLevel:30,maxLevel:39},{id:8907,minLevel:40,maxLevel:49},{id:9884,minLevel:50,maxLevel:59},{id:9885,minLevel:60}]),impId:C.fromSpellId(17055),fieldName:"giftOfTheWild"}),"Mark of the Wild"),_m=dd({values:[Ad({actionId:()=>C.fromSpellId(20217),fieldName:"blessingOfKings",showWhen:e=>e.getFaction()===js.Alliance}),Nd({actionId:()=>C.fromSpellId(409580),fieldName:"aspectOfTheLion"})],label:"Stats %"}),Dm=Td(Md({actionId:e=>e.getMatchingSpellActionId([{id:465,maxLevel:9},{id:10290,minLevel:10,maxLevel:19},{id:643,minLevel:20,maxLevel:29},{id:10291,minLevel:30,maxLevel:39},{id:1032,minLevel:40,maxLevel:49},{id:10292,minLevel:50,maxLevel:59},{id:10293,minLevel:60}]),impId:C.fromSpellId(20142),showWhen:e=>e.getFaction()===js.Alliance,fieldName:"devotionAura"}),"Armor"),Mm=Td(Md({actionId:e=>e.getMatchingSpellActionId([{id:8071,minLevel:4,maxLevel:13},{id:8154,minLevel:14,maxLevel:23},{id:8155,minLevel:24,maxLevel:33},{id:10406,minLevel:34,maxLevel:43},{id:10407,minLevel:44,maxLevel:53},{id:10408,minLevel:54}]),impId:C.fromSpellId(16293),showWhen:e=>e.getFaction()===js.Horde,fieldName:"stoneskinTotem"}),"Stoneskin"),Vm=dd({values:[Nd({actionId:e=>e.getMatchingSpellActionId([{id:976,minLevel:30,maxLevel:41},{id:10957,minLevel:42,maxLevel:55},{id:10958,minLevel:56}]),fieldName:"shadowProtection"}),Nd({actionId:e=>e.getMatchingSpellActionId([{id:19876,minLevel:28,maxLevel:39},{id:19895,minLevel:40,maxLevel:51},{id:19896,minLevel:52}]),fieldName:"shadowResistanceAura"}),Nd({actionId:e=>e.getMatchingSpellActionId([{id:10595,minLevel:30,maxLevel:43},{id:10600,minLevel:44,maxLevel:59},{id:10601,minLevel:60}]),fieldName:"natureResistanceTotem",showWhen:e=>e.getFaction()===js.Horde}),Nd({actionId:e=>e.getMatchingSpellActionId([{id:20043,minLevel:46,maxLevel:55},{id:20190,minLevel:56}]),fieldName:"aspectOfTheWild"}),Nd({actionId:e=>e.getMatchingSpellActionId([{id:19891,minLevel:36,maxLevel:47},{id:19899,minLevel:48,maxLevel:59},{id:19900,minLevel:60}]),fieldName:"fireResistanceAura",showWhen:e=>e.getFaction()===js.Alliance}),Nd({actionId:e=>e.getMatchingSpellActionId([{id:8184,minLevel:28,maxLevel:41},{id:10537,minLevel:42,maxLevel:57},{id:10538,minLevel:58}]),fieldName:"fireResistanceTotem",showWhen:e=>e.getFaction()===js.Horde}),Nd({actionId:e=>e.getMatchingSpellActionId([{id:19888,minLevel:32,maxLevel:43},{id:19897,minLevel:44,maxLevel:55},{id:19898,minLevel:56}]),fieldName:"frostResistanceAura",showWhen:e=>e.getFaction()===js.Alliance}),Nd({actionId:e=>e.getMatchingSpellActionId([{id:8181,minLevel:24,maxLevel:37},{id:10478,minLevel:38,maxLevel:53},{id:10479,minLevel:54}]),fieldName:"frostResistanceTotem",showWhen:e=>e.getFaction()===js.Horde})],label:"Resistances"}),Um=dd({values:[Md({actionId:e=>e.getMatchingSpellActionId([{id:1243,maxLevel:11},{id:1244,minLevel:12,maxLevel:23},{id:1245,minLevel:24,maxLevel:35},{id:2791,minLevel:36,maxLevel:47},{id:10937,minLevel:48,maxLevel:59},{id:10938,minLevel:60}]),impId:C.fromSpellId(14767),fieldName:"powerWordFortitude"}),Nd({actionId:e=>e.getMatchingItemActionId([{id:1180,minLevel:5,maxLevel:19},{id:1711,minLevel:20,maxLevel:34},{id:4422,minLevel:35,maxLevel:49},{id:10307,minLevel:50}]),fieldName:"scrollOfStamina"})],label:"Stamina"}),Wm=dd({values:[Md({actionId:e=>e.getMatchingSpellActionId([{id:6307,minLevel:4,maxLevel:13},{id:7804,minLevel:14,maxLevel:25},{id:7805,minLevel:26,maxLevel:37},{id:11766,minLevel:38,maxLevel:49},{id:11767,minLevel:50}]),impId:C.fromSpellId(18696),fieldName:"bloodPact"}),Nd({actionId:()=>C.fromSpellId(403215),fieldName:"commandingShout"})],label:"Blood Pact"}),Fm=dd({values:[Nd({actionId:()=>C.fromSpellId(425600),fieldName:"hornOfLordaeron",showWhen:e=>e.getFaction()==js.Alliance}),Vd({actionId:e=>e.getMatchingSpellActionId([{id:19740,minLevel:4,maxLevel:11},{id:19834,minLevel:12,maxLevel:21},{id:19835,minLevel:22,maxLevel:31},{id:19836,minLevel:32,maxLevel:41},{id:19837,minLevel:42,maxLevel:51},{id:19838,minLevel:52,maxLevel:59},{id:25291,minLevel:60}]),impId:C.fromSpellId(20048),fieldName:"blessingOfMight",showWhen:e=>e.getFaction()===js.Alliance})],label:"Paladin Physical"}),Om=Td(Md({actionId:e=>e.getMatchingSpellActionId([{id:8075,minLevel:10,maxLevel:23},{id:8160,minLevel:24,maxLevel:37},{id:8161,minLevel:38,maxLevel:51},{id:10442,minLevel:52,maxLevel:59},{id:25361,minLevel:60}]),impId:C.fromSpellId(16295),fieldName:"strengthOfEarthTotem",showWhen:e=>e.getFaction()===js.Horde}),"Strength"),Hm=Td(Md({actionId:e=>e.getMatchingSpellActionId([{id:8835,minLevel:42,maxLevel:55},{id:10627,minLevel:56,maxLevel:59},{id:25359,minLevel:60}]),impId:C.fromSpellId(16295),fieldName:"graceOfAirTotem",showWhen:e=>e.getFaction()===js.Horde}),"Agility"),qm=dd({values:[Nd({actionId:e=>e.getMatchingSpellActionId([{id:1459,maxLevel:13},{id:1460,minLevel:14,maxLevel:27},{id:1461,minLevel:28,maxLevel:41},{id:10156,minLevel:42,maxLevel:55},{id:10157,minLevel:56}]),fieldName:"arcaneBrilliance"}),Nd({actionId:e=>e.getMatchingItemActionId([{id:955,minLevel:5,maxLevel:19},{id:2290,minLevel:20,maxLevel:34},{id:4419,minLevel:35,maxLevel:49},{id:10308,minLevel:50}]),fieldName:"scrollOfIntellect"})],label:"Intellect"}),Bm=dd({values:[Nd({actionId:e=>e.getMatchingSpellActionId([{id:14752,minLevel:30,maxLevel:39},{id:14818,minLevel:40,maxLevel:49},{id:14819,minLevel:50,maxLevel:59},{id:27841,minLevel:60}]),fieldName:"divineSpirit"}),Nd({actionId:e=>e.getMatchingItemActionId([{id:1181,maxLevel:14},{id:1712,minLevel:15,maxLevel:29},{id:4424,minLevel:30,maxLevel:44},{id:10306,minLevel:45}]),fieldName:"scrollOfSpirit"})],label:"Spirit"}),zm=Td(Md({actionId:e=>e.getMatchingSpellActionId([{id:6673,maxLevel:11},{id:5242,minLevel:12,maxLevel:21},{id:6192,minLevel:22,maxLevel:31},{id:11549,minLevel:32,maxLevel:41},{id:11550,minLevel:42,maxLevel:51},{id:11551,minLevel:52,maxLevel:59},{id:25289,minLevel:60}]),impId:C.fromSpellId(12861),fieldName:"battleShout"}),"Battle Shout"),jm=Td(Nd({actionId:e=>e.getMatchingSpellActionId([{id:19506,minLevel:40,maxLevel:49},{id:20905,minLevel:50,maxLevel:59},{id:20906,minLevel:60}]),fieldName:"trueshotAura"}),"Trueshot Aura"),$m=Td(Vd({actionId:e=>e.getMatchingSpellActionId([{id:19742,minLevel:14,maxLevel:23},{id:19850,minLevel:24,maxLevel:33},{id:19852,minLevel:34,maxLevel:43},{id:19853,minLevel:44,maxLevel:53},{id:19854,minLevel:54,maxLevel:59},{id:25290,minLevel:60}]),impId:C.fromSpellId(20245),fieldName:"blessingOfWisdom",showWhen:e=>e.getFaction()===js.Alliance}),"Blessing of Wisdom"),Gm=Td(Md({actionId:e=>e.getMatchingSpellActionId([{id:5675,minLevel:26,maxLevel:35},{id:10495,minLevel:36,maxLevel:45},{id:10496,minLevel:46,maxLevel:55},{id:10497,minLevel:56}]),impId:C.fromSpellId(16208),fieldName:"manaSpringTotem",showWhen:e=>e.getFaction()===js.Horde}),"Mana Spring Totem"),Km=Td(Wd({actionId:()=>C.fromSpellId(402668),numStates:30,fieldName:"vampiricTouch",multiplier:100}),"Raid MP5"),Jm=Td(Nd({actionId:e=>e.getMatchingSpellActionId([{id:24932,minLevel:40}]),fieldName:"leaderOfThePack"}),"Leader of the Pack"),Zm=Td(Ad({actionId:e=>e.getMatchingSpellActionId([{id:408696,minLevel:40}]),fieldName:"spiritOfTheAlpha",showWhen:e=>e.getFaction()===js.Horde}),"Spirit of The Alpha"),Ym=Td(Nd({actionId:e=>e.getMatchingSpellActionId([{id:24907,minLevel:40}]),fieldName:"moonkinAura"}),"Moonkin Aura"),Qm=Td(Wd({actionId:()=>C.fromSpellId(425464),numStates:21,fieldName:"demonicPact",multiplier:10}),"Demonic Pact"),Xm=Nd({actionId:()=>C.fromSpellId(1232037),fieldName:"resilienceOfTheDawn"}),eh=Nd({actionId:()=>C.fromSpellId(1219557),fieldName:"atieshCastSpeedBuff"}),th=Nd({actionId:()=>C.fromSpellId(1219553),fieldName:"atieshHealingBuff"}),sh=Nd({actionId:()=>C.fromSpellId(1219558),fieldName:"atieshSpellCritBuff"}),ih=Nd({actionId:()=>C.fromSpellId(1219552),fieldName:"atieshSpellPowerBuff"}),ah=Nd({actionId:()=>C.fromSpellId(457544),fieldName:"improvedStoneskinWindwall"}),nh=Md({actionId:e=>e.getMatchingSpellActionId([{id:7294,minLevel:16,maxLevel:25},{id:10298,minLevel:26,maxLevel:35},{id:10299,minLevel:36,maxLevel:45},{id:10300,minLevel:46,maxLevel:55},{id:10301,minLevel:56}]),impId:C.fromSpellId(20092),fieldName:"retributionAura",showWhen:e=>e.getFaction()===js.Alliance}),oh=Nd({actionId:e=>e.getMatchingSpellActionId([{id:20218,minLevel:30}]),fieldName:"sanctityAura",showWhen:e=>e.getFaction()===js.Alliance}),lh=Md({actionId:e=>e.getMatchingSpellActionId([{id:467,minLevel:6,maxLevel:13},{id:782,minLevel:14,maxLevel:23},{id:1075,minLevel:24,maxLevel:33},{id:8914,minLevel:34,maxLevel:43},{id:9756,minLevel:44,maxLevel:53},{id:9910,minLevel:54}]),impId:C.fromSpellId(16840),fieldName:"thorns"}),rh=Fd({actionId:e=>e.getMatchingSpellActionId([{id:29166,minLevel:40}]),numStates:11,fieldName:"innervates"}),ch=Fd({actionId:e=>e.getMatchingSpellActionId([{id:10060,minLevel:40}]),numStates:11,fieldName:"powerInfusions"}),dh=Wd({actionId:e=>e.getMatchingSpellActionId([{id:23060,minLevel:40}]),numStates:6,fieldName:"battleSquawk"}),mh=dd({values:[Ad({actionId:()=>C.fromSpellId(22888),fieldName:"rallyingCryOfTheDragonslayer"}),Ad({actionId:()=>C.fromSpellId(461475),fieldName:"valorOfAzeroth"})],label:"Dragonslayer Buff"}),hh=Td(Ad({actionId:()=>C.fromSpellId(24425),fieldName:"spiritOfZandalar"}),"Spirit of Zandalar"),uh=Td(Ad({actionId:()=>C.fromSpellId(15366),fieldName:"songflowerSerenade"}),"Songflower Serenade"),ph=Td(Ad({actionId:()=>C.fromSpellId(16609),fieldName:"warchiefsBlessing",showWhen:e=>e.getFaction()===js.Horde}),"Warchief's Blessing"),gh=Td(Ad({actionId:()=>C.fromSpellId(460940),fieldName:"mightOfStormwind",showWhen:e=>e.getFaction()===js.Alliance}),"Might Of Stormwind"),fh=e=>{return kd({getModObject:e=>e,showWhen:e=>!t.showWhen||t.showWhen(e),getValue:e=>e.getBuffs(),setValue:(e,t,s)=>t.setBuffs(e,s),changeEmitter:e=>m.onAny([e.buffsChangeEmitter,e.levelChangeEmitter,e.raceChangeEmitter])},(t={direction:ld.Horizontal,values:[{iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_orb_02.jpg",value:$s.SaygesUnknown,text:"Sayge's Dark Fortune"},...e.map((e=>e.config))],fieldName:"saygesFortune"}).fieldName,t.values,t.numColumns,t.direction||ld.Vertical);var t},Ih={actionId:()=>C.fromSpellId(23768),value:$s.SaygesDamage,text:"Sayge's Damage"},wh={actionId:()=>C.fromSpellId(23736),value:$s.SaygesAgility,text:"Sayge's Agility"},vh={actionId:()=>C.fromSpellId(23766),value:$s.SaygesIntellect,text:"Sayge's Intellect"},bh={actionId:()=>C.fromSpellId(23738),value:$s.SaygesSpirit,text:"Sayge's Spirit"},Sh={actionId:()=>C.fromSpellId(23737),value:$s.SaygesStamina,text:"Sayge's Stamina"},xh=Td(Ad({actionId:e=>e.getMatchingSpellActionId([{id:22817,minLevel:51}]),fieldName:"fengusFerocity"}),"Fengus' Ferocity"),yh=Td(Ad({actionId:e=>e.getMatchingSpellActionId([{id:22818,minLevel:51}]),fieldName:"moldarsMoxie"}),"Moldar's Moxie"),Eh=Td(Ad({actionId:e=>e.getMatchingSpellActionId([{id:22820,minLevel:51}]),fieldName:"slipkiksSavvy"}),"Slip'kik's Savvy"),Ph=Td(Ad({actionId:e=>e.getMatchingSpellActionId([{id:430947,maxLevel:39}]),fieldName:"boonOfBlackfathom"}),"Boon of Blackfathom"),kh=Td(Ad({actionId:e=>e.getMatchingSpellActionId([{id:430352,maxLevel:39}]),fieldName:"ashenvalePvpBuff"}),"Ashenvale PvP Buff"),Ch=Td(Ad({actionId:e=>e.getMatchingSpellActionId([{id:438536,maxLevel:49}]),fieldName:"sparkOfInspiration"}),"Spark of Inspiration"),Lh=Td(Ad({actionId:e=>e.getMatchingSpellActionId([{id:446695,maxLevel:59}]),fieldName:"fervorOfTheTempleExplorer"}),"Fervor Of The Temple Explorer"),Th=dd({values:[Dd({actionId:e=>e.getMatchingSpellActionId([{id:7386,minLevel:10,maxLevel:21},{id:7405,minLevel:22,maxLevel:33},{id:8380,minLevel:34,maxLevel:45},{id:11596,minLevel:46,maxLevel:57},{id:11597,minLevel:58}]),fieldName:"sunderArmor"}),Ud({actionId:e=>e.getMatchingSpellActionId([{id:8647,minLevel:14,maxLevel:25},{id:8649,minLevel:26,maxLevel:35},{id:8650,minLevel:36,maxLevel:45},{id:11197,minLevel:46,maxLevel:55},{id:11198,minLevel:56}]),impId:C.fromSpellId(14169),fieldName:"exposeArmor"}),Ud({actionId:e=>e.getMatchingSpellActionId([{id:439500,minLevel:60}]),impId:C.fromSpellId(14169),fieldName:"sebaciousPoison"})],label:"Major Armor Penetration"}),Nh=Td(Dd({actionId:e=>e.getMatchingSpellActionId([{id:704,minLevel:14,maxLevel:27},{id:7658,minLevel:28,maxLevel:41},{id:7659,minLevel:42,maxLevel:55},{id:11717,minLevel:56}]),fieldName:"curseOfRecklessness"}),"Curse of Recklessness"),Ah=Td(Dd({actionId:e=>e.getMatchingSpellActionId([{id:770,minLevel:18,maxLevel:29},{id:778,minLevel:30,maxLevel:41},{id:9749,minLevel:42,maxLevel:53},{id:9907,minLevel:54}]),fieldName:"faerieFire"}),"Faerie Fire"),Rh=Td(Ud({actionId:e=>e.getMatchingSpellActionId([{id:702,minLevel:4,maxLevel:11},{id:1108,minLevel:12,maxLevel:21},{id:6205,minLevel:22,maxLevel:31},{id:7646,minLevel:32,maxLevel:41},{id:11707,minLevel:42,maxLevel:51},{id:11708,minLevel:52}]),impId:C.fromSpellId(18181),fieldName:"curseOfWeakness"}),"Curse of Weakness"),_h=dd({values:[Ud({actionId:e=>e.getMatchingSpellActionId([{id:1160,minLevel:14,maxLevel:23},{id:6190,minLevel:24,maxLevel:33},{id:11554,minLevel:34,maxLevel:43},{id:11555,minLevel:44,maxLevel:53},{id:11556,minLevel:54}]),impId:C.fromSpellId(12879),fieldName:"demoralizingShout"}),Ud({actionId:e=>e.getMatchingSpellActionId([{id:99,minLevel:10,maxLevel:19},{id:1735,minLevel:20,maxLevel:31},{id:9490,minLevel:32,maxLevel:41},{id:9747,minLevel:42,maxLevel:51},{id:9898,minLevel:52}]),impId:C.fromSpellId(16862),fieldName:"demoralizingRoar"}),Od({actionId:()=>C.fromSpellId(402811),numStates:11,multiplier:10,reverse:!0,fieldName:"homunculi"}),Dd({actionId:()=>C.fromSpellId(439473),fieldName:"atrophicPoison"})],label:"Attack Power"}),Dh=Td(Dd({actionId:()=>C.fromSpellId(409828),fieldName:"mangle"}),"Bleed"),Mh=dd({values:[Ud({actionId:()=>C.fromSpellId(6343),impId:C.fromSpellId(403219),fieldName:"thunderClap"}),Od({actionId:()=>C.fromSpellId(402808),numStates:11,multiplier:10,reverse:!0,fieldName:"homunculi"}),Dd({actionId:()=>C.fromSpellId(408699),fieldName:"waylay"}),Dd({actionId:()=>C.fromSpellId(21992),fieldName:"thunderfury"}),Dd({actionId:()=>C.fromSpellId(439472),fieldName:"numbingPoison"})],label:"Attack Speed"}),Vh=Td(Dd({actionId:e=>e.getMatchingSpellActionId([{id:5570,minLevel:20,maxLevel:29},{id:24974,minLevel:30,maxLevel:39},{id:24975,minLevel:40,maxLevel:49},{id:24976,minLevel:50,maxLevel:59},{id:24977,minLevel:60}]),fieldName:"insectSwarm"}),"Insect Swarm"),Uh=Td(Dd({actionId:e=>e.getMatchingSpellActionId([{id:17803,minLevel:10}]),fieldName:"improvedShadowBolt"}),"Improved Shadow Bolt"),Wh=Td(Dd({actionId:e=>e.getMatchingSpellActionId([{id:12873,minLevel:40}]),fieldName:"improvedScorch"}),"Scorch"),Fh=Td(Dd({actionId:e=>e.getMatchingSpellActionId([{id:28595,minLevel:40}]),fieldName:"wintersChill"}),"Winter's Chill"),Oh=dd({values:[Dd({actionId:e=>e.getMatchingSpellActionId([{id:17364,minLevel:40}]),fieldName:"stormstrike"}),Dd({actionId:()=>C.fromSpellId(408258),fieldName:"dreamstate"})],label:"Nature Damage"}),Hh=Td(Dd({actionId:e=>e.getMatchingSpellActionId([{id:15334,minLevel:40}]),fieldName:"shadowWeaving"}),"Shadow Weaving"),qh=dd({values:[Dd({actionId:e=>e.getMatchingSpellActionId([{id:461615}]),fieldName:"markOfChaos"}),Dd({actionId:e=>e.getMatchingSpellActionId([{id:1490,minLevel:32,maxLevel:45},{id:11721,minLevel:46,maxLevel:59},{id:11722,minLevel:60}]),fieldName:"curseOfElements"}),Dd({actionId:e=>e.getMatchingSpellActionId([{id:17862,minLevel:44,maxLevel:59},{id:17937,minLevel:60}]),fieldName:"curseOfShadow"})],label:"Warlock Curses"}),Bh=Td(Dd({actionId:e=>e.getMatchingItemActionId([{id:226374,minLevel:54}]),fieldName:"occultPoison"}),"Occult Poison"),zh=Td(Ud({actionId:e=>e.getMatchingSpellActionId([{id:1130,minLevel:6,maxLevel:21},{id:14323,minLevel:22,maxLevel:39},{id:14324,minLevel:40,maxLevel:57},{id:14325,minLevel:58}]),impId:C.fromSpellId(19425),fieldName:"huntersMark"}),"Hunter's Mark"),jh=Td(Dd({actionId:e=>e.getMatchingSpellActionId([{id:20186,minLevel:38,maxLevel:57},{id:20355,minLevel:58}]),fieldName:"judgementOfWisdom",showWhen:e=>e.getFaction()===js.Alliance}),"Judgement of Wisdom"),$h=Td(Ud({actionId:e=>e.getMatchingSpellActionId([{id:20300,minLevel:22,maxLevel:31},{id:20301,minLevel:32,maxLevel:41},{id:20302,minLevel:42,maxLevel:51},{id:20303,minLevel:52}]),impId:C.fromSpellId(20337),fieldName:"judgementOfTheCrusader",showWhen:e=>e.getFaction()===js.Alliance}),"Judgement of the Crusader"),Gh=Dd({actionId:e=>e.getMatchingSpellActionId([{id:455864,minLevel:60}]),fieldName:"improvedFaerieFire"}),Kh=Dd({actionId:e=>e.getMatchingSpellActionId([{id:456389,minLevel:60}]),fieldName:"meleeHunterDodgeDebuff"}),Jh=Dd({actionId:e=>e.getMatchingItemActionId([{id:213409,minLevel:40,maxLevel:45}]),fieldName:"mekkatorqueFistDebuff"}),Zh=Dd({actionId:e=>e.getMatchingItemActionId([{id:220589,minLevel:50,maxLevel:55}]),fieldName:"serpentsStrikerFistDebuff"}),Yh=Td(Dd({actionId:e=>e.getMatchingSpellActionId([{id:20185,minLevel:30,maxLevel:39},{id:20344,minLevel:40,maxLevel:49},{id:20345,minLevel:50,maxLevel:59},{id:20346,minLevel:60}]),fieldName:"judgementOfLight",showWhen:e=>e.getFaction()===js.Alliance}),"Judgement of Light"),Qh=Dd({actionId:e=>e.getMatchingSpellActionId([{id:427143,minLevel:25}]),fieldName:"curseOfVulnerability"}),Xh=Dd({actionId:e=>e.getMatchingSpellActionId([{id:11374,minLevel:41}]),fieldName:"giftOfArthas"}),eu=Dd({actionId:e=>e.getMatchingSpellActionId([{id:9176,minLevel:20}]),fieldName:"holySunder",showWhen:e=>e.getFaction()===js.Alliance}),tu=Dd({actionId:e=>e.getMatchingSpellActionId([{id:1219121,minLevel:60}]),fieldName:"bloodPlague"}),su=Dd({actionId:e=>e.getMatchingSpellActionId([{id:1219124,minLevel:60}]),fieldName:"frostFever"}),iu=[{config:Rm,picker:rd,stats:[]},{config:_m,picker:Am,stats:[]},{config:Um,picker:Am,stats:[t.StatStamina]},{config:Wm,picker:Am,stats:[t.StatStamina]},{config:qm,picker:Am,stats:[t.StatIntellect]},{config:Bm,picker:Am,stats:[t.StatSpirit]},{config:Dm,picker:rd,stats:[t.StatArmor]},{config:Mm,picker:rd,stats:[t.StatArmor]},{config:Vm,picker:Am,stats:[t.StatNatureResistance,t.StatShadowResistance,t.StatFireResistance,t.StatFrostResistance]},{config:Fm,picker:Am,stats:[t.StatAttackPower,t.StatStrength,t.StatAgility]},{config:Om,picker:rd,stats:[t.StatStrength]},{config:zm,picker:rd,stats:[t.StatAttackPower]},{config:Hm,picker:rd,stats:[t.StatAgility]},{config:jm,picker:rd,stats:[t.StatRangedAttackPower]},{config:Jm,picker:rd,stats:[t.StatMeleeCrit]},{config:Zm,picker:rd,stats:[t.StatArmor]},{config:Qm,picker:rd,stats:[t.StatSpellPower,t.StatSpellDamage]},{config:Ym,picker:rd,stats:[t.StatSpellCrit]},{config:$m,picker:rd,stats:[t.StatMP5]},{config:Gm,picker:rd,stats:[t.StatMP5]},{config:Km,picker:rd,stats:[t.StatMP5]}],au=[{config:Xm,picker:rd,stats:[]},{config:ih,picker:rd,stats:[t.StatSpellPower,t.StatSpellDamage]},{config:sh,picker:rd,stats:[t.StatSpellPower,t.StatSpellDamage]},{config:eh,picker:rd,stats:[t.StatSpellPower,t.StatSpellDamage]},{config:th,picker:rd,stats:[t.StatSpellPower,t.StatSpellDamage]},{config:ah,picker:rd,stats:[t.StatArmor]},{config:lh,picker:rd,stats:[t.StatArmor]},{config:nh,picker:rd,stats:[t.StatArmor]},{config:oh,picker:rd,stats:[t.StatHolyPower]},{config:rh,picker:rd,stats:[t.StatMP5]},{config:ch,picker:rd,stats:[]},{config:dh,picker:rd,stats:[t.StatMeleeHit]}],nu=[{config:mh,picker:Am,stats:[]},{config:uh,picker:rd,stats:[]},{config:hh,picker:rd,stats:[]},{config:ph,picker:rd,stats:[]},{config:gh,picker:rd,stats:[]},{config:Lh,picker:rd,stats:[]},{config:Ch,picker:rd,stats:[]},{config:Ph,picker:rd,stats:[t.StatMeleeCrit,t.StatSpellCrit,t.StatAttackPower]},{config:kh,picker:rd,stats:[t.StatAttackPower,t.StatSpellPower]},{config:xh,picker:rd,stats:[t.StatAttackPower]},{config:yh,picker:rd,stats:[t.StatStamina]},{config:Eh,picker:rd,stats:[t.StatSpellCrit]}],ou=[{config:Ih,stats:[]},{config:wh,stats:[t.StatAgility]},{config:vh,stats:[t.StatIntellect]},{config:bh,stats:[t.StatSpirit,t.StatMP5]},{config:Sh,stats:[t.StatStamina]}],lu=[{config:Th,stats:[t.StatAttackPower],picker:Am},{config:Nh,picker:rd,stats:[t.StatAttackPower]},{config:Ah,picker:rd,stats:[t.StatAttackPower]},{config:Dh,picker:rd,stats:[t.StatAttackPower,t.StatRangedAttackPower]},{config:$h,picker:rd,stats:[t.StatHolyPower]},{config:Uh,picker:rd,stats:[t.StatShadowPower]},{config:Wh,picker:rd,stats:[]},{config:Fh,picker:rd,stats:[t.StatFrostPower]},{config:Oh,picker:Am,stats:[]},{config:Hh,picker:rd,stats:[t.StatShadowPower]},{config:qh,picker:Am,stats:[]},{config:Bh,picker:rd,stats:[]},{config:_h,picker:Am,stats:[t.StatArmor]},{config:Mh,picker:Am,stats:[t.StatArmor]},{config:Rh,picker:rd,stats:[t.StatArmor]},{config:Vh,picker:rd,stats:[t.StatDodge]},{config:zh,picker:rd,stats:[t.StatRangedAttackPower]},{config:jh,picker:rd,stats:[t.StatMP5,t.StatIntellect]},{config:Yh,picker:rd,stats:[]}],ru=[{config:Gh,picker:rd,stats:[]},{config:Kh,picker:rd,stats:[t.StatMeleeHit]},{config:Jh,picker:rd,stats:[]},{config:Zh,picker:rd,stats:[]},{config:Qh,picker:rd,stats:[t.StatAttackPower,t.StatRangedAttackPower]},{config:Xh,picker:rd,stats:[t.StatAttackPower,t.StatRangedAttackPower]},{config:eu,picker:rd,stats:[t.StatAttackPower,t.StatRangedAttackPower]},{config:tu,picker:rd,stats:[]},{config:su,picker:rd,stats:[]}];function cu(e,t){return e.filter((e=>!t.individualConfig.excludeBuffDebuffInputs.includes(e.config)&&(0==e.stats.length||e.stats.some((e=>t.individualConfig.displayStats.includes(e)||Gs.includes(e)))||t.individualConfig.includeBuffDebuffInputs.includes(e.config))))}const du={id:"reaction-time",type:"number",label:"Reaction Time",labelTooltip:"Reaction time of the player, in milliseconds. Used with certain APL values (such as 'Aura Is Active With Reaction Time').",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getReactionTime(),setValue:(e,t,s)=>{t.setReactionTime(e,s)}},mu={id:"channel-clip-delay",type:"number",label:"Channel Clip Delay",labelTooltip:"Clip delay following channeled spells, in milliseconds. This delay occurs following any full or partial channel ending after the GCD becomes available, due to the player not being able to queue the next spell.",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getChannelClipDelay(),setValue:(e,t,s)=>{t.setChannelClipDelay(e,s)}},hu={id:"in-front-of-target",type:"boolean",label:"In Front of Target",labelTooltip:"Stand in front of the target, causing Blocks and Parries to be included in the attack table.",changedEvent:e=>e.inFrontOfTargetChangeEmitter,getValue:e=>e.getInFrontOfTarget(),setValue:(e,t,s)=>{t.setInFrontOfTarget(e,s)}},uu={id:"distance-from-target",type:"number",label:"Distance From Target",labelTooltip:"Distance from targets, in yards. Used to calculate travel time for certain spells.",changedEvent:e=>e.distanceFromTargetChangeEmitter,getValue:e=>e.getDistanceFromTarget(),setValue:(e,t,s)=>{t.setDistanceFromTarget(e,s)}},pu={tooltip:"Improved Shadow Bolt debuff configuration",inputs:[{id:"isb-using-shadowflame",type:"boolean",label:"Has Shadowflame Rune",labelTooltip:"Whether or not the Warlock is using the Shadowflame rune (4 stacks of ISB vs. 10)",float:!0,defaultValue:!0,inline:!0,changedEvent:e=>m.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbUsingShadowflame(),setValue:(e,t,s)=>{t.setIsbUsingShadowflame(e,s)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-sb-frequency",type:"number",label:"SB Frequency",labelTooltip:"How often a Shadow Bolt is cast by the external warlock.",float:!0,defaultValue:3,inline:!0,changedEvent:e=>m.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbSbFrequency(),setValue:(e,t,s)=>{t.setIsbSbFrequency(e,s)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-sb-crit",type:"number",label:"SB Crit",labelTooltip:"How often a Shadow Bolt from external warlock is a crit.",float:!0,defaultValue:25,inline:!0,changedEvent:e=>m.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbCrit(),setValue:(e,t,s)=>{t.setIsbCrit(e,s)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-warlock",type:"number",label:"SB Warlocks",labelTooltip:"Number of ISB warlocks.",defaultValue:1,inline:!0,changedEvent:e=>m.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbWarlocks(),setValue:(e,t,s)=>{t.setIsbWarlocks(e,s)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-sb-priests",type:"number",label:"Shadow Priests",labelTooltip:"Number of other shadow priests.",inline:!0,changedEvent:e=>m.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbSpriests(),setValue:(e,t,s)=>{t.setIsbSpriests(e,s)},showWhen:e=>1==e.getRaid()?.getDebuffs().improvedShadowBolt||e?.getTalents().improvedShadowBolt>0}]},gu={id:"tank-assignment",type:"enum",extraCssClasses:["tank-selector","threat-metrics","within-raid-sim-hide"],label:"Tank Assignment",labelTooltip:"Determines which mobs will be tanked. Most mobs default to targeting the Main Tank, but in preset multi-target encounters this is not always true.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:e=>e.getRaid().tanksChangeEmitter,getValue:e=>(e.getRaid()?.getTanks()||[]).findIndex((t=>Ce.equals(t,e.makeUnitReference()))),setValue:(e,t,s)=>{const i=[];if(-1!=s){for(let e=0;e<s;e++)i.push(Ks());i.push(t.makeUnitReference())}t.getRaid().setTanks(e,i)}},fu={id:"incoming-hps",type:"number",label:"Incoming HPS",labelTooltip:"\n\t\t<p>Average amount of healing received per second. Used for calculating chance of death.</p>\n\t\t<p class=\"mb-0>If set to 0, defaults to 17.5% of the primary target's base DPS.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().hps,setValue:(e,t,s)=>{const i=t.getHealingModel();i.hps=s,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>Ce.equals(t,e.makeUnitReference())))},Iu={id:"healing-cadence",type:"number",float:!0,label:"Healing Cadence",labelTooltip:"\n\t\t<p>How often the incoming heal 'ticks', in seconds. Generally, longer durations favor Effective Hit Points (EHP) for minimizing Chance of Death, while shorter durations favor avoidance.</p>\n\t\t<p>Example: if Incoming HPS is set to 1000 and this is set to 1s, then every 1s a heal will be received for 1000. If this is instead set to 2s, then every 2s a heal will be received for 2000.</p>\n\t\t<p class=\"mb-0\">If set to 0, defaults to 1.5 times the primary target's base swing timer, and half that for dual wielding targets.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceSeconds,setValue:(e,t,s)=>{const i=t.getHealingModel();i.cadenceSeconds=s,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>Ce.equals(t,e.makeUnitReference())))},wu={id:"healing-cadence-variation",type:"number",float:!0,label:"Cadence +/-",labelTooltip:"\n\t\t<p>Magnitude of random variation in healing intervals, in seconds.</p>\n\t\t<p>Example: if Healing Cadence is set to 1s with 0.5s variation, then the interval between successive heals will vary uniformly between 0.5 and 1.5s. If the variation is instead set to 2s, then 50% of healing intervals will fall between 0s and 1s, and the other 50% will fall between 1s and 3s.</p>\n\t\t<p class=\"mb-0\">The amount of healing per 'tick' is automatically scaled up or down based on the randomized time since the last tick, so as to keep HPS constant.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceVariation,setValue:(e,t,s)=>{const i=t.getHealingModel();i.cadenceVariation=s,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>Ce.equals(t,e.makeUnitReference())))},vu={id:"burst-window",type:"number",float:!1,label:"TMI Burst Window",labelTooltip:"\n\t\t<p>Size in whole seconds of the burst window for calculating TMI. It is important to use a consistent setting when comparing this metric.</p>\n\t\t<p>Default is 6 seconds. If set to 0, TMI calculations are disabled.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().burstWindow,setValue:(e,t,s)=>{const i=t.getHealingModel();i.burstWindow=s,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>Ce.equals(t,e.makeUnitReference())))},bu={id:"hp-percent-for-defensives",type:"number",float:!0,label:"HP % for Defensive CDs",labelTooltip:'\n\t\t<p>% of Maximum Health, below which defensive cooldowns are allowed to be used.</p>\n\t\t<p class="mb-0">If set to 0, this restriction is disabled.</p>\n\t',changedEvent:e=>e.rotationChangeEmitter,getValue:e=>100*e.getSimpleCooldowns().hpPercentForDefensives,setValue:(e,t,s)=>{const i=t.getSimpleCooldowns();i.hpPercentForDefensives=s/100,t.setSimpleCooldowns(e,i)}},Su={id:"inspiration-uptime",type:"number",float:!0,label:"Inspiration % Uptime",labelTooltip:'\n\t\t<p>% average of Encounter Duration, during which you have the Inspiration buff.</p>\n\t\t<p class="mb-0">If set to 0, the buff isn\'t applied.</p>\n\t',changedEvent:e=>e.healingModelChangeEmitter,getValue:e=>100*e.getHealingModel().inspirationUptime,setValue:(e,t,s)=>{const i=t.getHealingModel();i.inspirationUptime=s/100,t.setHealingModel(e,i)}},xu={actionId:e=>e.getMatchingItemActionId([{id:6947,minLevel:20,maxLevel:27},{id:6949,minLevel:28,maxLevel:35},{id:6950,minLevel:36,maxLevel:43},{id:8926,minLevel:44,maxLevel:51},{id:8927,minLevel:52,maxLevel:59},{id:8928,minLevel:60,maxLevel:60}]),value:Js.InstantPoison,showWhen:e=>e.getClass()==F.ClassRogue},yu={actionId:e=>e.getMatchingItemActionId([{id:2892,minLevel:30,maxLevel:37},{id:2893,minLevel:38,maxLevel:45},{id:8984,minLevel:46,maxLevel:53},{id:8985,minLevel:54,maxLevel:59},{id:20844,minLevel:60,maxLevel:60}]),value:Js.DeadlyPoison,showWhen:e=>e.getClass()==F.ClassRogue},Eu={actionId:e=>e.getMatchingItemActionId([{id:10918,minLevel:32,maxLevel:39},{id:10920,minLevel:40,maxLevel:47},{id:10921,minLevel:48,maxLevel:55},{id:10922,minLevel:56,maxLevel:60}]),value:Js.WoundPoison,showWhen:e=>e.getClass()==F.ClassRogue},Pu={actionId:e=>e.getMatchingItemActionId([{id:234444,minLevel:60}]),value:Js.OccultPoison,showWhen:e=>e.getClass()==F.ClassRogue},ku={actionId:e=>e.getMatchingItemActionId([{id:217345,minLevel:60}]),value:Js.SebaciousPoison,showWhen:e=>e.getClass()==F.ClassRogue},Cu={actionId:e=>e.getMatchingItemActionId([{id:217346,minLevel:60}]),value:Js.NumbingPoison,showWhen:e=>e.getClass()==F.ClassRogue},Lu={actionId:e=>e.getMatchingItemActionId([{id:217347,minLevel:60}]),value:Js.AtrophicPoison,showWhen:e=>e.getClass()==F.ClassRogue},Tu=e=>({actionId:e=>e.getMatchingSpellActionId([{id:8017,minLevel:1,maxLevel:7},{id:8018,minLevel:8,maxLevel:15},{id:8019,minLevel:16,maxLevel:23},{id:10399,minLevel:24,maxLevel:33},{id:16314,minLevel:34,maxLevel:43},{id:16315,minLevel:44,maxLevel:53},{id:16316,minLevel:54}]),value:Js.RockbiterWeapon,showWhen:t=>{if(!t.isClass(F.ClassShaman))return!1;const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),Nu=e=>({actionId:e=>e.getMatchingSpellActionId([{id:8024,minLevel:10,maxLevel:17},{id:8027,minLevel:18,maxLevel:25},{id:8030,minLevel:26,maxLevel:35},{id:16339,minLevel:36,maxLevel:45},{id:16341,minLevel:46,maxLevel:55},{id:16342,minLevel:56}]),value:Js.FlametongueWeapon,showWhen:t=>{if(!t.isClass(F.ClassShaman))return!1;const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),Au=e=>({actionId:e=>e.getMatchingSpellActionId([{id:8033,minLevel:20,maxLevel:27},{id:8038,minLevel:28,maxLevel:37},{id:10456,minLevel:38,maxLevel:47},{id:16355,minLevel:48,maxLevel:57},{id:16356,minLevel:58}]),value:Js.FrostbrandWeapon,showWhen:t=>{if(!t.isClass(F.ClassShaman))return!1;const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),Ru=e=>({actionId:e=>e.getMatchingSpellActionId([{id:8232,minLevel:30,maxLevel:39},{id:8235,minLevel:40,maxLevel:49},{id:10486,minLevel:50,maxLevel:59},{id:16362,minLevel:60}]),value:Js.WindfuryWeapon,showWhen:t=>{if(!t.isClass(F.ClassShaman))return!1;const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}});function _u(e){return(t,s)=>({type:"iconEnum",tooltip:s,numColumns:e.numColumns?e.numColumns:t.length>11?4:t.length>8?3:t.length>5?2:1,values:[{value:0}].concat(t.map((e=>({actionId:e.config.actionId,value:e.config.value,showWhen:t=>!e.config.showWhen||e.config.showWhen(t)})))),equals:(e,t)=>e==t,zeroValue:0,changedEvent:e=>m.onAny([e.consumesChangeEmitter,e.levelChangeEmitter,e.gearChangeEmitter,e.professionChangeEmitter]),showWhen:t=>!e.showWhen||e.showWhen(t),getValue:t=>t.getConsumes()[e.consumesFieldName],setValue:(t,s,i)=>{const a=s.getConsumes();a[e.consumesFieldName]!==i&&(a[e.consumesFieldName]=i,m.freezeAllAndDo((()=>{s.setConsumes(t,a),e.onSet&&e.onSet(t,s,i)})))}})}const Du=e=>(t,s,i,a)=>{const n={...e,values:a.map((e=>e.config))};return new Am(t,s,n,i)},Mu={actionId:e=>e.getMatchingItemActionId([{id:5509,minLevel:24}]),value:Ys.ConjuredHealthstone},Vu={actionId:e=>e.getMatchingItemActionId([{id:5510,minLevel:36}]),value:Ys.ConjuredGreaterHealthstone},Uu={actionId:e=>e.getMatchingItemActionId([{id:9421,minLevel:48}]),value:Ys.ConjuredMajorHealthstone},Wu={actionId:()=>C.fromItemId(4381),value:Ys.ConjuredMinorRecombobulator,showWhen:e=>e.getGear().hasTrinket(4381)},Fu={actionId:e=>e.getMatchingItemActionId([{id:12662,minLevel:40}]),value:Ys.ConjuredDemonicRune},Ou={actionId:e=>e.getMatchingItemActionId([{id:7676,minLevel:25}]),value:Ys.ConjuredRogueThistleTea,showWhen:e=>e.getClass()==F.ClassRogue},Hu=[{config:Uu,stats:[t.StatArmor]},{config:Vu,stats:[t.StatArmor]},{config:Mu,stats:[t.StatArmor]},{config:Fu,stats:[t.StatIntellect]},{config:Wu,stats:[t.StatIntellect]},{config:Ou,stats:[]}],qu=_u({consumesFieldName:"defaultConjured"}),Bu={actionId:e=>e.getMatchingItemActionId([{id:217308,minLevel:40}]),value:Qs.InnovationSigil,showWhen:e=>e.hasProfession(G.Enchanting)},zu={actionId:e=>e.getMatchingItemActionId([{id:221028,minLevel:50}]),value:Qs.LivingDreamsSigil,showWhen:e=>e.hasProfession(G.Enchanting)},ju={actionId:e=>e.getMatchingItemActionId([{id:228978,minLevel:50}]),value:Qs.FlowingWatersSigil},$u=[{config:{actionId:e=>e.getMatchingItemActionId([{id:233995,minLevel:50}]),value:Qs.WrathOfTheStormSigil},stats:[]},{config:ju,stats:[]},{config:zu,stats:[]},{config:Bu,stats:[]}],Gu=_u({consumesFieldName:"enchantedSigil"}),Ku={actionId:e=>e.getMatchingItemActionId([{id:10646,minLevel:50}]),showWhen:e=>e.hasProfession(G.Engineering),value:Xs.SapperGoblinSapper},Ju={actionId:e=>e.getMatchingItemActionId([{id:233985,minLevel:60}]),value:Xs.SapperFumigator},Zu={actionId:()=>C.fromItemId(13180),value:ei.ExplosiveStratholmeHolyWater},Yu={actionId:e=>e.getMatchingItemActionId([{id:233986,minLevel:60}]),value:ei.ExplosiveObsidianBomb},Qu={actionId:e=>e.getMatchingItemActionId([{id:10507,minLevel:40}]),showWhen:e=>e.hasProfession(G.Engineering),value:ei.ExplosiveSolidDynamite},Xu={actionId:e=>e.getMatchingItemActionId([{id:4395,minLevel:40}]),showWhen:e=>e.hasProfession(G.Engineering),value:ei.ExplosiveGoblinLandMine},ep={actionId:e=>e.getMatchingItemActionId([{id:18641,minLevel:50}]),showWhen:e=>e.hasProfession(G.Engineering),value:ei.ExplosiveDenseDynamite},tp={actionId:e=>e.getMatchingItemActionId([{id:15993,minLevel:50}]),showWhen:e=>e.hasProfession(G.Engineering),value:ei.ExplosiveThoriumGrenade},sp=[{config:Zu,stats:[]},{config:Yu,stats:[]},{config:{actionId:e=>e.getMatchingItemActionId([{id:215168,minLevel:40}]),value:ei.ExplosiveEzThroRadiationBomb},stats:[]},{config:{actionId:e=>e.getMatchingItemActionId([{id:215127,minLevel:40}]),showWhen:e=>e.hasProfession(G.Engineering),value:ei.ExplosiveHighYieldRadiationBomb},stats:[]},{config:Qu,stats:[]},{config:ep,stats:[]},{config:tp,stats:[]},{config:Xu,stats:[]}],ip=[{config:Ju,stats:[]},{config:Ku,stats:[]}],ap=_u({consumesFieldName:"fillerExplosive"}),np=_u({consumesFieldName:"sapperExplosive"}),op={actionId:e=>e.getMatchingItemActionId([{id:13510,minLevel:51}]),value:ti.FlaskOfTheTitans},lp={actionId:e=>e.getMatchingItemActionId([{id:233965,minLevel:60}]),value:ti.FlaskOfTheOldGods},rp={actionId:e=>e.getMatchingItemActionId([{id:233966,minLevel:60}]),value:ti.FlaskOfUnyieldingSorrow},cp={actionId:e=>e.getMatchingItemActionId([{id:233964,minLevel:60}]),value:ti.FlaskOfAncientKnowledge},dp={actionId:e=>e.getMatchingItemActionId([{id:13511,minLevel:51}]),value:ti.FlaskOfDistilledWisdom},mp={actionId:e=>e.getMatchingItemActionId([{id:233962,minLevel:60}]),value:ti.FlaskOfMadness},hp={actionId:e=>e.getMatchingItemActionId([{id:13512,minLevel:51}]),value:ti.FlaskOfSupremePower},up={actionId:e=>e.getMatchingItemActionId([{id:13513,minLevel:51}]),value:ti.FlaskOfChromaticResistance},pp={actionId:e=>e.getMatchingItemActionId([{id:222952,minLevel:50,maxLevel:59}]),value:ti.FlaskOfRestlessDreams,showWhen:e=>e.hasProfession(G.Alchemy)},gp={actionId:e=>e.getMatchingItemActionId([{id:221024,minLevel:50,maxLevel:59}]),value:ti.FlaskOfEverlastingNightmares,showWhen:e=>e.hasProfession(G.Alchemy)},fp=[{config:op,stats:[t.StatStamina]},{config:lp,stats:[t.StatStamina]},{config:mp,stats:[t.StatAttackPower]},{config:dp,stats:[t.StatIntellect]},{config:rp,stats:[t.StatIntellect]},{config:hp,stats:[t.StatMP5,t.StatSpellPower,t.StatSpellDamage]},{config:cp,stats:[t.StatMP5,t.StatSpellPower,t.StatSpellDamage]},{config:up,stats:[]},{config:pp,stats:[t.StatSpellPower,t.StatSpellDamage]},{config:gp,stats:[t.StatAttackPower]}],Ip=_u({consumesFieldName:"flask"}),wp={actionId:e=>e.getMatchingItemActionId([{id:238637,minLevel:55}]),value:si.FoodProwlerSteak},vp={actionId:e=>e.getMatchingItemActionId([{id:238638,minLevel:55}]),value:si.FoodFiletOFlank},bp={actionId:e=>e.getMatchingItemActionId([{id:238639,minLevel:55}]),value:si.FoodSunriseOmelette},Sp={actionId:e=>e.getMatchingItemActionId([{id:238641,minLevel:55}]),value:si.FoodSpecklefinFeast},xp={actionId:e=>e.getMatchingItemActionId([{id:238642,minLevel:55}]),value:si.FoodGrandLobsterBanquet},yp={actionId:e=>e.getMatchingItemActionId([{id:232436,minLevel:45}]),value:si.FoodDarkclawBisque},Ep={actionId:e=>e.getMatchingItemActionId([{id:232438,minLevel:45}]),value:si.FoodSmokedRedgill},Pp={actionId:e=>e.getMatchingItemActionId([{id:21023,minLevel:55}]),value:si.FoodDirgesKickChimaerokChops},kp={actionId:e=>e.getMatchingItemActionId([{id:13928,minLevel:50}]),value:si.FoodGrilledSquid},Cp={actionId:e=>e.getMatchingItemActionId([{id:20452,minLevel:50}]),value:si.FoodSmokedDesertDumpling},Lp={actionId:e=>e.getMatchingItemActionId([{id:18254,minLevel:45}]),value:si.FoodRunnTumTuberSurprise},Tp={actionId:e=>e.getMatchingItemActionId([{id:13810,minLevel:45}]),value:si.FoodBlessSunfruit},Np={actionId:e=>e.getMatchingItemActionId([{id:13813,minLevel:45}]),value:si.FoodBlessedSunfruitJuice},Ap={actionId:e=>e.getMatchingItemActionId([{id:13931,minLevel:35}]),value:si.FoodNightfinSoup},Rp={actionId:e=>e.getMatchingItemActionId([{id:18045,minLevel:40}]),value:si.FoodTenderWolfSteak},_p={actionId:e=>e.getMatchingItemActionId([{id:21217,minLevel:30}]),value:si.FoodSagefishDelight},Dp={actionId:e=>e.getMatchingItemActionId([{id:13851,minLevel:25}]),value:si.FoodHotWolfRibs},Mp={actionId:e=>e.getMatchingItemActionId([{id:21072,minLevel:10}]),value:si.FoodSmokedSagefish},Vp=[{config:bp,stats:[t.StatSpellPower,t.StatHealingPower,t.StatStamina]},{config:wp,stats:[t.StatStrength,t.StatStamina]},{config:vp,stats:[t.StatAgility,t.StatStamina]},{config:Sp,stats:[t.StatAttackPower,t.StatSpellPower,t.StatHealingPower,t.StatStamina]},{config:xp,stats:[t.StatAttackPower,t.StatSpellPower,t.StatHealingPower,t.StatStamina]},{config:yp,stats:[t.StatSpellDamage]},{config:Ep,stats:[t.StatHealingPower]},{config:Pp,stats:[t.StatStamina]},{config:kp,stats:[t.StatAgility]},{config:Cp,stats:[t.StatStrength]},{config:Lp,stats:[t.StatIntellect]},{config:Tp,stats:[t.StatStrength]},{config:Np,stats:[t.StatSpirit]},{config:Ap,stats:[t.StatMP5]},{config:Rp,stats:[t.StatStamina,t.StatSpirit]},{config:_p,stats:[t.StatMP5]},{config:Dp,stats:[t.StatSpirit]},{config:Mp,stats:[t.StatMP5]}],Up=_u({consumesFieldName:"food"}),Wp=Rd({actionId:e=>e.getMatchingItemActionId([{id:12217,minLevel:35}]),fieldName:"dragonBreathChili"}),Fp={actionId:e=>e.getMatchingItemActionId([{id:21151,minLevel:1}]),value:ii.AlcoholRumseyRumBlackLabel},Op={actionId:e=>e.getMatchingItemActionId([{id:18269,minLevel:56}]),value:ii.AlcoholGordokGreenGrog},Hp={actionId:e=>e.getMatchingItemActionId([{id:21114,minLevel:1}]),value:ii.AlcoholRumseyRumDark},qp={actionId:e=>e.getMatchingItemActionId([{id:20709,minLevel:1}]),value:ii.AlcoholRumseyRumLight},Bp={actionId:e=>e.getMatchingItemActionId([{id:18284,minLevel:56}]),value:ii.AlcoholKreegsStoutBeatdown},zp=[{config:Fp,stats:[t.StatStamina]},{config:Op,stats:[t.StatStamina]},{config:Hp,stats:[t.StatStamina]},{config:qp,stats:[t.StatStamina]},{config:Bp,stats:[t.StatSpirit]}],jp=_u({consumesFieldName:"alcohol"}),$p={actionId:e=>e.getMatchingItemActionId([{id:233969,minLevel:60}]),value:ai.ElixirOfTheIronside},Gp={actionId:e=>e.getMatchingItemActionId([{id:13445,minLevel:43}]),value:ai.ElixirOfSuperiorDefense},Kp={actionId:e=>e.getMatchingItemActionId([{id:8951,minLevel:29}]),value:ai.ElixirOfGreaterDefense},Jp={actionId:e=>e.getMatchingItemActionId([{id:3389,minLevel:16}]),value:ai.ElixirOfDefense},Zp={actionId:e=>e.getMatchingItemActionId([{id:5997,minLevel:1}]),value:ai.ElixirOfMinorDefense},Yp={actionId:e=>e.getMatchingItemActionId([{id:3013,minLevel:1,maxLevel:14},{id:1478,minLevel:15,maxLevel:29},{id:4421,minLevel:30,maxLevel:44},{id:10305,minLevel:45}]),value:ai.ScrollOfProtection},Qp=[{config:$p,stats:[t.StatArmor]},{config:Gp,stats:[t.StatArmor]},{config:Kp,stats:[t.StatArmor]},{config:Jp,stats:[t.StatArmor]},{config:Zp,stats:[t.StatArmor]},{config:Yp,stats:[t.StatArmor]}],Xp=_u({consumesFieldName:"armorElixir"}),eg={actionId:e=>e.getMatchingItemActionId([{id:3825,minLevel:25}]),value:ni.ElixirOfFortitude},tg={actionId:e=>e.getMatchingItemActionId([{id:2458,minLevel:2}]),value:ni.ElixirOfMinorFortitude},sg=[{config:eg,stats:[t.StatStamina]},{config:tg,stats:[t.StatStamina]}],ig=_u({consumesFieldName:"healthElixir"}),ag={actionId:e=>e.getMatchingItemActionId([{id:12460,minLevel:55}]),value:oi.JujuMight},ng={actionId:e=>e.getMatchingItemActionId([{id:12820,minLevel:45}]),value:oi.WinterfallFirewater},og=[{config:ag,stats:[t.StatAttackPower]},{config:ng,stats:[t.StatAttackPower]}],lg=_u({consumesFieldName:"attackPowerBuff"}),rg={actionId:e=>e.getMatchingItemActionId([{id:233967,minLevel:60}]),value:li.ElixirOfTheHoneyBadger},cg={actionId:e=>e.getMatchingItemActionId([{id:13452,minLevel:46}]),value:li.ElixirOfTheMongoose},dg={actionId:e=>e.getMatchingItemActionId([{id:9187,minLevel:38}]),value:li.ElixirOfGreaterAgility},mg={actionId:e=>e.getMatchingItemActionId([{id:8949,minLevel:27}]),value:li.ElixirOfAgility},hg={actionId:e=>e.getMatchingItemActionId([{id:3390,minLevel:18}]),value:li.ElixirOfLesserAgility},ug={actionId:e=>e.getMatchingItemActionId([{id:3012,minLevel:10,maxLevel:24},{id:1477,minLevel:25,maxLevel:39},{id:4425,minLevel:40,maxLevel:54},{id:10309,minLevel:55}]),value:li.ScrollOfAgility},pg=[{config:rg,stats:[t.StatAgility,t.StatMeleeCrit]},{config:cg,stats:[t.StatAgility,t.StatMeleeCrit]},{config:dg,stats:[t.StatAgility]},{config:mg,stats:[t.StatAgility]},{config:hg,stats:[t.StatAgility]},{config:ug,stats:[t.StatAgility]}],gg=_u({consumesFieldName:"agilityElixir"}),fg={actionId:e=>e.getMatchingItemActionId([{id:12451,minLevel:55}]),value:ri.JujuPower},Ig={actionId:e=>e.getMatchingItemActionId([{id:9206,minLevel:46}]),value:ri.ElixirOfGiants},wg={actionId:e=>e.getMatchingItemActionId([{id:3391,minLevel:20}]),value:ri.ElixirOfOgresStrength},vg={actionId:e=>e.getMatchingItemActionId([{id:954,minLevel:10,maxLevel:24},{id:2289,minLevel:25,maxLevel:39},{id:4426,minLevel:40,maxLevel:54},{id:10310,minLevel:55}]),value:ri.ScrollOfStrength},bg=[{config:fg,stats:[t.StatStrength]},{config:Ig,stats:[t.StatStrength]},{config:wg,stats:[t.StatStrength]},{config:vg,stats:[t.StatStrength]}],Sg=_u({consumesFieldName:"strengthBuff"}),xg=[{config:{actionId:()=>C.fromItemId(236364),value:ci.SealOfTheDawnDamageR10},stats:[]},{config:{actionId:()=>C.fromItemId(236363),value:ci.SealOfTheDawnDamageR9},stats:[]},{config:{actionId:()=>C.fromItemId(236362),value:ci.SealOfTheDawnDamageR8},stats:[]},{config:{actionId:()=>C.fromItemId(236361),value:ci.SealOfTheDawnDamageR7},stats:[]},{config:{actionId:()=>C.fromItemId(236360),value:ci.SealOfTheDawnDamageR6},stats:[]},{config:{actionId:()=>C.fromItemId(236358),value:ci.SealOfTheDawnDamageR5},stats:[]},{config:{actionId:()=>C.fromItemId(236357),value:ci.SealOfTheDawnDamageR4},stats:[]},{config:{actionId:()=>C.fromItemId(236356),value:ci.SealOfTheDawnDamageR3},stats:[]},{config:{actionId:()=>C.fromItemId(236355),value:ci.SealOfTheDawnDamageR2},stats:[]},{config:{actionId:()=>C.fromItemId(236354),value:ci.SealOfTheDawnDamageR1},stats:[]},{config:{actionId:()=>C.fromItemId(236386),value:ci.SealOfTheDawnTankR10},stats:[t.StatDefense]},{config:{actionId:()=>C.fromItemId(236388),value:ci.SealOfTheDawnTankR9},stats:[t.StatDefense]},{config:{actionId:()=>C.fromItemId(236389),value:ci.SealOfTheDawnTankR8},stats:[t.StatDefense]},{config:{actionId:()=>C.fromItemId(236390),value:ci.SealOfTheDawnTankR7},stats:[t.StatDefense]},{config:{actionId:()=>C.fromItemId(236391),value:ci.SealOfTheDawnTankR6},stats:[t.StatDefense]},{config:{actionId:()=>C.fromItemId(236392),value:ci.SealOfTheDawnTankR5},stats:[t.StatDefense]},{config:{actionId:()=>C.fromItemId(236393),value:ci.SealOfTheDawnTankR4},stats:[t.StatDefense]},{config:{actionId:()=>C.fromItemId(236394),value:ci.SealOfTheDawnTankR3},stats:[t.StatDefense]},{config:{actionId:()=>C.fromItemId(236395),value:ci.SealOfTheDawnTankR2},stats:[t.StatDefense]},{config:{actionId:()=>C.fromItemId(236396),value:ci.SealOfTheDawnTankR1},stats:[t.StatDefense]}],yg=_u({consumesFieldName:"sealOfTheDawn",numColumns:11,showWhen:e=>60===e.getLevel()}),Eg={actionId:e=>e.getMatchingItemActionId([{id:8410,minLevel:45}]),value:di.ROIDS},Pg={actionId:e=>e.getMatchingItemActionId([{id:8412,minLevel:45}]),value:di.GroundScorpokAssay},kg={actionId:e=>e.getMatchingItemActionId([{id:8411,minLevel:45}]),value:di.LungJuiceCocktail},Cg={actionId:e=>e.getMatchingItemActionId([{id:8423,minLevel:45}]),value:di.CerebralCortexCompound},Lg={actionId:e=>e.getMatchingItemActionId([{id:8424,minLevel:45}]),value:di.GizzardGum},Tg={actionId:e=>e.getMatchingItemActionId([{id:20079,minLevel:55}]),value:di.SpiritOfZanza},Ng={actionId:()=>C.fromItemId(221196),value:di.AtalaiMojoOfWar,showWhen:e=>50==e.getLevel()},Ag={actionId:()=>C.fromItemId(221030),value:di.AtalaiMojoOfForbiddenMagic,showWhen:e=>50==e.getLevel()},Rg={actionId:()=>C.fromItemId(221311),value:di.AtalaiMojoOfLife,showWhen:e=>50==e.getLevel()},_g=[{config:Tg,stats:[t.StatStamina,t.StatSpirit]},{config:Eg,stats:[t.StatStrength]},{config:Pg,stats:[t.StatAgility]},{config:kg,stats:[t.StatStamina]},{config:Cg,stats:[t.StatIntellect]},{config:Lg,stats:[t.StatSpirit]},{config:Ng,stats:[t.StatAttackPower]},{config:Ag,stats:[t.StatSpellPower,t.StatSpellDamage]},{config:Rg,stats:[t.StatHealingPower]}],Dg=_u({consumesFieldName:"zanzaBuff"}),Mg=_d({actionId:e=>e.getMatchingItemActionId([{id:e.getClass()===F.ClassHunter?235497:235825,minLevel:55}]),fieldName:"draughtOfTheSands",showWhen:e=>e.getClass()===F.ClassHunter||e.getClass()===F.ClassRogue}),Vg=_d({actionId:e=>e.getMatchingItemActionId([{id:213407,minLevel:20}]),fieldName:"catnip",showWhen:e=>e.getClass()===F.ClassDruid}),Ug=_d({actionId:()=>C.fromItemId(12450),fieldName:"jujuFlurry",showWhen:e=>e.getLevel()>=55}),Wg=_d({actionId:()=>C.fromItemId(5342),fieldName:"raptorPunch"}),Fg=_d({actionId:()=>C.fromItemId(210708),fieldName:"elixirOfCoalescedRegret"}),Og=_d({actionId:()=>C.fromItemId(5206),fieldName:"boglingRoot"}),Hg=[{config:Mg,picker:rd,stats:[]},{config:Vg,picker:rd,stats:[]},{config:Ug,picker:rd,stats:[t.StatAttackPower]},{config:Wg,picker:rd,stats:[t.StatIntellect]},{config:Fg,picker:rd,stats:[]},{config:Og,picker:rd,stats:[t.StatAttackPower]}],qg=Du({direction:ld.Vertical,tooltip:"Misc Offensive"}),Bg=_d({actionId:()=>C.fromItemId(23196),fieldName:"greaterMarkOfTheDawn",showWhen:e=>e.getLevel()>=60}),zg=_d({actionId:()=>C.fromItemId(12455),fieldName:"jujuEmber",showWhen:e=>e.getLevel()>=55}),jg=_d({actionId:()=>C.fromItemId(12457),fieldName:"jujuChill",showWhen:e=>e.getLevel()>=55}),$g=_d({actionId:()=>C.fromItemId(12459),fieldName:"jujuEscape",showWhen:e=>e.getLevel()>=55}),Gg=[{config:Bg,picker:rd,stats:[]},{config:zg,picker:rd,stats:[]},{config:jg,picker:rd,stats:[]},{config:$g,picker:rd,stats:[t.StatDodge]}],Kg=Du({direction:ld.Vertical,tooltip:"Misc Defensive"}),Jg=[{config:{actionId:()=>C.fromItemId(211953),value:mi.MageScrollArcaneRecovery,showWhen:e=>e.isClass(F.ClassMage)},stats:[]},{config:{actionId:()=>C.fromItemId(211954),value:mi.MageScrollArcaneAccuracy,showWhen:e=>e.isClass(F.ClassMage)},stats:[]},{config:{actionId:()=>C.fromItemId(211957),value:mi.MageScrollArcanePower,showWhen:e=>e.isClass(F.ClassMage)},stats:[]},{config:{actionId:()=>C.fromItemId(211955),value:mi.MageScrollFireProtection,showWhen:e=>e.isClass(F.ClassMage)},stats:[]},{config:{actionId:()=>C.fromItemId(211956),value:mi.MageScrollFrostProtection,showWhen:e=>e.isClass(F.ClassMage)},stats:[]}],Zg=_u({consumesFieldName:"mageScroll"}),Yg=Hd({direction:ld.Vertical,values:[{value:0,tooltip:"None"},{actionId:()=>C.fromItemId(12460),value:1,showWhen:e=>e.getLevel()>=55}],fieldName:"petAttackPowerConsumable"}),Qg=Hd({direction:ld.Vertical,values:[{value:0,tooltip:"None"},{actionId:()=>C.fromItemId(10309),value:1,showWhen:e=>e.getLevel()>=55},{actionId:()=>C.fromItemId(4425),value:2,showWhen:e=>e.getLevel()>=40},{actionId:()=>C.fromItemId(1477),value:3,showWhen:e=>e.getLevel()>=25},{actionId:()=>C.fromItemId(3012),value:4,showWhen:e=>e.getLevel()>=10}],fieldName:"petAgilityConsumable"}),Xg=Hd({direction:ld.Vertical,values:[{value:0,tooltip:"None"},{actionId:()=>C.fromItemId(12451),value:1,showWhen:e=>e.getLevel()>=55},{actionId:()=>C.fromItemId(10310),value:2,showWhen:e=>e.getLevel()>=55},{actionId:()=>C.fromItemId(4426),value:3,showWhen:e=>e.getLevel()>=40},{actionId:()=>C.fromItemId(2289),value:4,showWhen:e=>e.getLevel()>=25},{actionId:()=>C.fromItemId(954),value:5,showWhen:e=>e.getLevel()>=10}],fieldName:"petStrengthConsumable"});var ef;Sd({getModObject:e=>e,showWhen:e=>!ef.showWhen||ef.showWhen(e),getValue:e=>e.getConsumes().petMiscConsumes??Pe.create(),setValue:(e,t,s)=>{const i=t.getConsumes();i.petMiscConsumes=s,t.setConsumes(e,i)},changeEmitter:e=>m.onAny([e.consumesChangeEmitter,e.levelChangeEmitter,e.professionChangeEmitter])},(ef={actionId:()=>C.fromItemId(12450),fieldName:"jujuFlurry",showWhen:e=>e.getLevel()>=55}).actionId,ef.fieldName,ef.value),Du({direction:ld.Vertical,tooltip:"Misc Pet Consumes"});const tf={actionId:e=>e.getMatchingItemActionId([{id:1710,minLevel:21}]),value:hi.GreaterHealingPotion},sf={actionId:e=>e.getMatchingItemActionId([{id:3928,minLevel:35}]),value:hi.SuperiorHealingPotion},af={actionId:e=>e.getMatchingItemActionId([{id:13446,minLevel:45}]),value:hi.MajorHealingPotion},nf={actionId:e=>e.getMatchingItemActionId([{id:3827,minLevel:22}]),value:hi.ManaPotion},of={actionId:e=>e.getMatchingItemActionId([{id:6149,minLevel:31}]),value:hi.GreaterManaPotion},lf={actionId:e=>e.getMatchingItemActionId([{id:13443,minLevel:41}]),value:hi.SuperiorManaPotion},rf={actionId:e=>e.getMatchingItemActionId([{id:13444,minLevel:49}]),value:hi.MajorManaPotion},cf={actionId:e=>e.getMatchingItemActionId([{id:13442,minLevel:46}]),value:hi.MightyRagePotion,showWhen:e=>e.getClass()==F.ClassWarrior},df={actionId:e=>e.getMatchingItemActionId([{id:5633,minLevel:25}]),value:hi.GreatRagePotion,showWhen:e=>e.getClass()==F.ClassWarrior},mf={actionId:e=>e.getMatchingItemActionId([{id:5631,minLevel:4}]),value:hi.RagePotion,showWhen:e=>e.getClass()==F.ClassWarrior};hi.MagicResistancePotion;const hf={actionId:e=>e.getMatchingItemActionId([{id:13455,minLevel:46}]),value:hi.GreaterStoneshieldPotion},uf={actionId:e=>e.getMatchingItemActionId([{id:4623,minLevel:33}]),value:hi.LesserStoneshieldPotion},pf=[{config:af,stats:[t.StatArmor]},{config:sf,stats:[t.StatArmor]},{config:tf,stats:[t.StatArmor]},{config:rf,stats:[t.StatIntellect]},{config:lf,stats:[t.StatIntellect]},{config:of,stats:[t.StatIntellect]},{config:nf,stats:[t.StatIntellect]},{config:cf,stats:[]},{config:df,stats:[]},{config:mf,stats:[]},{config:hf,stats:[t.StatArmor]},{config:uf,stats:[t.StatArmor]}],gf=_u({consumesFieldName:"defaultPotion"}),ff=Rd({actionId:e=>e.getMatchingItemActionId([{id:215162,minLevel:35}]),fieldName:"mildlyIrradiatedRejuvPot"}),If={actionId:e=>e.getMatchingItemActionId([{id:233968,minLevel:60}]),value:ui.ElixirOfTheMageLord},wf={actionId:e=>e.getMatchingItemActionId([{id:13454,minLevel:46}]),value:ui.GreaterArcaneElixir},vf={actionId:e=>e.getMatchingItemActionId([{id:9155,minLevel:37}]),value:ui.ArcaneElixir},bf={actionId:e=>e.getMatchingItemActionId([{id:217398,minLevel:28}]),value:ui.LesserArcaneElixir},Sf=[{config:If,stats:[t.StatSpellPower,t.StatSpellDamage]},{config:wf,stats:[t.StatSpellPower,t.StatSpellDamage]},{config:vf,stats:[t.StatSpellPower,t.StatSpellDamage]},{config:bf,stats:[t.StatSpellPower,t.StatSpellDamage]}],xf=_u({consumesFieldName:"spellPowerBuff"}),yf={actionId:e=>e.getMatchingItemActionId([{id:21546,minLevel:51}]),value:pi.ElixirOfGreaterFirepower},Ef={actionId:e=>e.getMatchingItemActionId([{id:6373,minLevel:18}]),value:pi.ElixirOfFirepower},Pf=[{config:yf,stats:[t.StatFirePower]},{config:Ef,stats:[t.StatFirePower]}],kf=_u({consumesFieldName:"firePowerBuff"}),Cf=[{config:{actionId:e=>e.getMatchingItemActionId([{id:17708,minLevel:40}]),value:gi.ElixirOfFrostPower},stats:[t.StatFrostPower]}],Lf=_u({consumesFieldName:"frostPowerBuff"}),Tf=[{config:{actionId:e=>e.getMatchingItemActionId([{id:9264,minLevel:40}]),value:fi.ElixirOfShadowPower},stats:[t.StatShadowPower]}],Nf=_u({consumesFieldName:"shadowPowerBuff"}),Af=[{config:{actionId:e=>e.getMatchingItemActionId([{id:20007,minLevel:40}]),value:Ii.MagebloodPotion},stats:[t.StatMP5]}],Rf=_u({consumesFieldName:"manaRegenElixir"}),_f={actionId:e=>e.getMatchingSpellActionId([{id:8512,minLevel:32,maxLevel:41},{id:10613,minLevel:42,maxLevel:51},{id:10614,minLevel:52}]),value:Js.Windfury},Df={actionId:()=>C.fromSpellId(407975),value:Js.WildStrikes},Mf=e=>({actionId:e=>e.getMatchingItemActionId([{id:238234,minLevel:50}]),value:Js.BlessedWizardOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||s.item.weaponType!==p.WeaponTypeOffHand}}),Vf=e=>({actionId:e=>e.getMatchingItemActionId([{id:233996,minLevel:60}]),value:Js.EnchantedRepellent,showWhen:t=>{const s=t.getEquippedItem(e);return!s||s.item.weaponType!==p.WeaponTypeOffHand}}),Uf=e=>({actionId:e=>e.getMatchingItemActionId([{id:20749,minLevel:45}]),value:Js.BrilliantWizardOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),Wf=e=>({actionId:e=>e.getMatchingItemActionId([{id:20750,minLevel:40}]),value:Js.WizardOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),Ff=e=>({actionId:e=>e.getMatchingItemActionId([{id:20746,minLevel:30}]),value:Js.LesserWizardOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),Of=e=>({actionId:e=>e.getMatchingItemActionId([{id:20744,minLevel:5}]),value:Js.MinorWizardOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),Hf=e=>({actionId:e=>e.getMatchingItemActionId([{id:20748,minLevel:45}]),value:Js.BrilliantManaOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),qf=e=>({actionId:e=>e.getMatchingItemActionId([{id:20747,minLevel:40}]),value:Js.LesserManaOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),Bf=e=>({actionId:e=>e.getMatchingItemActionId([{id:20745,minLevel:20}]),value:Js.MinorManaOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),zf=e=>({actionId:e=>e.getMatchingItemActionId([{id:211848,minLevel:25}]),value:Js.BlackfathomManaOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),jf=e=>({actionId:e=>e.getMatchingItemActionId([{id:238241,minLevel:50}]),value:Js.ConsecratedSharpeningStone,showWhen:t=>{const s=t.getEquippedItem(e);return!s||s.item.weaponType!==p.WeaponTypeOffHand}}),$f=e=>({actionId:e=>e.getMatchingItemActionId([{id:237810,minLevel:50}]),value:Js.WeightedConsecratedSharpeningStone,showWhen:t=>t.getEquippedItem(e)?.item.handType===wi.HandTypeTwoHand}),Gf=e=>({actionId:e=>e.getMatchingItemActionId([{id:18262,minLevel:50}]),value:Js.ElementalSharpeningStone,showWhen:t=>{const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),Kf=e=>({actionId:e=>e.getMatchingItemActionId([{id:12404,minLevel:35}]),value:Js.DenseSharpeningStone,showWhen:t=>{const s=t.getEquippedItem(e);return!s||vi(s.item.weaponType)}}),Jf=e=>({actionId:e=>e.getMatchingItemActionId([{id:7964,minLevel:35}]),value:Js.SolidSharpeningStone,showWhen:t=>{const s=t.getEquippedItem(e);return!s||vi(s.item.weaponType)}}),Zf=e=>({actionId:()=>C.fromItemId(211845),value:Js.BlackfathomSharpeningStone,showWhen:t=>{const s=t.getEquippedItem(e);return!s||vi(s.item.weaponType)}}),Yf=e=>({actionId:e=>e.getMatchingItemActionId([{id:12643,minLevel:35}]),value:Js.DenseWeightstone,showWhen:t=>{const s=t.getEquippedItem(e);return!s||bi(s.item.weaponType)}}),Qf=e=>({actionId:e=>e.getMatchingItemActionId([{id:7965,minLevel:35}]),value:Js.SolidWeightstone,showWhen:t=>{const s=t.getEquippedItem(e);return!s||bi(s.item.weaponType)}}),Xf=e=>({actionId:e=>e.getMatchingItemActionId([{id:3824,minLevel:25}]),value:Js.ShadowOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),eI=e=>({actionId:e=>e.getMatchingItemActionId([{id:3829,minLevel:40}]),value:Js.FrostOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||Zs(s.item.weaponType)}}),tI=e=>({actionId:e=>e.getMatchingItemActionId([{id:228980,minLevel:40}]),value:Js.ConductiveShieldCoating,showWhen:t=>e===h.ItemSlotOffHand&&t.getEquippedItem(h.ItemSlotOffHand)?.item?.weaponType===p.WeaponTypeShield}),sI=e=>({actionId:e=>e.getMatchingItemActionId([{id:232611,minLevel:45}]),value:Js.MagnificentTrollshine,showWhen:t=>e===h.ItemSlotOffHand&&t.getEquippedItem(h.ItemSlotOffHand)?.item?.weaponType===p.WeaponTypeShield}),iI=e=>[{config:Tu(e),stats:[]},{config:Nu(e),stats:[]},{config:Au(e),stats:[]},{config:Ru(e),stats:[]}],aI=[{config:xu,stats:[]},{config:yu,stats:[]},{config:Eu,stats:[]},{config:Pu,stats:[]},{config:ku,stats:[]},{config:Lu,stats:[]},{config:Cu,stats:[]}],nI=e=>[{config:Mf(e),stats:[t.StatSpellPower,t.StatSpellDamage]},{config:Vf(e),stats:[t.StatSpellPower,t.StatSpellDamage]},{config:sI(e),stats:[t.StatSpellPower,t.StatSpellDamage]},{config:tI(e),stats:[t.StatSpellPower,t.StatSpellDamage]},{config:Uf(e),stats:[t.StatSpellPower,t.StatSpellDamage]},{config:Wf(e),stats:[t.StatSpellPower,t.StatSpellDamage]},{config:Ff(e),stats:[t.StatSpellPower,t.StatSpellDamage]},{config:Of(e),stats:[t.StatSpellPower,t.StatSpellDamage]},{config:Hf(e),stats:[t.StatHealingPower,t.StatSpellPower,t.StatSpellDamage]},{config:qf(e),stats:[t.StatHealingPower,t.StatSpellPower,t.StatSpellDamage]},{config:Bf(e),stats:[t.StatHealingPower,t.StatSpellPower,t.StatSpellDamage]},{config:zf(e),stats:[t.StatSpellPower,t.StatSpellDamage,t.StatMP5]},{config:$f(e),stats:[t.StatAttackPower]},{config:jf(e),stats:[t.StatAttackPower]},{config:Gf(e),stats:[t.StatAttackPower]},{config:Kf(e),stats:[t.StatAttackPower]},{config:Jf(e),stats:[t.StatAttackPower]},{config:Zf(e),stats:[t.StatMeleeHit]},{config:Yf(e),stats:[t.StatAttackPower]},{config:Qf(e),stats:[t.StatAttackPower]},{config:Xf(e),stats:[t.StatAttackPower]},{config:eI(e),stats:[t.StatAttackPower]}],oI=[...aI,...iI(h.ItemSlotOffHand),...nI(h.ItemSlotOffHand)],lI=[...aI,...iI(h.ItemSlotMainHand),{config:_f,stats:[t.StatMeleeHit]},{config:Df,stats:[t.StatMeleeHit]},...nI(h.ItemSlotMainHand)],rI=_u({consumesFieldName:"mainHandImbue",showWhen:e=>!!e.getGear().getEquippedItem(h.ItemSlotMainHand)}),cI=_u({consumesFieldName:"offHandImbue",showWhen:e=>!!e.getGear().getEquippedItem(h.ItemSlotOffHand)});class dI extends o{constructor(e,t){super(e,"consumes-picker-root"),this.simUI=t,this.simUI.sim.waitForInit().then((()=>{this.buildPotionsPicker(),this.buildFlaskPicker(),this.buildWeaponImbuePicker(),this.buildFoodPicker(),this.buildPhysicalBuffPickers(),this.buildDefensiveBuffPickers(),this.buildSpellPowerBuffPickers(),this.buildMiscConsumesPickers(),this.buildEngPickers(),this.buildEnchPicker(),this.buildPetPicker()}))}buildPotionsPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Potions</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-potions"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-potions"),i=gf(cu(pf,this.simUI),"Potions"),a=qu(cu(Hu,this.simUI)),n=[Ld(s,this.simUI.player,i),Ld(s,this.simUI.player,a),Ld(s,this.simUI.player,ff)];m.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,n))),this.updateRow(t,n)}buildFlaskPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Flasks</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-flasks"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-flasks"),i=Ip(cu(fp,this.simUI)),a=[Ld(s,this.simUI.player,i)];m.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,a))),this.updateRow(t,a)}buildWeaponImbuePicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Weapon Imbues</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-weapon-imbues"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-weapon-imbues"),i=rI(cu(lI,this.simUI),"Main-Hand"),a=cI(cu(oI,this.simUI),"Off-Hand"),n=[Ld(s,this.simUI.player,i),Ld(s,this.simUI.player,a)];m.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.gearChangeEmitter]).on((()=>this.updateRow(t,n))),this.updateRow(t,n)}buildFoodPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Food</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-food"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-food"),i=Up(cu(Vp,this.simUI)),a=jp(cu(zp,this.simUI)),n=[Ld(s,this.simUI.player,i),Ld(s,this.simUI.player,Wp),Ld(s,this.simUI.player,a)];m.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,n))),this.updateRow(t,n)}buildPhysicalBuffPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Physical</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-physical"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-physical"),i=lg(cu(og,this.simUI),"Attack Power"),a=gg(cu(pg,this.simUI),"Agility"),n=Sg(cu(bg,this.simUI),"Strength"),o=[Ld(s,this.simUI.player,i),Ld(s,this.simUI.player,a),Ld(s,this.simUI.player,n)];m.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,o))),this.updateRow(t,o)}buildDefensiveBuffPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Defensive</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-defensive"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-defensive"),i=ig(cu(sg,this.simUI),"Health"),a=Xp(cu(Qp,this.simUI),"Armor"),n=[Ld(s,this.simUI.player,i),Ld(s,this.simUI.player,a)];m.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,n))),this.updateRow(t,n)}buildSpellPowerBuffPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Spells</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-spells"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-spells"),i=xf(cu(Sf,this.simUI),"Spell Damage"),a=kf(cu(Pf,this.simUI),"Fire Damage"),n=Lf(cu(Cf,this.simUI),"Frost Damage"),o=Nf(cu(Tf,this.simUI),"Shadow Damage"),l=Rf(cu(Af,this.simUI),"Mana Regen"),r=[Ld(s,this.simUI.player,i),Ld(s,this.simUI.player,a),Ld(s,this.simUI.player,n),Ld(s,this.simUI.player,o),Ld(s,this.simUI.player,l)];m.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,r))),this.updateRow(t,r)}buildMiscConsumesPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Miscellaneous</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-misc"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-misc"),i=yg(cu(xg,this.simUI),"Seal of the Dawn Buffs"),a=Dg(cu(_g,this.simUI),"Zanza Buffs"),n=Zg(Jg,"Mage Scrolls"),o=cu(Hg,this.simUI),l=cu(Gg,this.simUI),r=[Ld(s,this.simUI.player,i),Ld(s,this.simUI.player,a),Ld(s,this.simUI.player,n),qg(s,this.simUI.player,this.simUI,o),Kg(s,this.simUI.player,this.simUI,l)];m.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,r))),this.updateRow(t,r)}buildEngPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Engineering</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-engi"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-engi"),i=ap(cu(sp,this.simUI),"Explosives"),a=np(cu(ip,this.simUI),"Sappers"),n=[Ld(s,this.simUI.player,a),Ld(s,this.simUI.player,i)];m.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,n))),this.updateRow(t,n)}buildEnchPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Enchanting</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-ench">\n\t\t\t\t\t\t</div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-ench"),i=Gu(cu($u,this.simUI),"Enchanted Sigils"),a=[Ld(s,this.simUI.player,i)];m.onAny([this.simUI.player.levelChangeEmitter,this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,a))),this.updateRow(t,a)}buildPetPicker(){if(!this.simUI.individualConfig.petConsumeInputs?.length)return;const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Pet</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-pet"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-pet"),i=[...this.simUI.individualConfig.petConsumeInputs.map((e=>Ld(s,this.simUI.player,e)))];m.onAny([this.simUI.player.levelChangeEmitter]).on((()=>this.updateRow(t,i))),this.updateRow(t,i)}updateRow(e,t){t.find((e=>e?.showWhen()))?e.classList.remove("hide"):e.classList.add("hide")}}class mI extends jn{constructor(e,t){super(e,t,{identifier:"settings-tab",title:"Settings"}),this.column1=this.buildColumn(1,"settings-left-col"),this.column2=this.buildColumn(2,"settings-left-col"),this.column3=this.buildColumn(3,"settings-left-col"),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("settings-tab-left","tab-panel-left"),this.leftPanel.appendChild(this.column1),this.leftPanel.appendChild(this.column2),this.leftPanel.appendChild(this.column3),this.simUI.isWithinRaidSim&&(this.column4=this.buildColumn(4,"settings-left-col"),this.leftPanel.appendChild(this.column4)),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("settings-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.simUI.isWithinRaidSim||this.buildEncounterSettings(),this.simUI.sim.waitForInit().then((()=>{this.buildPlayerSettings(),this.buildCustomSettingsSections(),this.buildConsumesSection(),this.buildOtherSettings(),this.buildIsbSettings(),this.simUI.isWithinRaidSim||(this.buildBuffsSettings(),this.buildWorldBuffsSettings(),this.buildDebuffsSettings(),this.buildPresetConfigurationPicker(),this.buildSavedDataPickers())}))}buildEncounterSettings(){const e=new qn(this.column1,"encounter-settings",{header:{title:"Encounter"}});new xm(e.bodyElement,this.simUI.sim.encounter,this.simUI.individualConfig.encounterPicker,this.simUI)}buildPlayerSettings(){const t=new qn(this.column1,"player-settings",{header:{title:"Player"}}),s=d.newGroupContainer();s.classList.add("player-icon-group","icon-group"),t.bodyElement.appendChild(s),this.configureIconSection(s,this.simUI.individualConfig.playerIconInputs.map((e=>Ld(s,this.simUI.player,e))),!0),new od(t.bodyElement,this.simUI.player,{id:"player-level",label:"Level",values:Si.map((e=>({name:`Level ${e}`,value:e}))),changedEvent:e=>e.levelChangeEmitter,getValue:e=>e.getLevel(),setValue:(e,t,s)=>t.setLevel(e,s)});const i=xi[this.simUI.player.spec];new od(t.bodyElement,this.simUI.player,{id:"player-race",label:"Race",values:i.map((e=>({name:yi.get(e),value:e}))),changedEvent:e=>e.raceChangeEmitter,getValue:e=>e.getRace(),setValue:(e,t,s)=>t.setRace(e,s)}),this.simUI.individualConfig.playerInputs?.inputs.length&&this.configureInputSection(t.bodyElement,this.simUI.individualConfig.playerInputs);const a=d.newGroupContainer();t.bodyElement.appendChild(a);const n=e(G);new od(a,this.simUI.player,{id:"player-profession-1",label:"Profession 1",values:n.map((e=>({name:Ei.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession1(),setValue:(e,t,s)=>t.setProfession1(e,s)}),new od(a,this.simUI.player,{id:"player-profession-2",label:"Profession 2",values:n.map((e=>({name:Ei.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession2(),setValue:(e,t,s)=>t.setProfession2(e,s)})}buildCustomSettingsSections(){(this.simUI.individualConfig.customSections||[]).forEach((e=>{e(this.column2,this.simUI).rootElem.classList.add("custom-section")}))}buildConsumesSection(){const e=this.simUI.isWithinRaidSim?this.column3:this.column2,t=new qn(e,"consumes-settings",{header:{title:"Consumables"}});new dI(t.bodyElement,this.simUI)}buildOtherSettings(){const e=this.simUI.individualConfig.otherInputs?.inputs.filter((e=>!e.extraCssClasses||!e.extraCssClasses?.includes("within-raid-sim-hide"))),t=this.simUI.individualConfig.itemSwapSlots||[];if(e.length||t?.length){const s=new qn(this.column2,"other-settings",{header:{title:"Other"}});e.length&&(this.configureInputSection(s.bodyElement,this.simUI.individualConfig.otherInputs),s.bodyElement.querySelectorAll(".input-root").forEach((e=>{e.classList.add("input-inline")}))),t.length>0&&new OI(s.bodyElement,this.simUI,this.simUI.player,{itemSlots:t})}}buildIsbSettings(){if(!this.simUI.isWithinRaidSim){const e=new qn(this.column1,"other-settings",{header:{title:"Improved Shadow Bolt"}});this.configureInputSection(e.bodyElement,pu),m.onAny([this.simUI.player.talentsChangeEmitter,this.simUI.player.getRaid().debuffsChangeEmitter]).on((()=>{const t=this.simUI.player?.getTalents().improvedShadowBolt>0,s=this.simUI.player?.getTalents().improvedShadowBolt>0;1==this.simUI.player.getRaid()?.getDebuffs()?.improvedShadowBolt||t||s?e.rootElem.classList.remove("hide"):e.rootElem.classList.add("hide")}))}}buildBuffsSettings(){const e=cu(iu,this.simUI),t=cu(au,this.simUI),s=new qn(this.column3,"buffs-settings",{header:{title:"Raid Buffs",tooltip:Pi}});this.configureIconSection(s.bodyElement,e.map((e=>e.picker&&new e.picker(s.bodyElement,this.simUI.player,e.config,this.simUI)))),t.length&&new Am(s.bodyElement,this.simUI.player,{values:t.map((e=>e.config)),label:"Misc Buffs"},this.simUI)}buildWorldBuffsSettings(){const e=new qn(this.column3,"world-buffs-settings",{header:{title:"World Buffs",tooltip:ki}}),t=cu(ou,this.simUI);new cd(e.bodyElement,this.simUI.player,fh(t));const s=cu(nu,this.simUI);this.configureIconSection(e.bodyElement,s.map((t=>t.picker&&new t.picker(e.bodyElement,this.simUI.player,t.config,this.simUI))))}buildDebuffsSettings(){const e=cu(lu,this.simUI),t=cu(ru,this.simUI);if(!e.length&&!t.length)return;const s=new qn(this.column3,"debuffs-settings",{header:{title:"Debuffs",tooltip:Ci}});this.configureIconSection(s.bodyElement,e.map((e=>e.picker&&new e.picker(s.bodyElement,this.simUI.player,e.config,this.simUI)))),t.length&&new Am(s.bodyElement,this.simUI.player,{values:t.map((e=>e.config)),label:"Misc Debuffs"},this.simUI),this.simUI.player.getRaid()?.debuffsChangeEmitter.emit(m.nextEventID())}buildPresetConfigurationPicker(){new ad(this.rightPanel,this.simUI,[id.Encounter,id.Settings])}buildSavedDataPickers(){const e=new sd(this.rightPanel,this.simUI.sim.encounter,{label:"Encounter",header:{title:"Saved Encounters"},storageKey:this.simUI.getSavedEncounterStorageKey(),getData:e=>Li.create({encounter:e.toProto()}),setData:(e,t,s)=>t.fromProto(e,s.encounter),changeEmitters:[this.simUI.sim.encounter.changeEmitter],equals:(e,t)=>Li.equals(e,t),toJson:e=>Li.toJson(e),fromJson:e=>Li.fromJson(e)}),t=new sd(this.rightPanel,this.simUI,{label:"Settings",header:{title:"Saved Settings"},storageKey:this.simUI.getSavedSettingsStorageKey(),getData:()=>this.getCurrentSavedSettings(),setData:(e,t,s)=>{m.freezeAllAndDo((()=>{t.player.setLevel(e,s.level),t.sim.raid.setBuffs(e,s.raidBuffs||ve.create()),t.sim.raid.setDebuffs(e,s.debuffs||Se.create());const i=t.player.getParty();i&&i.setBuffs(e,s.partyBuffs||Ti.create()),t.player.setBuffs(e,s.playerBuffs||be.create()),t.player.setConsumes(e,s.consumes||we.create()),t.player.setRace(e,s.race),t.player.setProfessions(e,s.professions),t.player.itemSwapSettings.setItemSwapSettings(e,s.enableItemSwap,t.sim.db.lookupItemSwap(s.itemSwap||Ie.create()),Dn.fromProto(s.itemSwap?.prepullBonusStats)),t.player.setReactionTime(e,s.reactionTimeMs),t.player.setChannelClipDelay(e,s.channelClipDelayMs),t.player.setInFrontOfTarget(e,s.inFrontOfTarget),t.player.setDistanceFromTarget(e,s.distanceFromTarget),t.player.setHealingModel(e,s.healingModel||fe.create())}))},changeEmitters:[this.simUI.sim.raid.buffsChangeEmitter,this.simUI.sim.raid.debuffsChangeEmitter,this.simUI.player.getParty().buffsChangeEmitter,this.simUI.player.buffsChangeEmitter,this.simUI.player.consumesChangeEmitter,this.simUI.player.raceChangeEmitter,this.simUI.player.professionChangeEmitter,this.simUI.player.itemSwapSettings.changeEmitter,this.simUI.player.miscOptionsChangeEmitter,this.simUI.player.inFrontOfTargetChangeEmitter,this.simUI.player.distanceFromTargetChangeEmitter,this.simUI.player.healingModelChangeEmitter],equals:(e,t)=>Ni.equals(e,t),toJson:e=>Ni.toJson(e),fromJson:e=>Ni.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),t.loadUserData(),this.simUI.individualConfig.presets.settings?.forEach((e=>{t.addSavedData({name:e.name,tooltip:e.tooltip,isPreset:!0,data:Ni.create({level:e.level,race:e.race,raidBuffs:e.raidBuffs,playerBuffs:e.buffs,debuffs:e.debuffs,consumes:e.consumes})})}))}))}getCurrentSavedSettings(){return Ni.create({raidBuffs:this.simUI.sim.raid.getBuffs(),partyBuffs:this.simUI.player.getParty()?.getBuffs()||Ti.create(),playerBuffs:this.simUI.player.getBuffs(),debuffs:this.simUI.sim.raid.getDebuffs(),consumes:this.simUI.player.getConsumes(),race:this.simUI.player.getRace(),level:this.simUI.player.getLevel(),professions:this.simUI.player.getProfessions(),enableItemSwap:this.simUI.player.itemSwapSettings.getEnableItemSwap(),itemSwap:this.simUI.player.itemSwapSettings.toProto(),reactionTimeMs:this.simUI.player.getReactionTime(),channelClipDelayMs:this.simUI.player.getChannelClipDelay(),inFrontOfTarget:this.simUI.player.getInFrontOfTarget(),distanceFromTarget:this.simUI.player.getDistanceFromTarget(),healingModel:this.simUI.player.getHealingModel()})}configureInputSection(e,t){t.inputs.forEach((t=>{"number"==t.type?new Fn(e,this.simUI.player,t):"boolean"==t.type?new re(e,this.simUI.player,{...t,reverse:!0}):"enum"==t.type&&new od(e,this.simUI.player,t)}))}configureIconSection(e,t,s){0==t.length?e.classList.add("hide"):s&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`))}}class hI extends jn{constructor(e,t){super(e,t,{identifier:"talents-tab",title:"Talents"}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("talents-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("talents-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildTalentsPicker(this.leftPanel),this.buildPresetConfigurationPicker(),this.buildSavedTalentsPicker()}buildTalentsPicker(e){new ho(e,this.simUI.player,{klass:this.simUI.player.getClass(),trees:ko[this.simUI.player.getClass()],changedEvent:e=>e.talentsChangeEmitter,getValue:e=>e.getTalentsString(),setValue:(e,t,s)=>{t.setTalentsString(e,s)},pointsPerRow:5})}buildPresetConfigurationPicker(){new ad(this.rightPanel,this.simUI,[id.Talents])}buildSavedTalentsPicker(){const e=new sd(this.rightPanel,this.simUI.player,{label:"Talents",header:{title:"Saved Talents"},storageKey:this.simUI.getSavedTalentsStorageKey(),getData:e=>le.create({talentsString:e.getTalentsString()}),setData:(e,t,s)=>{m.freezeAllAndDo((()=>{t.setTalentsString(e,s.talentsString)}))},changeEmitters:[this.simUI.player.talentsChangeEmitter,this.simUI.player.levelChangeEmitter],equals:(e,t)=>le.equals(e,t),toJson:e=>le.toJson(e),fromJson:e=>le.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.talents.forEach((t=>{t.isPreset=!0,e.addSavedData({name:t.name,isPreset:!0,data:t.data,enableWhen:t.enableWhen})}))}))}}class uI{constructor(e){this.changeEmitter=new m,this.excludedFromCalc=n.create(),this.storageKey=e.getStorageKey("__statweight_settings__"),this.changeEmitter.on((()=>{const e=_i.toJsonString(this.toProto());window.localStorage.setItem(this.storageKey,e)}))}applyDefaults(e){this.excludedFromCalc=n.create(),this.changeEmitter.emit(e)}load(e){const t=window.localStorage.getItem(this.storageKey);if(t){const s=_i.fromJsonString(t);s.excludedFromCalc&&(this.excludedFromCalc=s.excludedFromCalc),this.changeEmitter.emit(e)}}toProto(){const e=_i.create();return e.excludedFromCalc=this.excludedFromCalc,e}isStatExcludedFromCalc(e){return!!this.excludedFromCalc?.stats.includes(e)}isPseudostatExcludedFromCalc(e){return!!this.excludedFromCalc?.pseudoStats.includes(e)}isUnitStatExcludedFromCalc(e){return e.isStat()?this.isStatExcludedFromCalc(e.getStat()):this.isPseudostatExcludedFromCalc(e.getPseudoStat())}setStatExcluded(e,t,s){const i=(e,t)=>{const i=t.indexOf(e);s?-1===i&&t.push(e):-1!==i&&t.splice(i,1)};t.isStat()?i(t.getStat(),this.excludedFromCalc.stats):i(t.getPseudoStat(),this.excludedFromCalc.pseudoStats),this.changeEmitter.emit(e)}}const pI=class e extends Vn{constructor(e,t,s,a,n){super(e.rootElem,"ep-weights-menu",function(e){const t={footer:!0,scrollContents:!0};return e.sim.getShowThreatMetrics()?{size:"xl",...t}:t}(e)),this.showAllStats=!1,this.simUI=e,this.statsType="ep",this.epStats=t,this.epPseudoStats=s,this.epReferenceStat=a,this.settings=n,this.header?.insertAdjacentHTML("afterbegin",'<h5 class="modal-title">Calculate Stat Weights</h5>'),this.body.innerHTML='\n\t\t\t<div class="ep-weights-options row">\n\t\t\t\t<div class="col col-sm-3">\n\t\t\t\t\t<select class="ep-type-select form-select">\n\t\t\t\t\t\t<option value="ep">EP</option>\n\t\t\t\t\t\t<option value="weight">Weights</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="show-all-stats-container col col-sm-3"></div>\n\t\t\t</div>\n\t\t\t<div class="ep-reference-options row">\n\t\t\t\t<div class="col col-sm-4 damage-metrics">\n\t\t\t\t\t<span>DPS/TPS reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select damage-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col col-sm-4 healing-metrics">\n\t\t\t\t\t<span>Healing reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select healing-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col col-sm-4 threat-metrics">\n\t\t\t\t\t<span>Mitigation reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select threat-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<p>The above stat selectors control which reference stat is used for EP normalisation for the different EP columns.</p>\n\t\t\t</div>\n\t\t\t<p>The \'Current EP\' column displays the values currently used by the item pickers to sort items.</br>\n\t\t\tUse the <a href=\'javascript:void(0)\' class="fa fa-copy"></a> icon above the EPs to use newly calculated EPs.</p>\n\t\t\t<div class="results-ep-table-container modal-scroll-table">\n\t\t\t\t<div class="results-pending-overlay"></div>\n\t\t\t\t<table class="results-ep-table">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>Stat</th>\n\t\t\t\t\t\t\t<th>Update</th>\n\t\t\t\t\t\t\t<th class="damage-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>DPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="damage-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>DPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="healing-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>HPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="healing-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>HPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>TPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>TPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>DTPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>DTPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>TMI Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>TMI EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>Death Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>Death EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th style="text-align: center">\n\t\t\t\t\t\t\t\t<span>Current EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fas fa-arrows-rotate"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr class="ep-ratios">\n\t\t\t\t\t\t\t<td>EP Ratio</td>\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t<td class="damage-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="damage-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="healing-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="healing-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="text-align: center; vertical-align: middle;">\n\t\t\t\t\t\t\t\t<button class="btn btn-primary compute-ep">\n\t\t\t\t\t\t\t\t\t<i class="fas fa-calculator"></i>\n\t\t\t\t\t\t\t\t\t<span class="not-tiny">Update </span>EP\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t',this.footer.innerHTML='\n\t\t\t<button class="btn btn-primary calc-weights">\n\t\t\t\t<i class="fas fa-calculator"></i>\n\t\t\t\tCalculate\n\t\t\t</button>\n\t\t',this.container=this.rootElem.querySelector(".results-ep-table-container"),this.table=this.rootElem.querySelector(".results-ep-table"),this.tableBody=this.rootElem.querySelector(".results-ep-table tbody");const o=this.rootElem.querySelector(".results-pending-overlay");this.resultsViewer=new zn(o);const l=()=>{"ep"==this.statsType?(this.table.classList.remove("stats-type-weight"),this.table.classList.add("stats-type-ep")):(this.table.classList.add("stats-type-weight"),this.table.classList.remove("stats-type-ep"))},r=this.rootElem.getElementsByClassName("ep-type-select")[0];r.addEventListener("input",(e=>{this.statsType=r.value,l()})),r.value=this.statsType,l();const c=e=>void 0!==e?i(e,this.simUI.player.getClass()):"??",d=e=>{for(const t of this.epStats)if(c(t)==e)return t},h=()=>{this.simUI.player.epRefStatChangeEmitter.emit(m.nextEventID()),this.simUI.prevEpSimResult=this.calculateEp(this.getPrevSimResult()),this.updateTable()};this.rootElem.querySelectorAll(".ref-stat-select").forEach(((e,t)=>{this.epStats.forEach((t=>{e.options[e.options.length]=new Option(c(t))})),e.classList.contains("damage-metrics")?(e.addEventListener("input",(t=>{this.simUI.dpsRefStat=d(e.value),h()})),e.value=c(this.getDpsEpRefStat())):e.classList.contains("healing-metrics")?(e.addEventListener("input",(t=>{this.simUI.healRefStat=d(e.value),h()})),e.value=c(this.getHealEpRefStat())):e.classList.contains("threat-metrics")&&(e.addEventListener("input",(t=>{this.simUI.tankRefStat=d(e.value),h()})),e.value=c(this.getTankEpRefStat()))}));const u=this.rootElem.getElementsByClassName("calc-weights")[0];let p=!1;u.addEventListener("click",(async t=>{if(p)return;p=!0;try{await this.simUI.sim.signalManager.abortType(ae.All)}catch(r){return void console.error(r)}u.disabled=!0;const s=u.innerHTML;u.style.width=`${u.getBoundingClientRect().width.toFixed(3)}px`,u.innerHTML='<i class="fa fa-spinner fa-spin"></i>&nbsp;Running',this.container.scrollTo({top:0}),this.container.classList.add("pending"),this.resultsViewer.setPending();const i=this.simUI.sim.getIterations();let a=!1;this.resultsViewer.addAbortButton((async()=>{if(!a)try{a=!0,await e.sim.signalManager.abortType(ae.StatWeights)}catch(r){console.error("Error on stat weight abort!"),console.error(r)}finally{a=!1,p||(u.disabled=!1,u.innerHTML=s)}}));const n=this.epStats.filter((e=>!this.settings.isStatExcludedFromCalc(e))),o=this.epPseudoStats.filter((e=>!this.settings.isPseudostatExcludedFromCalc(e))),l=await this.simUI.player.computeStatWeights(m.nextEventID(),n,o,this.epReferenceStat,(e=>{this.setSimProgress(e)}));this.container.classList.remove("pending"),this.resultsViewer.hideAll(),p=!1,a||(u.disabled=!1,u.innerHTML=s),l&&(this.simUI.prevEpIterations=i,this.simUI.prevEpSimResult=this.calculateEp(l),this.updateTable())})),this.addOnHideCallback((()=>{this.simUI.sim.signalManager.abortType(ae.StatWeights).catch(console.error)}));const g=Array.from(this.rootElem.getElementsByClassName("col-action")),f=(e,t,s,i,a)=>{const n=e.previousElementSibling;Ln(n,{content:()=>{if(!a)return t;const e=c(a());return t+` Normalized by ${e}.`}}),Ln(e,{content:s}),e.addEventListener("click",(e=>{this.setEpWeightsWithoutExcluded(Dn.fromProto(i())),this.updateTable()}))};f(g[0],"Per-point increase in DPS (Damage Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dps.weights)),f(g[1],"EP (Equivalency Points) for DPS (Damage Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dps.epValues),(()=>this.getDpsEpRefStat())),f(g[2],"Per-point increase in HPS (Healing Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().hps.weights)),f(g[3],"EP (Equivalency Points) for HPS (Healing Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().hps.epValues),(()=>this.getHealEpRefStat())),f(g[4],"Per-point increase in TPS (Threat Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tps.weights)),f(g[5],"EP (Equivalency Points) for TPS (Threat Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tps.epValues),(()=>this.getDpsEpRefStat())),f(g[6],"Per-point increase in DTPS (Damage Taken Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dtps.weights)),f(g[7],"EP (Equivalency Points) for DTPS (Damage Taken Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dtps.epValues),(()=>this.getTankEpRefStat())),f(g[8],"Per-point decrease in TMI (Theck-Meloree Index) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tmi.weights)),f(g[9],"EP (Equivalency Points) for TMI (Theck-Meloree Index) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tmi.epValues),(()=>this.getTankEpRefStat())),f(g[10],"Per-point decrease in p(death) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().pDeath.weights)),f(g[11],"EP (Equivalency Points) for p(death) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().pDeath.epValues),(()=>this.getTankEpRefStat())),f(g[12],"Current EP Weights. Used to sort the gear selector menus.","Restore Default EP",(()=>this.simUI.individualConfig.defaults.epWeights.toProto()));const I=this.rootElem.getElementsByClassName("show-all-stats-container")[0];new re(I,this,{id:"ep-show-all-stats",label:"Show All Stats",inline:!0,changedEvent:()=>new m,getValue:()=>this.showAllStats,setValue:(e,t,s)=>{this.showAllStats=s,this.updateTable()}}),this.updateTable();const w=(e,t)=>{new Fn(e,this.simUI.player,{id:`ep-ratio-${t}`,float:!0,changedEvent:e=>e.epRatiosChangeEmitter,getValue:e=>this.simUI.player.getEpRatios()[t],setValue:(e,s,i)=>{const a=s.getEpRatios();a[t]=i,s.setEpRatios(e,a)}})};this.body.querySelectorAll(".type-ratio.type-ep").forEach(w),this.simUI.player.epRatiosChangeEmitter.on((e=>this.updateTable()));this.body.querySelectorAll(".type-ratio.type-weight").forEach(w);const v=this.rootElem.getElementsByClassName("compute-ep")[0];Ln(v,{content:"Compute Weighted EP"}),v.addEventListener("click",(e=>{const t=this.getPrevSimResult(),s=this.simUI.player.getEpRatios();if("ep"==this.statsType){const e=Dn.fromProto(t.dps.epValues).scale(s[0]),i=Dn.fromProto(t.hps.epValues).scale(s[1]),a=Dn.fromProto(t.tps.epValues).scale(s[2]),n=Dn.fromProto(t.dtps.epValues).scale(s[3]),o=Dn.fromProto(t.tmi.epValues).scale(s[4]),l=Dn.fromProto(t.pDeath.epValues).scale(s[5]),r=e.add(i).add(a).add(n).add(o).add(l);this.setEpWeightsWithoutExcluded(r)}else{const e=Dn.fromProto(t.dps.weights).scale(s[0]),i=Dn.fromProto(t.hps.weights).scale(s[1]),a=Dn.fromProto(t.tps.weights).scale(s[2]),n=Dn.fromProto(t.dtps.weights).scale(s[3]),o=Dn.fromProto(t.tmi.weights).scale(s[4]),l=Dn.fromProto(t.pDeath.weights).scale(s[5]),r=e.add(i).add(a).add(n).add(o).add(l);this.setEpWeightsWithoutExcluded(r)}this.updateTable()}))}setEpWeightsWithoutExcluded(e){const t=this.settings.excludedFromCalc,s=this.simUI.player.getEpWeights();for(const i of t.stats)e=e.withStat(i,s.getStat(i));for(const i of t.pseudoStats)e=e.withPseudoStat(i,s.getPseudoStat(i));this.simUI.player.setEpWeights(m.nextEventID(),e)}isEpStat(e){return e.isStat()?this.epStats.includes(e.getStat()):this.epPseudoStats.includes(e.getPseudoStat())}setSimProgress(e){this.resultsViewer.setContent(`\n\t\t\t<div class="results-sim">\n\t\t\t\t<div class=""> ${e.completedSims} / ${e.totalSims}<br>simulations complete</div>\n\t\t\t\t<div class="">\n\t\t\t\t\t${e.completedIterations} / ${e.totalIterations}<br>iterations complete\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)}updateTable(){this.tableBody.innerHTML="",e.epUnitStats.forEach((e=>{if(!this.showAllStats&&e.isStat()&&!this.epStats.includes(e.getStat())||e.isPseudoStat()&&!this.epPseudoStats.includes(e.getPseudoStat()))return;const t=this.makeTableRow(e);this.tableBody.appendChild(t)}))}makeTableRow(e){const t=document.createElement("tr"),s=this.settings.isUnitStatExcludedFromCalc(e)?null:this.simUI.prevEpSimResult,i=this.simUI.player.getEpRatios(),a=function(e,t,s){return s?(s.dps?.epValues?t[0]*e.getProtoValue(s.dps.epValues):0)+(s.hps?.epValues?t[1]*e.getProtoValue(s.hps.epValues):0)+(s.tps?.epValues?t[2]*e.getProtoValue(s.tps.epValues):0)+(s.dtps?.epValues?t[3]*e.getProtoValue(s.dtps.epValues):0)+(s.tmi?.epValues?t[4]*e.getProtoValue(s.tmi.epValues):0)+(s.pDeath?.epValues?t[5]*e.getProtoValue(s.pDeath.epValues):0):0}(e,i,s);if(t.innerHTML=`\n\t\t\t<td>${e.getName(this.simUI.player.getClass())}</td>\n\t\t\t<td class="swcalc-include-toggle"></td>\n\t\t\t${this.makeTableRowCells(e,s?.dps,"damage-metrics",a,i[0])}\n\t\t\t${this.makeTableRowCells(e,s?.hps,"healing-metrics",a,i[1])}\n\t\t\t${this.makeTableRowCells(e,s?.tps,"threat-metrics",a,i[2])}\n\t\t\t${this.makeTableRowCells(e,s?.dtps,"threat-metrics",a,i[3])}\n\t\t\t${this.makeTableRowCells(e,s?.tmi,"threat-metrics",a,i[4])}\n\t\t\t${this.makeTableRowCells(e,s?.pDeath,"threat-metrics",a,i[5])}\n\t\t\t<td class="current-ep"></td>\n\t\t`,this.isEpStat(e)){const s=t.querySelector(".swcalc-include-toggle");new re(s,this,{id:"sw-stat-toggle-"+e.getName(this.simUI.player.getClass()),getValue:t=>!t.settings.isUnitStatExcludedFromCalc(e),setValue:(t,s,i)=>s.settings.setStatExcluded(t,e,!i),changedEvent:e=>e.settings.changeEmitter,enableWhen:t=>!e.isStat()||t.epReferenceStat!=e.getStat()})}const n=t.querySelector(".current-ep");return new Fn(n,this.simUI.player,{id:`ep-weight-stat-${e}`,float:!0,changedEvent:e=>e.epWeightsChangeEmitter,getValue:t=>this.simUI.player.getEpWeights().getUnitStat(e),setValue:(t,s,i)=>{const a=s.getEpWeights().withUnitStat(e,i);s.setEpWeights(t,a)}}),t}makeTableRowCells(e,t,s,i,a){let n,o;if(t){const s=e.getProtoValue(t.weights),i=e.getProtoValue(t.weightsStdev);n=this.makeTableCellContents(s,i);const a=e.getProtoValue(t.epValues),l=e.getProtoValue(t.epValuesStdev);o=this.makeTableCellContents(a,l)}else n='<span class="results-avg notapplicable">N/A</span>',o=n;const l=document.createElement("template");if(l.innerHTML=`\n\t\t\t<td class="stdev-cell ${s} type-weight">\n\t\t\t\t${n}\n\t\t\t</td>\n\t\t\t<td class="stdev-cell ${s} type-ep">\n\t\t\t\t${o}\n\t\t\t</td>\n\t\t`,!t)return l.innerHTML;if(0==a){return l.content.querySelectorAll(".stdev-cell").forEach((e=>e.classList.add("unused-ep"))),l.innerHTML}const r=i-this.simUI.player.getEpWeights().getUnitStat(e),c=l.content.querySelector(".type-ep .results-avg");return"0.00"==r.toFixed(2)||(r>0?c.classList.add("positive"):r<0&&c.classList.add("negative")),l.innerHTML}makeTableCellContents(e,t){const s=this.simUI.prevEpIterations||1;return`\n\t\t\t<span class="results-avg">${e.toFixed(2)}</span>\n\t\t\t<span class="results-stdev">\n\t\t\t\t(<i class="fas fa-plus-minus fa-xs"></i>${Ai(t,s).toFixed(2)})\n\t\t\t</span>\n\t\t`}calculateEp(t){const s=Ri.clone(t),i=(t,s)=>{const i=_n.fromStat(t),a=i.getProtoValue(s.weights),n=i.getProtoValue(s.weightsStdev);e.epUnitStats.forEach((e=>{const t=e.getProtoValue(s.weights);e.setProtoValue(s.epValues,0==a?0:t/a);const i=e.getProtoValue(s.weightsStdev);e.setProtoValue(s.epValuesStdev,0==n?0:i/n)}))};return void 0!==this.simUI.dpsRefStat&&(i(this.simUI.dpsRefStat,s.dps),i(this.simUI.dpsRefStat,s.tps)),void 0!==this.simUI.healRefStat&&i(this.simUI.healRefStat,s.hps),void 0!==this.simUI.tankRefStat&&(i(this.simUI.tankRefStat,s.dtps),i(this.simUI.tankRefStat,s.tmi),i(this.simUI.tankRefStat,s.pDeath)),s}getDpsEpRefStat(){return void 0!==this.simUI.dpsRefStat?this.simUI.dpsRefStat:this.epReferenceStat}getHealEpRefStat(){return void 0!==this.simUI.healRefStat?this.simUI.healRefStat:this.epReferenceStat}getTankEpRefStat(){return void 0!==this.simUI.tankRefStat?this.simUI.tankRefStat:t.StatArmor}getPrevSimResult(){return this.simUI.prevEpSimResult||Ri.create({dps:{weights:(new Dn).toProto(),weightsStdev:(new Dn).toProto(),epValues:(new Dn).toProto(),epValuesStdev:(new Dn).toProto()},hps:{weights:(new Dn).toProto(),weightsStdev:(new Dn).toProto(),epValues:(new Dn).toProto(),epValuesStdev:(new Dn).toProto()},tps:{weights:(new Dn).toProto(),weightsStdev:(new Dn).toProto(),epValues:(new Dn).toProto(),epValuesStdev:(new Dn).toProto()},dtps:{weights:(new Dn).toProto(),weightsStdev:(new Dn).toProto(),epValues:(new Dn).toProto(),epValuesStdev:(new Dn).toProto()},tmi:{weights:(new Dn).toProto(),weightsStdev:(new Dn).toProto(),epValues:(new Dn).toProto(),epValuesStdev:(new Dn).toProto()},pDeath:{weights:(new Dn).toProto(),weightsStdev:(new Dn).toProto(),epValues:(new Dn).toProto(),epValuesStdev:(new Dn).toProto()}})}};pI.epUnitStats=_n.getAll().filter((e=>!!e.isStat()||[s.PseudoStatMainHandDps,s.PseudoStatOffHandDps,s.PseudoStatRangedDps,s.PseudoStatBonusPhysicalDamage,s.PseudoStatMeleeSpeedMultiplier,s.PseudoStatRangedSpeedMultiplier,s.PseudoStatCastSpeedMultiplier,s.PseudoStatTimewornBonus,s.PseudoStatSanctifiedBonus].includes(e.getPseudoStat())));let gI=pI;var fI=(e=>(e[e.Unlaunched=0]="Unlaunched",e[e.Alpha=1]="Alpha",e[e.Beta=2]="Beta",e[e.Launched=3]="Launched",e))(fI||{});const II={phase:Di.Phase1,status:0},wI={[u.SpecBalanceDruid]:{phase:Di.Phase8,status:1},[u.SpecFeralDruid]:{phase:Di.Phase8,status:1},[u.SpecFeralTankDruid]:{phase:Di.Phase8,status:1},[u.SpecRestorationDruid]:{phase:Di.Phase1,status:0},[u.SpecElementalShaman]:{phase:Di.Phase8,status:1},[u.SpecEnhancementShaman]:{phase:Di.Phase8,status:1},[u.SpecRestorationShaman]:{phase:Di.Phase1,status:0},[u.SpecWardenShaman]:{phase:Di.Phase8,status:1},[u.SpecHunter]:{phase:Di.Phase8,status:1},[u.SpecMage]:{phase:Di.Phase8,status:1},[u.SpecRogue]:{phase:Di.Phase8,status:1},[u.SpecTankRogue]:{phase:Di.Phase8,status:1},[u.SpecHolyPaladin]:{phase:Di.Phase1,status:0},[u.SpecProtectionPaladin]:{phase:Di.Phase5,status:1},[u.SpecRetributionPaladin]:{phase:Di.Phase8,status:1},[u.SpecHealingPriest]:{phase:Di.Phase1,status:0},[u.SpecShadowPriest]:{phase:Di.Phase8,status:1},[u.SpecWarlock]:{phase:Di.Phase8,status:1},[u.SpecTankWarlock]:{phase:Di.Phase8,status:1},[u.SpecWarrior]:{phase:Di.Phase8,status:1},[u.SpecTankWarrior]:{phase:Di.Phase8,status:1}};function vI(e){return Object.keys(H).map((e=>parseInt(e))).filter((t=>H[t]==e&&wI[t].status>0))}class bI extends Vn{constructor(e,t){super(e,"settings-menu",{title:"Options",footer:!0}),this.simUI=t;const s=r(),i=r(),a=r(),n=r(),o=r(),c=r(),d=r(),h=r(),u=r(),p=r(),g=l("div",null,l("div",{className:"picker-group"},l("div",{className:"fixed-rng-seed-container"},l("div",{ref:i,className:"fixed-rng-seed"}),l("div",{className:"form-text"},l("span",null,"Last used RNG seed:")," ",l("span",{ref:a,className:"last-used-rng-seed"},"0"))),l("div",{ref:n,className:"language-picker within-raid-sim-hide"})),l("div",{ref:o,className:"show-threat-metrics-picker w-50 pe-2"}),l("div",{ref:c,className:"show-experimental-picker w-50 pe-2"}),l("div",{ref:d,className:"show-quick-swap-picker w-50 pe-2"}),l("div",{ref:h,className:"use-concurrency-container w-50 pe-2"},l("div",{ref:u,className:"use-concurrent-workers-picker"}),l("div",{ref:p,className:"form-text",hidden:!0})));this.body.replaceChildren(g);const f=l("button",{ref:s,className:"restore-defaults-button btn btn-primary"},"Restore Defaults");if(this.footer&&this.footer.replaceChildren(f),s.value&&(Ln(s.value,{content:"Restores all default settings (gear, consumes, buffs, talents, EP weights, etc). Saved settings are preserved."}),s.value.addEventListener("click",(()=>{this.simUI.applyDefaults(m.nextEventID()),new $n({variant:"success",body:"Restored to default settings."})}))),i.value&&new Fn(i.value,this.simUI.sim,{id:"simui-fixed-rng-seed",label:"Fixed RNG Seed",labelTooltip:"Seed value for the random number generator used during sims, or 0 to use different randomness each run. Use this to share exact sim results or for debugging.",extraCssClasses:["mb-0"],changedEvent:e=>e.fixedRngSeedChangeEmitter,getValue:e=>e.getFixedRngSeed(),setValue:(e,t,s)=>{t.setFixedRngSeed(e,s)}}),a.value&&(a.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()),this.simUI.sim.lastUsedRngSeedChangeEmitter.on((()=>{a.value&&(a.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()))}))),n.value){const e=Object.keys(Mi),t=e.indexOf("en");new od(n.value,this.simUI.sim,{id:"simui-language-picker",label:"Language",labelTooltip:"Controls the language for Wowhead tooltips.",values:e.map(((e,t)=>({name:Mi[e],value:t}))),changedEvent:e=>e.languageChangeEmitter,getValue:s=>{const i=e.indexOf(s.getLanguage());return-1==i?t:i},setValue:(t,s,i)=>{s.setLanguage(t,e[i]||"en")}}).changeEmitter.on((()=>setTimeout((()=>location.reload()),100)))}if(o.value&&new re(o.value,this.simUI.sim,{id:"simui-show-threat-metrics",label:"Show Threat/Tank Options",labelTooltip:"Shows all options and metrics relevant to tanks, like TPS/DTPS.",inline:!0,changedEvent:e=>e.showThreatMetricsChangeEmitter,getValue:e=>e.getShowThreatMetrics(),setValue:(e,t,s)=>{t.setShowThreatMetrics(e,s)}}),c.value&&new re(c.value,this.simUI.sim,{id:"simui-show-experimental",label:"Show Experimental",labelTooltip:"Shows experimental options, if there are any active experiments.",inline:!0,changedEvent:e=>e.showExperimentalChangeEmitter,getValue:e=>e.getShowExperimental(),setValue:(e,t,s)=>{t.setShowExperimental(e,s)}}),h.value&&u.value){const e=[{value:0,name:"Off"}];for(let t=2;t<=navigator.hardwareConcurrency;t++)e.push({value:t,name:t.toString()});if(new od(u.value,this.simUI.sim,{id:"simui-concurrent-workers-picker",label:"Use Multiple CPU Cores",labelTooltip:"Use web workers to spread sim workload over multiple CPU cores.",changedEvent:e=>e.wasmConcurrencyChangeEmitter,getValue:e=>e.getWasmConcurrency(),setValue:(e,t,s)=>t.setWasmConcurrency(e,s),values:e}),p.value&&navigator.userAgent.toLowerCase().includes("firefox")){const e=p.value;e.hidden=!1,e.textContent="Too many workers can cause significant memory usage! If sim doesn't finish due to RAM running out use a lower number."}this.simUI.sim.isWasm().then((e=>{e||(h.value.hidden=!0)}))}}}class SI extends o{static buildDiscordLink(){const e=l("a",{href:"https://discord.gg/p3DgvmnDCS",target:"_blank",className:"discord-link link-alt",dataset:{tippyContent:"Join us on Discord"}},l("i",{className:"fab fa-discord fa-lg"}));return Ln(e),e}static buildGitHubLink(){const e=l("a",{href:"https://github.com/wowsims/sod",target:"_blank",className:"github-link link-alt",dataset:{tippyContent:"Contribute on GitHub"}},l("i",{className:"fab fa-github fa-lg"}));return Ln(e),e}static buildPatreonLink(){const e=l("a",{href:"https://patreon.com/wowsims",target:"_blank",className:"patreon-link link-alt",dataset:{tippyContent:"Support us on Patreon"}},l("i",{className:"fab fa-patreon fa-lg"})," Patreon");return Ln(e),e}}class xI extends o{constructor(e,t){super(e,"sim-header"),this.simUI=t,this.simTabsContainer=this.rootElem.querySelector(".sim-tabs"),this.simToolbar=this.rootElem.querySelector(".sim-toolbar"),this.knownIssuesContent=l("ul",{className:"text-start ps-3 mb-0"}),this.knownIssuesLink=this.addKnownIssuesLink(),this.addBugReportLink(),this.addDownloadBinaryLink(),this.addSimOptionsLink(),this.addSocialLinks(),new IntersectionObserver((([e])=>e.target.classList.toggle("stuck",e.intersectionRatio<1)),{threshold:[1]}).observe(this.rootElem)}activateTab(e){this.simTabsContainer.getElementsByClassName(e)[0].click()}addTab(e,t){const s=0==this.simTabsContainer.children.length,i=l("li",{className:`${t} nav-item`,attributes:{role:"presentation"}},l("a",{className:`nav-link ${s&&"active"}`,dataset:{bsToggle:"tab",bsTarget:`#${t}`},attributes:{role:"tab","aria-selected":s},type:"button"},e));i.setAttribute("aria-controls",t),this.simTabsContainer.appendChild(i)}addSimTabLink(e){const t=0==this.simTabsContainer.children.length;e.navLink.setAttribute("aria-selected",t.toString()),t&&e.navLink.classList.add("active","show"),this.simTabsContainer.appendChild(e.navItem)}addImportLink(e,t,s){this.addImportExportLink(".import-dropdown",e,t,s)}addExportLink(e,t,s){this.addImportExportLink(".export-dropdown",e,t,s)}addImportExportLink(e,t,s,i){const a=this.rootElem.querySelector(e).querySelector(".dropdown-menu"),n=r();a.appendChild(l("li",null,l("a",{ref:n,href:"javascript:void(0)",className:"dropdown-item",attributes:{role:"button"}},t))),n.value?.addEventListener("click",(()=>s.open()))}addToolbarLink(e){const t=r();return e.parent.appendChild(l("div",{className:"sim-toolbar-item"},l("a",{ref:t,href:e.href?e.href:"javascript:void(0)",className:e.classes||"",target:e.href?"_blank":"_self"},e.icon&&l("i",{className:e.icon}),e.text?` ${e.text} `:""))),t.value&&(e.onclick&&t.value.addEventListener("click",e.onclick),e.tooltip&&Ln(t.value,{content:e.tooltip,placement:"bottom"})),t.value}addKnownIssuesLink(){return this.addToolbarLink({parent:this.simToolbar,text:"Known Issues",tooltip:this.knownIssuesContent,classes:"known-issues link-danger hide"})}addKnownIssue(e){const t=l("li",null);t.innerHTML=e,this.knownIssuesContent.appendChild(t),this.knownIssuesLink.classList.remove("hide"),this.knownIssuesLink._tippy?.setContent(this.knownIssuesContent)}addBugReportLink(){this.addToolbarLink({href:"https://github.com/wowsims/sod/issues/new/choose",parent:this.simToolbar,icon:"fas fa-bug fa-lg",tooltip:"Report a bug or<br>Request a feature"})}addDownloadBinaryLink(){const e="https://github.com/wowsims/sod/releases",t="fas fa-gauge-high fa-lg",s=this.simToolbar;Vi()?fetch("/version").then((i=>{i.json().then((i=>{2==i.outdated&&this.addToolbarLink({href:e,parent:s,icon:t,tooltip:"Newer version of simulator available for download",classes:"downbin link-danger"})})).catch((e=>{console.warn("No version info found!")}))})):this.addToolbarLink({href:e,parent:s,icon:t,tooltip:"Download simulator for faster simulating",classes:"downbin"})}addSimOptionsLink(){const e=new bI(this.simUI.rootElem,this.simUI);this.addToolbarLink({parent:this.simToolbar,icon:"fas fa-cog fa-lg",tooltip:"Show Sim Options",classes:"sim-options",onclick:()=>e.open()})}addSocialLinks(){const e=document.createElement("div");e.classList.add("sim-toolbar-socials"),this.simToolbar.appendChild(e),this.addDiscordLink(e),this.addGitHubLink(e),this.addPatreonLink(e)}addDiscordLink(e){e.appendChild(l("div",{className:"sim-toolbar-item"},SI.buildDiscordLink()))}addGitHubLink(e){e.appendChild(l("div",{className:"sim-toolbar-item"},SI.buildGitHubLink()))}addPatreonLink(e){e.appendChild(l("div",{className:"sim-toolbar-item"},SI.buildPatreonLink()))}customRootElement(){return l("header",{className:"sim-header"},l("div",{className:"sim-header-container"},l("ul",{className:"sim-tabs nav nav-tabs",attributes:{role:"tablist"}}),l("div",{className:"import-export within-raid-sim-hide"},l("div",{className:"dropdown sim-dropdown-menu import-dropdown"},l("a",{href:"javascript:void(0)",className:"import-link",attributes:{role:"button","aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},l("i",{className:"fa fa-download"})," Import "),l("ul",{className:"dropdown-menu"})),l("div",{className:"dropdown sim-dropdown-menu export-dropdown"},l("a",{href:"javascript:void(0)",className:"export-link",attributes:{role:"button","aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},l("i",{className:"fa fa-right-from-bracket"})," Export "),l("ul",{className:"dropdown-menu"}))),l("div",{className:"sim-toolbar"})))}}class yI extends o{constructor(e,t,s={}){super(e,"sim-title-dropdown-root"),this.specLabels={[u.SpecBalanceDruid]:"Balance",[u.SpecFeralDruid]:"Feral DPS",[u.SpecFeralTankDruid]:"Feral Tank",[u.SpecRestorationDruid]:"Restoration",[u.SpecElementalShaman]:"Elemental",[u.SpecEnhancementShaman]:"Enhancement",[u.SpecRestorationShaman]:"Restoration",[u.SpecWardenShaman]:"Warden",[u.SpecHunter]:"Hunter",[u.SpecMage]:"Mage",[u.SpecRogue]:"DPS",[u.SpecTankRogue]:"Tank",[u.SpecHolyPaladin]:"Holy",[u.SpecProtectionPaladin]:"Protection",[u.SpecRetributionPaladin]:"Retribution",[u.SpecHealingPriest]:"Healing",[u.SpecShadowPriest]:"Shadow",[u.SpecWarlock]:"DPS",[u.SpecTankWarlock]:"Tank",[u.SpecWarrior]:"DPS",[u.SpecTankWarrior]:"Tank"};const i=null===t?{type:"Raid"}:{type:"Spec",index:t},a=this.buildRootSimLink(i);s.noDropdown?this.rootElem.innerHTML=a.outerHTML:(this.rootElem.innerHTML=`\n      <div class="dropdown sim-link-dropdown">\n        ${a.outerHTML}\n        <ul class="dropdown-menu"></ul>\n      </div>\n    `,this.dropdownMenu=this.rootElem.getElementsByClassName("dropdown-menu")[0],this.buildDropdown(),this.dropdownMenu.addEventListener("click",(e=>{e.target.closest('a:not([href="javascript:void(0)"]')||(e.stopPropagation(),e.preventDefault())})))}buildDropdown(){Ui.forEach((e=>{const t=document.createElement("li"),s=vI(e);1==s.length?(t.appendChild(this.buildClassLink(e)),this.dropdownMenu?.appendChild(t)):s.length>1&&(t.appendChild(this.buildClassDropdown(e)),this.dropdownMenu?.appendChild(t))}))}buildClassDropdown(e){const t=vI(e),s=document.createElement("fragment"),i=document.createElement("ul");i.classList.add("dropdown-menu");const a=this.buildClassLink(e);return t.forEach((e=>{const t=document.createElement("li"),s=this.buildSpecLink(e);t.appendChild(s),i.appendChild(t)})),s.innerHTML=`\n\t\t\t<div class="dropend sim-link-dropdown">\n\t\t\t\t${a.outerHTML}\n\t\t\t\t${i.outerHTML}\n\t\t\t</div>\n    \t`,s.children[0]}buildRootSimLink(e){let t;if("Raid"==e.type)t=ji;else{const s=H[e.index];t=vI(s).length>1?de[e.index]:Oi[s]}return l("a",{href:"javascript:void(0)",className:P("sim-link",this.getContextualKlass(e)),dataset:{bsToggle:"dropdown",bsTrigger:"click"}},l("div",{className:"sim-link-content"},l("img",{src:this.getSimIconPath(e),className:"sim-link-icon"}),l("div",{className:"d-flex flex-column"},l("span",{className:"sim-link-label text-white"},"WoWSims - Season of Discovery"),l("span",{className:"sim-link-title"},t),this.launchStatusLabel(e))))}buildRaidLink(){const e=this.getContextualKlass({type:"Raid"}),t=this.getSimIconPath({type:"Raid"}),s=ji,i=document.createElement("fragment");return i.innerHTML=`\n      <a href="${Wi}" class="sim-link ${e}">\n        <div class="sim-link-content">\n          <img src="${t}" class="sim-link-icon">\n          <div class="d-flex flex-column">\n            <span class="sim-link-title">${s}</span>\n            ${this.launchStatusLabel({type:"Raid"})}\n          </div>\n        </div>\n      </a>\n    `,i.children[0]}buildClassLink(e){const t=vI(e),s=t.length>1,i=s?"javascript:void(0)":Fi(t[0]);return l("a",{href:i,className:P("sim-link",this.getContextualKlass({type:"Class",index:e})),dataset:s?{bsToggle:"dropdown"}:{}},l("div",{className:"sim-link-content"},l("img",{src:this.getSimIconPath({type:"Class",index:e}),className:"sim-link-icon"}),l("div",{className:"d-flex flex-column"},l("span",{className:"sim-link-title"},Oi[e]),!s&&this.launchStatusLabel({type:"Spec",index:t[0]}))))}buildSpecLink(e){const t=Fi(e);return l("a",{href:t,className:P("sim-link",this.getContextualKlass({type:"Spec",index:e}))},l("div",{className:"sim-link-content"},l("img",{src:this.getSimIconPath({type:"Spec",index:e}),className:"sim-link-icon"}),l("div",{className:"d-flex flex-column"},l("span",{className:"sim-link-label"},Oi[H[e]]),l("span",{className:"sim-link-title"},this.specLabels[e]),this.launchStatusLabel({type:"Spec",index:e}))))}launchStatusLabel(e){const t="Raid"==e.type?II.status:wI[e.index].status,s="Raid"==e.type?II.phase:wI[e.index].phase;return l("span",{className:"launch-status-label text-brand"},t===fI.Unlaunched?l(k,null,"Not Yet Supported"):l(k,null,"Phase ",s,t!=fI.Launched&&l(k,null," - ",fI[t])))}getSimIconPath(e){let t;return t="Raid"==e.type?$i:"Class"==e.type?Hi[e.index]:qi[e.index],t}getContextualKlass(e){return"Raid"==e.type?"text-white":"Class"==e.type?Bi(e.index):zi(e.index)}}const EI=[];class PI extends o{constructor(e,t,s){super(e,"sim-ui"),this.sim=t,this.cssClass=s.cssClass,this.cssScheme=s.cssScheme,this.isWithinRaidSim=null!=this.rootElem.closest(".within-raid-sim");const i=l(k,null,l("div",{className:"sim-root"},l("div",{className:"sim-bg"}),s.noticeText?l("div",{className:"notices-banner alert border-bottom mb-0 text-center within-raid-sim-hide"},s.noticeText):null,l("div",{className:"sim-container"},l("aside",{className:"sim-sidebar"},l("div",{className:"sim-title"}),l("div",{className:"sim-sidebar-content"},l("div",{className:"sim-sidebar-actions within-raid-sim-hide"}),l("div",{className:"sim-sidebar-results within-raid-sim-hide"}),l("div",{className:"sim-sidebar-stats"}),l("div",{className:"sim-sidebar-socials"}))),l("div",{className:"sim-content container-fluid"}))),l("div",{className:"sim-toast-container p-3 bottom-0 right-0",id:"toastContainer"}));this.rootElem.appendChild(i),this.simContentContainer=this.rootElem.querySelector(".sim-content"),this.simHeader=new xI(this.simContentContainer,this),this.simMain=document.createElement("main"),this.simMain.classList.add("sim-main","tab-content"),this.simContentContainer.appendChild(this.simMain),this.rootElem.classList.add(this.cssClass),this.isWithinRaidSim||this.rootElem.classList.add("not-within-raid-sim"),this.changeEmitter=m.onAny([this.sim.changeEmitter],"SimUIChange"),this.sim.crashEmitter.on(((e,t)=>this.handleCrash(t)));const a=()=>{this.sim.getShowDamageMetrics()?this.rootElem.classList.remove("hide-damage-metrics"):this.rootElem.classList.add("hide-damage-metrics")};a(),this.sim.showDamageMetricsChangeEmitter.on(a);const n=()=>{this.sim.getShowThreatMetrics()?this.rootElem.classList.remove("hide-threat-metrics"):this.rootElem.classList.add("hide-threat-metrics")};n(),this.sim.showThreatMetricsChangeEmitter.on(n);const o=()=>{this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-healing-metrics"):this.rootElem.classList.add("hide-healing-metrics")};o(),this.sim.showHealingMetricsChangeEmitter.on(o);const r=()=>{this.sim.getShowThreatMetrics()||this.sim.getShowDamageMetrics()&&this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-ep-ratios"):this.rootElem.classList.add("hide-ep-ratios")};r(),this.sim.showDamageMetricsChangeEmitter.on(r),this.sim.showHealingMetricsChangeEmitter.on(r),this.sim.showThreatMetricsChangeEmitter.on(r);const c=()=>{this.sim.getShowExperimental()?this.rootElem.classList.remove("hide-experimental"):this.rootElem.classList.add("hide-experimental")};c(),this.sim.showExperimentalChangeEmitter.on(c),this.addKnownIssues(s);const d=this.rootElem.querySelector(".sim-title");new yI(d,s.spec,{noDropdown:this.isWithinRaidSim}),this.simActionsContainer=this.rootElem.querySelector(".sim-sidebar-actions"),this.iterationsPicker=new Fn(this.simActionsContainer,this.sim,{id:"simui-iterations",label:"Iterations",extraCssClasses:["iterations-picker","within-raid-sim-hide"],changedEvent:e=>e.iterationsChangeEmitter,getValue:e=>e.getIterations(),setValue:(e,t,s)=>{t.setIterations(e,s)}}).rootElem;const h=this.rootElem.querySelector(".sim-sidebar-results");this.resultsViewer=new zn(h);const u=this.rootElem.querySelector(".sim-sidebar-socials");u.appendChild(SI.buildDiscordLink()),u.appendChild(SI.buildGitHubLink()),u.appendChild(SI.buildPatreonLink()),this.simTabContentsContainer=this.rootElem.querySelector(".sim-main.tab-content"),this.isWithinRaidSim||window.addEventListener("message",(async e=>{"runOnce"==e.data&&this.runSimOnce()}))}addAction(e,t,s){const i=document.createElement("button");i.classList.add("btn","btn-primary","w-100",t),i.textContent=e,i.addEventListener("click",s),this.simActionsContainer.appendChild(i)}addTab(e,t,s){const i=t.replace(/\s+/g,"-")+"-tab",a=0==this.simTabContentsContainer.children.length;this.simHeader.addTab(e,i);const n=document.createElement("fragment");n.innerHTML=`\n\t\t\t<div\n\t\t\t\tid="${i}"\n\t\t\t\tclass="tab-pane fade ${a?"active show":""}"\n\t\t\t>${s}</div>\n\t\t`,this.simTabContentsContainer.appendChild(n.children[0])}addSimTab(e){this.simHeader.addSimTabLink(e)}addWarning(e){this.resultsViewer.addWarning(e)}addKnownIssues(e){let t="";t=e.simStatus.status==fI.Unlaunched?"This sim is a WORK IN PROGRESS. It is not fully developed and should not be used for general purposes.":e.simStatus.status==fI.Alpha?"This sim is in ALPHA status. New runes and items may not yet be functional and further testing is needed.":"This sim is in BETA status. New runes and items should be mostly functional.",t&&(e.knownIssues=[t].concat(e.knownIssues||[])),e.knownIssues&&e.knownIssues.length&&e.knownIssues.forEach((e=>this.simHeader.addKnownIssue(e))),EI.forEach((e=>this.simHeader.addKnownIssue(e)))}getSettingsStorageKey(){return this.getStorageKey("__currentSettings__")}getSavedEncounterStorageKey(){return"sharedData__savedEncounter__"}isIndividualSim(){return this.rootElem.classList.contains("individual-sim-ui")}async runSim(e){this.resultsViewer.setPending();try{await this.sim.signalManager.abortType(ae.All);const t=await this.sim.runRaidSim(m.nextEventID(),e);t instanceof Gi||t.type!=se.ErrorOutcomeAborted||new $n({variant:"info",body:"Raid sim cancelled."})}catch(t){this.resultsViewer.hideAll(),this.handleCrash(t)}}async runSimOnce(){this.resultsViewer.setPending();try{await this.sim.runRaidSimWithLogs(m.nextEventID())}catch(e){this.resultsViewer.hideAll(),this.handleCrash(e)}}async handleCrash(e){if(!(e instanceof dw))return void alert(e);const t=e.errorStr;if(t.startsWith("[USER_ERROR] ")){let e=t.substring(13);return e=await C.replaceAllInString(e),void alert(e)}if(window.confirm("Simulation Failure:\n"+t+"\nPress Ok to file crash report")){const e=this.hashCode(t),s=this.toLink(),i=this.sim.getLastUsedRngSeed();fetch("https://api.github.com/search/issues?q=is:issue+is:open+repo:wowsims/sod+"+e).then((a=>{a.json().then((a=>{if(a.total_count>0)window.open(a.items[0].html_url,"_blank");else{const a=`${"https://github.com/wowsims/sod/issues/new?assignees=&labels=&title=Crash%20Report%20"}${e}&body=`,n=2048-a.length;let o=encodeURIComponent(`Link:\n${s}\n\nRNG Seed: ${i}\n\n${t}`);s.includes("/raid/")&&(o=encodeURIComponent(`${t}\nRNG Seed: ${i}\nLink:\n${s}`));let l=!1;for(;o.length>n-(l?3:0);)o=o.slice(0,o.lastIndexOf("%")),l=!0;l&&(o+="...",new kI(this.rootElem,s)),window.open(a+o,"_blank")}}))})).catch((e=>{alert("Failed to file report... try again another time:"+e)}))}}hashCode(e){let t=0;for(let s=0,i=e.length;s<i;s++){t=(t<<5)-t+e.charCodeAt(s),t|=0}return t}}class kI extends Vn{constructor(e,t){super(e,"crash",{title:"Extra Crash Information"}),this.body.innerHTML='\n\t\t\t<div class="sim-crash-report">\n\t\t\t\t<h3 class="sim-crash-report-header">Please append the following complete link to the issue you just created. This will simplify debugging the issue.</h3>\n\t\t\t\t<textarea class="sim-crash-report-text form-control"></textarea>\n\t\t\t</div>\n\t\t';const s=document.createTextNode(t);this.body.querySelector("textarea")?.appendChild(s)}}function CI(e,t){return function(e,t){jI[e]=t}(e,t),t}const LI=[];class TI extends PI{constructor(e,t,s){super(e,t.sim,{cssClass:s.cssClass,cssScheme:s.cssScheme,spec:t.spec,knownIssues:s.knownIssues,simStatus:wI[t.spec],noticeText:l("span",null,"Find optimal build recommendations for Phase 8 on our"," ",l("a",{href:"https://docs.google.com/spreadsheets/d/e/2PACX-1vSWYkkIsvWV4N09okuB2vTi2yEAYJD-QbOUli9kQgK1xzcLbA6EaLHwxDVfvwwPHUpYdSgLQ6wrSEAL/pubhtml",target:"_blank"},"community spreadsheet"),"!")}),this.rootElem.classList.add("individual-sim-ui"),this.player=t,this.individualConfig=s,this.raidSimResultsManager=null,this.prevEpIterations=0,this.prevEpSimResult=null,this.statWeightActionSettings=new uI(this),(s.itemSwapSlots||[]).length>0&&!LI.includes(t.spec)&&LI.push(t.spec),this.addWarning({updateOn:m.onAny([this.player.gearChangeEmitter,this.player.professionChangeEmitter]),getContent:()=>{const e=this.player.getGear().getFailedProfessionRequirements(this.player.getProfessions());return 0==e.length?"":e.map((e=>`${e.name} requires ${Ei.get(e.requiredProfession)}, but it is not selected.`))}}),this.addWarning({updateOn:m.onAny([this.player.talentsChangeEmitter,this.player.levelChangeEmitter]),getContent:()=>{const e=Ki(this.player.getTalentsString());return 0==e?"":e<this.player.getLevel()-9?Ji:e>this.player.getLevel()-9?Zi:""}}),this.addWarning({updateOn:m.onAny([this.player.gearChangeEmitter,this.player.talentsChangeEmitter]),getContent:()=>this.player.canDualWield2H()||(this.player.getEquippedItem(h.ItemSlotMainHand)?.item.handType!=wi.HandTypeTwoHand||null==this.player.getEquippedItem(h.ItemSlotOffHand))&&this.player.getEquippedItem(h.ItemSlotOffHand)?.item.handType!=wi.HandTypeTwoHand?"":Yi}),(s.warnings||[]).forEach((e=>this.addWarning(e(this)))),this.isWithinRaidSim||this.sim.waitForInit().then((()=>{this.loadSettings(),rs(this.player.spec)&&alert(Qi)})),this.addSidebarComponents(),this.addGearTab(),this.bt=this.addBulkTab(),this.addSettingsTab(),this.addTalentsTab(),this.addRotationTab(),this.isWithinRaidSim||this.addDetailedResultsTab(),this.addTopbarComponents()}loadSettings(){const e=m.nextEventID();m.freezeAllAndDo((()=>{this.applyDefaults(e);const t=window.localStorage.getItem(this.getSettingsStorageKey());if(null!=t)try{const s=K.fromJsonString(t);this.fromProto(e,s)}catch(s){console.warn("Failed to parse saved settings: "+s)}try{const t=zc.tryParseUrlLocation(window.location);t&&this.fromProto(e,t.settings,t.categories)}catch(s){console.warn("Failed to parse link settings: "+s)}window.location.hash="",this.player.setName(e,"Player"),this.changeEmitter.on((e=>{const t=K.toJsonString(this.toProto());window.localStorage.setItem(this.getSettingsStorageKey(),t)})),this.statWeightActionSettings.load(e)}))}addSidebarComponents(){this.raidSimResultsManager=Xi(this),function(e,t,s,i,a){let n;e.addAction("Stat Weights","ep-weights-action",(()=>{n||(n=new gI(e,t,s||[],i,a)),n.open()}))}(this,this.individualConfig.epStats.concat(ta),ea.concat(this.individualConfig.epPseudoStats??[]),this.individualConfig.epReferenceStat,this.statWeightActionSettings);const e=[];this.individualConfig.displayStats.forEach((t=>e.push(_n.fromStat(t)))),Gs.forEach((t=>e.push(_n.fromStat(t)))),this.individualConfig.displayPseudoStats.forEach((t=>e.push(_n.fromPseudoStat(t)))),sa.forEach((t=>e.push(_n.fromPseudoStat(t)))),new Hn(this.rootElem.getElementsByClassName("sim-sidebar-stats")[0],this.player,e,this.individualConfig.modifyDisplayStats)}addGearTab(){new nd(this.simTabContentsContainer,this).rootElem.classList.add("active","show")}addBulkTab(){const e=new $c(this.simTabContentsContainer,this);return e.navLink.hidden=!this.sim.getShowExperimental(),this.sim.showExperimentalChangeEmitter.on((()=>{e.navLink.hidden=!this.sim.getShowExperimental()})),e}addSettingsTab(){new mI(this.simTabContentsContainer,this)}addTalentsTab(){new hI(this.simTabContentsContainer,this)}addRotationTab(){new Sm(this.simTabContentsContainer,this)}addDetailedResultsTab(){this.addTab("Results","detailed-results-tab",'\n\t\t\t<div class="detailed-results">\n\t\t\t</div>\n\t\t'),new ia(this.rootElem.getElementsByClassName("detailed-results")[0],this,this.raidSimResultsManager)}addTopbarComponents(){this.simHeader.addImportLink("JSON",new No(this.rootElem,this),!0),this.simHeader.addImportLink("60U SoD",new Lo(this.rootElem,this),!0),this.simHeader.addImportLink("Addon",new To(this.rootElem,this),!0),this.simHeader.addExportLink("Link",new Xc(this.rootElem,this),!1),this.simHeader.addExportLink("JSON",new Qc(this.rootElem,this),!0),this.simHeader.addExportLink("60U SoD EP",new Yc(this.rootElem,this),!1),this.simHeader.addExportLink("Pawn EP",new td(this.rootElem,this),!1)}applyEmptyAplRotation(e){m.freezeAllAndDo((()=>{this.player.setAplRotation(e,pe.create({type:ue.TypeAPL}))}))}applyDefaults(e){m.freezeAllAndDo((()=>{const t=Fs(this.player.spec),s=rs(this.player.spec);this.player.applySharedDefaults(e),this.player.setRace(e,this.individualConfig.defaults.race??xi[this.player.spec][0]),this.player.setLevel(e,aa[wI[this.player.spec].phase]),this.player.setGear(e,this.sim.db.lookupEquipmentSpec(this.individualConfig.defaults.gear)),this.individualConfig.defaults.itemSwap&&this.player.itemSwapSettings.setItemSwapSettings(e,!0,this.sim.db.lookupItemSwap(this.individualConfig.defaults.itemSwap||Ie.create())),this.player.setConsumes(e,this.individualConfig.defaults.consumes),this.player.setTalentsString(e,this.individualConfig.defaults.talents.talentsString),this.player.setSpecOptions(e,this.individualConfig.defaults.specOptions),this.player.setBuffs(e,this.individualConfig.defaults.individualBuffs),this.player.getParty().setBuffs(e,this.individualConfig.defaults.partyBuffs),this.player.getRaid().setBuffs(e,this.individualConfig.defaults.raidBuffs),this.player.setEpWeights(e,this.individualConfig.defaults.epWeights);const i=this.player.getDefaultEpRatios(t,s);this.player.setEpRatios(e,i),this.player.setProfession1(e,this.individualConfig.defaults.other?.profession1||G.Engineering),this.player.setProfession2(e,this.individualConfig.defaults.other?.profession2||G.ProfessionUnknown),this.player.setDistanceFromTarget(e,this.individualConfig.defaults.other?.distanceFromTarget||0),this.player.setChannelClipDelay(e,this.individualConfig.defaults.other?.channelClipDelay||0),this.isWithinRaidSim?this.sim.raid.setTargetDummies(e,0):(this.sim.raid.setTargetDummies(e,s?9:0),this.sim.encounter.applyDefaults(e),this.sim.raid.setDebuffs(e,this.individualConfig.defaults.debuffs),this.sim.applyDefaults(e,t,s),t?this.sim.raid.setTanks(e,[this.player.makeUnitReference()]):this.sim.raid.setTanks(e,[])),this.statWeightActionSettings.applyDefaults(e)}))}getSavedGearStorageKey(){return this.getStorageKey("__savedGear__")}getSavedRotationStorageKey(){return this.getStorageKey("__savedRotation__")}getSavedSettingsStorageKey(){return this.getStorageKey("__savedSettings__")}getSavedTalentsStorageKey(){return this.getStorageKey("__savedTalents__")}getStorageKey(e){return na[this.player.spec]+e}toProto(e){const t=t=>!e||0==e.length||e.includes(t),s=K.create({player:this.player.toProto(!0,!1,e)});return t(ao.Miscellaneous)&&K.mergePartial(s,{tanks:this.sim.raid.getTanks()}),t(ao.Encounter)&&K.mergePartial(s,{encounter:this.sim.encounter.toProto()}),t(ao.External)&&K.mergePartial(s,{partyBuffs:this.player.getParty()?.getBuffs()||Ti.create(),raidBuffs:this.sim.raid.getBuffs(),debuffs:this.sim.raid.getDebuffs(),targetDummies:this.sim.raid.getTargetDummies()}),t(ao.UISettings)&&K.mergePartial(s,{settings:this.sim.toProto(),epWeightsStats:this.player.getEpWeights().toProto(),epRatios:this.player.getEpRatios(),dpsRefStat:this.dpsRefStat,healRefStat:this.healRefStat,tankRefStat:this.tankRefStat}),s}toLink(){return Xc.createLink(this)}fromProto(e,t,s){const i=e=>!s||0==s.length||s.includes(e),a=Fs(this.player.spec),n=rs(this.player.spec);m.freezeAllAndDo((()=>{if(t.player){if(this.player.fromProto(e,t.player,s),i(ao.Miscellaneous)&&this.sim.raid.setTanks(e,t.tanks||[]),i(ao.External)){this.sim.raid.setBuffs(e,t.raidBuffs||ve.create()),this.sim.raid.setDebuffs(e,t.debuffs||Se.create());const s=this.player.getParty();s&&s.setBuffs(e,t.partyBuffs||Ti.create()),this.sim.raid.setTargetDummies(e,t.targetDummies)}if(i(ao.Encounter)&&this.sim.encounter.fromProto(e,t.encounter||ge.create()),i(ao.UISettings)){t.epWeightsStats?this.player.setEpWeights(e,Dn.fromProto(t.epWeightsStats)):this.player.setEpWeights(e,this.individualConfig.defaults.epWeights);const s=this.player.getDefaultEpRatios(a,n);if(t.epRatios){const i=new Array(s.length-t.epRatios.length).fill(0);this.player.setEpRatios(e,t.epRatios.concat(i))}else this.player.setEpRatios(e,s);t.dpsRefStat&&(this.dpsRefStat=t.dpsRefStat),t.healRefStat&&(this.healRefStat=t.healRefStat),t.tankRefStat&&(this.tankRefStat=t.tankRefStat),t.settings?this.sim.fromProto(e,t.settings):this.sim.applyDefaults(e,a,n)}}}))}}let NI={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};function AI(e,t){return window.getComputedStyle(t)[e]}class RI{constructor(e,t){this.last_cluster=0,this.scroll_debounce=0,this.pointer_events_set=!1,this.resize_debounce=0,this.cache={},this.options={rows_in_block:void 0!==t.rows_in_block?t.rows_in_block:NI.rows_in_block,blocks_in_cluster:void 0!==t.blocks_in_cluster?t.blocks_in_cluster:NI.blocks_in_cluster,show_no_data_row:void 0!==t.show_no_data_row?t.show_no_data_row:NI.show_no_data_row,no_data_class:void 0!==t.no_data_class?t.no_data_class:NI.no_data_class,no_data_text:void 0!==t.no_data_text?t.no_data_text:NI.no_data_text,keep_parity:void 0!==t.keep_parity?t.keep_parity:NI.keep_parity,tag:void 0!==t.tag?t.tag:NI.tag,callbacks:void 0!==t.callbacks?t.callbacks:NI.callbacks,cluster_height:0,item_height:void 0!==t.item_height?t.item_height:0,content_tag:"",block_height:0,scroll_top:0,rows_in_cluster:0},this.ds=e,this.displayedRows=t.rows,this.scroll_elem=t.scroll_elem,this.content_elem=t.content_elem,this.content_elem.hasAttribute("tabindex")||this.content_elem.setAttribute("tabindex","0");let s=this.scroll_elem.scrollTop;this.getRowsHeight(t.rows),this.insertToDom(t.rows,this.cache),this.scroll_elem.scrollTop=s,this.scroll_elem.addEventListener("scroll",this.scrollEv.bind(this)),window.addEventListener("resize",this.resizeEv.bind(this))}destroy(e){this.scroll_elem.removeEventListener("scroll",this.scrollEv.bind(this)),window.removeEventListener("resize",this.resizeEv.bind(this)),e&&this.setContentElemRows(this.generateEmptyRow())}dispose(){this.destroy()}refresh(e){(this.getRowsHeight(this.displayedRows)||e)&&this.update()}update(){let e=this.scroll_elem.scrollTop;this.ds.getNumberOfRows()*this.options.item_height<e&&(this.scroll_elem.scrollTop=0,this.last_cluster=0),this.insertToDom(this.displayedRows,this.cache),this.scroll_elem.scrollTop=e}elementUpdate(e){for(let t of this.displayedRows)e(t)}getScrollProgress(){return this.options.scroll_top/(this.ds.getNumberOfRows()*this.options.item_height)*100||0}scrollEv(){navigator.platform.toLowerCase().indexOf("mac")+1&&(this.pointer_events_set||(this.content_elem.style.pointerEvents="none"),this.pointer_events_set=!0,clearTimeout(this.scroll_debounce),this.scroll_debounce=window.setTimeout((()=>{this.content_elem.style.pointerEvents="auto",this.pointer_events_set=!1}),50)),this.last_cluster!=(this.last_cluster=this.getClusterNum(this.ds.getNumberOfRows()))&&this.insertToDom(this.displayedRows,this.cache),this.options.callbacks.scrollingProgress&&this.options.callbacks.scrollingProgress(this.getScrollProgress())}resizeEv(){clearTimeout(this.resize_debounce),this.resize_debounce=window.setTimeout(this.refresh.bind(this),100)}insertToDom(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);let s=this.generate(),i=s.rows;this.displayedRows=s.rows;let a=this.checkChanges("data",i,t),n=this.checkChanges("top",s.top_offset,t),o=this.checkChanges("bottom",s.bottom_offset,t),l=this.options.callbacks,r=[];if(a||n){if(s.top_offset){if(this.options.keep_parity){let e=this.renderExtraTag("keep-parity");e.hidden=!0,r.push(e)}r.push(this.renderExtraTag("top-space",s.top_offset))}r.push(...i),s.bottom_offset&&r.push(this.renderExtraTag("bottom-space",s.bottom_offset)),l.clusterWillChange&&l.clusterWillChange(),this.setContentElemRows(r),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",s.rows_above.toString()),this.content_elem.style.counterIncrement="clusterize-counter "+(s.rows_above-1),l.clusterChanged&&l.clusterChanged()}else o&&(this.content_elem.lastChild.style.height=s.bottom_offset+"px")}exploreEnvironment(e,t){let s=this.options;s.content_tag=this.content_elem.tagName.toLowerCase(),e.length&&(this.content_elem.children.length<=1&&this.setContentElemRows([e[0],e[0],e[0]]),s.tag||(s.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(e))}setContentElemRows(e){this.content_elem.innerHTML="",this.content_elem.append(...e)}getRowsHeight(e){let t=this.options,s=t.item_height;t.cluster_height=0;let i=this.content_elem.children;if(e.length&&i.length){let e=i[Math.floor(i.length/2)];if(t.item_height=e.offsetHeight,"tr"==t.tag&&"collapse"!=AI("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(AI("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag){let s=parseInt(AI("marginTop",e),10)||0,i=parseInt(AI("marginBottom",e),10)||0;t.item_height+=Math.max(s,i)}}return t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,s!=t.item_height}generate(){let e=this.options,t=this.ds.getNumberOfRows();if(t<e.rows_in_block){let e=this.ds.generateRows(0,t);return{top_offset:0,bottom_offset:0,rows_above:0,rows:t?e:this.generateEmptyRow()}}let s=Math.max((e.rows_in_cluster-e.rows_in_block)*this.getClusterNum(t),0),i=s+e.rows_in_cluster,a=Math.max(s*e.item_height,0),n=Math.max((t-i)*e.item_height,0),o=[],l=s;return a<1&&l++,o=this.ds.generateRows(s,i),{top_offset:a,bottom_offset:n,rows_above:l,rows:o}}generateEmptyRow(){let e=this.options;if(!e.tag||!e.show_no_data_row)return[];let t,s=document.createElement(e.tag),i=document.createTextNode(e.no_data_text);return s.className=e.no_data_class,"tr"==e.tag&&(t=document.createElement("td"),t.colSpan=100,t.appendChild(i)),s.appendChild(t||i),[s]}getClusterNum(e){let t=this.options;t.scroll_top=this.scroll_elem.scrollTop;let s=Math.max(t.cluster_height-t.block_height,1),i=Math.floor(t.scroll_top/s),a=Math.floor(e*t.item_height/s);return Math.min(i,a)}renderExtraTag(e,t){let s=document.createElement(this.options.tag),i="clusterize-";return s.className=[i+"extra-row",i+e].join(" "),s.style.marginTop="0",s.style.marginBottom="0",t&&(s.style.height=t+"px"),s}checkChanges(e,t,s){var i=t!=s[e];return s[e]=t,i}}const _I={[ne.UNSPECIFIED]:"None",[ne.ALLIANCE_ONLY]:"Alliance only",[ne.HORDE_ONLY]:"Horde only"};class DI extends Vn{constructor(t,s,i){super(t,"filters-menu",{size:"md",title:"Filters"});const a=this.newSection("General"),n=l("div",{className:"ilvl-filters"});a.appendChild(n),new Fn(n,s.sim,{id:"filters-min-ilvl",label:"Min ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minIlvl,setValue:(e,t,s)=>{const i=t.getFilters();i.minIlvl=s,t.setFilters(e,i)}}),n.appendChild(l("span",{className:"ilvl-filters-separator"},"-")),new Fn(n,s.sim,{id:"filters-max-ilvl",label:"Max ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxIlvl,setValue:(e,t,s)=>{const i=t.getFilters();i.maxIlvl=s,t.setFilters(e,i)}}),new od(a,s.sim,{id:"filters-faction-restriction",label:"Faction Restrictions",values:[ne.UNSPECIFIED,ne.ALLIANCE_ONLY,ne.HORDE_ONLY].map((e=>({name:_I[e],value:e}))),changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().factionRestriction,setValue:(e,t,s)=>{const i=t.getFilters();i.factionRestriction=s,t.setFilters(e,i)}});const o=this.newSection("Source");o.classList.add("filters-menu-section-bool-list");if(cw.ALL_SOURCES.filter((e=>e!=oa.SourceUnknown)).forEach((e=>{new re(o,s.sim,{id:`filters-source-${e}`,label:la.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().sources.includes(e),setValue:(t,s,i)=>{const a=s.getFilters();i?a.sources.push(e):a.sources=a.sources.filter((t=>t!=e)),s.setFilters(t,a)}})})),KI.ARMOR_SLOTS.includes(i)){const t=ra[s.getClass()];if(t>=ca.ArmorTypeLeather){const i=this.newSection("Armor Type");i.classList.add("filters-menu-section-bool-list");e(ca).filter((e=>e!=ca.ArmorTypeUnknown)).filter((e=>e<=t)).forEach((e=>{new re(i,s.sim,{id:`filters-armor-type-${e}`,label:da.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().armorTypes.includes(e),setValue:(t,s,i)=>{const a=s.getFilters();i?a.armorTypes.push(e):a.armorTypes=a.armorTypes.filter((t=>t!=e)),s.setFilters(t,a)}})}))}}else if(KI.WEAPON_SLOTS.includes(i)){const e=this.newSection("Weapon Type");e.classList.add("filters-menu-section-bool-list");ma[s.getClass()].map((e=>e.weaponType)).forEach((t=>{new re(e,s.sim,{id:`filters-weapon-type-${t}`,label:ha.get(t),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().weaponTypes.includes(t),setValue:(e,s,i)=>{const a=s.getFilters();i?a.weaponTypes.push(t):a.weaponTypes=a.weaponTypes.filter((e=>e!=t)),s.setFilters(e,a)}})}));const t=this.newSection("Weapon Speed");t.classList.add("filters-menu-section-number-list"),new Fn(t,s.sim,{id:"filters-min-weapon-speed",label:"Min MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minMhWeaponSpeed,setValue:(e,t,s)=>{const i=t.getFilters();i.minMhWeaponSpeed=s,t.setFilters(e,i)}}),new Fn(t,s.sim,{id:"filters-max-weapon-speed",label:"Max MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxMhWeaponSpeed,setValue:(e,t,s)=>{const i=t.getFilters();i.maxMhWeaponSpeed=s,t.setFilters(e,i)}}),ua(s)&&(new Fn(t,s.sim,{id:"filters-min-oh-weapon-speed",label:"Min OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minOhWeaponSpeed,setValue:(e,t,s)=>{const i=t.getFilters();i.minOhWeaponSpeed=s,t.setFilters(e,i)}}),new Fn(t,s.sim,{id:"filters-max-oh-weapon-speed",label:"Max OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxOhWeaponSpeed,setValue:(e,t,s)=>{const i=t.getFilters();i.maxOhWeaponSpeed=s,t.setFilters(e,i)}}))}else if(i==h.ItemSlotRanged){const e=pa[s.getClass()];if(e.length<=1)return;const t=this.newSection("Ranged Weapon Type");t.classList.add("filters-menu-section-bool-list"),e.forEach((e=>{new re(t,s.sim,{id:`filter-ranged-weapon-type-${e}`,label:ga.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().rangedWeaponTypes.includes(e),setValue:(t,s,i)=>{const a=s.getFilters();i?a.rangedWeaponTypes.push(e):a.rangedWeaponTypes=a.rangedWeaponTypes.filter((t=>t!=e)),s.setFilters(t,a)}})}));const i=this.newSection("Ranged Weapon Speed");i.classList.add("filters-menu-section-number-list"),new Fn(i,s.sim,{id:"filters-min-ranged-weapon-speed",label:"Min Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minRangedWeaponSpeed,setValue:(e,t,s)=>{const i=t.getFilters();i.minRangedWeaponSpeed=s,t.setFilters(e,i)}}),new Fn(i,s.sim,{id:"filters-max-ranged-weapon-speed",label:"Max Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxRangedWeaponSpeed,setValue:(e,t,s)=>{const i=t.getFilters();i.maxRangedWeaponSpeed=s,t.setFilters(e,i)}})}}newSection(e){const t=document.createElement("div");return t.classList.add("menu-section",`${e.toLowerCase().replaceAll(" ","-")}-section`),this.body.appendChild(t),t.innerHTML=`\n\t\t\t<div class="menu-section-header">\n\t\t\t\t<h6 class="menu-section-title">${e}</h6>\n\t\t\t</div>\n\t\t\t<div class="menu-section-content"></div>\n\t\t`,t.getElementsByClassName("menu-section-content")[0]}}class MI{constructor(e,t,s,i,a,n,o,c,d,u,p,g,f){this.sortBy=1,this.sortDirection=fa.DESC,this.id=e,this.label=o,this.simUI=s,this.player=n,this.itemData=d,this.computeEP=u,this.equippedToItemFn=p,this.onItemClick=f,this.slot=i,this.gearData=c,this.currentFilters=this.player.sim.getFilters();const I=o===a,w=r(),v=r(),b=r(),S=r(),x=r(),y=r(),E=r(),k=r(),C=r(),L=r();if(this.tabContent=l("div",{id:this.id,className:P("selector-modal-tab-pane tab-pane fade",I&&"active show")},l("div",{className:"selector-modal-filters"},l("input",{ref:w,className:"selector-modal-search form-control",type:"text",placeholder:"Search..."}),o===VI.Items&&l("button",{ref:b,className:"selector-modal-filters-button btn btn-primary"},"Filters"),l("div",{ref:x,className:"selector-modal-phase-selector hide"}),l("div",{ref:y,className:"sim-input selector-modal-boolean-option selector-modal-show-1h-weapons hide"}),l("div",{ref:E,className:"sim-input selector-modal-boolean-option selector-modal-show-2h-weapons hide"}),l("div",{ref:S,className:"sim-input selector-modal-boolean-option selector-modal-show-ep-values"}),l("button",{ref:C,className:"selector-modal-remove-button btn btn-danger"},"Unequip Item")),l("div",{className:"selector-modal-list-labels"},o===VI.Items&&l("h6",{className:"ilvl-label interactive",onclick:e=>{e.preventDefault(),this.sort(1)}},"ILvl"),l("h6",{className:"item-label"},o===VI.Items?"Item":o===VI.Enchants?"Enchant":o===VI.Runes?"Rune":""),o===VI.Items&&l("h6",{className:"source-label"},"Source"),l("h6",{className:"ep-label interactive",onclick:e=>{e.preventDefault(),this.sort(0)}},l("span",null,"EP"),l("i",{className:"fa-solid fa-plus-minus fa-2xs"}),l("button",{ref:v,className:"btn btn-link p-0 ms-1"},l("i",{className:"far fa-question-circle fa-lg"}))),l("h6",{className:"favorite-label"}),l("h6",{ref:L,className:"compare-label hide"})),l("ul",{ref:k,className:"selector-modal-list"})),t.appendChild(this.tabContent),this.label===VI.Items&&this.bindToggleCompare(L.value),Ln(v.value,{content:Ia}),o===VI.Items&&(i===h.ItemSlotMainHand||i===h.ItemSlotOffHand&&n.getClass()===F.ClassWarrior)&&(function(e,t){e.classList.remove("hide"),new re(e,t,{id:"show-1h-weapons-selector",extraCssClasses:["show-1h-weapons-selector","mb-0"],label:"1H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().oneHandedWeapons,setValue:(e,t,s)=>{const i=t.getFilters();i.oneHandedWeapons=s,t.setFilters(e,i)}})}(y.value,n.sim),function(e,t){e.classList.remove("hide"),new re(e,t,{id:"show-2h-weapons-selector",extraCssClasses:["show-2h-weapons-selector","mb-0"],label:"2H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().twoHandedWeapons,setValue:(e,t,s)=>{const i=t.getFilters();i.twoHandedWeapons=s,t.setFilters(e,i)}})}(E.value,n.sim)),this.label!==VI.Runes&&function(e,t){new re(e,t,{id:"show-ep-values-selector",extraCssClasses:["show-ep-values-selector","input-inline","mb-0"],label:"Show EP",inline:!0,changedEvent:e=>e.showEPValuesChangeEmitter,getValue:e=>e.getShowEPValues(),setValue:(e,t,s)=>{t.setShowEPValues(e,s)}})}(S.value,n.sim),o===VI.Items){const e=new DI(t,n,i);b.value?.addEventListener("click",(()=>e.open()))}this.listElem=this.tabContent.getElementsByClassName("selector-modal-list")[0],this.itemsToDisplay=[],this.scroller=new RI({getNumberOfRows:()=>this.itemsToDisplay.length,generateRows:(e,t)=>{const s=[];for(let i=e;i<t&&!(i>=this.itemsToDisplay.length);++i)s.push(this.createItemElem({idx:this.itemsToDisplay[i],data:this.itemData[this.itemsToDisplay[i]]}));return s}},{rows:[],scroll_elem:this.listElem,content_elem:this.listElem,item_height:56,show_no_data_row:!1,no_data_text:"",tag:"li",rows_in_block:16,blocks_in_cluster:2});const T=C.value;if(T)switch(T.addEventListener("click",(e=>{g(m.nextEventID())})),o){case VI.Enchants:T.textContent="Remove Enchant";break;case VI.Runes:T.textContent="Remove Rune"}this.updateSelected(),this.searchInput=this.tabContent.getElementsByClassName("selector-modal-search")[0],this.searchInput.addEventListener("input",(()=>this.applyFilters()))}sizeRefresh(){this.scroller.refresh(!0),this.applyFilters()}dispose(){this.scroller.dispose()}getItemIdByItemType(e){if(!e)return null;switch(this.label){case VI.Enchants:return e.effectId;case VI.Items:case VI.RandomSuffixes:case VI.Runes:return e.id;default:return null}}updateSelected(){const e=this.gearData.getEquippedItem(),t=this.equippedToItemFn(e),s=this.getItemIdByItemType(t),i=t?this.computeEP(t):0;this.scroller.elementUpdate((e=>{const t=e.dataset.idx,a=this.itemData[parseFloat(t)];a.id===s?e.classList.add("active"):e.classList.remove("active");const n=e.querySelector(".selector-modal-list-item-ep-delta");if(n&&(n.textContent="",a.item)){const e=this.computeEP(a.item);i!==e&&wa(n,i,e,0)}}))}applyFilters(){this.currentFilters=this.player.sim.getFilters();let e=new Array(this.itemData.length);for(let i=0;i<this.itemData.length;++i)e[i]=i;const t=this.gearData.getEquippedItem();this.label===VI.Items?e=this.player.filterItemData(e,(e=>this.itemData[e].item),this.slot):this.label===VI.Enchants&&(e=this.player.filterEnchantData(e,(e=>this.itemData[e].item),this.slot,t));const s=this.searchInput.value.toLowerCase().split(/:|,|\s/);"is"===s[0]?(s.shift(),s.forEach((t=>{"timeworn"===t?e=e.filter((e=>{const t=this.itemData[e];return t.item?.timeworn})):"sanctified"===t?e=e.filter((e=>{const t=this.itemData[e];return t.item?.sanctified})):"set"===t&&(e=e.filter((e=>{const t=this.itemData[e];return""!==t.item?.setName})))}))):e=e.filter((e=>{const t=this.itemData[e];if(this.searchInput.value.length){const e=t.name.toString().toLowerCase().replaceAll(/[^a-zA-Z0-9\s]/g,"");let i=!0;if(s.some((t=>{console.log(t),e.includes(t)||(i=!1)})),!i)return!1}return!0})),[h.ItemSlotTrinket1,h.ItemSlotTrinket2].includes(this.slot)||this.slot===h.ItemSlotRanged&&[F.ClassShaman,F.ClassPaladin,F.ClassDruid].includes(this.player.getClass())?this.sortBy=1:this.sortBy=0,e=this.sortIdxs(e),this.itemsToDisplay=e,this.scroller.update(),this.hideOrShowEPValues()}sort(e){this.sortBy===e?this.sortDirection=1-this.sortDirection:this.sortDirection=fa.DESC,this.sortBy=e,this.itemsToDisplay=this.sortIdxs(this.itemsToDisplay),this.scroller.update()}sortIdxs(e){let t=(e,t)=>{const s=this.sortDirection===fa.DESC?t:e,i=this.sortDirection===fa.DESC?e:t,a=this.computeEP(s)-this.computeEP(i);return Math.abs(a)<.01?s.ilvl-i.ilvl:a};if(1===this.sortBy)t=(e,t)=>{const s=this.sortDirection===fa.DESC?t:e,i=this.sortDirection===fa.DESC?e:t;return s.ilvl-i.ilvl};return e.sort(((e,s)=>{const i=this.itemData[e],a=this.itemData[s];return this.isItemFavorited(i)&&!this.isItemFavorited(a)?-1:this.isItemFavorited(a)&&!this.isItemFavorited(i)?1:t(i.item,a.item)}))}hideOrShowEPValues(){const e=this.tabContent.getElementsByClassName("ep-label"),t=this.tabContent.getElementsByClassName("selector-modal-list"),s=this.label!=VI.Runes&&this.player.sim.getShowEPValues(),i=s?"":"none";for(const a of e)a.style.display=i;for(const a of t)s?a.classList.remove("hide-ep"):a.classList.add("hide-ep")}createItemElem(e){const t=e.data,s=this.computeEP(t.item),i=this.equippedToItemFn(this.gearData.getEquippedItem()),a=this.getItemIdByItemType(i),n=i?this.computeEP(i):0,o=r(),c=r(),d=r(),u=r(),p=r(),g=r(),f=r(),I=l("li",{className:P("selector-modal-list-item",a===t.id&&"active"),dataset:{idx:e.idx.toString()}},this.label===VI.Items&&l("div",{className:"selector-modal-list-item-ilvl-container"},t.item.ilvl),l("div",{className:"selector-modal-list-label-cell"},l("a",{className:"selector-modal-list-item-link",ref:c,dataset:{whtticon:"false"}},l("img",{className:"selector-modal-list-item-icon",ref:d}),l("label",{className:"selector-modal-list-item-name",ref:o},t.name))),this.label===VI.Items&&l("div",{className:"selector-modal-list-item-source-container"},this.getSourceInfo(t.item,this.player.sim)),![h.ItemSlotTrinket1,h.ItemSlotTrinket2].includes(this.slot)&&l("div",{className:"selector-modal-list-item-ep"},l("span",{className:"selector-modal-list-item-ep-value"},s<9.95?s.toFixed(1).toString():Math.round(s).toString()),l("span",{className:"selector-modal-list-item-ep-delta",ref:e=>t.item&&n!==s&&wa(e,n,s,0)})),l("div",{className:"selector-modal-list-item-favorite-container"},l("button",{className:"selector-modal-list-item-favorite btn btn-link p-0",ref:u},l("i",{ref:p,className:"far fa-star fa-xl"}))),l("div",{ref:g,className:"selector-modal-list-item-compare-container hide"},l("button",{className:"selector-modal-list-item-compare btn btn-link p-0",ref:f},l("i",{className:"fas fa-arrow-right-arrow-left fa-xl"})))),w=e=>{const s=this.player.sim.getFilters();let i,a;switch(this.label){case VI.Items:i="favoriteItems",a=t.id;break;case VI.Enchants:i="favoriteEnchants",a=Jn(t.item);break;case VI.Runes:i="favoriteRunes",a=t.id;break;case VI.RandomSuffixes:i="favoriteRandomSuffixes",a=t.id;break;default:return}if(e)s[i].push(a);else{const e=s[i].indexOf(a);-1!==e&&s[i].splice(e,1)}u.value.classList.toggle("text-brand"),p.value.classList.toggle("fas"),p.value.classList.toggle("far"),I.dataset.fav=e.toString(),this.player.sim.setFilters(m.nextEventID(),s)};u.value.addEventListener("click",(()=>w("false"===I.dataset.fav)));this.isItemFavorited(t)?(u.value.classList.add("text-brand"),p.value?.classList.add("fas"),I.dataset.fav="true"):(p.value?.classList.add("far"),I.dataset.fav="false");const v=Ln(u.value);var b;if(b="true"===I.dataset.fav,v.setContent(b?"Remove from favorites":"Add to favorites"),this.label===VI.Items){const e=Ln(f.value);this.bindToggleCompare(g.value);const s=this.simUI instanceof TI?this.simUI:null;if(s){const i=()=>s.bt.hasItem(j.create({id:t.id})),a=()=>{const t=i();e.setContent(t?"Remove from Batch sim":"Add to Batch sim"),f.value.classList[t?"add":"remove"]("text-brand")};a(),s.bt.itemsChangedEmitter.on((()=>{a()})),f.value.addEventListener("click",(()=>{const e=i();s.bt[e?"removeItem":"addItem"](j.create({id:t.id})),new $n({delay:1e3,variant:"success",body:l(k,null,l("strong",null,t.name)," was ",l(k,null,e?"removed from the batch":"added to the batch"),".")})}))}}return c.value.addEventListener("click",(e=>{if(e.preventDefault(),e.target===u.value)return!1;this.onItemClick(t)})),t.actionId.fill().then((e=>{e.setWowheadHref(c.value),d.value.src=e.iconUrl})),Wn(o.value,t.quality),I}isItemFavorited(e){return this.label===VI.Items?this.currentFilters.favoriteItems.includes(e.id):this.label===VI.Enchants?this.currentFilters.favoriteEnchants.includes(Jn(e.item)):this.label===VI.Runes?this.currentFilters.favoriteRunes.includes(e.id):this.label===VI.RandomSuffixes&&this.currentFilters.favoriteRandomSuffixes.includes(e.id)}getSourceInfo(e,t){const s=(e,t)=>l("a",{href:e,target:"_blank",dataset:{whtticon:"false"}},l("small",null,t));if(!e.sources||0==e.sources.length)return e.randomSuffixOptions.length?s(`${C.makeItemUrl(e.id)}#dropped-by`,l("div",{className:"d-flex align-items-center"},this.getDropSourceIcon(),l("span",null,"World Drop"))):l(k,null);let i=e.sources[0];if("crafted"==i.source.oneofKind){const t=i.source.crafted;return s(t.spellId?C.makeSpellUrl(t.spellId):C.makeItemUrl(e.id),l("div",{className:"d-flex align-items-center"},this.getProfessionSourceIcon(t.profession),Ei.get(t.profession)??"Unknown"))}if("drop"==i.source.oneofKind){const a=i.source.drop,n=t.db.getZone(a.zoneId),o=t.db.getNpc(a.npcId);return o?s(C.makeNpcUrl(o.id),l("div",{className:"d-flex"},this.getDropSourceIcon(),l("span",null,n&&n.name,n&&l("br",null),o.name,a.category&&` - ${a.category}`))):n?s(C.makeItemUrl(e.id),l("div",{className:"d-flex"},this.getDropSourceIcon(),l("span",null,n.name,l("br",null),a.otherName?a.otherName:"Multiple Sources"))):s(`${C.makeItemUrl(e.id)}#dropped-by`,l("div",{className:"d-flex"},this.getDropSourceIcon(),l("span",null,"Multiple Sources")))}if("quest"==i.source.oneofKind&&i.source.quest.name){const t=i.source.quest;return s(C.makeQuestUrl(t.id),l("div",{className:"d-flex"},l("span",{className:"d-flex me-1"},this.getQuestSourceIcon(),e.factionRestriction==ne.ALLIANCE_ONLY&&this.getAllianceSourceIcon(),e.factionRestriction==ne.HORDE_ONLY&&this.getHordeSourceIcon()),l("span",null,t.name)))}if("rep"==(i=e.sources.find((e=>"rep"==e.source.oneofKind))??i).source.oneofKind){const a=e.sources.filter((e=>"rep"==e.source.oneofKind)).map((e=>t.db.getFaction(e.source.rep.repFactionId))).filter((e=>!!e)),n=i.source.rep;return s(C.makeItemUrl(e.id),l("div",{className:"d-flex"},l("img",{src:"https://static.wikia.nocookie.net/wowpedia/images/1/1f/Pointer_buy_on_32x32.png",width:"16",height:"16"}),l("div",{className:"d-flex flex-column"},a.map((t=>l("div",{className:"d-flex"},(e.factionRestriction==ne.ALLIANCE_ONLY||va(t.id))&&l("span",{className:"d-flex me-1"},this.getAllianceSourceIcon()),(e.factionRestriction==ne.HORDE_ONLY||ba(t.id))&&l("span",{className:"d-flex me-1"},this.getHordeSourceIcon()),t.name," - ",Sa[n.repLevel]))))))}if("soldBy"==i.source.oneofKind){const t=i.source.soldBy;return t.npcId?s(C.makeNpcUrl(t.npcId),l("div",{className:"d-flex"},this.getVendorSourceIcon(),l("span",null,t.npcName))):s(`${C.makeItemUrl(e.id)}#sold-by`,l("div",{className:"d-flex"},this.getVendorSourceIcon(),l("span",null,"Vendor")))}return l(k,null)}bindToggleCompare(e){const t=()=>e.classList[this.player.sim.getShowExperimental()?"remove":"add"]("hide");t(),this.player.sim.showExperimentalChangeEmitter.on((()=>{t()}))}getDropSourceIcon(){return l("img",{src:"https://wow.zamimg.com/images/icons/boss.gif",className:"item-source-icon-drop me-1"})}getVendorSourceIcon(){return l("img",{src:"https://static.wikia.nocookie.net/wowpedia/images/1/1f/Pointer_buy_on_32x32.png",className:"item-source-icon-vendor me-1"})}getProfessionSourceIcon(e){let t="https://static.wikia.nocookie.net/wowpedia/images/6/63/Pointer_repair_off_32x32.png";switch(e){case G.Alchemy:t="https://wow.zamimg.com/images/wow/icons/tiny/trade_alchemy.gif";break;case G.Blacksmithing:t="https://wow.zamimg.com/images/wow/icons/tiny/trade_blacksmithing.gif";break;case G.Enchanting:t="https://wow.zamimg.com/images/wow/icons/tiny/trade_engraving.gif";break;case G.Engineering:t="https://wow.zamimg.com/images/wow/icons/tiny/trade_engineering.gif";break;case G.Leatherworking:t="https://wow.zamimg.com/images/wow/icons/tiny/trade_leatherworking.gif";break;case G.Tailoring:t="https://wow.zamimg.com/images/wow/icons/tiny/trade_tailoring.gif"}return l("img",{src:t,className:"item-source-icon-profession me-1"})}getQuestSourceIcon(){return l("img",{src:"https://wow.zamimg.com/images/wow/icons/tiny/quest-start.gif",className:"item-source-icon-quest"})}getAllianceSourceIcon(){return l("img",{src:"https://wow.zamimg.com/images/icons/alliance.png",className:"item-source-icon-alliance"})}getHordeSourceIcon(){return l("img",{src:"https://wow.zamimg.com/images/icons/horde.png",className:"item-source-icon-horde"})}}var VI=(e=>(e.Enchants="Enchant",e.Items="Item",e.RandomSuffixes="Random Suffix",e.Runes="Rune",e))(VI||{});class UI extends Vn{constructor(e,t,s,i,a){super(e,"selector-modal",{disposeOnClose:!1,size:"xl"}),this.ilists=[],this.itemSlotTabElems=[],this.currentSlot=h.ItemSlotHead,this.currentTab="Item",this.disabledTabs=[],this.simUI=t,this.player=s,this.gearPicker=i,this.options={id:ye(),...a},this.disabledTabs=this.options.disabledTabs||[],this.addItemSlotTabs(),this.header.insertAdjacentElement("afterbegin",l("div",null,l("h6",{className:"selector-modal-title"}),l("ul",{className:"nav nav-tabs selector-modal-tabs"}))),this.body.appendChild(l("div",{className:"tab-content selector-modal-tab-content"})),this.titleElem=this.rootElem.querySelector(".selector-modal-title"),this.tabsElem=this.rootElem.querySelector(".selector-modal-tabs"),this.contentElem=this.rootElem.querySelector(".selector-modal-tab-content"),this.body.appendChild(l("div",{className:"d-flex align-items-center form-text mt-auto"},l("i",{className:"fas fa-circle-exclamation fa-xl me-2"}),l("span",null,"If gear is missing, check the selected phase and your gear filters.",l("br",null),"If the problem persists, save any un-saved data, click the",l("i",{className:"fas fa-cog mx-1"}),'to open your sim options, then click the "Restore Defaults".')))}openTab(e,t,s){this.titleElem.textContent=N.get(e)??"",this.setData(e,t,s),this.setActiveItemSlotTab(e),this.open()}onShow(){if(this.gearPicker){const e=this.switchToPreviousItemSlotTab.bind(this),t=this.switchToNextItemSlotTab.bind(this);document.addEventListener("keydown",e),document.addEventListener("keydown",t),this.addOnHideCallback((()=>document.removeEventListener("keydown",e))),this.addOnHideCallback((()=>document.removeEventListener("keydown",t)))}}setData(e,t,s){this.tabsElem.innerText="",this.contentElem.innerText="",this.ilists=[];const i=s.getEquippedItem(),a=this.player.getItems(e),n=this.player.getEnchants(e),o=this.player.getRunes(e);("Enchant"===t&&!n.length||"Rune"===t&&!o.length)&&(t="Item"),this.currentTab=t,this.currentSlot=e;!this.disabledTabs?.includes("Item")&&this.addTab({id:xa(`${this.options.id}-Item`),label:"Item",gearData:s,itemData:a.map((t=>({item:t,id:t.id,actionId:C.fromItem(t),name:t.name,quality:t.quality,phase:t.phase,baseEP:this.player.computeItemEP(t,e),ignoreEPFilter:!1,onEquip:(e,t)=>{const i=s.getEquippedItem();i?s.equipItem(e,i.withItem(t)):s.equipItem(e,new ya({item:t}))}}))),computeEP:t=>this.player.computeItemEP(t,e),equippedToItemFn:e=>e?.item,onRemove:e=>{s.equipItem(e,null),this.removeTabs("Random Suffix")}});!this.disabledTabs?.includes("Enchant")&&this.addTab({id:xa(`${this.options.id}-Enchant`),label:"Enchant",gearData:s,itemData:n.map((e=>({item:e,id:e.effectId,actionId:e.itemId?C.fromItemId(e.itemId):C.fromSpellId(e.spellId),name:e.name,quality:e.quality,phase:e.phase||1,baseEP:this.player.computeStatsEP(new Dn(e.stats)),ignoreEPFilter:!0,onEquip:(e,t)=>{const i=s.getEquippedItem();i&&s.equipItem(e,i.withEnchant(t))}}))),computeEP:e=>this.player.computeEnchantEP(e),equippedToItemFn:e=>e?.enchant,onRemove:e=>{const t=s.getEquippedItem();t&&s.equipItem(e,t.withEnchant(null))}});!this.disabledTabs?.includes("Rune")&&this.addTab({id:xa(`${this.options.id}-Rune`),label:"Rune",gearData:s,itemData:o.map((e=>({item:e,id:e.id,actionId:C.fromSpellId(e.id),name:e.name,quality:c.ItemQualityCommon,phase:1,baseEP:1,ignoreEPFilter:!0,onEquip:(e,t)=>{const i=s.getEquippedItem();i&&s.equipItem(e,i.withRune(t))}}))),computeEP:()=>1,equippedToItemFn:e=>e?.rune,onRemove:e=>{const t=s.getEquippedItem();t&&s.equipItem(e,t.withRune(null))}});!this.disabledTabs?.includes("Random Suffix")&&this.addRandomSuffixTab(i,s),this.ilists.find((e=>t===e.label))?.sizeRefresh()}addItemSlotTabs(){this.gearPicker&&this.dialog.prepend(l("div",{className:"gear-picker-modal-slots"},this.gearPicker.itemPickers.map((e=>{const t=r(),s=l("div",{className:"item-picker-icon-wrapper",dataset:{slot:e.slot}},l("a",{ref:t,className:"item-picker-icon",href:"javascript:void(0)",onclick:t=>{t.preventDefault(),e.slot!=this.currentSlot&&e.openSelectorModal(this.currentTab)},dataset:{whtticon:"false"}})),i=()=>{e.item?(this.player.setWowheadData(e.item,t.value),e.item.asActionId().fill().then((e=>{e.setBackgroundAndHref(t.value)}))):t.value.style.backgroundImage=`url('${Yn(e.slot)}')`};return i(),e.onUpdate((()=>i())),Ln(t.value,{content:`Edit ${N.get(e.slot)}`,placement:"left"}),this.itemSlotTabElems.push(s),s}))))}setActiveItemSlotTab(e){this.itemSlotTabElems.forEach((t=>{t.dataset.slot===e.toString()?t.classList.add("active"):t.classList.contains("active")&&t.classList.remove("active")}))}switchToPreviousItemSlotTab(e){if("ArrowUp"===e.key&&this.gearPicker){e.preventDefault();const t=Ea(this.currentSlot-1,Object.keys(h).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}switchToNextItemSlotTab(e){if("ArrowDown"===e.key&&this.gearPicker){e.preventDefault();const t=Ea(this.currentSlot+1,Object.keys(h).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}addRandomSuffixTab(e,t){if(!e||!e.item.randomSuffixOptions.length)return;const s=e.item;this.addTab({id:xa(`${this.options.id}-Random Suffix`),label:"Random Suffix",gearData:t,itemData:this.player.getRandomSuffixes(s).map((e=>({item:e,id:e.id,actionId:C.fromRandomSuffix(s,e),name:e.name,quality:s.quality,phase:s.phase,baseEP:this.player.computeRandomSuffixEP(e),ignoreEPFilter:!0,onEquip:(e,s)=>{const i=t.getEquippedItem();i&&t.equipItem(e,i.withItem(i.item).withRandomSuffix(s))}}))),computeEP:e=>this.player.computeRandomSuffixEP(e),equippedToItemFn:e=>e?.randomSuffix,onRemove:e=>{const s=t.getEquippedItem();s&&t.equipItem(e,s.withItem(s.item).withRandomSuffix(null))}})}addTab({id:e,label:t,gearData:s,itemData:i,computeEP:a,equippedToItemFn:n,onRemove:o,setTabContent:c}){if(!i.length)return;const d=t===this.currentTab,h=r();this.tabsElem.appendChild(l("li",{className:"nav-item"},l("button",{ref:h,className:P("nav-link selector-modal-item-tab",d&&"active"),dataset:{label:t,bsToggle:"tab",bsTarget:`#${e}`},attributes:{role:"tab","aria-selected":d}}))),c?c(h.value):h.value.textContent=t;const u=new MI(e,this.contentElem,this.simUI,this.currentSlot,this.currentTab,this.player,t,s,i,a,n,o,(e=>{const t=e;e.onEquip(m.nextEventID(),t.item);const i=X.is(t.item),a=!!t.actionId.randomSuffixId;(i||a)&&(a||(this.removeTabs("Random Suffix"),this.addRandomSuffixTab(s.getEquippedItem(),s)))})),p=()=>{u.updateSelected()},g=()=>{u.applyFilters()},f=()=>{u.hideOrShowEPValues()};s.changeEvent.on(p),this.player.sim.phaseChangeEmitter.on(g),this.player.sim.filtersChangeEmitter.on(g),this.player.sim.showEPValuesChangeEmitter.on(f),this.addOnDisposeCallback((()=>{s.changeEvent.off(p),this.player.sim.phaseChangeEmitter.off(g),this.player.sim.filtersChangeEmitter.off(g),this.player.sim.showEPValuesChangeEmitter.off(f),u.dispose()})),h.value.addEventListener("click",(e=>{this.currentTab=t})),h.value.addEventListener("shown.bs.tab",(e=>{u.sizeRefresh()})),this.ilists.push(u)}removeTabs(e){const t=[...this.tabsElem.querySelectorAll(".selector-modal-item-tab")].filter((t=>t.dataset?.label?.includes(e))),s=t.map((e=>document.querySelector(e.dataset.bsTarget))).filter((e=>Boolean(e)));t.forEach((e=>e.parentElement?.remove())),s.forEach((e=>e.remove()))}}class WI extends o{constructor(e,t,s,i){super(e,"icon-picker-root"),this.rootElem.classList.add("icon-picker"),this.player=s,this.slot=i;const a=r();this.rootElem.prepend(l("a",{ref:a,className:"icon-picker-button",href:"#",attributes:{role:"button"}})),this.iconAnchor=a.value;const n=new UI(t.rootElem,t,this.player);s.sim.waitForInit().then((()=>{this.iconAnchor.addEventListener("click",(e=>{e.preventDefault(),n.openTab(this.slot,VI.Items,this.createGearData())}))})),s.itemSwapSettings.changeEmitter.on((()=>{this.update(s.itemSwapSettings.getGear().getEquippedItem(i))}))}update(e){this.iconAnchor.style.backgroundImage=`url('${Yn(this.slot)}')`,this.iconAnchor.removeAttribute("data-wowhead"),this.iconAnchor.href="#",e?(e.asActionId().fillAndSet(this.iconAnchor,!0,!0),this.player.setWowheadData(e,this.iconAnchor),this.iconAnchor.classList.add("active")):this.iconAnchor.classList.remove("active")}createGearData(){return{equipItem:(e,t)=>{this.player.itemSwapSettings.equipItem(e,this.slot,t)},getEquippedItem:()=>this.player.itemSwapSettings.getItem(this.slot),changeEvent:this.player.itemSwapSettings.changeEmitter}}}class FI{constructor(e){this.changeEmitter=new m("PlayerItemSwap"),this.enableItemSwap=!1,this.gear=new Pa({}),this.bonusStats=new Dn,this.player=e}setItemSwapSettings(e,t,s,i){this.enableItemSwap=t,this.gear=s,this.bonusStats=i||new Dn,this.changeEmitter.emit(e)}setBonusStats(e,t){this.bonusStats=t,this.changeEmitter.emit(e)}getBonusStats(){return this.bonusStats}getEnableItemSwap(){return this.enableItemSwap}setEnableItemSwap(e,t){t!=this.enableItemSwap&&(this.enableItemSwap=t,this.changeEmitter.emit(e))}equipItem(e,t,s){this.setGear(e,this.gear.withEquippedItem(t,s,this.player.canDualWield2H()))}getItem(e){return this.gear.getEquippedItem(e)}getGear(){return this.gear}setGear(e,t){t.equals(this.gear)||(this.gear=t,this.changeEmitter.emit(e))}toProto(){return Ie.create({prepullBonusStats:this.bonusStats.toProto(),items:this.gear.asArray().map((e=>e?e.asSpec():j.create()))})}}class OI extends o{constructor(e,t,s,i){super(e,"item-swap-picker-root"),this.itemSlots=i.itemSlots,new re(this.rootElem,s,{id:"enable-item-swap",reverse:!0,label:"Enable Item Swapping",labelTooltip:"Allows configuring an Item Swap Set which is used with the <b>Item Swap</b> APL action.",extraCssClasses:["input-inline"],getValue:e=>e.itemSwapSettings.getEnableItemSwap(),setValue(e,t,s){t.itemSwapSettings.setEnableItemSwap(e,s)},changedEvent:e=>e.itemSwapSettings.changeEmitter});const a=r(),n=r(),o=r(),c=d.newGroupContainer("icon-group");this.rootElem.appendChild(l(k,null,l("div",{ref:a,className:"input-root input-inline input-item-swap-container"},l("label",{className:"form-label"},"Item Swap"),l("div",{className:"d-flex"},l("button",{ref:n,className:"btn btn-link p-2"},l("i",{className:"fas fa-arrows-rotate me-1"})),c)),i.note&&l("p",{ref:o,className:"form-text"},i.note)));const h=()=>{s.itemSwapSettings.getEnableItemSwap()?(a.value?.classList.remove("hide"),o.value?.classList.remove("hide")):(a.value?.classList.add("hide"),o.value?.classList.add("hide"))};s.itemSwapSettings.changeEmitter.on(h),h(),n.value&&(n.value.addEventListener("click",(e=>this.swapWithGear(m.nextEventID(),s))),Ln(n.value,{content:"Swap with equipped items"}));const u=l(k,null);this.itemSlots.forEach((e=>{new WI(u,t,s,e)})),c.appendChild(u)}swapWithGear(e,t){let s=t.getGear(),i=t.itemSwapSettings.getGear();this.itemSlots.forEach((e=>{const a=t.getGear().getEquippedItem(e),n=t.itemSwapSettings.getGear().getEquippedItem(e);s=s.withEquippedItem(e,n,t.canDualWield2H()),i=i.withEquippedItem(e,a,t.canDualWield2H())})),m.freezeAllAndDo((()=>{t.setGear(e,s),t.itemSwapSettings.setGear(e,i)}))}}const HI=5;class qI{constructor(e,t){this.buffs=Ti.create(),this.compChangeEmitter=new m,this.buffsChangeEmitter=new m,this.sim=t,this.raid=e,this.players=[...Array(5).keys()].map((e=>null)),this.playerChangeListener=e=>this.changeEmitter.emit(e),this.changeEmitter=m.onAny([this.compChangeEmitter,this.buffsChangeEmitter],"PartyChange")}size(){return this.players.filter((e=>null!=e)).length}isEmpty(){return 0==this.size()}clear(e){this.setBuffs(e,Ti.create());for(let t=0;t<5;t++)this.setPlayer(e,t,null)}getIndex(){return this.raid.getParties().indexOf(this)}getPlayers(){return this.players.slice()}getPlayer(e){return this.players[e]}setPlayer(e,t,s){if(t<0||t>=5)throw new Error("Invalid player index: "+t);s!=this.players[t]&&m.freezeAllAndDo((()=>{const i=this.players[t];if(null!=i&&(i.changeEmitter.off(this.playerChangeListener),i.setParty(null)),null!=s){const i=s.getParty();i&&i.setPlayer(e,s.getPartyIndex(),null),this.players[t]=s,s.changeEmitter.on(this.playerChangeListener),s.setParty(this)}else this.players[t]=null;this.compChangeEmitter.emit(e)}))}getBuffs(){return Ti.clone(this.buffs)}setBuffs(e,t){Ti.equals(this.buffs,t)||(this.buffs=Ti.clone(t),this.buffsChangeEmitter.emit(e))}toProto(e,t){return ka.create({players:this.players.map((s=>null==s?Ca.create():s.toProto(e,t))),buffs:this.buffs})}fromProto(e,t){m.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||Ti.create());for(let s=0;s<5;s++){if(!t.players[s]||t.players[s].class==F.ClassUnknown){this.setPlayer(e,s,null);continue}const i=t.players[s],a=La(i),n=this.players[s];if(n&&a==n.spec)n.fromProto(e,i);else{const t=new KI(a,this.sim);t.fromProto(e,i),this.setPlayer(e,s,t)}}}))}}class BI{constructor(){this.name="",this.auras=[],this.spells=[]}getName(){return this.name}getAuras(){return this.auras.slice()}getSpells(){return this.spells.slice()}async update(e){let t=e.spells.map((e=>({data:e,id:C.fromProto(e.id)}))),s=e.auras.map((e=>({data:e,id:C.fromProto(e.id)})));await Promise.all([...t,...s].map((e=>e.id.fill().then((t=>e.id=t))))),t=t.sort(((e,t)=>Ka(e.id.name,t.id.name))),s=s.sort(((e,t)=>Ka(e.id.name,t.id.name)));let i=!1;return e.name!==this.name&&(this.name=e.name,i=!0),(t.length!==this.spells.length||t.some(((e,t)=>!e.id.equals(this.spells[t].id))))&&(this.spells=t,i=!0),(s.length!==this.auras.length||s.some(((e,t)=>!e.id.equals(this.auras[t].id))))&&(this.auras=s,i=!0),i}}class zI{constructor(){this.metadatas=[]}async update(e){const t=this.metadatas.length;if(e.length>t)for(let i=t;i<e.length;i++)this.metadatas.push(new BI);else e.length<t&&(this.metadatas=this.metadatas.slice(0,e.length));const s=await Promise.all(e.map(((e,t)=>this.metadatas[t].update(e))));return t!==this.metadatas.length||s.some((e=>e))}asList(){return this.metadatas.slice()}}const jI={};function $I(e){const t=jI[e];if(!t)throw new Error("No config registered for Spec: "+e);return t}const GI=class e{constructor(t,s){this.name="",this.buffs=be.create(),this.consumes=we.create(),this.bonusStats=new Dn,this.gear=new Ta({}),this.profession1=0,this.profession2=0,this.aplRotation=pe.create(),this.talentsString="",this.reactionTime=0,this.channelClipDelay=0,this.inFrontOfTarget=!1,this.distanceFromTarget=0,this.healingModel=fe.create(),this.healingEnabled=!1,this.isbUsingShadowflame=!0,this.isbSbFrequency=3,this.isbCrit=25,this.isbWarlocks=1,this.isbSpriests=0,this.autoRotationGenerator=null,this.simpleRotationGenerator=null,this.itemEPCache=new Array,this.randomSuffixEPCache=new Map,this.enchantEPCache=new Map,this.talents=null,this.epRatios=new Array(e.numEpRatios).fill(0),this.epWeights=new Dn,this.currentStats=Na.create(),this.metadata=new BI,this.petMetadatas=new zI,this.nameChangeEmitter=new m("PlayerName"),this.buffsChangeEmitter=new m("PlayerBuffs"),this.consumesChangeEmitter=new m("PlayerConsumes"),this.bonusStatsChangeEmitter=new m("PlayerBonusStats"),this.gearChangeEmitter=new m("PlayerGear"),this.professionChangeEmitter=new m("PlayerProfession"),this.raceChangeEmitter=new m("PlayerRace"),this.levelChangeEmitter=new m("PlayerLevel"),this.rotationChangeEmitter=new m("PlayerRotation"),this.talentsChangeEmitter=new m("PlayerTalents"),this.specOptionsChangeEmitter=new m("PlayerSpecOptions"),this.inFrontOfTargetChangeEmitter=new m("PlayerInFrontOfTarget"),this.distanceFromTargetChangeEmitter=new m("PlayerDistanceFromTarget"),this.healingModelChangeEmitter=new m("PlayerHealingModel"),this.epWeightsChangeEmitter=new m("PlayerEpWeights"),this.miscOptionsChangeEmitter=new m("PlayerMiscOptions"),this.currentStatsEmitter=new m("PlayerCurrentStats"),this.epRatiosChangeEmitter=new m("PlayerEpRatios"),this.epRefStatChangeEmitter=new m("PlayerEpRefStat"),this.sim=s,this.party=null,this.raid=null,this.spec=t,this.race=xi[this.spec][0],this.level=aa[wI[this.spec].phase],this.specTypeFunctions=O[this.spec],this.specOptions=this.specTypeFunctions.optionsCreate();const i=jI[this.spec];if(!i)throw new Error("Could not find spec config for spec: "+this.spec);this.autoRotationGenerator=i.autoRotation,i.simpleRotation?this.simpleRotationGenerator=i.simpleRotation:this.simpleRotationGenerator=null;for(let e=0;e<h.ItemSlotRanged+1;++e)this.itemEPCache[e]=new Map;this.itemSwapSettings=new FI(this),this.changeEmitter=m.onAny([this.nameChangeEmitter,this.buffsChangeEmitter,this.consumesChangeEmitter,this.bonusStatsChangeEmitter,this.gearChangeEmitter,this.professionChangeEmitter,this.raceChangeEmitter,this.levelChangeEmitter,this.rotationChangeEmitter,this.talentsChangeEmitter,this.specOptionsChangeEmitter,this.miscOptionsChangeEmitter,this.inFrontOfTargetChangeEmitter,this.distanceFromTargetChangeEmitter,this.healingModelChangeEmitter,this.epWeightsChangeEmitter,this.epRatiosChangeEmitter,this.epRefStatChangeEmitter],"PlayerChange")}getSpecIcon(){return Aa(this.spec,this.getTalentsString())}getClass(){return H[this.spec]}getClassColor(){return Ra[this.getClass()]}isSpec(e){return this.spec===e}isClass(e){return this.getClass()===e}getParty(){return this.party}getRaid(){return this.raid}getPartyIndex(){if(null===this.party)throw new Error("Can't get party index for player without a party!");return this.party.getPlayers().indexOf(this)}getRaidIndex(){if(null===this.party)throw new Error("Can't get raid index for player without a party!");return 5*this.party.getIndex()+this.getPartyIndex()}setParty(e){null===e?(this.party=null,this.raid=null):(this.party=e,this.raid=e.raid)}getOtherPartyMembers(){return null===this.party?[]:this.party.getPlayers().filter((e=>null!==e&&e!==this))}getItems(e){return this.sim.db.getItems(e).filter((t=>oe(this,t,e)))}getRandomSuffixes(e){return e.randomSuffixOptions.map((e=>this.sim.db.getRandomSuffixById(e))).filter((e=>this.computeRandomSuffixEP(e)>0||e.id>=2338&&e.id<=2343))}getEnchants(e){return this.sim.db.getEnchants(e).filter((e=>_a(e,this)))}getRunes(e){return this.sim.db.getRunes(e,this.getClass())}hasRune(e,t){return this.getEquippedItem(e)?.rune?.id===t}getEpWeights(){return this.epWeights}setEpWeights(e,t){this.epWeights=t,this.epWeightsChangeEmitter.emit(e),this.enchantEPCache=new Map,this.randomSuffixEPCache=new Map;for(let s=0;s<h.ItemSlotRanged+1;++s)this.itemEPCache[s]=new Map}getDefaultEpRatios(t,s){const i=new Array(e.numEpRatios).fill(0);return s?i[1]=1:t?(i[2]=1,i[3]=1,i[4]=0,i[5]=0):i[0]=1,i}getEpRatios(){return this.epRatios.slice()}setEpRatios(e,t){this.epRatios=t,this.epRatiosChangeEmitter.emit(e)}async computeStatWeights(e,t,s,i,a){try{const e=await this.sim.statWeights(this,t,s,i,a);return e.error?(e.error.type===se.ErrorOutcomeAborted&&new $n({variant:"info",body:"Statweight sim cancelled."}),null):e}catch(n){return console.error(n),new $n({variant:"error",body:n?.message||"Something went wrong calculating your stat weights. Reload the page and try again."}),null}}getCurrentStats(){return Na.clone(this.currentStats)}setCurrentStats(e,t){this.currentStats=t,this.currentStatsEmitter.emit(e)}getMetadata(){return this.metadata}getPetMetadatas(){return this.petMetadatas}async updateMetadata(){const e=this.metadata.update(this.currentStats.metadata),t=this.petMetadatas.update(this.currentStats.pets.map((e=>e.metadata))),s=await e,i=await t;return s||i}getName(){return this.name}setName(e,t){t!==this.name&&(this.name=t,this.nameChangeEmitter.emit(e))}getLabel(){return this.party?`${this.name} (#${this.getRaidIndex()+1})`:this.name}getRace(){return this.race}setRace(e,t){t!==this.race&&(this.race=t,this.raceChangeEmitter.emit(e))}getLevel(){return this.level}setLevel(e,t){t!==this.level&&(this.level=t,this.levelChangeEmitter.emit(e))}getProfession1(){return this.profession1}setProfession1(e,t){t!==this.profession1&&(this.profession1=t,this.professionChangeEmitter.emit(e))}getProfession2(){return this.profession2}setProfession2(e,t){t!==this.profession2&&(this.profession2=t,this.professionChangeEmitter.emit(e))}getProfessions(){return[this.profession1,this.profession2].filter((e=>e!==G.ProfessionUnknown))}setProfessions(e,t){m.freezeAllAndDo((()=>{this.setProfession1(e,t[0]||G.ProfessionUnknown),this.setProfession2(e,t[1]||G.ProfessionUnknown)}))}hasProfession(e){return this.getProfessions().includes(e)}isBlacksmithing(){return this.hasProfession(G.Blacksmithing)}getFaction(){return Da[this.getRace()]}getBuffs(){return be.clone(this.buffs)}setBuffs(e,t){be.equals(this.buffs,t)||(this.buffs=be.clone(t),this.buffsChangeEmitter.emit(e))}getConsumes(){return we.clone(this.consumes)}setConsumes(e,t){we.equals(this.consumes,t)||(this.consumes=we.clone(t),this.consumesChangeEmitter.emit(e))}canDualWield2H(){return!1}equipItem(e,t,s){this.setGear(e,this.gear.withEquippedItem(t,s,this.canDualWield2H()))}getEquippedItem(e){return this.gear.getEquippedItem(e)}getGear(){return this.gear}setGear(e,t){t.equals(this.gear)||(this.gear=t,this.gearChangeEmitter.emit(e))}getBonusStats(){return this.bonusStats}setBonusStats(e,t){t.equals(this.bonusStats)||(this.bonusStats=t,this.bonusStatsChangeEmitter.emit(e))}getMeleeCritCapInfo(){const e=(this.currentStats.finalStats?.stats[t.StatMeleeCrit]||0)/Ma,s=(this.currentStats.finalStats?.stats[t.StatMeleeHit]||0)/y,i=(this.currentStats.finalStats?.stats[t.StatExpertise]||0)/Va/4,a=void 0!==this.getGear().getEquippedItem(h.ItemSlotOffHand)?.item.weaponSpeed,n=a&&this.spec!==u.SpecWarrior?27:8,o=this.getInFrontOfTarget()?14:0,l=6.5+o,r=Math.max(n-s,0),c=Math.max(6.5-i,0)+Math.max(o-i,0);let d=0;if(this.spec===u.SpecEnhancementShaman){d=3*this.getTalents().elementalDevastation}this.sim.raid.getDebuffs();const m=64.8-r-c-d;return{meleeCrit:e,meleeHit:s,expertise:i,suppression:4.8,glancing:40,debuffCrit:0,hasOffhandWeapon:a,meleeHitCap:n,expertiseCap:l,remainingMeleeHitCap:r,remainingExpertiseCap:c,baseCritCap:m,specSpecificOffset:d,playerCritCapDelta:e-m+0}}getMeleeCritCap(){return this.getMeleeCritCapInfo().playerCritCapDelta}getSimpleRotation(){const e=this.aplRotation.simple?.specRotationJson||"";if(!e)return this.specTypeFunctions.rotationCreate();try{const t=JSON.parse(e);return this.specTypeFunctions.rotationFromJson(t)}catch(t){return console.warn(`Error parsing rotation spec options: ${t}\n\nSpec options: '${e}'`),this.specTypeFunctions.rotationCreate()}}setSimpleRotation(e,t){this.specTypeFunctions.rotationEquals(t,this.getSimpleRotation())||(this.aplRotation.simple||(this.aplRotation.simple=Ua.create()),this.aplRotation.simple.specRotationJson=JSON.stringify(this.specTypeFunctions.rotationToJson(t)),this.rotationChangeEmitter.emit(e))}getSimpleCooldowns(){return Wa.clone(this.aplRotation.simple?.cooldowns||Wa.create())}setSimpleCooldowns(e,t){Wa.equals(this.getSimpleCooldowns(),t)||(this.aplRotation.simple||(this.aplRotation.simple=Ua.create()),this.aplRotation.simple.cooldowns=t,this.rotationChangeEmitter.emit(e))}setAplRotation(e,t){pe.equals(t,this.aplRotation)||(this.aplRotation=pe.clone(t),this.rotationChangeEmitter.emit(e))}getRotationType(){return this.aplRotation.type===ue.TypeUnknown?ue.TypeAPL:this.aplRotation.type}hasSimpleRotationGenerator(){return null!==this.simpleRotationGenerator}getResolvedAplRotation(){const e=this.getRotationType();if(e===ue.TypeAuto&&this.autoRotationGenerator){const e=pe.clone(this.autoRotationGenerator(this));return e.type=ue.TypeAuto,e}if(e===ue.TypeSimple&&this.simpleRotationGenerator){const e=this.getSimpleRotation(),t=pe.clone(this.simpleRotationGenerator(this,e,this.getSimpleCooldowns()));return t.simple=this.aplRotation.simple,t.type=ue.TypeSimple,t}return this.aplRotation}getTalents(){return null===this.talents&&(this.talents=Co(this.spec,this.talentsString)),this.talents}getTalentsString(){return this.talentsString}setTalentsString(e,t){t!==this.talentsString&&(this.talentsString=t,this.talents=null,this.talentsChangeEmitter.emit(e))}getTalentTree(){return Fa(this.getTalentsString())}getTalentTreePoints(){return Oa(this.getTalentsString())}getTalentTreeIcon(){return Aa(this.spec,this.getTalentsString())}getSpecOptions(){return this.specTypeFunctions.optionsCopy(this.specOptions)}setSpecOptions(e,t){this.specTypeFunctions.optionsEquals(t,this.specOptions)||(this.specOptions=this.specTypeFunctions.optionsCopy(t),this.specOptionsChangeEmitter.emit(e))}getReactionTime(){return this.reactionTime}setReactionTime(e,t){t!==this.reactionTime&&(this.reactionTime=t,this.miscOptionsChangeEmitter.emit(e))}getChannelClipDelay(){return this.channelClipDelay}setChannelClipDelay(e,t){t!==this.channelClipDelay&&(this.channelClipDelay=t,this.miscOptionsChangeEmitter.emit(e))}getInFrontOfTarget(){return this.inFrontOfTarget}setInFrontOfTarget(e,t){t!==this.inFrontOfTarget&&(this.inFrontOfTarget=t,this.inFrontOfTargetChangeEmitter.emit(e))}getDistanceFromTarget(){return this.distanceFromTarget}setDistanceFromTarget(e,t){t!==this.distanceFromTarget&&(this.distanceFromTarget=t,this.distanceFromTargetChangeEmitter.emit(e))}setDefaultHealingParams(e){const t=this.sim.encounter.primaryTarget,s=t.dualWield;0===e.cadenceSeconds&&(e.cadenceSeconds=1.5*t.swingSpeed,s&&(e.cadenceSeconds/=2)),0===e.hps&&(e.hps=.175*t.minBaseDamage/t.swingSpeed,s&&(e.hps*=1.5))}enableHealing(){this.healingEnabled=!0;const e=this.getHealingModel();0!==e.cadenceSeconds&&0!==e.hps||(this.setDefaultHealingParams(e),this.setHealingModel(0,e))}getHealingModel(){return fe.clone(this.healingModel)}setHealingModel(e,t){fe.equals(this.healingModel,t)||(this.healingModel=fe.clone(t),this.healingEnabled&&this.setDefaultHealingParams(this.healingModel),this.healingModelChangeEmitter.emit(e))}getIsbUsingShadowflame(){return this.isbUsingShadowflame}setIsbUsingShadowflame(e,t){t!==this.isbUsingShadowflame&&(this.isbUsingShadowflame=t,this.changeEmitter.emit(e))}getIsbSbFrequency(){return this.isbSbFrequency}setIsbSbFrequency(e,t){t!==this.isbSbFrequency&&(this.isbSbFrequency=t,this.changeEmitter.emit(e))}getIsbCrit(){return this.isbCrit}setIsbCrit(e,t){t!==this.isbCrit&&(this.isbCrit=t,this.changeEmitter.emit(e))}getIsbWarlocks(){return this.isbWarlocks}setIsbWarlocks(e,t){t!==this.isbWarlocks&&(this.isbWarlocks=t,this.changeEmitter.emit(e))}getIsbSpriests(){return this.isbSpriests}setIsbSpriests(e,t){t!==this.isbSpriests&&(this.isbSpriests=t,this.changeEmitter.emit(e))}computeStatsEP(e){return void 0===e?0:e.computeEP(this.epWeights)}computeEnchantEP(e){if(this.enchantEPCache.has(e.effectId))return this.enchantEPCache.get(e.effectId);let i=this.computeStatsEP(new Dn(e.stats));return e.stats[t.StatMeleeHaste]>0&&(i+=this.epWeights.getPseudoStat(s.PseudoStatMeleeSpeedMultiplier)*e.stats[t.StatMeleeHaste],i+=this.epWeights.getPseudoStat(s.PseudoStatRangedSpeedMultiplier)*e.stats[t.StatMeleeHaste]),e.stats[t.StatSpellHaste]>0&&(i+=this.epWeights.getPseudoStat(s.PseudoStatCastSpeedMultiplier)*e.stats[t.StatSpellHaste]),this.enchantEPCache.set(e.effectId,i),i}computeRandomSuffixEP(e){if(this.randomSuffixEPCache.has(e.id))return this.randomSuffixEPCache.get(e.id);const t=this.computeStatsEP(new Dn(e.stats));return this.randomSuffixEPCache.set(e.id,t),t}computeItemEP(e,i){if(null===e)return 0;const a=this.itemEPCache[i].get(e.id);if(void 0!==a)return a;let n=new Dn(e.stats);if(e.weaponSpeed>0){const t=Ha(e);i===h.ItemSlotMainHand?n=n.withPseudoStat(s.PseudoStatMainHandDps,t):i===h.ItemSlotOffHand?n=n.withPseudoStat(s.PseudoStatOffHandDps,t):i===h.ItemSlotRanged&&(n=n.withPseudoStat(s.PseudoStatRangedDps,t))}n=n.addPseudoStat(s.PseudoStatBonusPhysicalDamage,e.bonusPhysicalDamage),e.stats[t.StatSpellHaste]>0&&(n=n.addPseudoStat(s.PseudoStatCastSpeedMultiplier,e.stats[t.StatSpellHaste]),n=n.addStat(t.StatSpellHaste,e.stats[t.StatSpellHaste]));let o=0;if(e.randomSuffixOptions.length>0){const t=e.randomSuffixOptions.map((e=>this.computeRandomSuffixEP(this.sim.db.getRandomSuffixById(e))));o=Math.max(...t)}let l=n.computeEP(this.epWeights)+o;return e.unique&&(l-=.01),e.stats[t.StatMeleeHaste]>0&&(l+=this.epWeights.getPseudoStat(s.PseudoStatMeleeSpeedMultiplier)*e.stats[t.StatMeleeHaste],l+=this.epWeights.getPseudoStat(s.PseudoStatRangedSpeedMultiplier)*e.stats[t.StatMeleeHaste]),e.stats[t.StatSpellHaste]>0&&(l+=this.epWeights.getPseudoStat(s.PseudoStatCastSpeedMultiplier)*e.stats[t.StatSpellHaste]),e.timeworn&&(l+=this.epWeights.getPseudoStat(s.PseudoStatTimewornBonus)),e.sanctified&&(l+=this.epWeights.getPseudoStat(s.PseudoStatSanctifiedBonus)),this.itemEPCache[i].set(e.id,l),l}setWowheadData(e,t){const s=[],i=Ja(),a=i?i+".":"";s.push(`domain=${a}${T}`),null!==e.enchant&&s.push("ench="+e.enchant.effectId),s.push("pcs="+this.gear.asArray().filter((e=>null!==e)).map((e=>e.item.id)).join(":")),t.dataset.wowhead=s.join("&"),t.dataset.whtticon="false"}filterItemData(t,s,i){const a=this.sim.getFilters(),n=(e,t)=>e.filter((e=>t(s(e))));if(0!==a.minIlvl&&(t=n(t,(e=>e.ilvl>=a.minIlvl))),0!==a.maxIlvl&&(t=n(t,(e=>e.ilvl<=a.maxIlvl))),a.factionRestriction!==ne.UNSPECIFIED&&(t=n(t,(e=>e.factionRestriction===a.factionRestriction||e.factionRestriction===ne.UNSPECIFIED))),a.sources.includes(oa.SourceCrafting)||(t=n(t,(e=>!e.sources.some((e=>"crafted"===e.source.oneofKind))))),a.sources.includes(oa.SourceQuest)||(t=n(t,(e=>!e.sources.some((e=>"quest"===e.source.oneofKind))))),a.sources.includes(oa.SourceReputation)||(t=n(t,(e=>!e.sources.some((e=>"rep"===e.source.oneofKind))))),!a.sources.includes(oa.SourceDungeon)){const e=[];for(const t in qa){const s=qa[t];"number"!=typeof s||0===s||a.raids.includes(s)||e.push(s)}t=n(t,(t=>!t.sources.some((t=>"drop"===t.source.oneofKind&&e.includes(t.source.drop.zoneId)))))}if(!a.sources.includes(oa.SourceRaid)){const e=[];for(const t in Ba){const s=Ba[t];"number"==typeof s&&0!==s&&e.push(s)}t=n(t,(t=>!t.sources.some((t=>"drop"===t.source.oneofKind&&e.includes(t.source.drop.zoneId)))))}for(const e in za){const s=za[e];"number"==typeof s&&0!==s&&(t=n(t,(e=>!e.sources.some((e=>"drop"===e.source.oneofKind&&e.source.drop.zoneId===s)))))}return a.sources.includes(oa.SourceWorldBOE)||(t=n(t,(e=>0===e.randomSuffixOptions.length))),e.ARMOR_SLOTS.includes(i)?t=n(t,(e=>a.armorTypes.includes(e.armorType))):e.WEAPON_SLOTS.includes(i)?t=n(t,(e=>{if(!a.weaponTypes.includes(e.weaponType))return!1;if(!a.oneHandedWeapons&&e.handType!==wi.HandTypeTwoHand)return!1;if(!a.twoHandedWeapons&&e.handType===wi.HandTypeTwoHand)return!1;const t=i===h.ItemSlotMainHand?a.minMhWeaponSpeed:a.minOhWeaponSpeed,s=i===h.ItemSlotMainHand?a.maxMhWeaponSpeed:a.maxOhWeaponSpeed;return!(t>0&&e.weaponSpeed<t)&&!(s>0&&e.weaponSpeed>s)})):i===h.ItemSlotRanged&&(t=n(t,(e=>{if(!a.rangedWeaponTypes.includes(e.rangedWeaponType))return!1;const t=a.minRangedWeaponSpeed,s=a.maxRangedWeaponSpeed;return!(t>0&&e.weaponSpeed<t)&&!(s>0&&e.weaponSpeed>s)}))),t}filterEnchantData(e,t,s,i){return i?e.filter((e=>{const s=t(e);return!!ja(s,i.item)})):e}makeUnitReference(){return null===this.party?Ks():$a(this.getRaidIndex())}toDatabase(){const e=this.getGear().toDatabase(),t=this.itemSwapSettings.getGear().toDatabase();return D.mergeSimDatabases(e,t)}toProto(e,t,s){const i=e=>!s||0===s.length||s.includes(e),a=this.getGear(),n=t?this.getResolvedAplRotation():this.aplRotation;let o=Ca.create({class:this.getClass(),database:e?void 0:this.toDatabase()});return i(ao.Gear)&&Ca.mergePartial(o,{equipment:a.asSpec(),bonusStats:this.getBonusStats().toProto(),enableItemSwap:this.itemSwapSettings.getEnableItemSwap(),itemSwap:this.itemSwapSettings.toProto()}),i(ao.Talents)&&Ca.mergePartial(o,{talentsString:this.getTalentsString()}),i(ao.Rotation)&&Ca.mergePartial(o,{cooldowns:Wa.create({hpPercentForDefensives:this.getSimpleCooldowns().hpPercentForDefensives}),rotation:n}),i(ao.Consumes)&&Ca.mergePartial(o,{consumes:this.getConsumes()}),i(ao.Miscellaneous)&&(Ca.mergePartial(o,{name:this.getName(),race:this.getRace(),level:this.getLevel(),profession1:this.getProfession1(),profession2:this.getProfession2(),reactionTimeMs:this.getReactionTime(),channelClipDelayMs:this.getChannelClipDelay(),inFrontOfTarget:this.getInFrontOfTarget(),distanceFromTarget:this.getDistanceFromTarget(),healingModel:this.getHealingModel(),isbUsingShadowflame:this.getIsbUsingShadowflame(),isbSbFrequency:this.getIsbSbFrequency(),isbCrit:this.getIsbCrit(),isbWarlocks:this.getIsbWarlocks(),isbSpriests:this.getIsbSpriests()}),o=Ga(this.spec,o,this.getSpecOptions())),i(ao.External)&&Ca.mergePartial(o,{buffs:this.getBuffs()}),o}fromProto(e,t,s){const i=e=>!s||0===s.length||s.includes(e);t.rotation?.type===ue.TypeLegacy&&(t.rotation.type=ue.TypeAuto),m.freezeAllAndDo((()=>{i(ao.Gear)&&(this.setGear(e,t.equipment?this.sim.db.lookupEquipmentSpec(t.equipment):new Ta({})),this.itemSwapSettings.setItemSwapSettings(e,t.enableItemSwap,t.itemSwap?this.sim.db.lookupItemSwap(t.itemSwap):new Pa({}),Dn.fromProto(t.itemSwap?.prepullBonusStats)),this.setBonusStats(e,Dn.fromProto(t.bonusStats||n.create()))),i(ao.Talents)&&this.setTalentsString(e,t.talentsString),i(ao.Rotation)&&(t.rotation?.type!==ue.TypeUnknown&&t.rotation?.type!==ue.TypeLegacy||(t.rotation||(t.rotation=pe.create()),t.rotation.type=ue.TypeAuto),this.setAplRotation(e,t.rotation||pe.create())),i(ao.Consumes)&&this.setConsumes(e,t.consumes||we.create()),i(ao.Miscellaneous)&&(this.setSpecOptions(e,this.specTypeFunctions.optionsFromPlayer(t)),this.setName(e,t.name),this.setLevel(e,t.level),this.setRace(e,t.race),this.setProfession1(e,t.profession1),this.setProfession2(e,t.profession2),this.setReactionTime(e,t.reactionTimeMs),this.setChannelClipDelay(e,t.channelClipDelayMs),this.setInFrontOfTarget(e,t.inFrontOfTarget),this.setDistanceFromTarget(e,t.distanceFromTarget),this.setHealingModel(e,t.healingModel||fe.create()),this.setIsbSbFrequency(e,t.isbSbFrequency),this.setIsbCrit(e,t.isbCrit),this.setIsbWarlocks(e,t.isbWarlocks),this.setIsbSpriests(e,t.isbSpriests)),i(ao.External)&&this.setBuffs(e,t.buffs||be.create())}))}clone(t){const s=new e(this.spec,this.sim);return s.fromProto(t,this.toProto()),s}applySharedDefaults(e){m.freezeAllAndDo((()=>{this.setReactionTime(e,200),this.setInFrontOfTarget(e,Fs(this.spec)),this.setHealingModel(e,fe.create({burstWindow:Fs(this.spec)?6:0})),this.setSimpleCooldowns(e,Wa.create({hpPercentForDefensives:Fs(this.spec)?.35:0})),this.setBonusStats(e,new Dn),this.setAplRotation(e,pe.create({type:ue.TypeAuto}))}))}getMatchingSpellActionId(e){const t=e.find((e=>(!e.minLevel||e.minLevel<=this.getLevel())&&(!e.maxLevel||e.maxLevel>=this.getLevel())));return t?C.fromSpellId(t.id):null}getMatchingItemActionId(e){const t=e.find((e=>(!e.minLevel||e.minLevel<=this.getLevel())&&(!e.maxLevel||e.maxLevel>=this.getLevel())));return t?C.fromItemId(t.id):null}};GI.numEpRatios=6,GI.ARMOR_SLOTS=[h.ItemSlotHead,h.ItemSlotShoulder,h.ItemSlotChest,h.ItemSlotWrist,h.ItemSlotHands,h.ItemSlotLegs,h.ItemSlotWaist,h.ItemSlotFeet],GI.WEAPON_SLOTS=[h.ItemSlotMainHand,h.ItemSlotOffHand];let KI=GI;class JI{constructor(e){this.duration=120,this.durationVariation=15,this.executeProportion20=.2,this.executeProportion25=.25,this.executeProportion35=.35,this.useHealth=!1,this.targetsChangeEmitter=new m,this.durationChangeEmitter=new m,this.executeProportionChangeEmitter=new m,this.changeEmitter=new m,this.sim=e,this.targetsMetadata=new zI,e.waitForInit().then((()=>{const t=e.raid.getPlayer(0)?.getLevel()??Os,s=JI.getPresetTargetForLevel(t,e);this.targets=[s.target],[this.targetsChangeEmitter,this.durationChangeEmitter,this.executeProportionChangeEmitter].forEach((e=>e.on((e=>this.changeEmitter.emit(e)))))}))}get primaryTarget(){return Hs.clone(this.targets[0])}getDurationVariation(){return this.durationVariation}setDurationVariation(e,t){t!=this.durationVariation&&(this.durationVariation=t,this.durationChangeEmitter.emit(e))}getDuration(){return this.duration}setDuration(e,t){t!=this.duration&&(this.duration=t,this.durationChangeEmitter.emit(e))}getExecuteProportion20(){return this.executeProportion20}setExecuteProportion20(e,t){t!=this.executeProportion20&&(this.executeProportion20=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion25(){return this.executeProportion25}setExecuteProportion25(e,t){t!=this.executeProportion25&&(this.executeProportion25=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion35(){return this.executeProportion35}setExecuteProportion35(e,t){t!=this.executeProportion35&&(this.executeProportion35=t,this.executeProportionChangeEmitter.emit(e))}getUseHealth(){return this.useHealth}setUseHealth(e,t){t!=this.useHealth&&(this.useHealth=t,this.durationChangeEmitter.emit(e),this.executeProportionChangeEmitter.emit(e))}matchesPreset(e){return e.targets.length==this.targets.length&&this.targets.every(((t,s)=>Hs.equals(t,e.targets[s].target)))}applyPreset(e,t){this.targets=t.targets.map((e=>e.target||Hs.create())),this.targetsChangeEmitter.emit(e)}applyPresetTarget(e,t,s){this.targets[s]=t.target||Hs.create(),this.targetsChangeEmitter.emit(e)}toProto(){return ge.create({duration:this.duration,durationVariation:this.durationVariation,executeProportion20:this.executeProportion20,executeProportion25:this.executeProportion25,executeProportion35:this.executeProportion35,useHealth:this.useHealth,targets:this.targets})}fromProto(e,t){m.freezeAllAndDo((()=>{this.setDuration(e,t.duration),this.setDurationVariation(e,t.durationVariation),this.setExecuteProportion20(e,t.executeProportion20),this.setExecuteProportion25(e,t.executeProportion25),this.setExecuteProportion35(e,t.executeProportion35),this.setUseHealth(e,t.useHealth),this.targets=t.targets,this.targetsChangeEmitter.emit(e)}))}applyDefaults(e){const t=this.sim.raid.getPlayer(0)?.getLevel()??Os,s=JI.getPresetTargetForLevel(t,this.sim);this.fromProto(e,ge.create({duration:120,durationVariation:15,executeProportion20:.2,executeProportion25:.25,executeProportion35:.35,targets:[s.target]}))}static getPresetTargetForLevel(e,t){const s=t.db.getAllPresetTargets();return s.find((t=>t?.target?.level&&t?.target?.level>e))??s[0]}}const ZI=8;class YI{constructor(e){this.buffs=ve.create(),this.debuffs=Se.create(),this.tanks=[],this.targetDummies=0,this.numActiveParties=5,this.compChangeEmitter=new m,this.buffsChangeEmitter=new m,this.debuffsChangeEmitter=new m,this.tanksChangeEmitter=new m,this.targetDummiesChangeEmitter=new m,this.numActivePartiesChangeEmitter=new m,this.sim=e,this.parties=[...Array(8).keys()].map((t=>{const s=new qI(this,e);return s.compChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),s.changeEmitter.on((e=>this.changeEmitter.emit(e))),s})),this.activePlayers=[],this.numActivePartiesChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),this.changeEmitter=m.onAny([this.compChangeEmitter,this.buffsChangeEmitter,this.debuffsChangeEmitter,this.tanksChangeEmitter,this.targetDummiesChangeEmitter],"RaidChange"),this.changeEmitter.on((()=>{this.activePlayers=[]}))}size(){return V(this.parties.map((e=>e.size())))}isEmpty(){return 0==this.size()}getParties(){return this.parties.slice()}getParty(e){return this.parties[e]}getPlayers(){return this.parties.map((e=>e.getPlayers())).flat()}getPlayer(e){if(-1===e)return null;return this.parties[Math.floor(e/5)].getPlayer(e%5)}getPlayerFromUnitReference(e,t){return e&&e.type!=Te.Unknown?e.type==Te.Player?this.getPlayer(e.index):e.type==Te.Self&&t||null:null}setPlayer(e,t,s){this.parties[Math.floor(t/5)].setPlayer(e,t%5,s)}getClassCount(e){return this.getPlayers().filter((t=>null!=t&&t.getClass()==e)).length}getBuffs(){return ve.clone(this.buffs)}setBuffs(e,t){ve.equals(this.buffs,t)||(this.buffs=ve.clone(t),this.buffsChangeEmitter.emit(e))}getDebuffs(){return Se.clone(this.debuffs)}setDebuffs(e,t){Se.equals(this.debuffs,t)||(this.debuffs=Se.clone(t),this.debuffsChangeEmitter.emit(e))}getTanks(){return this.tanks.map((e=>Ce.clone(e)))}setTanks(e,t){this.tanks.length==t.length&&this.tanks.every(((e,s)=>Ce.equals(e,t[s])))||(this.tanks=t.map((e=>Ce.clone(e))),this.tanksChangeEmitter.emit(e))}getTargetDummies(){return this.targetDummies}setTargetDummies(e,t){this.targetDummies!=t&&(this.targetDummies=t,this.targetDummiesChangeEmitter.emit(e))}getNumActiveParties(){return this.numActiveParties}setNumActiveParties(e,t){t!=this.numActiveParties&&t>0&&(this.numActiveParties=t,this.numActivePartiesChangeEmitter.emit(e))}getActivePlayers(){if(0==this.activePlayers.length){const e=this.getParties().filter(((e,t)=>t<this.numActiveParties));this.activePlayers=e.map((e=>e.getPlayers())).flat().filter((e=>null!=e))}return this.activePlayers}toProto(e,t){return Za.create({parties:this.parties.map((s=>s.toProto(e,t))),buffs:this.getBuffs(),debuffs:this.getDebuffs(),tanks:this.getTanks(),targetDummies:this.getTargetDummies(),numActiveParties:this.getNumActiveParties()})}fromProto(e,t){t.debuffs?.curseOfElements&&t.debuffs.curseOfElementsNew==Ya.TristateEffectMissing&&(t.debuffs.curseOfElementsNew=Ya.TristateEffectRegular,t.debuffs.curseOfElements=!1),t.debuffs?.curseOfShadow&&t.debuffs.curseOfShadowNew==Ya.TristateEffectMissing&&(t.debuffs.curseOfShadowNew=Ya.TristateEffectRegular,t.debuffs.curseOfShadow=!1),m.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||ve.create()),this.setDebuffs(e,t.debuffs||Se.create()),this.setTanks(e,t.tanks),this.setTargetDummies(e,t.targetDummies),this.setNumActiveParties(e,t.numActiveParties||5);for(let s=0;s<8;s++)t.parties[s]?this.parties[s].fromProto(e,t.parties[s]):this.parties[s].clear(e)}))}clear(e){m.freezeAllAndDo((()=>{for(let t=0;t<8;t++)this.parties[t].clear(e)}))}}class QI{constructor(e,t){this.concurrency=e,this.iterationsTotal=t,this.iterationsDone=Array(this.concurrency).fill(0),this.dpsValues=Array(this.concurrency).fill(0),this.hpsValues=Array(this.concurrency).fill(0),this.finalResults=Array(this.concurrency)}getIterationsDone(){let e=0;for(const t of this.iterationsDone)e+=t;return e}getDpsAvg(){let e=0;for(const t of this.dpsValues)e+=t;return e/this.concurrency}getHpsAvg(){let e=0;for(const t of this.hpsValues)e+=t;return e/this.concurrency}updateProgress(e,t){this.iterationsDone[e]=t.completedIterations,this.dpsValues[e]=t.dps,this.hpsValues[e]=t.hps,t.finalRaidResult&&(this.finalResults[e]=t.finalRaidResult)}makeProgressMetrics(){return an.create({totalIterations:this.iterationsTotal,completedIterations:this.getIterationsDone(),dps:this.getDpsAvg(),hps:this.getHpsAvg()})}}const XI=(e,t)=>{const s=nn.create();return"string"==typeof e?(console.error(e),s.error=Xa.create({message:e})):(e.message&&console.error(e.message),s.error=e),t(an.create({finalRaidResult:s})),s},ew=async(e,t,s,i)=>{console.log(`Sending requests split for ${t.getNumWorkers()} splits.`);const a=await t.raidSimRequestSplit(Qa.create({splitCount:t.getNumWorkers(),request:e}));if(a.errorResult)return XI(a.errorResult,s);if(i.abort.isTriggered())return XI(Xa.create({type:se.ErrorOutcomeAborted}),s);console.log(`Running ${e.simOptions.iterations} iterations on ${a.splitsDone} concurrent sims...`);const n=await((e,t,s,i,a)=>new Promise((n=>{const o=new QI(e.length,t);let l=0,r=e.length;const c=(e,t)=>{if(r&&(o.updateProgress(e,t),l++,l%r==0&&i(o.makeProgressMetrics()),t.finalRaidResult)){let s;if(r--,t.finalRaidResult.error&&(t.finalRaidResult.error.type==se.ErrorOutcomeError&&console.error(`Worker ${e} had an error!`),s=t.finalRaidResult,a.abort.trigger()),s||0==r){r=0;const e=o.makeProgressMetrics();return e.finalRaidResult=s,i(e),void n({errorResult:s,results:o.finalResults,progressMetricsFinal:e})}}};for(let t=0;t<e.length;t++)s.raidSimAsync(e[t],(e=>c(t,e)),a)})))(a.requests,e.simOptions.iterations,t,s,i);if(n.errorResult&&n.errorResult.error)return XI(n.errorResult.error,s);if(i.abort.isTriggered())return XI(Xa.create({type:se.ErrorOutcomeAborted}),s);console.log(`All ${a.splitsDone} sims finished successfully. Combining ${n.results.length} results.`);const o=await t.raidSimResultCombination(en.create({results:n.results}));return o.error?XI(o.error,s):(n.progressMetricsFinal.finalRaidResult=o,s(n.progressMetricsFinal),o)},tw=(e,t)=>{const s=nn.create();return"string"==typeof e?(console.error(e),s.error=Xa.create({message:e})):(e.message&&console.error(e.message),s.error=e),t(an.create({finalWeightResult:s})),s};var sw=(e=>(e.bulkSimAsync="bulkSimAsync",e.computeStats="computeStats",e.computeStatsJson="computeStatsJson",e.raidSim="raidSim",e.raidSimJson="raidSimJson",e.raidSimAsync="raidSimAsync",e.statWeights="statWeights",e.statWeightsAsync="statWeightsAsync",e.statWeightRequests="statWeightRequests",e.statWeightCompute="statWeightCompute",e.raidSimRequestSplit="raidSimRequestSplit",e.raidSimResultCombination="raidSimResultCombination",e.abortById="abortById",e))(sw||{});const iw=`/${In}/sim_worker.js`,aw=e=>e+"-"+Array.from(Array(4)).map((()=>Math.floor(65536*Math.random()).toString(16))).join("");class nw{constructor(e){this.workers=[],this.workersDisabled=[],this.setNumWorkers(e)}setNumWorkers(e){if(e<this.workers.length){for(let t=this.workers.length-1;t>=e;t--)this.workers[t].disable(),this.workersDisabled[t]=this.workers[t];this.workers.length=e}else for(let t=0;t<e;t++)this.workers[t]||(this.workersDisabled[t]?(this.workers[t]=this.workersDisabled[t],delete this.workersDisabled[t],this.workers[t].enable()):this.workers[t]=new ow(t))}getNumWorkers(){return this.workers.length}getLeastBusyWorker(){return this.workers.reduce(((e,t)=>e.getSimTaskWorkAmount()<t.getSimTaskWorkAmount()?e:t))}async makeApiCall(e,t){return await this.getLeastBusyWorker().doApiCall(e,t,aw(e))}async computeStats(e){const t=await this.makeApiCall(sw.computeStats,on.toBinary(e));return ln.fromBinary(t)}getProgressName(e){return`${e}progress`}async statWeightsAsync(e,t,s){const i=this.getLeastBusyWorker();i.log("Stat weights request: "+rn.toJsonString(e));const a=aw(sw.statWeightsAsync);s.abort.onTrigger((async()=>{await i.sendAbortById(a)}));const n=e.simOptions?e.simOptions.iterations*e.statsToWeigh.length:3e4,o=await this.doAsyncRequest(sw.statWeightsAsync,rn.toBinary(e),a,i,t,n);return i.log("Stat weights result: "+Ri.toJsonString(o.finalWeightResult)),o.finalWeightResult}async statWeightRequests(e){const t=await this.makeApiCall(sw.statWeightRequests,rn.toBinary(e));return cn.fromBinary(t)}async statWeightCompute(e){const t=await this.makeApiCall(sw.statWeightCompute,tn.toBinary(e));return Ri.fromBinary(t)}async bulkSimAsync(e,t,s){const i=this.getLeastBusyWorker();i.log("bulk sim request: "+dn.toJsonString(e,{enumAsInteger:!0}));const a=aw(sw.bulkSimAsync);s.abort.onTrigger((async()=>{await i.sendAbortById(a)}));const n=e.baseSettings?.simOptions?.iterations??3e4,o=await this.doAsyncRequest(sw.bulkSimAsync,dn.toBinary(e),a,i,t,n),l=mn.toJson(o.finalBulkResult);return i.log("bulk sim result: "+JSON.stringify(l)),o.finalBulkResult}async raidSimAsync(e,t,s){const i=this.getLeastBusyWorker();i.log("Raid sim request: "+hn.toJsonString(e));const a=aw(sw.raidSimAsync);s.abort.onTrigger((async()=>{await i.sendAbortById(a)}));const n=e.simOptions?.iterations??3e3,o=await this.doAsyncRequest(sw.raidSimAsync,hn.toBinary(e),a,i,t,n),l=nn.toJson(o.finalRaidResult);return delete l.logs,i.log("Raid sim result: "+JSON.stringify(l)),o.finalRaidResult}async raidSimRequestSplit(e){const t=await this.makeApiCall(sw.raidSimRequestSplit,Qa.toBinary(e));return un.fromBinary(t)}async raidSimResultCombination(e){const t=await this.makeApiCall(sw.raidSimResultCombination,en.toBinary(e));return nn.fromBinary(t)}isWasm(){return this.workers[0].isWasmWorker()}async doAsyncRequest(e,t,s,i,a,n){try{i.addSimTaskRunning(s,n),i.doApiCall(e,t,s);const o=new Promise((e=>{i.addPromiseFunc(this.getProgressName(s),this.newProgressHandler(s,i,a,(t=>e(t))),pn)}));return await o}finally{i.updateSimTask(s,0)}}newProgressHandler(e,t,s,i){return a=>{const n=an.fromBinary(a);s(n),t.updateSimTask(e,Math.max(1,n.totalIterations-n.completedIterations)),null==n.finalRaidResult&&null==n.finalWeightResult&&null==n.finalBulkResult?t.addPromiseFunc(this.getProgressName(e),this.newProgressHandler(e,t,s,i),pn):i(n)}}}class ow{constructor(e){this.workerId=e,this.simTasksRunning={},this.taskIdsToPromiseFuncs={},this.wasmWorker=!1,this.shouldDestroy=!1,this.onReady=new Promise(((e,t)=>{this.resolveReady=e})),this.setupWorker(),this.log("Created.")}setupWorker(){this.setTaskActive("setup",!0),this.onReady=new Promise(((e,t)=>{this.resolveReady=e})),this.worker=new window.Worker(iw),this.worker.addEventListener("message",(({data:e})=>{const{id:t,msg:s,outputData:i}=e;switch(s){case"ready":this.wasmWorker=!!i&&!!i[0],this.postMessage({msg:"setID",id:this.workerId.toString()}),this.resolveReady(),this.setTaskActive("setup",!1),this.log(`Ready, isWasm: ${this.wasmWorker}`);break;case"idConfirm":break;default:const e=this.taskIdsToPromiseFuncs[t];if(!e)return void console.warn(`Unrecognized result id ${t} for msg ${s}`);t.includes("progress")||this.setTaskActive(t,!1),delete this.taskIdsToPromiseFuncs[t],e[0](i)}}))}addSimTaskRunning(e,t){this.simTasksRunning[e]={workLeft:t},this.log(`Added work ${e}, current work amount: ${this.getSimTaskWorkAmount()}`)}updateSimTask(e,t){if(t<=0)return delete this.simTasksRunning[e],this.log(`Work ${e} done, current work amount: ${this.getSimTaskWorkAmount()}`),void(this.shouldDestroy&&0==this.getSimTaskWorkAmount()&&this.disable(!0));this.simTasksRunning[e].workLeft=t}getSimTaskWorkAmount(){let e=0;for(const t of Object.values(this.simTasksRunning))e+=t.workLeft;return e}hasTaskId(e){return!!this.simTasksRunning[e]}setTaskActive(e,t){t?this.addSimTaskRunning(e+"task",1):this.updateSimTask(e+"task",0)}async isWasmWorker(){if(!this.onReady||this.shouldDestroy)throw new Error("Disabled worker was used!");return await this.onReady,this.wasmWorker}addPromiseFunc(e,t,s){this.taskIdsToPromiseFuncs[e]=[t,s]}async doApiCall(e,t,s){if(!this.onReady||this.shouldDestroy)throw new Error("Disabled worker was used!");if(!s)throw new Error("ApiCall with empty id!");this.setTaskActive(s,!0),await this.onReady;const i=new Promise(((i,a)=>{this.taskIdsToPromiseFuncs[s]=[i,a],this.postMessage({msg:e,id:s,inputData:t})}));return await i}postMessage(e){if(!this.worker)throw new Error(`Worker ${this.workerId} postMessage while disabled!`);this.worker.postMessage(e)}disable(e=!1){this.shouldDestroy=!0,!this.worker||!e&&this.getSimTaskWorkAmount()||(this.worker.terminate(),delete this.worker,delete this.onReady,delete this.resolveReady,this.log("Disabled."))}enable(){this.shouldDestroy=!1,this.worker||(this.setupWorker(),this.log("Enabled."))}log(e){console.log(`Worker ${this.workerId}: ${e}`)}async sendAbortById(e){const t=gn.toBinary(gn.create({requestId:e})),s=aw(sw.abortById),i=await this.doApiCall(sw.abortById,t,s);return fn.fromBinary(i)}}const lw="sod_wasmconcurrency",rw=class e{constructor(){this.iterations=3e3,this.phase=wn,this.faction=js.Alliance,this.fixedRngSeed=0,this.filters=e.defaultFilters(),this.showDamageMetrics=!0,this.showThreatMetrics=!1,this.showHealingMetrics=!1,this.showExperimental=!1,this.wasmConcurrency=0,this.showEPValues=!1,this.language="",this.db_=null,this.iterationsChangeEmitter=new m,this.phaseChangeEmitter=new m,this.factionChangeEmitter=new m,this.fixedRngSeedChangeEmitter=new m,this.lastUsedRngSeedChangeEmitter=new m,this.filtersChangeEmitter=new m,this.showDamageMetricsChangeEmitter=new m,this.showThreatMetricsChangeEmitter=new m,this.showHealingMetricsChangeEmitter=new m,this.showExperimentalChangeEmitter=new m,this.wasmConcurrencyChangeEmitter=new m,this.showEPValuesChangeEmitter=new m,this.languageChangeEmitter=new m,this.crashEmitter=new m,this.unitMetadataEmitter=new m("UnitMetadata"),this.simResultEmitter=new m,this.bulkSimStartEmitter=new m,this.bulkSimResultEmitter=new m,this.lastUsedRngSeed=0,this.modifyRaidProto=pn,this.workerPool=new nw(1),this.wasmConcurrencyChangeEmitter.on((async()=>{if(await this.workerPool.isWasm()){const e=Math.max(1,Math.min(this.wasmConcurrency,navigator.hardwareConcurrency));this.workerPool.setNumWorkers(e)}}));let t=parseInt(window.localStorage.getItem(lw)??"NaN");isNaN(t)&&(t=0,navigator.hardwareConcurrency>1&&(t=Math.min(4,Math.floor(navigator.hardwareConcurrency/2)))),this.setWasmConcurrency(m.nextEventID(),t),this.signalManager=new vn,this._initPromise=D.get().then((e=>{this.db_=e})),this.raid=new YI(this),this.encounter=new JI(this),this.settingsChangeEmitter=m.onAny([this.iterationsChangeEmitter,this.phaseChangeEmitter,this.fixedRngSeedChangeEmitter,this.filtersChangeEmitter,this.showDamageMetricsChangeEmitter,this.showThreatMetricsChangeEmitter,this.showHealingMetricsChangeEmitter,this.showExperimentalChangeEmitter,this.showEPValuesChangeEmitter,this.languageChangeEmitter]),this.changeEmitter=m.onAny([this.settingsChangeEmitter,this.raid.changeEmitter,this.encounter.changeEmitter]),m.onAny([this.raid.changeEmitter,this.encounter.changeEmitter]).on((e=>this.updateCharacterStats(e)))}waitForInit(){return this._initPromise}isWasm(){return this.workerPool.isWasm()}async shouldUseWasmConcurrency(){return await this.isWasm()&&this.getWasmConcurrency()>=2&&this.workerPool.getNumWorkers()>=2}get db(){return this.db_}setModifyRaidProto(e){this.modifyRaidProto=e}getModifiedRaidProto(){const e=this.raid.toProto(!1,!0);return this.modifyRaidProto(e),e.parties.forEach((e=>{e.players.forEach((e=>{e.equipment&&this.db.lookupEquipmentSpec(e.equipment)}))})),e}makeRaidSimRequest(e){const t=this.getModifiedRaidProto(),s=this.encounter.toProto();return hn.create({raid:t,encounter:s,simOptions:bn.create({iterations:e?1:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debugFirstIteration:!0})})}async runBulkSim(e,t,s){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const i=dn.create({baseSettings:this.makeRaidSimRequest(!1),bulkSettings:e});if(null!=i.baseSettings&&null!=i.baseSettings.simOptions&&(i.baseSettings.simOptions.debugFirstIteration=!1),!i.baseSettings?.raid||0==i.baseSettings?.raid?.parties.length||0==i.baseSettings?.raid?.parties[0].players.length)throw new Error("Raid must contain exactly 1 player for bulk sim.");const a=i.baseSettings.raid.parties[0].players[0].database;a?.items.push(...t.items),a?.enchants.push(...t.enchants),this.bulkSimStartEmitter.emit(m.nextEventID(),i);const n=this.signalManager.registerRunning(ae.BulkSim);try{const e=await this.workerPool.bulkSimAsync(i,s,n);if(e.error){if(e.error.type!=se.ErrorOutcomeError)return e;throw new dw(e.error.message)}return this.bulkSimResultEmitter.emit(m.nextEventID(),e),e}catch(o){if(o instanceof dw)throw o;throw console.log(o),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(n)}}async runRaidSim(e,t){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const s=this.signalManager.registerRunning(ae.RaidSim);try{await this.waitForInit();const i=this.makeRaidSimRequest(!1);let a;if(a=await this.shouldUseWasmConcurrency()?await ew(i,this.workerPool,t,s):await this.workerPool.raidSimAsync(i,t,s),a.error){if(a.error.type!=se.ErrorOutcomeError)return a.error;throw new dw(a.error.message)}const n=await Gi.makeNew(i,a);return this.simResultEmitter.emit(e,n),n}catch(i){if(i instanceof dw)throw i;throw console.error(i),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(s)}}async runRaidSimWithLogs(e){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");const t=this.signalManager.registerRunning(ae.RaidSim);try{await this.waitForInit();const s=this.makeRaidSimRequest(!0),i=await this.workerPool.raidSimAsync(s,pn,t);if(i.error)throw new dw(i.error.message);const a=await Gi.makeNew(s,i);return this.simResultEmitter.emit(e,a),a}catch(s){if(s instanceof dw)throw s;throw console.error(s),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(t)}}async updateCharacterStats(e){if(0==e)return;e=m.nextEventID(),await this.waitForInit();const t=this.raid.getPlayers(),s=on.create({raid:this.getModifiedRaidProto(),encounter:this.encounter.toProto()}),i=await this.workerPool.computeStats(s);""==i.errorResult?m.freezeAllAndDo((async()=>{const s=i.raidStats.parties.map(((s,i)=>s.players.map(((s,a)=>{const n=t[5*i+a];return n?(n.setCurrentStats(e,s),n.updateMetadata()):null})))).flat().filter((e=>null!=e)),a=this.encounter.targetsMetadata.update(i.encounterStats.targets.map((e=>e.metadata)));(await Promise.all(s.concat([a]))).some((e=>e))&&this.unitMetadataEmitter.emit(e)})):this.crashEmitter.emit(e,new dw(i.errorResult))}async statWeights(e,t,s,i,a){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");if(await this.waitForInit(),null==e.getParty())return console.warn("Trying to get stat weights without a party!"),Ri.create();{const o=this.raid.getTanks().map((e=>e.index)).includes(e.getRaidIndex())?[Ce.create({type:Te.Player,index:0})]:[],l=rn.create({player:e.toProto(!1,!0),raidBuffs:this.raid.getBuffs(),partyBuffs:e.getParty().getBuffs(),debuffs:this.raid.getDebuffs(),encounter:this.encounter.toProto(),simOptions:bn.create({iterations:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debug:!1}),tanks:o,statsToWeigh:t,pseudoStatsToWeigh:s,epReferenceStat:i}),r=this.signalManager.registerRunning(ae.StatWeights);try{let e;if(e=await this.shouldUseWasmConcurrency()?await(async(e,t,s,i)=>{console.log("Getting stat weight sim requests.");const a=await t.statWeightRequests(e);if(i.abort.isTriggered())return tw(Xa.create({type:se.ErrorOutcomeAborted}),s);let n=a.baseRequest.simOptions.iterations,o=0,l=1,r=0;for(const p of a.statSimRequests)n+=p.requestLow.simOptions.iterations+p.requestHigh.simOptions.iterations,l+=2;console.log(`Need to run a total of ${l} sims and ${n} iterations.`);let c=0;const d=e=>{o+=e.completedIterations-c,c=e.completedIterations,s(an.create({totalIterations:n,completedIterations:o,totalSims:l,completedSims:r})),e.finalRaidResult&&r++},m=await ew(a.baseRequest,t,d,i);if(m.error)return tw(m.error,s);const h=tn.create({baseResult:m,epReferenceStat:a.epReferenceStat,statSimResults:[]});for(const p of a.statSimRequests){if(i.abort.isTriggered())return tw(Xa.create({type:se.ErrorOutcomeAborted}),s);c=0;const e=await ew(p.requestLow,t,d,i);if(e.error)return tw(e.error,s);c=0;const a=await ew(p.requestHigh,t,d,i);if(a.error)return tw(a.error,s);h.statSimResults.push(sn.create({statData:p.statData,resultLow:e,resultHigh:a}))}console.log(`All ${l} sims finished successfully. Computing weights.`);const u=await t.statWeightCompute(h);return u.error?tw(u.error,s):(s(an.create({finalWeightResult:u})),u)})(l,this.workerPool,a,r):await this.workerPool.statWeightsAsync(l,a,r),e.error){if(e.error.type!=se.ErrorOutcomeError)return e;throw new dw(e.error.message)}return e}catch(n){if(n instanceof dw)throw n;throw console.error(n),new Error("Something went wrong calculating your stat weights. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(r)}}}getUnitMetadata(e,t,s){if(!e||e.type==Te.Unknown)return this.getUnitMetadata(s,t,s);if(e.type==Te.Player)return this.raid.getPlayerFromUnitReference(e)?.getMetadata();if(e.type==Te.Target)return this.encounter.targetsMetadata.asList()[e.index];if(e.type==Te.Pet){const s=this.raid.getPlayerFromUnitReference(e.owner,t);return s?s.getPetMetadatas().asList()[e.index]:void 0}return e.type==Te.Self?t?.getMetadata():e.type==Te.CurrentTarget?this.encounter.targetsMetadata.asList()[0]:void 0}getPhase(){return this.phase}setPhase(e,t){t!=this.phase&&t>0&&(this.phase=t,this.phaseChangeEmitter.emit(e))}getFaction(){return this.faction}setFaction(e,t){t!=this.faction&&t&&(this.faction=t,this.factionChangeEmitter.emit(e))}getFixedRngSeed(){return this.fixedRngSeed}setFixedRngSeed(e,t){t!=this.fixedRngSeed&&(this.fixedRngSeed=t,this.fixedRngSeedChangeEmitter.emit(e))}nextRngSeed(){let t=0;return t=this.fixedRngSeed?this.fixedRngSeed:Math.floor(Math.random()*e.MAX_RNG_SEED),this.lastUsedRngSeed=t,this.lastUsedRngSeedChangeEmitter.emit(m.nextEventID()),t}getLastUsedRngSeed(){return this.lastUsedRngSeed}getFilters(){return Sn.clone(this.filters)}setFilters(e,t){Sn.equals(t,this.filters)||(this.filters=Sn.clone(t),this.filtersChangeEmitter.emit(e))}getShowDamageMetrics(){return this.showDamageMetrics}setShowDamageMetrics(e,t){t!=this.showDamageMetrics&&(this.showDamageMetrics=t,this.showDamageMetricsChangeEmitter.emit(e))}getShowThreatMetrics(){return this.showThreatMetrics}setShowThreatMetrics(e,t){t!=this.showThreatMetrics&&(this.showThreatMetrics=t,this.showThreatMetricsChangeEmitter.emit(e))}getShowHealingMetrics(){return this.showHealingMetrics}setShowHealingMetrics(e,t){t!=this.showHealingMetrics&&(this.showHealingMetrics=t,this.showHealingMetricsChangeEmitter.emit(e))}getShowExperimental(){return this.showExperimental}setShowExperimental(e,t){t!=this.showExperimental&&(this.showExperimental=t,this.showExperimentalChangeEmitter.emit(e))}getWasmConcurrency(){return this.wasmConcurrency}setWasmConcurrency(e,t){t!=this.wasmConcurrency&&(this.wasmConcurrency=t,window.localStorage.setItem(lw,t.toString()),this.wasmConcurrencyChangeEmitter.emit(e))}getShowEPValues(){return this.showEPValues}setShowEPValues(e,t){t!=this.showEPValues&&(this.showEPValues=t,this.showEPValuesChangeEmitter.emit(e))}getLanguage(){return this.language}setLanguage(e,t){(t=t||xn())!=this.language&&(this.language=t,yn(this.language),this.languageChangeEmitter.emit(e))}getIterations(){return this.iterations}setIterations(e,t){t!=this.iterations&&(this.iterations=t,this.iterationsChangeEmitter.emit(e))}toProto(){const t=this.getFilters();return t.armorTypes.length==e.ALL_ARMOR_TYPES.length&&(t.armorTypes=[]),t.weaponTypes.length==e.ALL_WEAPON_TYPES.length&&(t.weaponTypes=[]),t.rangedWeaponTypes.length==e.ALL_RANGED_WEAPON_TYPES.length&&(t.rangedWeaponTypes=[]),t.sources.length==e.ALL_SOURCES.length&&(t.sources=[]),t.raids.length==e.ALL_RAIDS.length&&(t.raids=[]),En.create({iterations:this.getIterations(),phase:this.getPhase(),fixedRngSeed:BigInt(this.getFixedRngSeed()),showDamageMetrics:this.getShowDamageMetrics(),showThreatMetrics:this.getShowThreatMetrics(),showHealingMetrics:this.getShowHealingMetrics(),showExperimental:this.getShowExperimental(),showEpValues:this.getShowEPValues(),language:this.getLanguage(),faction:this.getFaction(),filters:t})}fromProto(t,s){m.freezeAllAndDo((()=>{this.setIterations(t,s.iterations||3e3),this.setPhase(t,s.phase||wn),this.setFixedRngSeed(t,Number(s.fixedRngSeed)),this.setShowDamageMetrics(t,s.showDamageMetrics),this.setShowThreatMetrics(t,s.showThreatMetrics),this.setShowHealingMetrics(t,s.showHealingMetrics),this.setShowExperimental(t,s.showExperimental),this.setShowEPValues(t,s.showEpValues),this.setLanguage(t,s.language),this.setFaction(t,s.faction||js.Alliance);const i=s.filters||e.defaultFilters();0==i.armorTypes.length&&(i.armorTypes=e.ALL_ARMOR_TYPES.slice()),0==i.weaponTypes.length&&(i.weaponTypes=e.ALL_WEAPON_TYPES.slice()),0==i.rangedWeaponTypes.length&&(i.rangedWeaponTypes=e.ALL_RANGED_WEAPON_TYPES.slice()),0==i.sources.length&&(i.sources=e.ALL_SOURCES.slice()),0==i.raids.length&&(i.raids=e.ALL_RAIDS.slice()),this.setFilters(t,i)}))}applyDefaults(t,s,i){this.fromProto(t,En.create({iterations:3e3,phase:wn,faction:js.Alliance,showDamageMetrics:!i,showThreatMetrics:s,showHealingMetrics:i,language:this.getLanguage(),filters:e.defaultFilters(),showEpValues:!1}))}static defaultFilters(){return Sn.create({oneHandedWeapons:!0,twoHandedWeapons:!0})}};rw.MAX_RNG_SEED=Math.pow(2,32)-1,rw.ALL_ARMOR_TYPES=e(ca).filter((e=>0!=e)),rw.ALL_WEAPON_TYPES=e(p).filter((e=>0!=e)),rw.ALL_RANGED_WEAPON_TYPES=e(Pn).filter((e=>0!=e)),rw.ALL_SOURCES=e(oa).filter((e=>0!=e)),rw.ALL_RAIDS=e(Ba).filter((e=>0!=e));let cw=rw;class dw extends Error{constructor(e){super(e),this.errorStr=e}}function mw(e,t,s){return function(e,t,s){const i=[];null!=s.talentTree&&i.push((e=>e.getTalentTree()==s.talentTree));null!=s.talentTrees&&i.push((e=>(s.talentTrees||[]).includes(e.getTalentTree())));null!=s.faction&&i.push((e=>e.getFaction()==s.faction));null!=s.customCondition&&i.push(s.customCondition);return{name:e,tooltip:s.tooltip||kn,gear:t,enableWhen:i.length>0?e=>i.every((t=>t(e))):void 0,onLoad:s?.onLoad}}(e,M.fromJson(t),s||{})}function hw(e,t,s){const i=[];return s&&s.customCondition&&i.push(s.customCondition),{name:e,data:t,enableWhen:i.length>0?e=>i.every((t=>t(e))):void 0}}function uw(e,t,s){return gw(e,Ws.create({rotation:pe.fromJson(t)}),s)}function pw(e,t,s,i){return gw(e,Ws.create({rotation:{type:ue.TypeSimple,simple:{specRotationJson:JSON.stringify(O[t].rotationToJson(s))}}}),i)}function gw(e,t,s){const i=[];return null!=s?.talentTree&&i.push((e=>e.getTalentTree()==s.talentTree)),null!=s?.customCondition&&i.push(s.customCondition),{name:e,rotation:t,enableWhen:i.length>0?e=>i.every((t=>t(e))):void 0,onLoad:s?.onLoad}}const fw=(e,t,s)=>{let i,a;if("string"==typeof t){const e=zc.tryParseUrlLocation(new URL(t)),s=e?.settings;t=s?.encounter,i=s?.player?.healingModel,a=s?.tanks}return{name:e,encounter:t,tanks:a,healingModel:i,...s}},Iw=(e,{gear:t,talents:s,rotation:i,epWeights:a,encounter:n,settings:o})=>({name:e,gear:t,talents:s,rotation:i,epWeights:a,encounter:n,settings:o}),ww=(e,t,s,i)=>{const a=K.fromJson(s),n={};a.player&&(a.player.equipment&&(n.gear=mw(e,a.player.equipment,i)),a.player?.talentsString&&(n.talents=hw(e,le.create({talentsString:a.player.talentsString}),i)),a.player?.rotation&&a.player?.rotation.type===ue.TypeAPL&&(n.rotation=gw(e,Ws.create({rotation:a.player.rotation}),i))),a.encounter&&(n.encounter=fw(e,a.encounter,i));const o=((e,t,s)=>{const i={name:e};return s.player?.level&&(i.level=s.player.level),s.player?.race&&(i.race=s.player.race),s.player&&(i.specOptions=O[t].optionsFromPlayer(s.player),s.player.buffs&&(i.buffs=s.player.buffs),s.player.consumes&&(i.consumes=s.player.consumes),i.playerOptions={distanceFromTarget:s.player.distanceFromTarget,enableItemSwap:s.player.enableItemSwap},s.player.profession1!==G.ProfessionUnknown&&(i.playerOptions.profession1=s.player.profession1),s.player.profession2!==G.ProfessionUnknown&&(i.playerOptions.profession2=s.player.profession2),s.player.itemSwap&&(i.playerOptions.itemSwap=s.player.itemSwap)),s.raidBuffs&&(i.raidBuffs=s.raidBuffs),s.partyBuffs&&(i.partyBuffs=s.partyBuffs),s.debuffs&&(i.debuffs=s.debuffs),i})(e,t,a);return Object.keys(o).length>1&&(n.settings=o),a.epWeightsStats&&(n.epWeights=((e,t,s)=>{const i=[];return void 0!==s?.customCondition&&i.push(s.customCondition),{name:e,epWeights:t,enableWhen:i.length?e=>i.every((t=>t(e))):void 0,onLoad:s?.onLoad}})(e,Dn.fromProto(a.epWeightsStats),i)),Iw(e,n)};export{Iu as $,pg as A,Vn as B,qn as C,uu as D,Gc as E,Pf as F,wd as G,Zm as H,oo as I,$m as J,Gm as K,Bm as L,ZI as M,hu as N,gd as O,KI as P,hd as Q,du as R,cw as S,gu as T,fd as U,ud as V,pw as W,qm as X,jh as Y,Ym as Z,fu as _,JI as a,wu as a0,vu as a1,Su as a2,bu as a3,xd as a4,Cd as a5,vd as a6,ww as a7,Yg as a8,Qg as a9,Xg as aa,$h as ab,oh as ac,Um as ad,fw as ae,Hh as af,mu as ag,Th as ah,Nh as ai,Ah as aj,Fm as ak,Om as al,zm as am,Hm as an,Jm as ao,dh as ap,Qh as aq,Xh as ar,eu as as,od as b,HI as c,jn as d,sd as e,cd as f,$I as g,xm as h,rd as i,PI as j,uw as k,hw as l,mw as m,Iw as n,CI as o,Bc as p,Dn as q,II as r,Uh as s,Wh as t,Fh as u,bg as v,Cf as w,Tf as x,TI as y,Dh as z};
